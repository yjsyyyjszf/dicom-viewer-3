{"version":3,"sources":["fs/fs.js","functions.js","constants/settings.js","actions/index.js","components/Dicomdir.js","constants/uids.js","components/OpenUrlDlg.js","components/CinePlayer.js","db/db.js","components/DicomViewer.js","components/DicomViewerForList.js","components/DicomHeader.js","components/MeasureItem.js","components/Measurements.js","components/Settings.js","components/AboutDlg.js","components/Histogram.js","components/LayoutTool.js","components/OpenMultipleFilesDlg.js","components/FsUI.js","components/DownloadZipDlg.js","components/SeriesItem.js","App.js","serviceWorker.js","store/index.js","reducers/index.js","index.js"],"names":["fs","Dexie","version","stores","files","open","capitalize","str","undefined","charAt","toUpperCase","slice","isInputDirSupported","tmpInput","document","createElement","isUrlImage","url","match","isFileImage","file","includes","isFsFileImage","fsItem","console","log","type","toLowerCase","getFileNameCorrect","filename","isAndroid","isFirefox","getFileExt","getFileName","ext","exec","getFileExtReal","name","replace","getSettingsSaveInto","saveInto","localStorage","getItem","setItem","getSettingsOverlay","overlay","getSettingsFsView","view","isMobile","isTablet","getSettingsDicomdirView","getSettingsMprInterpolation","method","toCsvValue","theValue","t","String","fsFileStore","fsFile","filesStore","dcmIsOpen","value","dcmTool","tool","activeDcm","dcm","activeMeasurements","measurements","setZippedFile","fsZippedFile","ExpandIcon","expanded","Dicomdir","props","state","data","buildData","id","output","images","series","study","patient","reverse","forEach","obj","i","key","unshift","path","number","children","setState","buildOutput","dataset","elements","x00041220","items","e","index","toString","dataSet","string","push","split","pop","openDicomdir","reader","FileReader","onload","arrayBuffer","result","byteArray","Uint8Array","dicomParser","err","readAsArrayBuffer","openDicomdirFs","onClick","find","x","dicomdir","origin","onOpenFile","components","fsCurrentDir","parent","join","where","first","item","setFsFileStore","onOpenFs","this","classes","styleComponent","marginTop","height","width","style","List","map","ListItem","button","ListItemText","primary","secondary","listItemText","Collapse","in","dense","className","PureComponent","connect","dispatch","withStyles","theme","paddingLeft","spacing","fontSize","uids","OpenUrlDlg","hide","onClose","cancel","window","stop","Dialog","aria-labelledby","DialogTitle","DialogContent","LinearProgress","variant","progress","color","DialogActions","Button","CinePlayer","firstframe","runCinePlayer","previousframe","play","pause","nextframe","lastframe","inPlay","IconButton","mdiPause","size","mdiPlay","margin","mdiSkipBackward","mdiSkipPrevious","mdiSkipNext","mdiSkipForward","db","measurement","scrollToIndex","csTools","cornerstoneTools","cornerstone","cornerstoneMath","cornerstoneFileImageLoader","cornerstoneWebImageLoader","cornerstoneWADOImageLoader","Hammer","DicomViewer","visibleOpenUrlDlg","visibleCinePlayer","errorOnOpenImage","errorOnCors","frame","viewport","onOpenUrl","eventData","detail","percentComplete","showOpenUrlDlg","addEventListener","loadImage","hideOpenUrlDlg","measurementSave","measure","measurementClear","splice","length","measurementRemove","getTransferSyntax","image","getSopClass","getSopInstanceUID","getPixelRepresentation","uint16","getPlanarConfiguration","onImageLoaded","onImageRendered","target","getElementById","textContent","mprIsOrthogonalView","mprPlane","PatientsName","displayedArea","brhc","y","Math","round","voi","windowWidth","windowCenter","scale","toFixed","isDicom","numberOfFrames","onMeasurementModified","onMeasurementAdded","note","measurementData","setActiveMeasurements","onMeasurementCompleted","setTimeout","onErrorOpenImageClose","onErrorCorsClose","displayImageFromFilesByImage","element","dicomImage","displayImageFromFilesMohammad","_files","imageIds","fileManager","add","stack","currentImageIdIndex","onNewImage","StackScrollMouseWheelTool","then","mprPlanePosition","setActiveDcm","setIsOpenStore","enableTool","displayImageFromFiles","imageId","sopInstanceUid","equals","each","runTool","loadImageFromCanvas","canvas","addCanvas","loadImageFromCustomObject","columns","rows","pixelData","customObj","originImage","addCustom","localfile","localurl","isOpenStore","addBuffer","intString","error","pos","indexOf","substring","toolName","mouseButtonNumber","WwwcTool","LengthTool","PanTool","ZoomTouchPinchTool","ZoomTool","ProbeTool","EllipticalRoiTool","RectangleRoiTool","FreehandRoiTool","AngleTool","MagnifyTool","disableAllTools","runTool2","opt","mouseButtonMask","isTouchActive","invert","getElementsByClassName","activeDcmIndex","zoom","cols","myCanvas","cropCanvas","a","href","toDataURL","download","body","appendChild","click","blobUtil","blob","newName","counter","done","fsCurrentList","transaction","async","byteLength","makeFsRefresh","reset","delete","sopinstanceuid","newCanvas","getContext","drawImage","changeTool","cmdName","defaultViewport","imageOrientation","v","Array","fill","parseFloat","p","abs","transpose","matrix","Object","keys","colNumber","rowNumber","mprRenderYZPlane","mprData","volume","xSize","ySize","zSize","zDim","xoffset","floor","plane","Int16Array","z","yzPlane","mprBuildYZPlane","mprRenderXZPlane","trunc","xzPlane","mprBuildXZPlane","layout","dicomImageRef","el","onImageClick","dcmRef","previousProps","isOpen","styleContainer","border","position","DialogContentText","autoFocus","aria-describedby","Typography","gutterBottom","Link","textShadow","onContextMenu","ref","top","left","display","right","bottom","marginLeft","marginRight","textAlign","backgroundColor","React","Component","lut","clearingStore","toolStore","DicomViewerForList","DicomHeader","dcmViewer","header","minPixelValue","maxPixelValue","listItems","Toolbar","title","grow","exportAs","fileData","objArray","cDelimiter","l","row","n","nl","names","sDelimiter","hasOwnProperty","toCsv","reduce","o","JSON","stringify","Blob","URL","createObjectURL","mdiContentSaveOutline","component","MeasureItem","visibleDlgNote","visibleDlgDelete","showDlgNote","hideDlgNote","showDlgDelete","hideDlgDelete","handleOnChangeNote","event","confirmNote","noteField","confirmDelete","toolRemove","onEdit","onDelete","createRef","pText","sText","unit","rAngle","cachedStats","area","mean","stdDev","meanStdDev","edge","TextField","fullWidth","defaultValue","inputRef","input","Measurements","visibleClearMeasureDlg","showClearMeasureDlg","hideClearMeasureDlg","confirmClearMeasureDlg","dicomViewersRefs","useStyles","makeStyles","appBar","formControl","formLabel","radioControl","flex","Settings","saveAs","getSettingsSaveAs","getSettingsDcmHeader","fsView","dicomdirView","mprInterpolation","useState","fullScreen","AppBar","elevation","aria-label","FormControl","FormControlLabel","control","Checkbox","checked","onChange","label","FormLabel","RadioGroup","Radio","AboutDlg","linkRepository","packageJson","disableTypography","padding","styleSlider","styleCanvasGradient","styleTable","borderCollapse","fontFamily","styleTableTd","tableLayout","Histogram","activeDrags","deltaPosition","controlledPosition","histCount","valueScale","minHist","maxHist","handleChangeValue","newValue","binSize","hist256","onDrag","ui","deltaX","deltaY","onStart","onStop","canvasHistogram","canvasGradient","canvasH","current","ctxH","translate","updateCanvas","clearRect","evt","rect","getBoundingClientRect","clientX","clientY","getPixelData","storedPixelData","spIndex","column","red","green","blue","alpha","getRGBPixelsImage","getPixelsImage","intercept","lenHist","zero256","stepWW","stepWC","m","hist","mo","getPixel","slope","s","pow","sqrt","max","binStep","iHist","j","step","mousePos","getMousePos","beginPath","fillStyle","fillRect","strokeStyle","h","moveTo","lineTo","stroke","lineWidth","lowX","highX","ctxG","grd","createLinearGradient","addColorStop","cursor","Slider","min","LayoutTool","initTable","col","tableRef","cells","bgColor","cellClick","parentNode","rowIndex","cellIndex","renderTable","OpenMultipleFilesDlg","getInstanceNumber","getSliceLocation","getRows","getColumns","getSliceDistance","ipp","topLeftCorner","iop","dist","close","count","nextProgress","t0","performance","now","setFilesStore","instanceNumber","sliceDistance","sliceLocation","sort","r","t1","FsUI","textFieldLabel","textFieldValue","selected","selectedCopy","visibleTextField","visibleDeleteDlg","visibleOthers","visibleAlreadyExistDlg","visibleOSaveAsDlg","visibleWaiting","visibleOpenMultipleFilesDlg","doSelectUnselect","newSelected","openSelectedFilesRetrieveItems","startsWithIgnoreCase","openSelectedFiles","hideOpenMultipleFilesDlg","onOpenMultipleFilesCompleted","onOpenImage","createDir","renameItem","lastSelected","previousDir","nextDir","setCurrentDir","fsListDir","confirmText","oldParent","fsBuildParent","newParent","fsCreateDir","cancelDir","saveItem","localFileStore","buffer","copyItem","newSelectedCopy","cutItem","cut","pasteItem","deleteItem","showOthers","exportItem","itemClick","selectedIndex","concat","itemDoubleClick","onOpenDicomdir","onOpen","showDeleteDlg","hideDeleteDlg","confirmDeleteDlg","hideAlreadyExistDlg","hideSaveAs","closeSaveAs","saveAsField","zip","JSZip","folder","generateAsync","mouseDown","timer","mouseUp","clearTimeout","itemsCount","loadAsync","contents","relativePath","zipEntry","dir","content","fsAddItem","setFsZippedFile","put","create","sortBy","list","and","setCurrentList","totalItemsCount","Paper","textPaper","InputBase","textInput","placeholder","textButton","mdiCheck","mdiClose","leftButtons","CircularProgress","Tooltip","mdiChevronLeft","toolbarButtons","mdiCheckBoxOutline","mdiFolderOutline","mdiFolderPlusOutline","mdiSquareEditOutline","mdiDotsHorizontal","mdiContentCut","mdiContentCopy","mdiContentPaste","mdiDeleteOutline","mdiExportVariant","float","TableContainer","Table","table","TableHead","TableRow","TableCell","align","TableBody","isItemSelected","role","hover","onDoubleClick","onTouchStart","onTouchEnd","onMouseDown","onMouseUp","scope","bytes","decimals","k","dm","sizes","formatBytes","localFile","fsRefresh","setFsCurrentDir","setFsCurrentList","minWidth","alignItems","source","axios","CancelToken","DownloadZipDlg","loading","requestDownloadZip","responseType","cancelToken","token","onDownloadProgress","progressEvent","percentCompleted","loaded","total","response","catch","SeriesItem","iconTool","App","anchorElLayout","openMenu","openImageEdit","openTools","openMpr","openLayout","visibleMainMenu","visibleHeader","visibleSettings","visibleToolbar","visibleOpenUrl","visibleToolbox","visibleMeasure","visibleAbout","visibleDicomdir","visibleFileManager","visibleZippedFileDlg","visibleDownloadZipDlg","toolState","sliceIndex","sliceMax","listOpenFilesScrolling","visibleVolumeBuilding","visibleMprOrthogonal","visibleMprCoronal","visibleMprSagittal","visibleMprAxial","anchorEl","anchorElMpr","anchorElImageEdit","visibleSeries","totalSeries","seriesListDicomViewers","seriesCounter","visibleExplorer","setDcmViewer","seriesListDicomViewersRefs","getDcmViewerRef","getDcmViewer","dicomViewers","getActiveDcmViewer","toggleFileManager","handleOpenLocalFs","filesSelected","changeLayout","setLocalFileStore","handleOpenSandboxFs","handleOpenImage","handleOpenFileDicomdir","handleOpenFsDicomdir","setDicomdirStore","toggleDicomdir","showAppBar","scrollTo","toggleSeriesMenu","toggleMainMenu","showMainMenu","hideMainMenu","handleVisibility","toggleHeader","visible","toggleToolbox","saveMeasure","toggleMeasure","hideMeasure","handleVisibilityMeasure","clearMeasure","showZippedFileDlg","hideZippedFileDlg","confirmZippedFileDlg","showAbout","showSettings","hideSettings","handleVisibilitySettings","hideDownloadZipDlg","openMultipleFilesCompleted","openMultipleFilesFromList","showOpenUrl","hideOpenUrl","openDlg","openUrlField","downloadOpenUrl","resetImage","saveShot","cinePlayer","clear","handleLayout","currentTarget","closeLayout","layoutGridClick","setLayoutStore","toolExecute","mdiArrowAll","mdiCursorPointer","mdiMagnify","mdiRuler","mdiEyedropper","mdiAngleAcute","mdiEllipse","mdiRectangle","mdiGesture","toolChange","toggleOpenMenu","toggleImageEdit","toggleTools","toggleMpr","layoutListClick","mprSliceIndex","setActiveDcmIndex","layoutGridTouch","buildLayoutGrid","dicomviewers","styleLayoutGrid","gridTemplateRows","gridTemplateColumns","buildLayoutList","seriesNumber","getStringVisiblePlane","appBarTitle","webkitRelativePath","getImageOrientationZ","mprBuildVolume","xPixelSpacing","getPixelSpacing","spacingBetweenSlice","getSpacingBetweenSlice","sliceThickness","getSliceThickness","zDimMethod2","len","emptyPlane","order","iFile","previous","filter","object","intervals","ceil","interpolationMethod","w","p0","p1","zStep","changeToOrthogonalView","changeToSagittalView","changeToCoronalView","changeToAxialView","xzIndex","yzIndex","mprOrthogonal","mprSagittal","mprCoronal","mprAxial","listOpenFilesFirstFrame","listOpenFilesPreviousFrame","listOpenFilesNextFrame","listOpenFilesLastFrame","scrolling","clearInterval","timerScrolling","setInterval","handleSliceChange","fileOpen","showFileOpen","bind","showOpenDicomdir","openFolder","showOpenFolder","seriesNumberList","_totalSeries","_seriesCounter","fileImageSeriesNumber","ts","datafiles","primaryClass","isDicomdir","isMultipleFiles","iconToolColor","handleClose","Divider","orientation","flexItem","arrow","mdiFileCabinet","mdiFolderMultiple","Popper","transition","disablePortal","placement","TransitionProps","Grow","transformOrigin","borderRadius","ClickAwayListener","onClickAway","MenuList","autoFocusItem","onKeyDown","MenuItem","disabled","ListItemIcon","mdiFolder","mdiWeb","mdiFolderOpen","mdiDelete","mdiViewGridPlusOutline","Boolean","mdiSettings","mdiInformationOutline","mdiVideo","mdiRefresh","mdiCamera","mdiToolbox","mdiFileCad","mdiFileDocument","Slide","direction","mountOnEnter","unmountOnExit","Card","toolbarCard","justifyContent","mdiChartHistogram","mdiAxisArrow","mdiImageEdit","mdiInvertColors","mdiCursorDefault","mdiCheckboxIntermediate","Drawer","zIndex","toolbar","mdiArrowLeftCircle","anchor","mdiTrashCanOutline","Snackbar","anchorOrigin","vertical","horizontal","autoHideDuration","message","Grid","container","xs","rootGridList","GridList","cellHeight","gridList","tile","GridListTile","GridListTileBar","subtitle","multiple","handleOpenDicomdir","webkitdirectory","mozdirectory","directory","handleOpenFolder","setLayout","setDicomdir","setVolumeStore","palette","common","black","flexGrow","root","menuButton","drawer","transitions","easing","sharp","duration","leavingScreen","appBarShift","enteringScreen","flexShrink","whiteSpace","drawerOpen","drawerClose","overflowX","breakpoints","up","mixins","flexWrap","overflow","icon","isLocalhost","location","hostname","registerValidSW","swUrl","config","navigator","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","initialState","store","createStore","action","__REDUX_DEVTOOLS_EXTENSION__","WebFontLoader","load","google","families","createMuiTheme","overrides","MuiFormControlLabel","MuiFormLabel","main","ReactDOM","render","process","fetch","contentType","headers","get","status","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.39c53acc.chunk.js","sourcesContent":["import Dexie from 'dexie'\n\nconst fs = new Dexie('fsDB')\n\nfs.version(1).stores({ \n    files: '[parent+name], parent, name, type' \n})\n\nfs.open()\n\nexport default fs\n","import { \n    isAndroid,\n    isFirefox,\n    isMobile, \n    isTablet \n  } from 'react-device-detect'\nimport { \n    SETTINGS_SAVEAS, \n    SETTINGS_SAVEINTO,\n    SETTINGS_DCMHEADER, \n    SETTINGS_OVERLAY, \n    SETTINGS_MEASUREMENT,\n    SETTINGS_FSVIEW,\n    SETTINGS_DICOMDIRVIEW,    \n    SETTINGS_MPRINTERPOLATION,\n} from './constants/settings'\n\n\nexport function getPixelSpacing(image, index) {\n    const value = image.data.string('x00280030')\n    if (value === undefined) {\n        return\n    }\n    const pixelSpacing = value.split('\\\\')\n    return pixelSpacing[index]\n}\n\nexport function getSpacingBetweenSlice(image) {\n    const value = image.data.string('x00180088')\n    if (value === undefined) {\n        return\n    }\n    return parseFloat(value)\n}\n\nexport function getSliceThickness(image) {\n    const value = image.data.string('x00180050')\n    if (value === undefined) {\n        return\n    }\n    return parseFloat(value)\n}\n\nexport function getSliceLocation(image) {\n    const value = image.data.string('x00201041')\n    if (value === undefined) {\n        return\n    }\n    return parseFloat(value)\n}\t\n\n  \nexport function capitalize(str) {\n    if (str === undefined) \n        return ''\n    else \n        return str.charAt(0).toUpperCase() + str.slice(1)\n}\n\n// To see the console output set the key 'debug-u-dicom-viewer' in \n// 'Storage->Local Storage' panel of your browser Develop Tool\nexport function log() {\n    let log = localStorage.getItem('debug-u-dicom-viewer')\n    if (log === null) {\n        console.log = function(){}\n    }\n}\n\nexport function isInputDirSupported() {\n    var tmpInput = document.createElement('input')\n    if ('webkitdirectory' in tmpInput \n        || 'mozdirectory' in tmpInput \n        || 'odirectory' in tmpInput \n        || 'msdirectory' in tmpInput \n        || 'directory' in tmpInput) return true\n    return false\n}\n\nexport function isUrlImage(url) {\n    if (url === undefined || url === null) return false\n    return(url.match(/\\.(jpeg|jpg|png)$/) != null)\n}\n\nexport function isFileImage(file) {\n    if (file === undefined || file === null) return false \n    const acceptedImageTypes = ['image/jpeg', 'image/png'] // 'image/gif', \n    return file && acceptedImageTypes.includes(file['type'])\n}\n\nexport function isFsFileImage(fsItem) {\n    console.log('isFsFileImage: ', fsItem)\n    if (fsItem === undefined || fsItem === null) return false\n    return fsItem.type.toLowerCase() === 'jpeg' || fsItem.type.toLowerCase() === 'png'\n}\n\nexport function getFileNameCorrect(filename) {\n    if (isAndroid && isFirefox) { // possible uncorrect .null extension is found in Android Firefox, it's a bug? CHECK IT\n        const ext = getFileExt(filename)\n        if (ext === 'null') {\n            return getFileName(filename)\n        }\n    }\n    return filename \n}\n\nexport function getFileExt(file) {\n    const re = /(?:\\.([^.]+))?$/\n    const ext = re.exec(file)[1]\n    if (ext === undefined) {\n        return 'dcm'\n    }\n    return ext\n}\n\nexport function getFileExtReal(file) {\n    const re = /(?:\\.([^.]+))?$/\n    const ext = re.exec(file)[1]\n    if (ext === undefined) {\n        return ''\n    }\n    return ext\n}\n\nexport function getFileName(file) {\n    const name = file.replace(/\\.[^.$]+$/, '')\n    if (name === undefined) {\n        return ''\n    }\n    return name    \n}\n\nexport function formatBytes(bytes, decimals = 2) {\n    if (bytes === '') return ''\n    if (bytes === 0) return '0 Bytes'\n    const k = 1024\n    const dm = decimals < 0 ? 0 : decimals\n    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']\n    const i = Math.floor(Math.log(bytes) / Math.log(k))\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i]\n}\n\nexport function getSettingsSaveAs() {\n    let saveAs = localStorage.getItem(SETTINGS_SAVEAS)\n    if (saveAs === null) {\n      saveAs = \"png\"\n      localStorage.setItem(SETTINGS_SAVEAS, saveAs)\n    }\n    return saveAs\n}\n\nexport function setSettingsSaveAs(value) {\n    localStorage.setItem(SETTINGS_SAVEAS, value)  \n}\n\nexport function getSettingsSaveInto() {\n    let saveInto = localStorage.getItem(SETTINGS_SAVEINTO)\n    if (saveInto === null) {\n        saveInto = \"local\"\n      localStorage.setItem(SETTINGS_SAVEINTO, saveInto)\n    }\n    return saveInto\n}\n\nexport function setSettingsSaveInto(value) {\n    localStorage.setItem(SETTINGS_SAVEINTO, value)  \n}\n\nexport function getSettingsDcmHeader() {\n    let exportAs = localStorage.getItem(SETTINGS_DCMHEADER)\n    if (exportAs === null) {\n      exportAs = \"json\"\n      localStorage.setItem(SETTINGS_DCMHEADER, exportAs)\n    }  \n    return exportAs\n}\n\nexport function setSettingsDcmHeader(value) {\n    localStorage.setItem(SETTINGS_DCMHEADER, value)  \n}\n\nexport function getSettingsOverlay() {\n    let overlay = localStorage.getItem(SETTINGS_OVERLAY)\n    if (overlay === null) {\n      overlay = \"1\"\n      localStorage.setItem(SETTINGS_OVERLAY, overlay)\n    }\n    return overlay === '1'\n}\n\nexport function setSettingsOverlay(value) {\n    localStorage.setItem(SETTINGS_OVERLAY, value ? '1' : '0')  \n}\n\nexport function getSettingsMeasurement() {\n    let measurement = localStorage.getItem(SETTINGS_MEASUREMENT)\n    if (measurement === null) {\n        measurement = '1'\n        localStorage.setItem(SETTINGS_MEASUREMENT, measurement)\n    }\n    return measurement\n}\n\nexport function setSettingsMeasurement(value) {\n    localStorage.setItem(SETTINGS_MEASUREMENT, value)  \n}\n\nexport function getSettingsFsView() {\n    let view = localStorage.getItem(SETTINGS_FSVIEW)\n    if (view === null) {\n        view = isMobile && !isTablet ? 'bottom' : 'right'\n        localStorage.setItem(SETTINGS_FSVIEW, view)\n    }\n    return view\n}\n\nexport function setSettingsFsView(value) {\n    localStorage.setItem(SETTINGS_FSVIEW, value)  \n}\n\nexport function getSettingsDicomdirView() {\n    let view = localStorage.getItem(SETTINGS_DICOMDIRVIEW)\n    if (view === null) {\n        view = isMobile && !isTablet ? 'bottom' : 'right'\n        localStorage.setItem(SETTINGS_DICOMDIRVIEW, view)\n    }\n    return view\n}\n\nexport function setSettingsDicomdirView(value) {\n    localStorage.setItem(SETTINGS_DICOMDIRVIEW, value)  \n}\n\nexport function getSettingsMprInterpolation() {\n    let method = localStorage.getItem(SETTINGS_MPRINTERPOLATION)\n    if (method === null) {\n        method = 'weightedlinear'\n        localStorage.setItem(SETTINGS_MPRINTERPOLATION, method)\n    }\n    return method\n}\n\nexport function setSettingsMprInterpolation(value) {\n    localStorage.setItem(SETTINGS_MPRINTERPOLATION, value)  \n}\n\n/**\n * Converts a value to a string appropriate for entry into a CSV table.  E.g., a string value will be surrounded by quotes.\n * @param {string|number|object} theValue\n */\nfunction toCsvValue(theValue) {\n    let t = typeof theValue,\n        output\n\n    let sDelimiter = '\"'\n\n    if (t === 'undefined' || t === null) {\n        output = ''\n    } else if (t === 'string') {\n        output = sDelimiter + theValue.replace(/\"/g, '\"\"') + sDelimiter\n    } else {\n        output = sDelimiter + String(theValue).replace(/\"/g, '\"\"') + sDelimiter\n    }\n\n    return output\n}\n\n/**\n * Converts an array of objects (with identical schemas) into a CSV table.\n * @param {Array} objArray An array of objects.  Each object in the array must have the same property list.\n * @param {string} cDelimiter The column delimiter.  Defaults to a comma (,) if omitted.\n * @return {string} The CSV equivalent of objArray.\n */\nexport function toCsv(objArray, cDelimiter) {\n    var i,\n        l,\n        names = [],\n        name,\n        value,\n        obj,\n        row,\n        output = '',\n        n,\n        nl\n\n    // Initialize default parameters.\n\n    let sDelimiter = '\"'\n    if (typeof cDelimiter === 'undefined' || cDelimiter === null) {\n        cDelimiter = ','\n    }\n\n    for (i = 0, l = objArray.length; i < l; i += 1) {\n        // Get the names of the properties.\n        obj = objArray[i]\n        row = ''\n        if (i === 0) {\n            // Loop through the names\n            for (name in obj) {\n                if (obj.hasOwnProperty(name)) {\n                    names.push(name)\n                    row += [\n                        sDelimiter,\n                        name.replace(/\"/g, '\"\"'),\n                        sDelimiter,\n                        cDelimiter,\n                    ].join('')\n                }\n            }\n            row = row.substring(0, row.length - 1)\n            output += row\n        }\n\n        output += '\\n'\n        row = ''\n        for (n = 0, nl = names.length; n < nl; n += 1) {\n            name = names[n]\n            value = obj[name]\n            if (n > 0) {\n                row += cDelimiter\n            }\n            row += toCsvValue(value)\n        }\n        output += row\n    }\n\n    return output\n}\n\n","\nexport const SETTINGS_SAVEAS = 'saveAs'\nexport const SETTINGS_SAVEINTO = 'saveInto'\nexport const SETTINGS_DCMHEADER = 'exportAs'\nexport const SETTINGS_OVERLAY = 'overlay'\nexport const SETTINGS_MEASUREMENT = 'measurement'\nexport const SETTINGS_FSVIEW = 'fsView'\nexport const SETTINGS_DICOMDIRVIEW = 'dicomdirView'\nexport const SETTINGS_MPRINTERPOLATION = 'mprInterpolation'\n","export const CLEAR_STORE = 'CLEAR_STORE'\nexport const LOCALFILE_STORE = 'LOCALFILE_STORE'\nexport const FSFILE_STORE = 'LOCALFILE_STORE'\nexport const FILES_STORE = 'FILES_STORE'\nexport const DCM_IS_OPEN = 'DCM_IS_OPEN'\nexport const DCM_TOOL = 'DCM_TOOL'\nexport const ACTIVE_DCM_INDEX = 'ACTIVE_DCM_INDEX'\nexport const ACTIVE_DCM = 'ACTIVE_DCM'\n//export const DCM_IMAGE = 'DCM_IMAGE'\nexport const ACTIVE_MEASUREMENTS = 'ACTIVE_MEASUREMENTS'\nexport const LAYOUT = 'LAYOUT'\nexport const DICOMDIR = 'DICOMDIR'\nexport const FSCURRENTDIR = 'FSCURRENTDIR'\nexport const FSCURRENTLIST = 'FSCURRENTLIST'\nexport const FSZIPPEDFILE = 'FSZIPPEDFILE'\nexport const FSREFRESH = 'FSREFRESH'\nexport const VOLUME_STORE = 'VOLUME_STORE'\n//export const LUT_STORE = 'LUT_STORE'\n//export const SANDBOXEDFILE_STORE = 'SANDBOXEDFILE_STORE'\n\nexport const clearStore = () => {\n    return { \n        type: CLEAR_STORE, \n    }\n}\n\nexport const localFileStore = (file) => {\n    return { \n        type: LOCALFILE_STORE, \n        localFile: file\n    }\n}\n\nexport const fsFileStore = (file) => {\n    return { \n        type: FSFILE_STORE, \n        fsFile: file\n    }\n}\n\nexport const filesStore = (files) => {\n    return { \n        type: FILES_STORE, \n        files: files\n    }\n}\n\nexport const dcmIsOpen = (value) => {\n    return { \n        type: DCM_IS_OPEN, \n        value: value\n    }\n}\n\nexport const dcmTool = (tool) => {\n    return { \n        type: DCM_TOOL, \n        tool: tool \n    }\n}\n\nexport const activeDcmIndex = (index) => {\n    return { \n        type: ACTIVE_DCM_INDEX, \n        activeDcmIndex: index \n    }\n}\n\nexport const activeDcm = (dcm) => {\n    return { \n        type: ACTIVE_DCM, \n        activeDcm: dcm \n    }\n}\n/*\nexport const dcmImage = (image) => {\n    return { \n        type: DCM_IMAGE, \n        images: image \n    }\n}\n*/\nexport const activeMeasurements = (measurements) => {\n    return { \n        type: ACTIVE_MEASUREMENTS, \n        measurements: measurements \n    }\n}\n\nexport const setLayout = (row, col) => {\n    return { \n        type: LAYOUT, \n        layout: [row, col]\n    }\n}\n\nexport const setDicomdir = (dicomdir) => {\n    return { \n        type: DICOMDIR, \n        dicomdir: dicomdir\n    }\n}\n\nexport const setFsCurrentDir = (dir) => {\n    return { \n        type: FSCURRENTDIR, \n        fsCurrentDir: dir\n    }\n}\n\nexport const setFsCurrentList = (list) => {\n    return { \n        type: FSCURRENTLIST, \n        fsCurrentList: list\n    }\n}\n\nexport const setZippedFile = (file) => {\n    return { \n        type: FSZIPPEDFILE, \n        fsZippedFile: file\n    }\n}\n\nexport const doFsRefresh = () => {\n    return { \n        type: FSREFRESH,\n    }\n}\n\nexport const setVolume = (volume) => {\n    return { \n        type: VOLUME_STORE,\n        volume: volume,\n    }\n}\n/*\nexport const setLut = (lut) => {\n    return { \n        type: LUT_STORE,\n        lut: lut,\n    }\n}\n\n\nexport const sandboxedfileStore = (file) => {\n    return { \n        type: SANDBOXEDFILE_STORE, \n        sandboxedFile: file\n    }\n}\n*/","import React, { Fragment, PureComponent } from 'react'\nimport {connect} from 'react-redux'\nimport { withStyles } from '@material-ui/core/styles'\nimport List from '@material-ui/core/List'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport Collapse from '@material-ui/core/Collapse'\nimport * as dicomParser from 'dicom-parser'\nimport ExpandLessIcon from '@material-ui/icons/ExpandLess'\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore'\nimport fs from '../fs/fs'\nimport {\n  getSettingsDicomdirView,\n} from '../functions'\nimport {\n  fsFileStore,\n} from '../actions'\n\nconst styles = theme => ({\n  study: { \n    paddingLeft: theme.spacing(3) \n  },\n  series: { \n    paddingLeft: theme.spacing(5) \n  },\n  images: { \n    paddingLeft: theme.spacing(7) \n  },  \n  listItemText:{\n    fontSize:'0.80em',\n  }\n})\n\nconst ExpandIcon = ({ expanded }) => expanded ? <ExpandLessIcon /> : <ExpandMoreIcon />\n\nclass Dicomdir extends PureComponent {\n    constructor(props) {\n      super(props)\n      this.output = null\n    }\n\n    state = {\n      data: [],\n      expanded: [],\n    }\n\n    componentDidMount() {\n        if (this.props.dicomdir.origin === 'local')\n          this.openDicomdir(this.props.dicomdir.dicomdir)   \n        else \n          this.openDicomdirFs(this.props.dicomdir.dicomdir)               \n    }\n\n    buildData = (id = null) => {\n      let output = this.output\n      if (id !== null) {\n        output[id].expanded = !output[id].expanded\n      }\n      let images = []\n      let series = []\n      let study = []\n      let patient = []\n      output.slice().reverse().forEach((obj, i) => {\n        if (obj.key === 'image') {\n          images.unshift({id: obj.id, key: obj.key, path: obj.path, value: obj.value})\n        } else if (obj.key === 'series') {\n          series.unshift({id: obj.id, key: obj.key, number: obj.number, value: obj.value, expanded: obj.expanded, children: images})\n          images = []\n        } else if (obj.key === 'study') {\n          study.unshift({id: obj.id, key: obj.key, value: obj.value, expanded: obj.expanded, children: series})\n          series = []\n        } else if (obj.key === 'patient') {\n          patient.unshift({id: obj.id, key: obj.key, value: obj.value, expanded: obj.expanded, children: study})\n          study = []\n        }\n      })\n      this.setState({data: patient})\n    }\n\n    buildOutput = (dataset) => {\n      //console.log('dataset: ', dataset)\n      let data = dataset.elements.x00041220.items\n      let output = []\n      if (data) {\n          data.forEach((e, index) => {\n            const id = index.toString()\n            if (e.dataSet.string('x00041430') === 'PATIENT') {\n                //console.log(\"Patient Name - \"+e.dataSet.string('x00100010'))\n                output.push({id: id, key: 'patient', value: e.dataSet.string('x00100010'), expanded: true})\n            } else if (e.dataSet.string('x00041430') === 'STUDY') {\n                //console.log(\"Study - \"+e.dataSet.string('x00081030'))\n                output.push({id: id, key: 'study', value: e.dataSet.string('x00081030'), expanded: true})\n            } else if (e.dataSet.string('x00041430') === 'SERIES') {\n                //console.log(\"Series number - \"+e.dataSet.string('x00200011'))\n                output.push({id: id, key: 'series', number: e.dataSet.string('x00200011'), value: e.dataSet.string('x00080060'), expanded: true})\n            } else if (e.dataSet.string('x00041430') === 'IMAGE') {\n                //console.log(\"Image - \"+e.dataSet.string('x00041500'))\n                output.push({id: id, key: 'image', path: e.dataSet.string('x00041500').replace(/\\\\/g, '/'), value: e.dataSet.string('x00041500').split('\\\\').pop(), expanded: true})\n            }              \n          })\n      }\n      //console.log('output: ', output)\n      return output\n    }\n\n    openDicomdir = (file) => {\n        var reader = new FileReader()\n        reader.onload = (file) => {\n          let arrayBuffer = reader.result\n          let byteArray = new Uint8Array(arrayBuffer)\n          // Invoke the paresDicom function and get back a DataSet object with the contents\n          let dataset = null\n          let output = []\n          try {\n              dataset = dicomParser.parseDicom(byteArray)\n              output = this.buildOutput(dataset)\n          } catch(err) {\n              if (typeof err.dataSet != 'undefined') {\n                  output = this.buildOutput(err.dataSet)\n              }\n          }\n          this.output = output\n          this.buildData()\n        }\n\n        reader.readAsArrayBuffer(file)\n    }\n\n    openDicomdirFs = (fsItem) => {\n      let byteArray = new Uint8Array(fsItem.data)\n      let dataset = null\n      let output = []\n      try {\n        dataset = dicomParser.parseDicom(byteArray)\n        output = this.buildOutput(dataset)\n      } catch(err) {\n        if (typeof err.dataSet != 'undefined') {\n          output = this.buildOutput(err.dataSet)\n        }\n      }\n      this.output = output\n      this.buildData()\n    }\n\n    onClick = (id) => {\n      const obj = this.output.find(x => x.id === id)\n      if (obj.key === 'image') {\n        if (this.props.dicomdir.origin === 'local') { // load it from local\n          const file = this.props.dicomdir.files.find(x => x.name === obj.value)\n          this.props.onOpenFile(file)\n        } else { // load it from sandboxed file system\n          let components = obj.path.split('/')\n          const name = components.pop()\n          components.unshift(this.props.fsCurrentDir)\n          const parent = components.join('/')\n          fs.files.where({parent: parent, name: name}).first((item) => {\n            this.props.setFsFileStore(item)\n            this.props.onOpenFs(item)\n          })\n        }\n      } else {\n        this.buildData(id)\n      }\n    }\n\n    render() {   \n      const { classes } = this.props\n\n      let styleComponent = null\n      if (getSettingsDicomdirView() === 'bottom') {\n          styleComponent = {marginTop: '0px', height: '275px'}\n      } else {\n          styleComponent = {marginTop: '48px', width: '350px'}\n      }\n\n      return (\n        <div style={styleComponent}>\n          <List>\n            {this.state.data.map(({ ...patient }, index) => (\n              <Fragment key={index}>\n                <ListItem button onClick={() => this.onClick(patient.id)}>\n                  <ListItemText primary={patient.value} secondary={patient.key} classes={{primary:classes.listItemText, secondary:classes.listItemText}} />\n                  <ExpandIcon expanded={patient.expanded} />\n                </ListItem>\n                <Collapse in={patient.expanded}>\n                  {patient.children.map(study => (\n                    <Fragment key={study.id}>\n                      <ListItem key={study.id} button dense onClick={() => this.onClick(study.id)} className={classes.study}>\n                        <ListItemText primary={study.value} secondary={study.key} classes={{primary:classes.listItemText, secondary:classes.listItemText}} />\n                        <ExpandIcon expanded={study.expanded} />\n                      </ListItem>\n                      <Collapse in={study.expanded}>\n                        {study.children.map(series => (\n                          <Fragment key={series.id}>\n                            <ListItem key={series.id} button dense onClick={() => this.onClick(series.id)} className={classes.series}>\n                              <ListItemText primary={`${series.value} (${series.number})`} secondary={series.key} classes={{primary:classes.listItemText, secondary:classes.listItemText}} />\n                              <ExpandIcon expanded={study.expanded} />\n                            </ListItem>\n                            <Collapse in={series.expanded}>\n                              {series.children.map(images => (\n                                <ListItem key={images.id} button dense onClick={() => this.onClick(images.id)} className={classes.images}>\n                                  <ListItemText primary={images.value} classes={{primary:classes.listItemText}} />\n                                </ListItem>\n                              ))}\n                            </Collapse>\n                          </Fragment>\n                        ))}\n                      </Collapse>\n                    </Fragment>\n                  ))}\n                </Collapse>\n              </Fragment>\n            ))}\n          </List>\n        </div>\n      )\n    }\n}   \n\nconst mapStateToProps = (state) => {\n    return {\n      dicomdir: state.dicomdir,\n      fsCurrentDir: state.fsCurrentDir,\n    }\n}\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    setFsFileStore: (file) => dispatch(fsFileStore(file))\n  }\n}\n  \nexport default connect(mapStateToProps, mapDispatchToProps)(withStyles(styles)(Dicomdir))\n","// The table below was generated by running the following javascript in the console window while\n// viewing the HTML version of the standard here:\n// DICOM Standard here: http://dicom.nema.org/medical/dicom/current/output/html/part06.html\n// see the blog post about it here: http://chafey.blogspot.com/2015/08/parsing-dicom-standard-with-javascript.html\n\n/*\n (function () {\n var elements = document.querySelectorAll('#table_A-1 ~ div tbody tr');\n var result = \"\";for(var i=0; i < elements.length; i++) {\n result += \"'\" + elements[i].childNodes[1].childNodes[1].innerText.replace(/[^\\x20-\\x7E]+/g, '')  + \"':'\" +\n elements[i].childNodes[3].childNodes[1].innerText.replace(/[^\\x20-\\x7E]+/g, '') + \"',\\n\";\n }\n return result;\n })();\n */\n\nexport const uids = {\n  '1.2.840.10008.1.1':'Verification SOP Class',\n  '1.2.840.10008.1.2':'Implicit VR Little Endian: Default Transfer Syntax for DICOM',\n  '1.2.840.10008.1.2.1':'Explicit VR Little Endian',\n  '1.2.840.10008.1.2.1.99':'Deflated Explicit VR Little Endian',\n  '1.2.840.10008.1.2.2':'Explicit VR Big Endian (Retired)',\n  '1.2.840.10008.1.2.4.50':'JPEG Baseline (Process 1): Default Transfer Syntax for Lossy JPEG 8 Bit Image Compression',\n  '1.2.840.10008.1.2.4.51':'JPEG Extended (Process 2 & 4): Default Transfer Syntax for Lossy JPEG 12 Bit Image Compression (Process 4 only)',\n  '1.2.840.10008.1.2.4.52':'JPEG Extended (Process 3 & 5) (Retired)',\n  '1.2.840.10008.1.2.4.53':'JPEG Spectral Selection, Non-Hierarchical (Process 6 & 8) (Retired)',\n  '1.2.840.10008.1.2.4.54':'JPEG Spectral Selection, Non-Hierarchical (Process 7 & 9) (Retired)',\n  '1.2.840.10008.1.2.4.55':'JPEG Full Progression, Non-Hierarchical (Process 10 & 12) (Retired)',\n  '1.2.840.10008.1.2.4.56':'JPEG Full Progression, Non-Hierarchical (Process 11 & 13) (Retired)',\n  '1.2.840.10008.1.2.4.57':'JPEG Lossless, Non-Hierarchical (Process 14)',\n  '1.2.840.10008.1.2.4.58':'JPEG Lossless, Non-Hierarchical (Process 15) (Retired)',\n  '1.2.840.10008.1.2.4.59':'JPEG Extended, Hierarchical (Process 16 & 18) (Retired)',\n  '1.2.840.10008.1.2.4.60':'JPEG Extended, Hierarchical (Process 17 & 19) (Retired)',\n  '1.2.840.10008.1.2.4.61':'JPEG Spectral Selection, Hierarchical (Process 20 & 22) (Retired)',\n  '1.2.840.10008.1.2.4.62':'JPEG Spectral Selection, Hierarchical (Process 21 & 23) (Retired)',\n  '1.2.840.10008.1.2.4.63':'JPEG Full Progression, Hierarchical (Process 24 & 26) (Retired)',\n  '1.2.840.10008.1.2.4.64':'JPEG Full Progression, Hierarchical (Process 25 & 27) (Retired)',\n  '1.2.840.10008.1.2.4.65':'JPEG Lossless, Hierarchical (Process 28) (Retired)',\n  '1.2.840.10008.1.2.4.66':'JPEG Lossless, Hierarchical (Process 29) (Retired)',\n  '1.2.840.10008.1.2.4.70':'JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1]): Default Transfer Syntax for Lossless JPEG Image Compression',\n  '1.2.840.10008.1.2.4.80':'JPEG-LS Lossless Image Compression',\n  '1.2.840.10008.1.2.4.81':'JPEG-LS Lossy (Near-Lossless) Image Compression',\n  '1.2.840.10008.1.2.4.90':'JPEG 2000 Image Compression (Lossless Only)',\n  '1.2.840.10008.1.2.4.91':'JPEG 2000 Image Compression',\n  '1.2.840.10008.1.2.4.92':'JPEG 2000 Part 2 Multi-component Image Compression (Lossless Only)',\n  '1.2.840.10008.1.2.4.93':'JPEG 2000 Part 2 Multi-component Image Compression',\n  '1.2.840.10008.1.2.4.94':'JPIP Referenced',\n  '1.2.840.10008.1.2.4.95':'JPIP Referenced Deflate',\n  '1.2.840.10008.1.2.4.100':'MPEG2 Main Profile @ Main Level',\n  '1.2.840.10008.1.2.4.101':'MPEG2 Main Profile @ High Level',\n  '1.2.840.10008.1.2.4.102':'MPEG-4 AVC/H.264 High Profile / Level 4.1',\n  '1.2.840.10008.1.2.4.103':'MPEG-4 AVC/H.264 BD-compatible High Profile / Level 4.1',\n  '1.2.840.10008.1.2.4.104':'MPEG-4 AVC/H.264 High Profile / Level 4.2 For 2D Video',\n  '1.2.840.10008.1.2.4.105':'MPEG-4 AVC/H.264 High Profile / Level 4.2 For 3D Video',\n  '1.2.840.10008.1.2.4.106':'MPEG-4 AVC/H.264 Stereo High Profile / Level 4.2',\n  '1.2.840.10008.1.2.5':'RLE Lossless',\n  '1.2.840.10008.1.2.6.1':'RFC 2557 MIME encapsulation',\n  '1.2.840.10008.1.2.6.2':'XML Encoding',\n  '1.2.840.10008.1.3.10':'Media Storage Directory Storage',\n  '1.2.840.10008.1.4.1.1':'Talairach Brain Atlas Frame of Reference',\n  '1.2.840.10008.1.4.1.2':'SPM2 T1 Frame of Reference',\n  '1.2.840.10008.1.4.1.3':'SPM2 T2 Frame of Reference',\n  '1.2.840.10008.1.4.1.4':'SPM2 PD Frame of Reference',\n  '1.2.840.10008.1.4.1.5':'SPM2 EPI Frame of Reference',\n  '1.2.840.10008.1.4.1.6':'SPM2 FIL T1 Frame of Reference',\n  '1.2.840.10008.1.4.1.7':'SPM2 PET Frame of Reference',\n  '1.2.840.10008.1.4.1.8':'SPM2 TRANSM Frame of Reference',\n  '1.2.840.10008.1.4.1.9':'SPM2 SPECT Frame of Reference',\n  '1.2.840.10008.1.4.1.10':'SPM2 GRAY Frame of Reference',\n  '1.2.840.10008.1.4.1.11':'SPM2 WHITE Frame of Reference',\n  '1.2.840.10008.1.4.1.12':'SPM2 CSF Frame of Reference',\n  '1.2.840.10008.1.4.1.13':'SPM2 BRAINMASK Frame of Reference',\n  '1.2.840.10008.1.4.1.14':'SPM2 AVG305T1 Frame of Reference',\n  '1.2.840.10008.1.4.1.15':'SPM2 AVG152T1 Frame of Reference',\n  '1.2.840.10008.1.4.1.16':'SPM2 AVG152T2 Frame of Reference',\n  '1.2.840.10008.1.4.1.17':'SPM2 AVG152PD Frame of Reference',\n  '1.2.840.10008.1.4.1.18':'SPM2 SINGLESUBJT1 Frame of Reference',\n  '1.2.840.10008.1.4.2.1':'ICBM 452 T1 Frame of Reference',\n  '1.2.840.10008.1.4.2.2':'ICBM Single Subject MRI Frame of Reference',\n  '1.2.840.10008.1.5.1':'Hot Iron Color Palette SOP Instance',\n  '1.2.840.10008.1.5.2':'PET Color Palette SOP Instance',\n  '1.2.840.10008.1.5.3':'Hot Metal Blue Color Palette SOP Instance',\n  '1.2.840.10008.1.5.4':'PET 20 Step Color Palette SOP Instance',\n  '1.2.840.10008.1.9':'Basic Study Content Notification SOP Class (Retired)',\n  '1.2.840.10008.1.20.1':'Storage Commitment Push Model SOP Class',\n  '1.2.840.10008.1.20.1.1':'Storage Commitment Push Model SOP Instance',\n  '1.2.840.10008.1.20.2':'Storage Commitment Pull Model SOP Class (Retired)',\n  '1.2.840.10008.1.20.2.1':'Storage Commitment Pull Model SOP Instance (Retired)',\n  '1.2.840.10008.1.40':'Procedural Event Logging SOP Class',\n  '1.2.840.10008.1.40.1':'Procedural Event Logging SOP Instance',\n  '1.2.840.10008.1.42':'Substance Administration Logging SOP Class',\n  '1.2.840.10008.1.42.1':'Substance Administration Logging SOP Instance',\n  '1.2.840.10008.2.6.1':'DICOM UID Registry',\n  '1.2.840.10008.2.16.4':'DICOM Controlled Terminology',\n  '1.2.840.10008.3.1.1.1':'DICOM Application Context Name',\n  '1.2.840.10008.3.1.2.1.1':'Detached Patient Management SOP Class (Retired)',\n  '1.2.840.10008.3.1.2.1.4':'Detached Patient Management Meta SOP Class (Retired)',\n  '1.2.840.10008.3.1.2.2.1':'Detached Visit Management SOP Class (Retired)',\n  '1.2.840.10008.3.1.2.3.1':'Detached Study Management SOP Class (Retired)',\n  '1.2.840.10008.3.1.2.3.2':'Study Component Management SOP Class (Retired)',\n  '1.2.840.10008.3.1.2.3.3':'Modality Performed Procedure Step SOP Class',\n  '1.2.840.10008.3.1.2.3.4':'Modality Performed Procedure Step Retrieve SOP Class',\n  '1.2.840.10008.3.1.2.3.5':'Modality Performed Procedure Step Notification SOP Class',\n  '1.2.840.10008.3.1.2.5.1':'Detached Results Management SOP Class (Retired)',\n  '1.2.840.10008.3.1.2.5.4':'Detached Results Management Meta SOP Class (Retired)',\n  '1.2.840.10008.3.1.2.5.5':'Detached Study Management Meta SOP Class (Retired)',\n  '1.2.840.10008.3.1.2.6.1':'Detached Interpretation Management SOP Class (Retired)',\n  '1.2.840.10008.4.2':'Storage Service Class',\n  '1.2.840.10008.5.1.1.1':'Basic Film Session SOP Class',\n  '1.2.840.10008.5.1.1.2':'Basic Film Box SOP Class',\n  '1.2.840.10008.5.1.1.4':'Basic Grayscale Image Box SOP Class',\n  '1.2.840.10008.5.1.1.4.1':'Basic Color Image Box SOP Class',\n  '1.2.840.10008.5.1.1.4.2':'Referenced Image Box SOP Class (Retired)',\n  '1.2.840.10008.5.1.1.9':'Basic Grayscale Print Management Meta SOP Class',\n  '1.2.840.10008.5.1.1.9.1':'Referenced Grayscale Print Management Meta SOP Class (Retired)',\n  '1.2.840.10008.5.1.1.14':'Print Job SOP Class',\n  '1.2.840.10008.5.1.1.15':'Basic Annotation Box SOP Class',\n  '1.2.840.10008.5.1.1.16':'Printer SOP Class',\n  '1.2.840.10008.5.1.1.16.376':'Printer Configuration Retrieval SOP Class',\n  '1.2.840.10008.5.1.1.17':'Printer SOP Instance',\n  '1.2.840.10008.5.1.1.17.376':'Printer Configuration Retrieval SOP Instance',\n  '1.2.840.10008.5.1.1.18':'Basic Color Print Management Meta SOP Class',\n  '1.2.840.10008.5.1.1.18.1':'Referenced Color Print Management Meta SOP Class (Retired)',\n  '1.2.840.10008.5.1.1.22':'VOI LUT Box SOP Class',\n  '1.2.840.10008.5.1.1.23':'Presentation LUT SOP Class',\n  '1.2.840.10008.5.1.1.24':'Image Overlay Box SOP Class (Retired)',\n  '1.2.840.10008.5.1.1.24.1':'Basic Print Image Overlay Box SOP Class (Retired)',\n  '1.2.840.10008.5.1.1.25':'Print Queue SOP Instance (Retired)',\n  '1.2.840.10008.5.1.1.26':'Print Queue Management SOP Class (Retired)',\n  '1.2.840.10008.5.1.1.27':'Stored Print Storage SOP Class (Retired)',\n  '1.2.840.10008.5.1.1.29':'Hardcopy Grayscale Image Storage SOP Class (Retired)',\n  '1.2.840.10008.5.1.1.30':'Hardcopy Color Image Storage SOP Class (Retired)',\n  '1.2.840.10008.5.1.1.31':'Pull Print Request SOP Class (Retired)',\n  '1.2.840.10008.5.1.1.32':'Pull Stored Print Management Meta SOP Class (Retired)',\n  '1.2.840.10008.5.1.1.33':'Media Creation Management SOP Class UID',\n  '1.2.840.10008.5.1.1.40':'Display System SOP Class',\n  '1.2.840.10008.5.1.1.40.1':'Display System SOP Instance',\n  '1.2.840.10008.5.1.4.1.1.1':'Computed Radiography Image Storage',\n  '1.2.840.10008.5.1.4.1.1.1.1':'Digital X-Ray Image Storage - For Presentation',\n  '1.2.840.10008.5.1.4.1.1.1.1.1':'Digital X-Ray Image Storage - For Processing',\n  '1.2.840.10008.5.1.4.1.1.1.2':'Digital Mammography X-Ray Image Storage - For Presentation',\n  '1.2.840.10008.5.1.4.1.1.1.2.1':'Digital Mammography X-Ray Image Storage - For Processing',\n  '1.2.840.10008.5.1.4.1.1.1.3':'Digital Intra-Oral X-Ray Image Storage - For Presentation',\n  '1.2.840.10008.5.1.4.1.1.1.3.1':'Digital Intra-Oral X-Ray Image Storage - For Processing',\n  '1.2.840.10008.5.1.4.1.1.2':'CT Image Storage',\n  '1.2.840.10008.5.1.4.1.1.2.1':'Enhanced CT Image Storage',\n  '1.2.840.10008.5.1.4.1.1.2.2':'Legacy Converted Enhanced CT Image Storage',\n  '1.2.840.10008.5.1.4.1.1.3':'Ultrasound Multi-frame Image Storage (Retired)',\n  '1.2.840.10008.5.1.4.1.1.3.1':'Ultrasound Multi-frame Image Storage',\n  '1.2.840.10008.5.1.4.1.1.4':'MR Image Storage',\n  '1.2.840.10008.5.1.4.1.1.4.1':'Enhanced MR Image Storage',\n  '1.2.840.10008.5.1.4.1.1.4.2':'MR Spectroscopy Storage',\n  '1.2.840.10008.5.1.4.1.1.4.3':'Enhanced MR Color Image Storage',\n  '1.2.840.10008.5.1.4.1.1.4.4':'Legacy Converted Enhanced MR Image Storage',\n  '1.2.840.10008.5.1.4.1.1.5':'Nuclear Medicine Image Storage (Retired)',\n  '1.2.840.10008.5.1.4.1.1.6':'Ultrasound Image Storage (Retired)',\n  '1.2.840.10008.5.1.4.1.1.6.1':'Ultrasound Image Storage',\n  '1.2.840.10008.5.1.4.1.1.6.2':'Enhanced US Volume Storage',\n  '1.2.840.10008.5.1.4.1.1.7':'Secondary Capture Image Storage',\n  '1.2.840.10008.5.1.4.1.1.7.1':'Multi-frame Single Bit Secondary Capture Image Storage',\n  '1.2.840.10008.5.1.4.1.1.7.2':'Multi-frame Grayscale Byte Secondary Capture Image Storage',\n  '1.2.840.10008.5.1.4.1.1.7.3':'Multi-frame Grayscale Word Secondary Capture Image Storage',\n  '1.2.840.10008.5.1.4.1.1.7.4':'Multi-frame True Color Secondary Capture Image Storage',\n  '1.2.840.10008.5.1.4.1.1.8':'Standalone Overlay Storage (Retired)',\n  '1.2.840.10008.5.1.4.1.1.9':'Standalone Curve Storage (Retired)',\n  '1.2.840.10008.5.1.4.1.1.9.1':'Waveform Storage - Trial (Retired)',\n  '1.2.840.10008.5.1.4.1.1.9.1.1':'12-lead ECG Waveform Storage',\n  '1.2.840.10008.5.1.4.1.1.9.1.2':'General ECG Waveform Storage',\n  '1.2.840.10008.5.1.4.1.1.9.1.3':'Ambulatory ECG Waveform Storage',\n  '1.2.840.10008.5.1.4.1.1.9.2.1':'Hemodynamic Waveform Storage',\n  '1.2.840.10008.5.1.4.1.1.9.3.1':'Cardiac Electrophysiology Waveform Storage',\n  '1.2.840.10008.5.1.4.1.1.9.4.1':'Basic Voice Audio Waveform Storage',\n  '1.2.840.10008.5.1.4.1.1.9.4.2':'General Audio Waveform Storage',\n  '1.2.840.10008.5.1.4.1.1.9.5.1':'Arterial Pulse Waveform Storage',\n  '1.2.840.10008.5.1.4.1.1.9.6.1':'Respiratory Waveform Storage',\n  '1.2.840.10008.5.1.4.1.1.10':'Standalone Modality LUT Storage (Retired)',\n  '1.2.840.10008.5.1.4.1.1.11':'Standalone VOI LUT Storage (Retired)',\n  '1.2.840.10008.5.1.4.1.1.11.1':'Grayscale Softcopy Presentation State Storage SOP Class',\n  '1.2.840.10008.5.1.4.1.1.11.2':'Color Softcopy Presentation State Storage SOP Class',\n  '1.2.840.10008.5.1.4.1.1.11.3':'Pseudo-Color Softcopy Presentation State Storage SOP Class',\n  '1.2.840.10008.5.1.4.1.1.11.4':'Blending Softcopy Presentation State Storage SOP Class',\n  '1.2.840.10008.5.1.4.1.1.11.5':'XA/XRF Grayscale Softcopy Presentation State Storage',\n  '1.2.840.10008.5.1.4.1.1.12.1':'X-Ray Angiographic Image Storage',\n  '1.2.840.10008.5.1.4.1.1.12.1.1':'Enhanced XA Image Storage',\n  '1.2.840.10008.5.1.4.1.1.12.2':'X-Ray Radiofluoroscopic Image Storage',\n  '1.2.840.10008.5.1.4.1.1.12.2.1':'Enhanced XRF Image Storage',\n  '1.2.840.10008.5.1.4.1.1.12.3':'X-Ray Angiographic Bi-Plane Image Storage (Retired)',\n  '1.2.840.10008.5.1.4.1.1.13.1.1':'X-Ray 3D Angiographic Image Storage',\n  '1.2.840.10008.5.1.4.1.1.13.1.2':'X-Ray 3D Craniofacial Image Storage',\n  '1.2.840.10008.5.1.4.1.1.13.1.3':'Breast Tomosynthesis Image Storage',\n  '1.2.840.10008.5.1.4.1.1.13.1.4':'Breast Projection X-Ray Image Storage - For Presentation',\n  '1.2.840.10008.5.1.4.1.1.13.1.5':'Breast Projection X-Ray Image Storage - For Processing',\n  '1.2.840.10008.5.1.4.1.1.14.1':'Intravascular Optical Coherence Tomography Image Storage - For Presentation',\n  '1.2.840.10008.5.1.4.1.1.14.2':'Intravascular Optical Coherence Tomography Image Storage - For Processing',\n  '1.2.840.10008.5.1.4.1.1.20':'Nuclear Medicine Image Storage',\n  '1.2.840.10008.5.1.4.1.1.30':'Parametric Map Storage',\n  '1.2.840.10008.5.1.4.1.1.66':'Raw Data Storage',\n  '1.2.840.10008.5.1.4.1.1.66.1':'Spatial Registration Storage',\n  '1.2.840.10008.5.1.4.1.1.66.2':'Spatial Fiducials Storage',\n  '1.2.840.10008.5.1.4.1.1.66.3':'Deformable Spatial Registration Storage',\n  '1.2.840.10008.5.1.4.1.1.66.4':'Segmentation Storage',\n  '1.2.840.10008.5.1.4.1.1.66.5':'Surface Segmentation Storage',\n  '1.2.840.10008.5.1.4.1.1.67':'Real World Value Mapping Storage',\n  '1.2.840.10008.5.1.4.1.1.68.1':'Surface Scan Mesh Storage',\n  '1.2.840.10008.5.1.4.1.1.68.2':'Surface Scan Point Cloud Storage',\n  '1.2.840.10008.5.1.4.1.1.77.1':'VL Image Storage - Trial (Retired)',\n  '1.2.840.10008.5.1.4.1.1.77.2':'VL Multi-frame Image Storage - Trial (Retired)',\n  '1.2.840.10008.5.1.4.1.1.77.1.1':'VL Endoscopic Image Storage',\n  '1.2.840.10008.5.1.4.1.1.77.1.1.1':'Video Endoscopic Image Storage',\n  '1.2.840.10008.5.1.4.1.1.77.1.2':'VL Microscopic Image Storage',\n  '1.2.840.10008.5.1.4.1.1.77.1.2.1':'Video Microscopic Image Storage',\n  '1.2.840.10008.5.1.4.1.1.77.1.3':'VL Slide-Coordinates Microscopic Image Storage',\n  '1.2.840.10008.5.1.4.1.1.77.1.4':'VL Photographic Image Storage',\n  '1.2.840.10008.5.1.4.1.1.77.1.4.1':'Video Photographic Image Storage',\n  '1.2.840.10008.5.1.4.1.1.77.1.5.1':'Ophthalmic Photography 8 Bit Image Storage',\n  '1.2.840.10008.5.1.4.1.1.77.1.5.2':'Ophthalmic Photography 16 Bit Image Storage',\n  '1.2.840.10008.5.1.4.1.1.77.1.5.3':'Stereometric Relationship Storage',\n  '1.2.840.10008.5.1.4.1.1.77.1.5.4':'Ophthalmic Tomography Image Storage',\n  '1.2.840.10008.5.1.4.1.1.77.1.5.5':'Wide Field Ophthalmic Photography Stereographic Projection Image Storage',\n  '1.2.840.10008.5.1.4.1.1.77.1.5.6':'Wide Field Ophthalmic Photography 3D Coordinates Image Storage',\n  '1.2.840.10008.5.1.4.1.1.77.1.6':'VL Whole Slide Microscopy Image Storage',\n  '1.2.840.10008.5.1.4.1.1.78.1':'Lensometry Measurements Storage',\n  '1.2.840.10008.5.1.4.1.1.78.2':'Autorefraction Measurements Storage',\n  '1.2.840.10008.5.1.4.1.1.78.3':'Keratometry Measurements Storage',\n  '1.2.840.10008.5.1.4.1.1.78.4':'Subjective Refraction Measurements Storage',\n  '1.2.840.10008.5.1.4.1.1.78.5':'Visual Acuity Measurements Storage',\n  '1.2.840.10008.5.1.4.1.1.78.6':'Spectacle Prescription Report Storage',\n  '1.2.840.10008.5.1.4.1.1.78.7':'Ophthalmic Axial Measurements Storage',\n  '1.2.840.10008.5.1.4.1.1.78.8':'Intraocular Lens Calculations Storage',\n  '1.2.840.10008.5.1.4.1.1.79.1':'Macular Grid Thickness and Volume Report Storage',\n  '1.2.840.10008.5.1.4.1.1.80.1':'Ophthalmic Visual Field Static Perimetry Measurements Storage',\n  '1.2.840.10008.5.1.4.1.1.81.1':'Ophthalmic Thickness Map Storage',\n  '1.2.840.10008.5.1.4.1.1.82.1':'Corneal Topography Map Storage',\n  '1.2.840.10008.5.1.4.1.1.88.1':'Text SR Storage - Trial (Retired)',\n  '1.2.840.10008.5.1.4.1.1.88.2':'Audio SR Storage - Trial (Retired)',\n  '1.2.840.10008.5.1.4.1.1.88.3':'Detail SR Storage - Trial (Retired)',\n  '1.2.840.10008.5.1.4.1.1.88.4':'Comprehensive SR Storage - Trial (Retired)',\n  '1.2.840.10008.5.1.4.1.1.88.11':'Basic Text SR Storage',\n  '1.2.840.10008.5.1.4.1.1.88.22':'Enhanced SR Storage',\n  '1.2.840.10008.5.1.4.1.1.88.33':'Comprehensive SR Storage',\n  '1.2.840.10008.5.1.4.1.1.88.34':'Comprehensive 3D SR Storage',\n  '1.2.840.10008.5.1.4.1.1.88.35':'Extensible SR Storage',\n  '1.2.840.10008.5.1.4.1.1.88.40':'Procedure Log Storage',\n  '1.2.840.10008.5.1.4.1.1.88.50':'Mammography CAD SR Storage',\n  '1.2.840.10008.5.1.4.1.1.88.59':'Key Object Selection Document Storage',\n  '1.2.840.10008.5.1.4.1.1.88.65':'Chest CAD SR Storage',\n  '1.2.840.10008.5.1.4.1.1.88.67':'X-Ray Radiation Dose SR Storage',\n  '1.2.840.10008.5.1.4.1.1.88.68':'Radiopharmaceutical Radiation Dose SR Storage',\n  '1.2.840.10008.5.1.4.1.1.88.69':'Colon CAD SR Storage',\n  '1.2.840.10008.5.1.4.1.1.88.70':'Implantation Plan SR Storage',\n  '1.2.840.10008.5.1.4.1.1.104.1':'Encapsulated PDF Storage',\n  '1.2.840.10008.5.1.4.1.1.104.2':'Encapsulated CDA Storage',\n  '1.2.840.10008.5.1.4.1.1.128':'Positron Emission Tomography Image Storage',\n  '1.2.840.10008.5.1.4.1.1.128.1':'Legacy Converted Enhanced PET Image Storage',\n  '1.2.840.10008.5.1.4.1.1.129':'Standalone PET Curve Storage (Retired)',\n  '1.2.840.10008.5.1.4.1.1.130':'Enhanced PET Image Storage',\n  '1.2.840.10008.5.1.4.1.1.131':'Basic Structured Display Storage',\n  '1.2.840.10008.5.1.4.1.1.481.1':'RT Image Storage',\n  '1.2.840.10008.5.1.4.1.1.481.2':'RT Dose Storage',\n  '1.2.840.10008.5.1.4.1.1.481.3':'RT Structure Set Storage',\n  '1.2.840.10008.5.1.4.1.1.481.4':'RT Beams Treatment Record Storage',\n  '1.2.840.10008.5.1.4.1.1.481.5':'RT Plan Storage',\n  '1.2.840.10008.5.1.4.1.1.481.6':'RT Brachy Treatment Record Storage',\n  '1.2.840.10008.5.1.4.1.1.481.7':'RT Treatment Summary Record Storage',\n  '1.2.840.10008.5.1.4.1.1.481.8':'RT Ion Plan Storage',\n  '1.2.840.10008.5.1.4.1.1.481.9':'RT Ion Beams Treatment Record Storage',\n  '1.2.840.10008.5.1.4.1.1.501.1':'DICOS CT Image Storage',\n  '1.2.840.10008.5.1.4.1.1.501.2.1':'DICOS Digital X-Ray Image Storage - For Presentation',\n  '1.2.840.10008.5.1.4.1.1.501.2.2':'DICOS Digital X-Ray Image Storage - For Processing',\n  '1.2.840.10008.5.1.4.1.1.501.3':'DICOS Threat Detection Report Storage',\n  '1.2.840.10008.5.1.4.1.1.501.4':'DICOS 2D AIT Storage',\n  '1.2.840.10008.5.1.4.1.1.501.5':'DICOS 3D AIT Storage',\n  '1.2.840.10008.5.1.4.1.1.501.6':'DICOS Quadrupole Resonance (QR) Storage',\n  '1.2.840.10008.5.1.4.1.1.601.1':'Eddy Current Image Storage',\n  '1.2.840.10008.5.1.4.1.1.601.2':'Eddy Current Multi-frame Image Storage',\n  '1.2.840.10008.5.1.4.1.2.1.1':'Patient Root Query/Retrieve Information Model - FIND',\n  '1.2.840.10008.5.1.4.1.2.1.2':'Patient Root Query/Retrieve Information Model - MOVE',\n  '1.2.840.10008.5.1.4.1.2.1.3':'Patient Root Query/Retrieve Information Model - GET',\n  '1.2.840.10008.5.1.4.1.2.2.1':'Study Root Query/Retrieve Information Model - FIND',\n  '1.2.840.10008.5.1.4.1.2.2.2':'Study Root Query/Retrieve Information Model - MOVE',\n  '1.2.840.10008.5.1.4.1.2.2.3':'Study Root Query/Retrieve Information Model - GET',\n  '1.2.840.10008.5.1.4.1.2.3.1':'Patient/Study Only Query/Retrieve Information Model - FIND (Retired)',\n  '1.2.840.10008.5.1.4.1.2.3.2':'Patient/Study Only Query/Retrieve Information Model - MOVE (Retired)',\n  '1.2.840.10008.5.1.4.1.2.3.3':'Patient/Study Only Query/Retrieve Information Model - GET (Retired)',\n  '1.2.840.10008.5.1.4.1.2.4.2':'Composite Instance Root Retrieve - MOVE',\n  '1.2.840.10008.5.1.4.1.2.4.3':'Composite Instance Root Retrieve - GET',\n  '1.2.840.10008.5.1.4.1.2.5.3':'Composite Instance Retrieve Without Bulk Data - GET',\n  '1.2.840.10008.5.1.4.31':'Modality Worklist Information Model - FIND',\n  '1.2.840.10008.5.1.4.32':'General Purpose Worklist Management Meta SOP Class (Retired)',\n  '1.2.840.10008.5.1.4.32.1':'General Purpose Worklist Information Model - FIND (Retired)',\n  '1.2.840.10008.5.1.4.32.2':'General Purpose Scheduled Procedure Step SOP Class (Retired)',\n  '1.2.840.10008.5.1.4.32.3':'General Purpose Performed Procedure Step SOP Class (Retired)',\n  '1.2.840.10008.5.1.4.33':'Instance Availability Notification SOP Class',\n  '1.2.840.10008.5.1.4.34.1':'RT Beams Delivery Instruction Storage - Trial (Retired)',\n  '1.2.840.10008.5.1.4.34.2':'RT Conventional Machine Verification - Trial (Retired)',\n  '1.2.840.10008.5.1.4.34.3':'RT Ion Machine Verification - Trial (Retired)',\n  '1.2.840.10008.5.1.4.34.4':'Unified Worklist and Procedure Step Service Class - Trial (Retired)',\n  '1.2.840.10008.5.1.4.34.4.1':'Unified Procedure Step - Push SOP Class - Trial (Retired)',\n  '1.2.840.10008.5.1.4.34.4.2':'Unified Procedure Step - Watch SOP Class - Trial (Retired)',\n  '1.2.840.10008.5.1.4.34.4.3':'Unified Procedure Step - Pull SOP Class - Trial (Retired)',\n  '1.2.840.10008.5.1.4.34.4.4':'Unified Procedure Step - Event SOP Class - Trial (Retired)',\n  '1.2.840.10008.5.1.4.34.5':'UPS Global Subscription SOP Instance',\n  '1.2.840.10008.5.1.4.34.5.1':'UPS Filtered Global Subscription SOP Instance',\n  '1.2.840.10008.5.1.4.34.6':'Unified Worklist and Procedure Step Service Class',\n  '1.2.840.10008.5.1.4.34.6.1':'Unified Procedure Step - Push SOP Class',\n  '1.2.840.10008.5.1.4.34.6.2':'Unified Procedure Step - Watch SOP Class',\n  '1.2.840.10008.5.1.4.34.6.3':'Unified Procedure Step - Pull SOP Class',\n  '1.2.840.10008.5.1.4.34.6.4':'Unified Procedure Step - Event SOP Class',\n  '1.2.840.10008.5.1.4.34.7':'RT Beams Delivery Instruction Storage',\n  '1.2.840.10008.5.1.4.34.8':'RT Conventional Machine Verification',\n  '1.2.840.10008.5.1.4.34.9':'RT Ion Machine Verification',\n  '1.2.840.10008.5.1.4.37.1':'General Relevant Patient Information Query',\n  '1.2.840.10008.5.1.4.37.2':'Breast Imaging Relevant Patient Information Query',\n  '1.2.840.10008.5.1.4.37.3':'Cardiac Relevant Patient Information Query',\n  '1.2.840.10008.5.1.4.38.1':'Hanging Protocol Storage',\n  '1.2.840.10008.5.1.4.38.2':'Hanging Protocol Information Model - FIND',\n  '1.2.840.10008.5.1.4.38.3':'Hanging Protocol Information Model - MOVE',\n  '1.2.840.10008.5.1.4.38.4':'Hanging Protocol Information Model - GET',\n  '1.2.840.10008.5.1.4.39.1':'Color Palette Storage',\n  '1.2.840.10008.5.1.4.39.2':'Color Palette Information Model - FIND',\n  '1.2.840.10008.5.1.4.39.3':'Color Palette Information Model - MOVE',\n  '1.2.840.10008.5.1.4.39.4':'Color Palette Information Model - GET',\n  '1.2.840.10008.5.1.4.41':'Product Characteristics Query SOP Class',\n  '1.2.840.10008.5.1.4.42':'Substance Approval Query SOP Class',\n  '1.2.840.10008.5.1.4.43.1':'Generic Implant Template Storage',\n  '1.2.840.10008.5.1.4.43.2':'Generic Implant Template Information Model - FIND',\n  '1.2.840.10008.5.1.4.43.3':'Generic Implant Template Information Model - MOVE',\n  '1.2.840.10008.5.1.4.43.4':'Generic Implant Template Information Model - GET',\n  '1.2.840.10008.5.1.4.44.1':'Implant Assembly Template Storage',\n  '1.2.840.10008.5.1.4.44.2':'Implant Assembly Template Information Model - FIND',\n  '1.2.840.10008.5.1.4.44.3':'Implant Assembly Template Information Model - MOVE',\n  '1.2.840.10008.5.1.4.44.4':'Implant Assembly Template Information Model - GET',\n  '1.2.840.10008.5.1.4.45.1':'Implant Template Group Storage',\n  '1.2.840.10008.5.1.4.45.2':'Implant Template Group Information Model - FIND',\n  '1.2.840.10008.5.1.4.45.3':'Implant Template Group Information Model - MOVE',\n  '1.2.840.10008.5.1.4.45.4':'Implant Template Group Information Model - GET',\n  '1.2.840.10008.7.1.1':'Native DICOM Model',\n  '1.2.840.10008.7.1.2':'Abstract Multi-Dimensional Image Model',\n  '1.2.840.10008.8.1.1':'DICOM Content Mapping Resource',\n  '1.2.840.10008.15.0.3.1':'dicomDeviceName',\n  '1.2.840.10008.15.0.3.2':'dicomDescription',\n  '1.2.840.10008.15.0.3.3':'dicomManufacturer',\n  '1.2.840.10008.15.0.3.4':'dicomManufacturerModelName',\n  '1.2.840.10008.15.0.3.5':'dicomSoftwareVersion',\n  '1.2.840.10008.15.0.3.6':'dicomVendorData',\n  '1.2.840.10008.15.0.3.7':'dicomAETitle',\n  '1.2.840.10008.15.0.3.8':'dicomNetworkConnectionReference',\n  '1.2.840.10008.15.0.3.9':'dicomApplicationCluster',\n  '1.2.840.10008.15.0.3.10':'dicomAssociationInitiator',\n  '1.2.840.10008.15.0.3.11':'dicomAssociationAcceptor',\n  '1.2.840.10008.15.0.3.12':'dicomHostname',\n  '1.2.840.10008.15.0.3.13':'dicomPort',\n  '1.2.840.10008.15.0.3.14':'dicomSOPClass',\n  '1.2.840.10008.15.0.3.15':'dicomTransferRole',\n  '1.2.840.10008.15.0.3.16':'dicomTransferSyntax',\n  '1.2.840.10008.15.0.3.17':'dicomPrimaryDeviceType',\n  '1.2.840.10008.15.0.3.18':'dicomRelatedDeviceReference',\n  '1.2.840.10008.15.0.3.19':'dicomPreferredCalledAETitle',\n  '1.2.840.10008.15.0.3.20':'dicomTLSCyphersuite',\n  '1.2.840.10008.15.0.3.21':'dicomAuthorizedNodeCertificateReference',\n  '1.2.840.10008.15.0.3.22':'dicomThisNodeCertificateReference',\n  '1.2.840.10008.15.0.3.23':'dicomInstalled',\n  '1.2.840.10008.15.0.3.24':'dicomStationName',\n  '1.2.840.10008.15.0.3.25':'dicomDeviceSerialNumber',\n  '1.2.840.10008.15.0.3.26':'dicomInstitutionName',\n  '1.2.840.10008.15.0.3.27':'dicomInstitutionAddress',\n  '1.2.840.10008.15.0.3.28':'dicomInstitutionDepartmentName',\n  '1.2.840.10008.15.0.3.29':'dicomIssuerOfPatientID',\n  '1.2.840.10008.15.0.3.30':'dicomPreferredCallingAETitle',\n  '1.2.840.10008.15.0.3.31':'dicomSupportedCharacterSet',\n  '1.2.840.10008.15.0.4.1':'dicomConfigurationRoot',\n  '1.2.840.10008.15.0.4.2':'dicomDevicesRoot',\n  '1.2.840.10008.15.0.4.3':'dicomUniqueAETitlesRegistryRoot',\n  '1.2.840.10008.15.0.4.4':'dicomDevice',\n  '1.2.840.10008.15.0.4.5':'dicomNetworkAE',\n  '1.2.840.10008.15.0.4.6':'dicomNetworkConnection',\n  '1.2.840.10008.15.0.4.7':'dicomUniqueAETitle',\n  '1.2.840.10008.15.0.4.8':'dicomTransferCapability',\n  '1.2.840.10008.15.1.1':'Universal Coordinated Time',\n};\n","import React, { PureComponent } from 'react'\nimport Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport LinearProgress from '@material-ui/core/LinearProgress'\n\nclass OpenUrlDlg extends PureComponent {\n\n  hide = () => {\n    this.props.onClose()\n  }\n\n  cancel = () => {\n    window.stop()\n    this.hide()\n  }\n\n  render() {\n    return (\n      <div>\n        <Dialog\n            open={true}\n            onClose={this.hide}\n            aria-labelledby=\"alert-dialog-title\"\n        >\n            <DialogTitle id=\"alert-dialog-title\">{\"Downloading file ...\"}</DialogTitle>\n            <DialogContent>\n              <LinearProgress variant=\"determinate\" value={this.props.progress} color='secondary' />\n            </DialogContent>\n            <DialogActions>\n                <Button onClick={this.cancel}>\n                    Cancel\n                </Button>\n            </DialogActions>\n        </Dialog>\n      </div>\n    )\n  }\n}\n\nexport default OpenUrlDlg\n","import React, { PureComponent } from 'react'\nimport Icon from '@mdi/react'\nimport IconButton from '@material-ui/core/IconButton'\n\nimport { \n    mdiPlay,\n    mdiPause,\n    mdiSkipBackward,\n    mdiSkipForward,\n    mdiSkipNext,\n    mdiSkipPrevious,\n  } from '@mdi/js'\n\nconst iconColor = '#FFFFFF'\n\nclass CinePlayer extends PureComponent {\n    firstframe = () => {\n        this.props.runCinePlayer('firstframe') \n    }\n\n    previousframe = () => {\n        this.props.runCinePlayer('previousframe') \n    }\n\n    play = () => {\n        this.props.runCinePlayer('play') \n    }\n\n    pause = () => {\n        this.props.runCinePlayer('pause') \n    }\n\n    nextframe = () => {\n        this.props.runCinePlayer('nextframe') \n    }\n\n    lastframe = () => {\n        this.props.runCinePlayer('lastframe') \n    }\n\n    render() {\n        let play = null\n        if (!this.props.inPlay) {\n            play = <IconButton onClick={this.play}>\n                        <Icon path={mdiPlay} size={'1.5rem'} color={iconColor} />\n                   </IconButton>          \n        } else {\n            play = <IconButton onClick={this.pause}>\n                        <Icon path={mdiPause} size={'1.5rem'} color={iconColor} />\n                   </IconButton>  \n        }\n        return (\n            <div style={{ width:240, margin:'0 auto' }}>\n                <IconButton onClick={this.firstframe}>\n                    <Icon path={mdiSkipBackward} size={'1.5rem'} color={iconColor} />\n                </IconButton>\n                <IconButton onClick={this.previousframe}>\n                    <Icon path={mdiSkipPrevious} size={'1.5rem'} color={iconColor} />\n                </IconButton>\n                {play}\n                <IconButton onClick={this.nextframe}>\n                    <Icon path={mdiSkipNext} size={'1.5rem'} color={iconColor} />\n                </IconButton>\n                <IconButton onClick={this.lastframe}>\n                    <Icon path={mdiSkipForward} size={'1.5rem'} color={iconColor} />\n                </IconButton>\n            </div>\n        )\n    }\n}\n\nexport default CinePlayer\n","import Dexie from 'dexie'\n\nconst db = new Dexie('udvDB')\n\ndb.version(1).stores({ \n    measurement: '++id, sopinstanceuid, tool' \n})\n\ndb.open()\n\nexport default db\n","import React from \"react\"\nimport {connect} from 'react-redux'\nimport Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogContentText from '@material-ui/core/DialogContentText'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport Link from '@material-ui/core/Link'\nimport Typography from '@material-ui/core/Typography'\nimport Hammer from \"hammerjs\"\nimport * as cornerstone from \"cornerstone-core\"\nimport * as cornerstoneTools from \"cornerstone-tools\"\nimport * as cornerstoneMath from \"cornerstone-math\"\nimport * as cornerstoneFileImageLoader from \"cornerstone-file-image-loader\"\nimport * as cornerstoneWebImageLoader from \"cornerstone-web-image-loader\"\nimport * as cornerstoneWADOImageLoader from \"cornerstone-wado-image-loader\"\nimport * as dicomParser from 'dicom-parser'\nimport * as blobUtil from 'blob-util'\nimport {uids} from '../constants/uids'\nimport { SETTINGS_SAVEAS } from '../constants/settings'\nimport OpenUrlDlg from './OpenUrlDlg'\nimport CinePlayer from './CinePlayer'\nimport { isMobile } from 'react-device-detect'\nimport { import as csTools } from 'cornerstone-tools'\nimport db from '../db/db'\nimport fs from '../fs/fs'\nimport {\n  clearStore,\n  dcmIsOpen,\n  activeDcm,\n  dcmTool,\n  activeMeasurements,\n  doFsRefresh}\nfrom '../actions'\nimport {\n  capitalize,\n  getFileName,\n  getSettingsOverlay,\n  isFileImage,\n  isFsFileImage,\n  isUrlImage,\n  getSettingsSaveInto\n} from '../functions'\n\nconst scrollToIndex = csTools('util/scrollToIndex');\n\n/*\nfunction getBlobUrl(url) {\n  const baseUrl = window.URL || window.webkitURL;\n  const blob = new Blob([`importScripts('${url}')`], {type: \"application/javascript\"});\n  return baseUrl.createObjectURL(blob);\n}\n\nlet webWorkerUrl = getBlobUrl(\n  \"https://unpkg.com/cornerstone-wado-image-loader@3.0.0/dist/cornerstoneWADOImageLoaderWebWorker.min.js\"\n)\nlet codecsUrl = getBlobUrl(\n  \"https://unpkg.com/cornerstone-wado-image-loader@3.0.0/dist/cornerstoneWADOImageLoaderCodecs.js\"\n  // \"https://unpkg.com/cornerstone-wado-image-loader/dist/cornerstoneWADOImageLoaderCodecs.js\"\n)\n// See componentDidMount line 110 for initialization, registration\n\nconst config = {\n  maxWebWorkers: 4, //\n  //startWebWorkersOnDemand: true, //\n  webWorkerPath: webWorkerUrl,\n  //webWorkerTaskPaths: [], //\n  taskConfiguration: {\n    decodeTask: {\n      //loadCodecsOnStartup: true, //\n      //initializeCodecsOnStartup: false, //\n      codecsPath: codecsUrl,\n      //usePDFJS: false, //\n      //strict: true //\n    }\n  }\n}\nvar config = {\n  maxWebWorkers: navigator.hardwareConcurrency || 1,\n  startWebWorkersOnDemand: false,\n}\n*/\ncornerstoneTools.external.cornerstone = cornerstone;\ncornerstoneTools.external.cornerstoneMath = cornerstoneMath;\ncornerstoneFileImageLoader.external.cornerstone = cornerstone;\ncornerstoneWebImageLoader.external.cornerstone = cornerstone;\ncornerstoneWADOImageLoader.external.cornerstone = cornerstone;\n//cornerstoneWADOImageLoader.webWorkerManager.initialize(config)\ncornerstoneWADOImageLoader.external.dicomParser = dicomParser;\ncornerstoneTools.external.Hammer = Hammer;\ncornerstoneTools.init();\n\n//console.log({ cornerstone })\n//console.log({ cornerstoneWADOImageLoader })\n//console.log({ dicomParser })\n\nclass DicomViewer extends React.Component {\n    constructor(props) {\n      super(props);\n      this.filename = '';\n      this.localfile = null;\n      this.localurl = null;\n      this.fsItem = null;\n      this.dicomImage = null;\n      this.imageId = null;\n      this.image = null;\n      this.isDicom = false;\n      this.numberOfFrames = 1;\n      this.measurements = [];\n      this.xSize = 0;\n      this.ySize = 0;\n      this.zSize = 0;\n      this.volume = null;\n      this.originImage = null;\n      this.mprPlane = ''\n    }\n\n    state = {\n      visibleOpenUrlDlg: false,\n      progress: null,\n      visibleCinePlayer: false,\n      errorOnOpenImage: null,\n      errorOnCors: false,\n      frame: 1,\n      inPlay: false,\n      viewport: null,\n    };\n\n    componentDidMount() {\n      this.props.runTool(this);\n      // this.props.runTool2(this);\n      this.props.changeTool(this);\n      cornerstone.events.addEventListener('cornerstoneimageloaded', this.onImageLoaded);\n      const { dcmRef } = this.props;\n      dcmRef(this)\n\n    }\n\n    componentWillUnmount() {\n      this.props.runTool(undefined);\n      // this.props.runTool2(undefined);\n      this.props.changeTool(undefined);\n      const { dcmRef } = this.props;\n      dcmRef(undefined)\n    }\n\n    componentDidUpdate(previousProps) {\n      //console.log('dicomviewer - componentDidUpdate: ')\n      /*if (this.props.files !== null) {\n        console.log('this.props.files[0]: ', this.props.files[0])\n        console.log('this.props.files: ', this.props.files)\n      }*/\n      /*if (this.props.volume !== null) {\n        console.log('volume set: ', this.props.volume)\n        this.volume = this.props.volume\n      }*/\n      const isOpen = this.props.isOpen[this.props.index];\n      if (this.props.layout !== previousProps.layout && isOpen) {\n        cornerstone.resize(this.dicomImage)\n      }\n    }\n\n    onOpenUrl = (e) => {\n      const eventData = e.detail;\n      this.setState({ progress: eventData.percentComplete })\n    };\n\n    showOpenUrlDlg = (url) => {\n      this.setState({ visibleOpenUrlDlg: true }, () => {\n        cornerstone.events.addEventListener('cornerstoneimageloadprogress', this.onOpenUrl);\n        this.loadImage(undefined, url)\n      })\n    };\n\n    hideOpenUrlDlg = () => {\n      this.setState({ visibleOpenUrlDlg: false, progress: null })\n    };\n\n    measurementSave = (measure) => {\n      this.measurements.push(measure)\n    };\n\n    measurementClear = () => {\n      this.measurements.splice(0, this.measurements.length)\n    };\n\n    measurementRemove = (index) => {\n      //console.log('this.measurements: ', this.measurements)\n      this.measurements.splice(index, 1)\n    };\n\n    getTransferSyntax = () => {\n      const value = this.image.data.string('x00020010');\n      return value + ' [' + uids[value] + ']'\n    };\n\n    getSopClass = () => {\n      const value = this.image.data.string('x00080016');\n      return value + ' [' + uids[value] + ']'\n    };\n\n    getSopInstanceUID = () => {\n      const value = this.image.data.string('x00080018');\n      return value\n    };\n\n    getPixelRepresentation = () => {\n      const value = this.image.data.uint16('x00280103');\n      if (value === undefined) return;\n      return value + (value === 0 ? ' (unsigned)' : ' (signed)')\n    };\n\n    getPlanarConfiguration = () => {\n      const value = this.image.data.uint16('x00280006');\n      if (value === undefined) return;\n      return value + (value === 0 ? ' (pixel)' : ' (plane)')\n    };\n\n    onImageLoaded = (e) => {\n      //console.log('cornerstoneimageloaded: ')\n    };\n\n    // Listen for changes to the viewport so we can update the text overlays in the corner\n    onImageRendered = (e) => {\n      //console.log('cornerstoneimagerendered: ', e.target)\n      //console.log('cornerstoneimagerendered, plane: ', this.mprPlane)\n\n      //const viewport = cornerstone.getViewport(this.dicomImage)\n      const viewport = cornerstone.getViewport(e.target);\n\n      //console.log('viewport: ', viewport)\n\n      //if (this.props.activeDcm !== null)\n      //  console.log('viewport activeDcm: ', cornerstone.getViewport(this.props.activeDcm.element))\n\n      console.log(\"props.index : \", this.props.index);\n      document.getElementById(\n        `mrtopleft-${this.props.index}`\n      ).textContent = this.mprIsOrthogonalView() ? `${capitalize(this.mprPlane)}` : `${this.PatientsName}`;\n\n      document.getElementById(\n        `mrtopright-${this.props.index}`\n      ).textContent = `${viewport.displayedArea.brhc.x}x${viewport.displayedArea.brhc.y}`;\n\n      document.getElementById(\n        `mrbottomleft-${this.props.index}`\n      ).textContent = `WW/WC: ${Math.round(viewport.voi.windowWidth)}/${Math.round(viewport.voi.windowCenter)}`;\n\n      document.getElementById(\n        `mrbottomright-${this.props.index}`\n      ).textContent = `Zoom: ${Math.round(viewport.scale.toFixed(2)*100)}%`;\n\n      document.getElementById(\n        `mrtopcenter-${this.props.index}`\n      ).textContent = ``;\n      document.getElementById(\n        `mrbottomcenter-${this.props.index}`\n      ).textContent = ``;\n      document.getElementById(\n        `mrleftcenter-${this.props.index}`\n      ).textContent = ``;\n      document.getElementById(\n        `mrrightcenter-${this.props.index}`\n      ).textContent = ``;\n\n      if (this.mprPlane === 'sagittal') {\n        document.getElementById(\n          `mrtopcenter-${this.props.index}`\n        ).textContent = `S`;\n        document.getElementById(\n          `mrbottomcenter-${this.props.index}`\n        ).textContent = `I`;\n        document.getElementById(\n          `mrleftcenter-${this.props.index}`\n        ).textContent = `A`;\n        document.getElementById(\n          `mrrightcenter-${this.props.index}`\n        ).textContent = `P`\n\n      } else if (this.mprPlane === 'axial') {\n        document.getElementById(\n          `mrtopcenter-${this.props.index}`\n        ).textContent = `A`;\n        document.getElementById(\n          `mrbottomcenter-${this.props.index}`\n        ).textContent = `P`;\n        document.getElementById(\n          `mrleftcenter-${this.props.index}`\n        ).textContent = `R`;\n        document.getElementById(\n          `mrrightcenter-${this.props.index}`\n        ).textContent = `L`\n\n      } else if (this.mprPlane === 'coronal') {\n        document.getElementById(\n          `mrtopcenter-${this.props.index}`\n        ).textContent = `S`;\n        document.getElementById(\n          `mrbottomcenter-${this.props.index}`\n        ).textContent = `I`;\n        document.getElementById(\n          `mrleftcenter-${this.props.index}`\n        ).textContent = `R`;\n        document.getElementById(\n          `mrrightcenter-${this.props.index}`\n        ).textContent = `L`\n      }\n\n      if (this.isDicom && this.state.visibleCinePlayer && this.numberOfFrames > 1) {\n        document.getElementById(\n          `frameLabel-${this.props.index}`\n        ).textContent = `${this.state.frame} / ${this.numberOfFrames}`;\n        if (this.state.inPlay) {\n          let frame = this.state.frame === this.numberOfFrames ? 1 : this.state.frame+1;\n          this.setState({frame: frame})\n        }\n      }\n    };\n\n    onMeasurementModified = (e) => {\n      //console.log('cornerstonetoolsmeasurementmodified: ', e.detail.measurementData)\n\n    };\n\n    onMeasurementAdded = (e) => {\n      //console.log('cornerstonetoolsmeasurementadded: ', e.detail.measurementData)\n      if (this.props.tool !== \"Angle\") return;\n      const measure = {\n        tool: this.props.tool,\n        note: '',\n        data: e.detail.measurementData\n      };\n      this.measurementSave(measure);\n      this.props.setActiveMeasurements(this.measurements)\n    };\n\n    onMeasurementCompleted = (e) => {\n      //console.log('cornerstonetoolsmeasurementcompleted: ', e.detail.measurementData)\n      const measure = {\n        tool: this.props.tool,\n        note: '',\n        data: e.detail.measurementData\n      };\n      if (this.props.tool === \"FreehandRoi\") {\n        setTimeout(() => {\n          this.measurementSave(measure);\n          this.props.setActiveMeasurements(this.measurements)\n        }, 500)\n      } else {\n        this.measurementSave(measure);\n        this.props.setActiveMeasurements(this.measurements)\n      }\n    };\n\n    onErrorOpenImageClose = () => {\n      this.setState({errorOnOpenImage: null})\n    };\n\n    onErrorCorsClose = () => {\n      this.setState({errorOnCors: false})\n    };\n\n    /*overlayImage = () => {\n      const viewport = cornerstone.getViewport(this.dicomImage)\n\n      if (this.isDicom) document.getElementById(\n        `mrtopleft-${this.props.index}`\n      ).textContent = `${this.PatientsName}`\n\n      document.getElementById(\n        `mrtopright-${this.props.index}`\n      ).textContent = `${viewport.displayedArea.brhc.x}x${viewport.displayedArea.brhc.y}`\n\n      document.getElementById(\n        `mrbottomleft-${this.props.index}`\n      ).textContent = `WW/WC: ${Math.round(viewport.voi.windowWidth)}/${Math.round(viewport.voi.windowCenter)}`\n\n      document.getElementById(\n        `mrbottomright-${this.props.index}`\n      ).textContent = `Zoom: ${Math.round(viewport.scale.toFixed(2)*100)}%`\n\n      if (this.isDicom && this.state.visibleCinePlayer && this.numberOfFrames > 1) {\n        document.getElementById(\n          `frameLabel-${this.props.index}`\n        ).textContent = `${this.state.frame} / ${this.numberOfFrames}`\n        if (this.state.inPlay) {\n          let frame = this.state.frame === this.numberOfFrames ? 1 : this.state.frame+1\n          this.setState({frame: frame})\n        }\n      }\n    }*/\n\n    displayImageFromFilesByImage = (index, image) => {\n\n      const element = this.dicomImage;\n      cornerstone.enable(element);\n      cornerstone.displayImage(element, image);\n    }\n    displayImageFromFilesMohammad = (_files) => {\n      // console.log('displayImageFromFiles: ', index);\n      // console.log('files: ', this.props.files);\n\n\n      // const files = this.files === null ? this.props.files : this.files\n      let files = _files;\n\n      // console.log('displayImageFromFiles - this.files: ', this.files)\n\n      // MOHAMMAD\n      let imageIds = [];\n      for(let i=0; i< files.length; i++){\n        // imageIds.push(files[i].imageId);\n        imageIds.push(cornerstoneWADOImageLoader.wadouri.fileManager.add(files[i]));\n        console.log('file -- ' ,files[i]);\n        console.log('files image id-- ' ,cornerstoneWADOImageLoader.wadouri.fileManager.add(files[i]));\n      }\n      let stack = {\n        currentImageIdIndex: 0,\n        imageIds\n      }\n\n\n\n\n\n      // const image = this.props.files[index].image;\n      // const imageId = this.props.files[index].imageId;\n      // this.filename = this.props.files[index].name;\n\n      // let image = files[0].image;\n      // let imageId = files[0].imageId;\n      this.filename = files[0].name;\n\n      let element = this.dicomImage;\n      element.addEventListener(\"cornerstonenewimage\", this.onNewImage);\n      element.addEventListener(\"cornerstoneimagerendered\", this.onImageRendered);\n      element.addEventListener(\"cornerstonetoolsmeasurementadded\", this.onMeasurementAdded);\n      element.addEventListener(\"cornerstonetoolsmeasurementmodified\", this.onMeasurementModified);\n      element.addEventListener(\"cornerstonetoolsmeasurementcompleted\", this.onMeasurementCompleted);\n      cornerstone.enable(element);\n\n      // this.image = image;\n\n      // this.isDicom = true;\n\n      // this.PatientsName = image.data.string('x00100010');\n      // this.sopInstanceUid = this.getSopInstanceUID();\n\n      // let stack = { currentImageIdIndex: 0, imageIds: \"\" };\n      // this.numberOfFrames = image.data.intString('x00280008');\n      // if (this.numberOfFrames > 0) {\n      //   let imageIds = [];\n      //   for(var i=0; i < this.numberOfFrames; ++i) {\n      //     imageIds.push(imageId + \"?frame=\"+i)\n      //   }\n      //   stack.imageIds = imageIds\n      // }\n\n\n\n\n      // MOHAMMAD\n      // Add our tool, and set it's mode\n      const StackScrollMouseWheelTool = cornerstoneTools.StackScrollMouseWheelTool\n      cornerstone.loadImage(imageIds[0]).then((image) => {\n        this.image = image\n        this.isDicom = true\n\n        cornerstone.displayImage(element, image)\n        this.mprPlanePosition()\n        cornerstoneTools.addStackStateManager(element, ['stack'])\n        cornerstoneTools.addToolState(element, 'stack', stack)\n      })\n      cornerstoneTools.addTool(StackScrollMouseWheelTool)\n      cornerstoneTools.setToolActive('StackScrollMouseWheel', { })\n\n\n\n\n\n      // cornerstone.displayImage(element, image);\n\n      // let viewport = cornerstone.getViewport(this.dicomImage)\n      // let lut =  cornerstone.generateLut(this.image, viewport.voi.windowWidth, viewport.voi.windowCenter, viewport.invert, viewport.modalityLUT, viewport.voiLUT)\n      // this.props.setLutStore(lut)\n      // this.mprPlanePosition();\n\n\n\n      this.props.setActiveDcm({image: this.image, element: this.dicomImage, isDicom: this.isDicom});\n      // this.props.isOpenStore(true);\n      this.props.setIsOpenStore({index: this.props.index, value: true})\n\n\n\n      this.enableTool();\n\n      // if (this.numberOfFrames > 1) {\n      //   cornerstoneTools.addStackStateManager(element, ['stack', 'playClip']);\n      //   cornerstoneTools.addToolState(element, 'stack', stack);\n      //   this.setState({frame: 1})\n      // }\n\n      // Load the possible measurements from DB and save in the store\n      // db.measurement.where('sopinstanceuid').equals(this.sopInstanceUid).each(measure => {\n      //   console.log('load measure from db: ', measure);\n      //   this.measurementSave(measure);\n      //   cornerstoneTools.addToolState(element, measure.tool, measure.data);\n      //   this.runTool(measure.tool);\n      //   cornerstone.updateImage(element);\n      //   cornerstoneTools.setToolEnabled(measure.tool)\n      // }).then(() => {\n      //   this.props.setActiveMeasurements(this.measurements);\n      //   this.props.setActiveDcm({image: this.image, element: this.dicomImage, isDicom: this.isDicom});\n      //   this.props.setIsOpenStore({index: this.props.index, value: true})\n      // })\n\n      //this.overlayImage()\n\n    };\n    displayImageFromFiles = (index) => {\n      // console.log('displayImageFromFiles: ', index);\n      // console.log('files: ', this.props.files);\n\n\n      const files = this.files === null ? this.props.files : this.files\n      // let files = _files;\n\n      // console.log('displayImageFromFiles - this.files: ', this.files)\n\n      // MOHAMMAD\n      let imageIds = [];\n      for(let i=0; i< files.length; i++){\n        imageIds.push(files[i].imageId);\n        // imageIds.push(cornerstoneWADOImageLoader.wadouri.fileManager.add(files[i]));\n        // console.log('file -- ' ,files[i]);\n        // console.log('files image id-- ' ,cornerstoneWADOImageLoader.wadouri.fileManager.add(files[i]));\n      }\n      let stack = {\n        currentImageIdIndex: 0,\n        imageIds\n      }\n\n\n\n\n\n      const image = this.props.files[index].image;\n      // const imageId = this.props.files[index].imageId;\n      this.filename = this.props.files[index].name;\n\n      // const image = files[0].image;\n      // const imageId = files[0].imageId;\n      // this.filename = files[0].name;\n\n      const element = this.dicomImage;\n      element.addEventListener(\"cornerstonenewimage\", this.onNewImage);\n      element.addEventListener(\"cornerstoneimagerendered\", this.onImageRendered);\n      element.addEventListener(\"cornerstonetoolsmeasurementadded\", this.onMeasurementAdded);\n      element.addEventListener(\"cornerstonetoolsmeasurementmodified\", this.onMeasurementModified);\n      element.addEventListener(\"cornerstonetoolsmeasurementcompleted\", this.onMeasurementCompleted);\n      cornerstone.enable(element);\n\n      this.image = image;\n\n      this.isDicom = true;\n\n      this.PatientsName = image.data.string('x00100010');\n      this.sopInstanceUid = this.getSopInstanceUID();\n\n      // let stack = { currentImageIdIndex: 0, imageIds: \"\" };\n      // this.numberOfFrames = image.data.intString('x00280008');\n      // if (this.numberOfFrames > 0) {\n      //   let imageIds = [];\n      //   for(var i=0; i < this.numberOfFrames; ++i) {\n      //     imageIds.push(imageId + \"?frame=\"+i)\n      //   }\n      //   stack.imageIds = imageIds\n      // }\n\n\n\n\n      // MOHAMMAD\n      // Add our tool, and set it's mode\n      const StackScrollMouseWheelTool = cornerstoneTools.StackScrollMouseWheelTool\n      cornerstone.loadImage(imageIds[0]).then((image) => {\n        cornerstone.displayImage(element, image)\n        cornerstoneTools.addStackStateManager(element, ['stack'])\n        cornerstoneTools.addToolState(element, 'stack', stack)\n      })\n      cornerstoneTools.addTool(StackScrollMouseWheelTool)\n      cornerstoneTools.setToolActive('StackScrollMouseWheel', { })\n\n\n\n\n\n      // cornerstone.displayImage(element, image);\n\n      /*const viewport = cornerstone.getViewport(this.dicomImage)\n      const lut =  cornerstone.generateLut(this.image, viewport.voi.windowWidth, viewport.voi.windowCenter, viewport.invert, viewport.modalityLUT, viewport.voiLUT)\n      this.props.setLutStore(lut)*/\n      // this.mprPlanePosition();\n\n      this.enableTool();\n\n      // if (this.numberOfFrames > 1) {\n      //   cornerstoneTools.addStackStateManager(element, ['stack', 'playClip']);\n      //   cornerstoneTools.addToolState(element, 'stack', stack);\n      //   this.setState({frame: 1})\n      // }\n\n      // Load the possible measurements from DB and save in the store\n      db.measurement.where('sopinstanceuid').equals(this.sopInstanceUid).each(measure => {\n        console.log('load measure from db: ', measure);\n        this.measurementSave(measure);\n        cornerstoneTools.addToolState(element, measure.tool, measure.data);\n        this.runTool(measure.tool);\n        cornerstone.updateImage(element);\n        cornerstoneTools.setToolEnabled(measure.tool)\n      }).then(() => {\n        this.props.setActiveMeasurements(this.measurements);\n        this.props.setActiveDcm({image: this.image, element: this.dicomImage, isDicom: this.isDicom});\n        this.props.setIsOpenStore({index: this.props.index, value: true})\n      })\n\n      //this.overlayImage()\n\n    };\n\n    loadImageFromCanvas = (canvas) => {\n      console.log('loadImageFromCanvas, dcmViewer: ', this.props.index);\n\n      const element = this.dicomImage;\n      element.addEventListener(\"cornerstonenewimage\", this.onNewImage);\n      element.addEventListener(\"cornerstoneimagerendered\", this.onImageRendered);\n      element.addEventListener(\"cornerstonetoolsmeasurementadded\", this.onMeasurementAdded);\n      element.addEventListener(\"cornerstonetoolsmeasurementmodified\", this.onMeasurementModified);\n      element.addEventListener(\"cornerstonetoolsmeasurementcompleted\", this.onMeasurementCompleted);\n      cornerstone.enable(element);\n\n      const imageId = cornerstoneFileImageLoader.fileManager.addCanvas(canvas);\n\n      cornerstone.loadImage(imageId).then(image => {\n        //this.t1 = performance.now()\n        //console.log(`performance load image: ${this.t1-this.t0} milliseconds`)\n\n        console.log('loadImageFromCanvas, image: ', image);\n\n        this.image = image;\n\n        this.isDicom = false;\n\n        cornerstone.displayImage(element, image);\n\n        this.enableTool();\n\n        //this.props.setActiveDcm({image: this.image, element: this.dicomImage, isDicom: this.isDicom})\n        this.props.setIsOpenStore({index: this.props.index, value: true})\n\n        //this.t2 = performance.now()\n        //console.log(`performance: ${this.t2-this.t1} milliseconds`)\n\n        //this.overlayImage()\n\n      }, (e) => {\n        console.log('error', e);\n        this.setState({errorOnOpenImage: \"This is not a valid canvas.\"})\n      })\n    };\n\n    loadImageFromCustomObject = (columns, rows, pixelData) => {\n      //console.log('loadImageFromCustomObject: ')\n\n      const element = this.dicomImage;\n      element.addEventListener(\"cornerstonenewimage\", this.onNewImage);\n      element.addEventListener(\"cornerstoneimagerendered\", this.onImageRendered);\n      element.addEventListener(\"cornerstonetoolsmeasurementadded\", this.onMeasurementAdded);\n      element.addEventListener(\"cornerstonetoolsmeasurementmodified\", this.onMeasurementModified);\n      element.addEventListener(\"cornerstonetoolsmeasurementcompleted\", this.onMeasurementCompleted);\n      cornerstone.enable(element);\n\n      let customObj = {\n        rows: rows,\n        columns: columns,\n        pixelData: pixelData,\n        image: this.originImage,\n      };\n\n      const imageId = cornerstoneFileImageLoader.fileManager.addCustom(customObj);\n\n      cornerstone.loadImage(imageId).then(image => {\n        //console.log('loadImageFromCustomObject, image: ', image)\n\n        this.image = image;\n\n        this.isDicom = true;\n\n        cornerstone.displayImage(element, image);\n\n        //this.enableTool()\n\n        this.props.setIsOpenStore({index: this.props.index, value: true})\n\n      }, (e) => {\n        console.log('error', e);\n        this.setState({errorOnOpenImage: \"This is not a valid canvas.\"})\n      })\n    };\n\n    loadImage = (localfile, url=undefined, fsItem=undefined) => {\n      console.log('loadImage, localfile: ', localfile);\n      console.log('loadImage, fsItem: ', fsItem);\n      console.log('loadImage, url: ', url);\n\n      if (localfile === undefined && url === undefined && fsItem === undefined) return;\n\n      if (fsItem !== undefined) {\n        this.fsItem = fsItem\n      } else if (localfile !== undefined) {\n        this.localfile = localfile\n      } else {\n        this.localurl = url\n      }\n\n      const element = this.dicomImage;\n\n      element.addEventListener(\"cornerstonenewimage\", this.onNewImage);\n      element.addEventListener(\"cornerstoneimagerendered\", this.onImageRendered);\n      element.addEventListener(\"cornerstonetoolsmeasurementadded\", this.onMeasurementAdded);\n      element.addEventListener(\"cornerstonetoolsmeasurementmodified\", this.onMeasurementModified);\n      element.addEventListener(\"cornerstonetoolsmeasurementcompleted\", this.onMeasurementCompleted);\n\n      let imageId = undefined;\n\n      cornerstone.enable(element);\n\n      let size = 0;\n\n      if (localfile === undefined && isUrlImage(url)) { // check if it's a simple image [jpeg or png] from url\n        //console.log('image: ', file)\n        cornerstone.loadImage(url).then(image => {\n          //console.log('loadImage, image from url: ', image)\n\n          this.hideOpenUrlDlg();\n\n          this.image = image;\n\n          this.isDicom = false;\n\n          cornerstone.displayImage(element, image);\n\n          this.enableTool();\n\n          this.props.setActiveDcm({image: this.image, element: this.dicomImage, isDicom: this.isDicom});\n          this.props.isOpenStore(true)\n\n        }, (e) => {\n          console.log('error', e);\n          this.setState({errorOnOpenImage: \"This is not a valid JPG or PNG file.\"})\n        })\n\n      } else if ((localfile !== undefined && isFileImage(localfile)) || (fsItem !== undefined && isFsFileImage(fsItem))) { // otherwise try to open as local image file (JPEG, PNG)\n        if (fsItem !== undefined) {\n          imageId = cornerstoneFileImageLoader.fileManager.addBuffer(fsItem.data)\n        } else {\n          imageId = cornerstoneFileImageLoader.fileManager.add(localfile)\n        }\n        cornerstone.loadImage(imageId).then(image => {\n          // console.log('loadImage, image from local: ', image);\n\n          this.image = image;\n          this.isDicom = false;\n          this.PatientsName = '';\n          // console.log(\"image data:\" + image.data);\n          cornerstone.displayImage(element, image);\n\n          this.enableTool();\n\n          this.props.setActiveDcm({image: this.image, element: this.dicomImage, isDicom: this.isDicom});\n          //this.props.isOpenStore(true)\n          this.props.setIsOpenStore({index: this.props.index, value: true})\n\n        }, (e) => {\n          console.log('error', e);\n          this.setState({errorOnOpenImage: \"This is not a valid JPG or PNG file.\"})\n        })\n\n      } else { // otherwise try to open as Dicom file\n\n        if (fsItem !== undefined) {\n          imageId = cornerstoneWADOImageLoader.wadouri.fileManager.addBuffer(fsItem.data);\n          this.filename = fsItem.name;\n          size = fsItem.size\n        } else if (localfile !== undefined) {\n          imageId = cornerstoneWADOImageLoader.wadouri.fileManager.add(localfile);\n          this.filename = localfile.name;\n          size = localfile.size\n        } else { // it's a web dicom image\n          imageId = \"wadouri:\"+url\n        }\n\n        // console.log('loadImage, imageId: ', imageId);\n\n        cornerstone.loadAndCacheImage(imageId).then(image => {\n          console.log('loadImage, image: ', image);\n          // let pixelDataElement = image.data.elements.x7fe00010;\n          // console.log('loadImage, pixelDataElement: ', pixelDataElement);\n          // console.log('loadImage, getPixelData: ', image.getPixelData());\n\n\n          this.hideOpenUrlDlg();\n\n          this.image = image;\n\n          this.isDicom = true;\n\n          let dataSet = dicomParser.parseDicom(image.data.byteArray);\n          console.log('image dataset -----: ' + dataSet.string('x00200011'));\n          console.log('Series Number: ' + image.data.string('x00200011'));\n\n\n          this.PatientsName = image.data.string('x00100010');\n          console.log('PatientsName: ' + this.PatientsName);\n          this.sopInstanceUid = this.getSopInstanceUID();\n\n          let stack = { currentImageIdIndex: 0, imageIds: \"\" };\n          this.numberOfFrames = image.data.intString('x00280008');\n          if (this.numberOfFrames > 0) {\n            let imageIds = [];\n            for(var i=0; i < this.numberOfFrames; ++i) {\n              imageIds.push(imageId + \"?frame=\"+i)\n            }\n            stack.imageIds = imageIds\n          }\n\n          cornerstone.displayImage(element, image);\n          //cornerstoneTools.mouseInput.enable(element);\n          //cornerstoneTools.mouseWheelInput.enable(element);\n\n          this.enableTool();\n\n          /*const viewport = cornerstone.getViewport(this.dicomImage)\n          const lut =  cornerstone.generateLut(this.image, viewport.voi.windowWidth, viewport.voi.windowCenter, viewport.invert, viewport.modalityLUT, viewport.voiLUT)\n          console.log('lut: ', lut)*/\n\n          if (this.numberOfFrames > 1) {\n            cornerstoneTools.addStackStateManager(element, ['stack', 'playClip']);\n            cornerstoneTools.addToolState(element, 'stack', stack);\n            //cornerstoneTools.setToolActive('StackScrollMouseWheel', { })\n            this.setState({frame: 1})\n          }\n\n          // Load the possible measurements from DB and save in the store\n          db.measurement.where('sopinstanceuid').equals(this.sopInstanceUid).each(measure => {\n            console.log('load measure from db: ', measure);\n            //this.props.measurementStore(measure)\n            this.measurementSave(measure);\n            cornerstoneTools.addToolState(element, measure.tool, measure.data);\n            this.runTool(measure.tool);\n            cornerstone.updateImage(element);\n            cornerstoneTools.setToolEnabled(measure.tool)\n          }).then(() => {\n            //console.log('this.measurements: ', this.measurements)\n            this.props.setActiveMeasurements(this.measurements);\n            this.props.setActiveDcm({name: this.filename, size: size, image: this.image, element: this.dicomImage, isDicom: this.isDicom});\n            this.props.setIsOpenStore({index: this.props.index, value: true})\n          });\n\n\n\n\n\n\n        }, (e) => {\n          console.log('error', e);\n          this.hideOpenUrlDlg();\n          //console.log('toString: ', e.error.toString())\n          const error = e.error.toString();\n          if (error === '[object XMLHttpRequest]') {\n            this.setState({errorOnCors: true})\n          } else {\n            const pos = error.indexOf(\":\");\n            this.setState({errorOnOpenImage: pos < 0 ? e.error : error.substring(pos+1)})\n          }\n        })\n      }\n    };\n\n    enableTool = (toolName, mouseButtonNumber) => {\n      // Enable all tools we want to use with this element\n      const WwwcTool = cornerstoneTools.WwwcTool;\n      const LengthTool = cornerstoneTools['LengthTool'];\n      const PanTool = cornerstoneTools.PanTool;\n      const ZoomTouchPinchTool = cornerstoneTools.ZoomTouchPinchTool;\n      const ZoomTool = cornerstoneTools.ZoomTool;\n      const ProbeTool = cornerstoneTools.ProbeTool;\n      const EllipticalRoiTool = cornerstoneTools.EllipticalRoiTool;\n      const RectangleRoiTool = cornerstoneTools.RectangleRoiTool;\n      const FreehandRoiTool = cornerstoneTools.FreehandRoiTool;\n      const AngleTool = cornerstoneTools.AngleTool;\n      const MagnifyTool = cornerstoneTools.MagnifyTool;\n      const StackScrollMouseWheelTool = cornerstoneTools.StackScrollMouseWheelTool;\n\n      cornerstoneTools.addTool(MagnifyTool);\n      cornerstoneTools.addTool(AngleTool);\n      cornerstoneTools.addTool(WwwcTool);\n      cornerstoneTools.addTool(LengthTool);\n      cornerstoneTools.addTool(PanTool);\n      cornerstoneTools.addTool(ZoomTouchPinchTool);\n      cornerstoneTools.addTool(ZoomTool);\n      cornerstoneTools.addTool(ProbeTool);\n      cornerstoneTools.addTool(EllipticalRoiTool);\n      cornerstoneTools.addTool(RectangleRoiTool);\n      cornerstoneTools.addTool(FreehandRoiTool);\n      cornerstoneTools.addTool(StackScrollMouseWheelTool)\n    };\n\n    // helper function used by the tool button handlers to disable the active tool\n    // before making a new tool active\n    disableAllTools = () => {\n      cornerstoneTools.setToolEnabled('Length');\n      cornerstoneTools.setToolEnabled('Pan');\n      cornerstoneTools.setToolEnabled('Magnify');\n      cornerstoneTools.setToolEnabled('Angle');\n      cornerstoneTools.setToolEnabled('RectangleRoi');\n      cornerstoneTools.setToolEnabled('Wwwc');\n      cornerstoneTools.setToolEnabled('ZoomTouchPinch');\n      cornerstoneTools.setToolEnabled('Probe');\n      cornerstoneTools.setToolEnabled('EllipticalRoi');\n      cornerstoneTools.setToolEnabled('FreehandRoi');\n      cornerstoneTools.setToolEnabled('StackScrollMouseWheel')\n    };\n\n    runTool2 = (index, image) => {\n      cornerstone.disable(this.dicomImage);\n      this.displayImageFromFilesByImage(index, image);\n    }\n\n    runTool = (toolName, opt) => {\n      //console.log('run tool: ', toolName)\n      // this.disableAllTools()\n      switch (toolName) {\n        case 'openImage': {\n          cornerstone.disable(this.dicomImage);\n          // this.displayImageFromFilesByImage(opt);\n          break\n        }\n        case 'openimage': {\n          //console.log('openimage: ', opt)\n          //console.log('openimage, this.dicomImage: ', this.dicomImage)\n          cornerstone.disable(this.dicomImage);\n          this.displayImageFromFiles(opt);\n          break\n        }\n        case 'Mohammad':{\n          cornerstone.disable(this.dicomImage);\n          this.displayImageFromFilesMohammad(opt);\n          break\n        }\n        // case 'openLocalFs': {\n        //   console.log('openLocalFs: ', opt);\n        //   cornerstone.disable(this.dicomImage);\n        //   // this.loadImage(opt);\n        //   break\n        // }\n        case 'openSandboxFs': {\n          console.log('openSandboxFs: ', opt)\n          cornerstone.disable(this.dicomImage);\n          this.setState({ file: opt })\n          this.loadImage(undefined, undefined, opt);\n          break\n        }\n        case 'openurl': {\n          //console.log('run tool opt: ', opt)\n          this.showOpenUrlDlg(opt);\n          break\n        }\n        case 'clear': {\n          this.setState({ visibleCinePlayer: false });\n          this.mprPlane = '';\n          //this.props.clearingStore()\n          cornerstone.disable(this.dicomImage);\n          break\n        }\n        case 'notool': {\n          this.disableAllTools();\n\n          //const element = this.dicomImage\n\n          //cornerstoneTools.clearToolState(element, 'Length')\n\n          //const toolStateManager = cornerstoneTools.getElementToolStateManager(element)\n          //console.log('toolStateManager.toolState: ', toolStateManager.toolState)\n          /*\n          const toolState = toolStateManager.toolState\n          // const allTools = Object.keys(toolState).map(key => toolState[key])\n          let key = Object.keys(toolState)[0]\n          let allTools = toolState[key]\n          //console.log('allTools: ', allTools)\n\n          for (let [tool, data] of Object.entries(allTools)) {\n            //console.log(`${tool}: `, data)\n            let key = Object.keys(data)[0]\n            let tools = data[key]\n            //console.log('tools: ', tools)\n            tools.forEach(item => {\n              //console.log('tool: ', tool)\n              //console.log(item)\n              const measure = {\n                tool: tool,\n                note: '',\n                data: item\n              }\n              console.log('measure: ', measure)\n              this.props.measurementStore(measure)\n            })\n          }\n          */\n          //const toolState = toolStateManager.get(element, 'Length')\n          //console.log('toolState: ', toolState)\n\n          /*\n          const measurementData = {\n            visible: true,\n            active: true,\n            invalidated: true,\n            handles: {\n                start: {\n                    x: 100,\n                    y: 100,\n                    highlight: true,\n                    active: false\n                },\n                end: {\n                    x: 200,\n                    y: 200,\n                    highlight: true,\n                    active: true\n                },\n                textBox: {\n                    active: false,\n                    hasMoved: false,\n                    movesIndependently: false,\n                    drawnIndependently: true,\n                    allowedOutsideImage: true,\n                    hasBoundingBox: true\n                }\n              }\n          }\n          cornerstoneTools.addToolState(element, 'RectangleRoi', measurementData)\n          cornerstoneTools.setToolActive('RectangleRoi', { mouseButtonMask: 1 })\n          */\n          //cornerstone.updateImage(element)\n          break\n        }\n        case 'Wwwc': {\n          cornerstoneTools.setToolActive('Wwwc', { mouseButtonMask: 1 });\n          break\n        }\n        case 'Pan': {\n          cornerstoneTools.setToolActive('Pan', { mouseButtonMask: 1 });\n          break\n        }\n        case 'Zoom': {\n          cornerstoneTools.setToolActive(isMobile ? 'ZoomTouchPinch' : 'Zoom', { mouseButtonMask: 1 });\n          break\n        }\n        case 'Length': {\n          cornerstoneTools.setToolActive('Length', isMobile ? { isTouchActive: true } : { mouseButtonMask: 1 });\n          break\n        }\n        case 'Probe': {\n            cornerstoneTools.setToolActive('Probe', { mouseButtonMask: 1 });\n          break\n        }\n        case 'EllipticalRoi': {\n          cornerstoneTools.setToolActive('EllipticalRoi', { mouseButtonMask: 1 });\n          break\n        }\n        case 'RectangleRoi': {\n          cornerstoneTools.setToolActive('RectangleRoi', { mouseButtonMask: 1 });\n          break\n        }\n        case 'Angle': {\n          cornerstoneTools.setToolActive('Angle', { mouseButtonMask: 1 });\n          break\n        }\n        case 'Magnify': {\n          cornerstoneTools.setToolActive('Magnify', { mouseButtonMask: 1 });\n          break\n        }\n        case 'FreehandRoi': {\n          cornerstoneTools.setToolActive('FreehandRoi', { mouseButtonMask: 1 });\n          break\n        }\n        case 'Invert': {\n          const element = this.dicomImage;\n          const viewport = cornerstone.getViewport(element);\n          viewport.invert = !viewport.invert;\n          cornerstone.setViewport(element, viewport);\n          break\n        }\n        case 'saveas': {\n            let type = localStorage.getItem(SETTINGS_SAVEAS);\n            if (getSettingsSaveInto() === 'local') {\n              // cornerstoneTools.SaveAs(this.dicomImage, `${this.filename}.${type}`, `image/${type}`)\n              const element = this.dicomImage;\n              const viewport = cornerstone.getViewport(element);\n              const canvas = document.getElementsByClassName('cornerstone-canvas')[this.props.activeDcmIndex];\n              const zoom = viewport.scale.toFixed(2);\n              const cols = this.image.columns * zoom;\n              const rows = this.image.rows * zoom;\n\n              let myCanvas = document.createElement('canvas');\n              myCanvas = this.cropCanvas(canvas,\n                Math.round(canvas.width / 2 - cols / 2),\n                Math.round(canvas.height / 2 - rows / 2),\n                cols, rows);\n\n              let a = document.createElement(\"a\");\n              a.href = myCanvas.toDataURL(`image/${type}`);\n              a.download = `${this.filename}.${type}`;\n              document.body.appendChild(a); // Required for this to work in FireFox\n              a.click()\n\n            } else { // store image into sandbox file system\n              const element = this.dicomImage;\n              const viewport = cornerstone.getViewport(element);\n              const canvas = document.getElementsByClassName('cornerstone-canvas')[this.props.activeDcmIndex];\n              const zoom = viewport.scale.toFixed(2);\n              const cols = this.image.columns * zoom;\n              const rows = this.image.rows * zoom;\n\n              let myCanvas = document.createElement('canvas');\n              myCanvas = this.cropCanvas(canvas,\n                Math.round(canvas.width / 2 - cols / 2),\n                Math.round(canvas.height / 2 - rows / 2),\n                cols, rows);\n\n              blobUtil.canvasToBlob(myCanvas, `image/${type}`).then(blob => {\n                blobUtil.blobToArrayBuffer(blob).then(arrayBuffer => {\n                  const name = `${getFileName(this.filename)}-MPR-${this.mprPlane}`;\n                  let newName = name;\n                  let counter = 1;\n                  let done = false;\n                  do {\n                      let filename = `${newName}.${type}`;\n                      const checkName = this.props.fsCurrentList.find(e => e.name === filename);\n                      if (checkName === undefined) {\n                          fs.transaction('rw', fs.files, async () => {\n                              await fs.files.add({\n                                  parent: this.props.fsCurrentDir,\n                                  name: filename,\n                                  type: type,\n                                  size: arrayBuffer.byteLength,\n                                  data: arrayBuffer\n                              })\n                          }).then(() => {\n                            this.props.makeFsRefresh()\n                          });\n                          done = true\n                      } else {\n                          newName = `${name} - ${counter}`;\n                          counter++\n                      }\n                  } while (!done)\n                })\n              })\n            }\n          break\n        }\n        case 'cine': {\n          this.setState({ visibleCinePlayer: !this.state.visibleCinePlayer });\n          break\n        }\n        case 'reset': {\n          this.reset();\n          break\n        }\n        case 'removetool': {\n          console.log('removetool index: ', opt);\n          const element = this.dicomImage;\n          cornerstoneTools.removeToolState(element, this.measurements[opt].tool, this.measurements[opt].data);\n          cornerstone.updateImage(element);\n          //this.props.measurementRemoveStore(opt)\n          this.measurementRemove(opt);\n          this.props.setActiveMeasurements(this.measurements);\n          break\n        }\n        case 'removetools': {\n          const element = this.dicomImage;\n          // for each measurement remove it\n          this.measurements.forEach(measure => {\n            cornerstoneTools.clearToolState(element, measure.tool)\n          });\n          cornerstone.updateImage(element);\n          this.measurementClear();\n          // also remove all measurements from db\n          db.measurement.where('sopinstanceuid').equals(this.sopInstanceUid).delete();\n          this.props.setActiveMeasurements(this.measurements);\n          break\n        }\n        case 'savetools': {\n          // first, remove eventually previous measurements from db\n          db.measurement.where('sopinstanceuid').equals(this.sopInstanceUid).delete();\n          // then save all the current measurements\n          this.measurements.forEach(measure => {\n            try {\n              db.measurement.add({\n                sopinstanceuid: this.sopInstanceUid,\n                tool: measure.tool,\n                note: measure.note,\n                data: measure.data\n              })\n            } catch(error) {\n              console.error(error)\n            }\n          });\n          break\n        }\n        default: {\n          break\n        }\n      }\n    };\n\n    cropCanvas = (canvas, x, y, width, height) => {\n      console.log(`canvas: ${canvas.width}, ${canvas.height}`);\n      console.log(`x, y: ${x}, ${y}`);\n      console.log(`width, height: ${width}, ${height}`);\n\n      // create a temp canvas\n      const newCanvas = document.createElement('canvas');\n      // set its dimensions\n      newCanvas.width = width;\n      newCanvas.height = height;\n      // draw the canvas in the new resized temp canvas\n      newCanvas.getContext('2d').drawImage(canvas, x, y, width, height, 0, 0, width, height);\n      return newCanvas\n    };\n\n    changeTool = (toolName, value) => {\n      console.log('change tool, value: ', toolName, value);\n\n      switch (toolName) {\n        case 'Wwwc':\n          if (value === 1) {\n            cornerstoneTools.setToolActive('Wwwc', { mouseButtonMask: 1 })\n          } else if (value === 0) {\n            cornerstoneTools.setToolPassive('Wwwc')\n          }\n          break;\n        case 'Pan':\n          if (value === 1) {\n            cornerstoneTools.setToolActive('Pan', { mouseButtonMask: 1 })\n          } else if (value === 0) {\n            cornerstoneTools.setToolPassive('Pan')\n          }\n          break;\n        case 'Zoom':\n          if (value === 1) {\n            cornerstoneTools.setToolActive(isMobile ? 'ZoomTouchPinch' : 'Zoom', { mouseButtonMask: 1 })\n          } else if (value === 0) {\n            cornerstoneTools.setToolPassive(isMobile ? 'ZoomTouchPinch' : 'Zoom')\n          }\n          break;\n        case 'Length':\n          if (value === 1) {\n            cornerstoneTools.setToolActive('Length', isMobile ? { isTouchActive: true } : { mouseButtonMask: 1 })\n          } else if (value === 0) {\n            cornerstoneTools.setToolPassive('Length')\n          }\n          break;\n        case 'Probe':\n          if (value === 1) {\n            cornerstoneTools.setToolActive('Probe', { mouseButtonMask: 1 })\n          } else if (value === 0) {\n            cornerstoneTools.setToolPassive('Probe')\n          }\n          break;\n        case 'Angle':\n          if (value === 1) {\n            cornerstoneTools.setToolActive('Angle', { mouseButtonMask: 1 })\n          } else if (value === 0) {\n            cornerstoneTools.setToolPassive('Angle')\n          }\n          break;\n        case 'Magnify':\n          if (value === 1) {\n            cornerstoneTools.setToolActive('Magnify', { mouseButtonMask: 1 })\n          } else if (value === 0) {\n            cornerstoneTools.setToolPassive('Magnify')\n          }\n          break;\n        case 'EllipticalRoi':\n          if (value === 1) {\n            cornerstoneTools.setToolActive('EllipticalRoi', { mouseButtonMask: 1 })\n          } else if (value === 0) {\n            cornerstoneTools.setToolPassive('EllipticalRoi')\n          }\n          break;\n        case 'RectangleRoi':\n          if (value === 1) {\n            cornerstoneTools.setToolActive('RectangleRoi', { mouseButtonMask: 1 })\n          } else if (value === 0) {\n            cornerstoneTools.setToolPassive('RectangleRoi')\n          }\n          break;\n        case 'FreehandRoi':\n          if (value === 1) {\n            cornerstoneTools.setToolActive('FreehandRoi', { mouseButtonMask: 1 })\n          } else if (value === 0) {\n            cornerstoneTools.setToolPassive('FreehandRoi')\n          }\n          break;\n        default:\n            break\n        }\n    };\n\n    runCinePlayer = (cmdName) => {\n      //console.log('this.state.frame: ', this.state.frame)\n      const element = this.dicomImage;\n      switch (cmdName) {\n        case 'firstframe': {\n          let frame = 1;\n          this.setState({frame: frame});\n          scrollToIndex(element, 0);\n          break\n        }\n        case 'previousframe': {\n          if (this.state.frame > 1) {\n            let frame = this.state.frame-1;\n            this.setState({frame: frame});\n            scrollToIndex(element, frame-1)\n          }\n          break\n        }\n        case 'play': {\n          cornerstoneTools.playClip(element, 30);\n          this.setState({inPlay: true});\n          break\n        }\n        case 'pause': {\n            cornerstoneTools.stopClip(element);\n            this.setState({inPlay: false});\n          break\n        }\n        case 'nextframe': {\n          if (this.state.frame < this.numberOfFrames) {\n            let frame = this.state.frame+1;\n            this.setState({frame: frame});\n            scrollToIndex(element, frame-1)\n          }\n          break\n        }\n        case 'lastframe': {\n          let frame = this.numberOfFrames;\n          this.setState({frame: frame});\n          scrollToIndex(element, frame-1);\n          break\n        }\n        default:\n          break\n      }\n    };\n\n    reset = () => {\n      const element = this.dicomImage;\n      const defaultViewport = cornerstone.getDefaultViewportForImage(element, this.image);\n      let viewport = cornerstone.getViewport(element);\n      viewport.voi.windowWidth = defaultViewport.voi.windowWidth;\n      viewport.voi.windowCenter = defaultViewport.voi.windowCenter;\n      viewport.invert = false;\n      cornerstone.setViewport(element, viewport)\n    };\n\n    // -------------------------------------------------------------------------------------------- MPR\n\n    mprPlanePosition = () => {\n      //console.log(\"mprPlanePosition: \")\n      try {\n        console.log(\"is dicom:   \" + this.isDicom);\n        if (!this.isDicom) return this.mprPlane;\n        console.log(\"image data:   \" + this.image.data);\n        const imageOrientation = this.image.data.string('x00200037').split('\\\\');\n        console.log(\"image imageOrientation:   \" + imageOrientation);\n        let v = new Array(6).fill(0);\n        v[0] = parseFloat(imageOrientation[0]); // the x direction cosines of the first row X\n        v[1] = parseFloat(imageOrientation[1]); // the y direction cosines of the first row X\n        v[2] = parseFloat(imageOrientation[2]); // the z direction cosines of the first row X\n        v[3] = parseFloat(imageOrientation[3]); // the x direction cosines of the first column Y\n        v[4] = parseFloat(imageOrientation[4]); // the y direction cosines of the first column Y\n        v[5] = parseFloat(imageOrientation[5]); // the z direction cosines of the first column Y\n        v = v.map((x) => Math.round(x));\n        let p = [v[1]*v[5] - v[2]*v[4], v[2]*v[3] - v[0]*v[5], v[0]*v[4] - v[1]*v[3]]; // cross product of X x Y\n        p = p.map((x) => Math.abs(x));\n        if (p[0] === 1) {\n          this.mprPlane = 'sagittal'\n        } else if (p[1] === 1) {\n          this.mprPlane = 'coronal'\n        } else if (p[2] === 1) {\n          this.mprPlane = 'axial'\n        }\n      } catch(error) { // it's not possible to build MPR\n        console.log('its not possible to build MPR');\n        this.mprPlane = ''\n      }\n      console.log(\"this.mprPlane: \" + this.mprPlane);\n      return this.mprPlane\n    };\n\n    transpose = (matrix) => {\n      return Object.keys(matrix[0]).map(colNumber => matrix.map(rowNumber => rowNumber[colNumber]));\n    };\n\n    mprRenderYZPlane = (filename, origin, x, mprData) => {\n      if (this.volume === null) return;\n      this.filename = filename;\n      cornerstone.disable(this.dicomImage);\n      //console.log(`mprRenderYZPlane, origin: ${origin}, x: ${x}`)\n      //console.log('mprRenderYZPlane, volume: ', this.volume)\n\n      if (origin === 'sagittal')\n        this.mprPlane = 'coronal';\n      else if (origin === 'axial')\n        this.mprPlane = 'sagittal';\n      else\n        this.mprPlane = 'sagittal';\n\n      this.xSize = this.props.files[0].columns;\n      this.ySize = this.props.files[0].rows;\n      this.zSize = mprData.zDim;\n\n      const i = Math.round(x / this.xSize * this.props.files.length);\n      this.originImage = this.props.files[i].image;\n\n      if (origin === 'sagittal') {\n        let xoffset = Math.floor(this.xSize / 2) - Math.floor(this.zSize / 2);\n        let plane = new Int16Array(this.xSize * this.ySize);\n        for (let y = 0; y < this.ySize; y++)\n          for (let z = 0; z < this.zSize; z++)\n            plane[z + this.ySize * y + xoffset] = this.volume[z][x + this.ySize * y];\n        this.loadImageFromCustomObject(this.xSize, this.ySize, plane)\n\n      } else if (origin === 'coronal') {\n        let xoffset = Math.floor(this.xSize / 2) - Math.floor(this.zSize / 2);\n        let plane = new Int16Array(this.xSize * this.ySize);\n        for (let y = 0; y < this.ySize; y++)\n          for (let z = 0; z < this.zSize; z++)\n            plane[z + this.ySize * y + xoffset] = this.volume[z][x + this.ySize * y];\n        this.loadImageFromCustomObject(this.xSize, this.ySize, plane)\n\n      } else { // axial\n        const yzPlane = this.mprBuildYZPlane(x);\n        this.loadImageFromCustomObject(this.ySize, this.zSize, yzPlane)\n      }\n    };\n\n    mprBuildYZPlane = (x) => {\n      //console.log(`mprBuildYZPlane, ySize: ${this.ySize}, zSize: ${this.zSize} `)\n      let plane = new Int16Array(this.ySize * this.zSize);\n      for (var y = 0; y < this.ySize; y++)\n        for (var z = 0; z < this.zSize; z++)\n          plane[y + this.ySize * z] = this.volume[z][x + this.ySize * y];\n      //console.log('mprBuildYZPlane, plane: ', plane)\n      return plane\n    };\n\n    mprRenderXZPlane = (filename, origin, y, mprData) => {\n      if (this.volume === null) return;\n      this.filename = filename;\n      cornerstone.disable(this.dicomImage);\n      //console.log(`mprRenderXZPlane, origin: ${origin}, y: ${y}`)\n      //console.log('mprRenderXZPlane, volume: ', this.volume)\n\n      if (origin === 'sagittal')\n        this.mprPlane = 'axial';\n      else if (origin === 'axial')\n        this.mprPlane = 'coronal';\n      else\n        this.mprPlane = 'axial';\n\n      this.xSize = this.props.files[0].columns;\n      this.ySize = this.props.files[0].rows;\n      this.zSize = mprData.zDim;\n\n      const i = Math.trunc(y / this.ySize * this.props.files.length);\n      this.originImage = this.props.files[i].image;\n\n      if (origin === 'sagittal') {\n        let xoffset = Math.floor(this.xSize / 2) - Math.floor(this.zSize / 2);\n        let plane = new Int16Array(this.xSize * this.ySize);\n        for (let x = 0; x < this.xSize; x++)\n          for (let z = 0; z < this.zSize; z++)\n            plane[z + this.xSize * x + xoffset] = this.volume[z][x + this.xSize * y];\n        this.loadImageFromCustomObject(this.xSize, this.ySize, plane)\n\n      } else {\n        const xzPlane = this.mprBuildXZPlane(y);\n        this.loadImageFromCustomObject(this.xSize, this.zSize, xzPlane)\n      }\n    };\n\n    mprBuildXZPlane = (y) => {\n      //console.log(`mprBuildXZPlane, xSize: ${this.xSize}, zSize: ${this.zSize} `)\n      let plane = new Int16Array(this.xSize * this.zSize);\n      for (let x = 0; x < this.xSize; x++)\n        for (let z = 0; z < this.zSize; z++)\n          plane[x + this.xSize * z] = this.volume[z][x + this.xSize * y];\n      //console.log('mprBuildXZPlane, plane: ', plane)\n      return plane\n    };\n\n    mprIsOrthogonalView = () => {\n      console.log('---------------------------------------');\n      console.log('mprPlane: ', this.mprPlane)\n      console.log('this.props.layout[0]: ', this.props.layout[0])\n      console.log('this.props.layout[1]: ', this.props.layout[1])\n      console.log('result: ' + (this.mprPlane !== '' && this.props.layout[0] === 1 && this.props.layout[1] === 3) ? 'true' : 'false')\n      console.log('---------------------------------------');\n      return (this.mprPlane !== '' && this.props.layout[0] === 1 && this.props.layout[1] === 3)\n    };\n\n    // -------------------------------------------------------------------------------------------- MPR\n\n    dicomImageRef = el => {\n      this.dicomImage = el\n    };\n\n    onImageClick = () => {\n      console.log('onImageClick: ')\n    };\n\n    render() {\n      //console.log('DicomViewer render: ')\n\n      //this.props.visible ? document.body.style = 'background: #000000;' : document.body.style = 'background: $md-grey-700;'\n\n      const isOpen = this.props.isOpen[this.props.index];\n      console.log('isOpen: ' + isOpen);\n      //const visibleHistogram = this.state.visibleHistogram\n      const visibleOpenUrlDlg = this.state.visibleOpenUrlDlg;\n      const errorOnOpenImage = this.state.errorOnOpenImage;\n      const progress = this.state.progress;\n\n      const styleContainer = {\n        width: '100%',\n        height: '100%',\n        border: this.props.activeDcmIndex === this.props.index && (this.props.layout[0] > 1 || this.props.layout[1] > 1) ? 'solid 1px #AAAAAA' : null,\n        position: 'relative',\n      };\n\n      const styleDicomImage = {\n        width: '100%',\n        height: '100%',\n        position: 'relative',\n      };\n\n      const overlay = getSettingsOverlay();\n      console.log('overlay: ' + overlay);\n\n      return (\n        <div className=\"container\" style={styleContainer} >\n\n          {visibleOpenUrlDlg ? <OpenUrlDlg progress={progress} onClose={this.hideOpenUrlDlg} /> : null}\n\n          <Dialog\n            open={errorOnOpenImage !== null}\n            onClose={this.onErrorOpenImageClose}\n          >\n            <DialogTitle id=\"alert-dialog-title\">{\"Error on opening image\"}</DialogTitle>\n            <DialogContent>\n              <DialogContentText id=\"alert-dialog-description\">\n                {this.state.errorOnOpenImage}\n              </DialogContentText>\n            </DialogContent>\n            <DialogActions>\n              <Button onClick={this.onErrorOpenImageClose} autoFocus>\n                Ok\n              </Button>\n            </DialogActions>\n          </Dialog>\n\n          <Dialog\n            open={this.state.errorOnCors}\n            onClose={this.onErrorCorsClose}\n            aria-labelledby=\"alert-dialog-title\"\n            aria-describedby=\"alert-dialog-description\"\n          >\n            <DialogTitle id=\"alert-dialog-title\">{\"Error on loading image\"}</DialogTitle>\n            <DialogContent>\n              <DialogContentText id=\"alert-dialog-description\">\n                <Typography gutterBottom>\n                  CORS or Cross Origin Resource Sharing is a browser security policy\n                  that prevents javascript from loading data from a server with a different base URL\n                  than the server that served up the javascript file.\n                </Typography>\n                <Typography gutterBottom>\n                  See the &nbsp;\n                  <Link href=\"http://enable-cors.org/\" target='_blank' color='textPrimary'>\n                    Enable CORS site\n                  </Link>\n                  &nbsp; for information about CORS.\n                </Typography>\n              </DialogContentText>\n            </DialogContent>\n            <DialogActions>\n              <Button onClick={this.onErrorCorsClose} autoFocus>\n                Ok\n              </Button>\n            </DialogActions>\n          </Dialog>\n\n          <div\n            style={{\n              width: '100%',\n              height: '100%',\n              position: \"relative\",\n              color: '#FFFFFF',\n              textShadow: '1px 1px #000000'\n            }}\n            onContextMenu={() => false}\n            className=\"cornerstone-enabled-image\"\n          >\n            <div\n              ref={this.dicomImageRef} style={styleDicomImage}\n            >\n            </div>\n\n            <div\n              id={`mrtopleft-${this.props.index}`}\n              style={{ position: \"absolute\", top: 0, left: 3, display: isOpen && overlay ? \"\" : \"none\" }}\n            >\n\n            </div>\n            <div\n              id={`mrtopright-${this.props.index}`}\n              style={{ position: \"absolute\", top: 0, right: 3, display: isOpen && overlay ? \"\" : \"none\" }}\n            >\n\n            </div>\n            <div\n              id={`mrbottomright-${this.props.index}`}\n              style={{ position: \"absolute\", bottom: 0, right: 3, display: isOpen && overlay ? \"\" : \"none\" }}\n            >\n\n            </div>\n            <div\n              id={`mrbottomleft-${this.props.index}`}\n              style={{ position: \"absolute\", bottom: 0, left: 3, display: isOpen && overlay ? \"\" : \"none\" }}\n            >\n\n            </div>\n\n            <div\n              id={`mrtopcenter-${this.props.index}`}\n              style={{ position: \"absolute\", top: 0, width: '60px', left: '50%', marginLeft: '0px', display: isOpen && overlay ? \"\" : \"none\" }}\n            >\n\n            </div>\n\n            <div\n              id={`mrleftcenter-${this.props.index}`}\n              style={{ position: \"absolute\", top: '50%', width: '30px', left: 3, marginLeft: '0px', display: isOpen && overlay ? \"\" : \"none\" }}\n            >\n\n            </div>\n\n            <div\n              id={`mrrightcenter-${this.props.index}`}\n              style={{ position: \"absolute\", top: '50%', width: '30px', right: 3, marginRight: '-20px', display: isOpen && overlay ? \"\" : \"none\" }}\n            >\n\n            </div>\n\n            <div\n              id={`mrbottomcenter-${this.props.index}`}\n              style={{ position: \"absolute\", bottom: 0, width: '60px', left: '50%', marginLeft: '0px', display: isOpen && overlay ? \"\" : \"none\" }}\n            >\n\n            </div>\n\n            { this.state.visibleCinePlayer && this.numberOfFrames > 1 ? (\n              <div style={{position:\"absolute\", width:'100%', bottom:0, textAlign:'center'}}>\n                <div style={{margin:'0 auto', width:'240px', backgroundColor:'rgba(136, 136, 136, 0.5)'}}>\n                  <CinePlayer runCinePlayer={this.runCinePlayer} inPlay={this.state.inPlay} />\n                  <div\n                    id={`frameLabel-${this.props.index}`}\n                    style={{ width:230, margin:'0 auto', marginTop:-10, textAlign:\"center\" }}\n                  >\n                    {this.state.frame} / {this.numberOfFrames}\n                  </div>\n                </div>\n              </div>\n              ) : null\n            }\n            {/*<div style={{position:\"absolute\", width:'100%', height:'100%', top:0, left:0}}></div>*/}\n          </div>\n        </div>\n      )\n    }\n  }\n\nconst mapStateToProps = (state) => {\n  return {\n    files: state.files,\n    url: state.url,\n    isOpen: state.isOpen,\n    tool: state.tool,\n    activeDcmIndex: state.activeDcmIndex,\n    activeDcm: state.activeDcm,\n    measurements: state.measurements,\n    layout: state.layout,\n    fsCurrentDir: state.fsCurrentDir,\n    fsCurrentList: state.fsCurrentList,\n    volume: state.volume,\n    lut: state.lut,\n    //sandboxedFile: state.sandboxedFile,\n  }\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    clearingStore: () => dispatch(clearStore()),\n    setIsOpenStore: (value) => dispatch(dcmIsOpen(value)),\n    toolStore: (tool) => dispatch(dcmTool(tool)),\n    setActiveDcm: (dcm) => dispatch(activeDcm(dcm)),\n    setActiveMeasurements: (measurements) => dispatch(activeMeasurements(measurements)),\n    makeFsRefresh: (dcm) => dispatch(doFsRefresh()),\n    //setLutStore: (lut) => dispatch(setLut(lut)),\n  }\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(DicomViewer)\n","import React from \"react\"\nimport {connect} from 'react-redux'\nimport Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogContentText from '@material-ui/core/DialogContentText'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport Link from '@material-ui/core/Link'\nimport Typography from '@material-ui/core/Typography'\nimport Hammer from \"hammerjs\"\nimport * as cornerstone from \"cornerstone-core\"\nimport * as cornerstoneTools from \"cornerstone-tools\"\nimport * as cornerstoneMath from \"cornerstone-math\"\nimport * as cornerstoneFileImageLoader from \"cornerstone-file-image-loader\"\nimport * as cornerstoneWebImageLoader from \"cornerstone-web-image-loader\"\nimport * as cornerstoneWADOImageLoader from \"cornerstone-wado-image-loader\"\nimport * as dicomParser from 'dicom-parser'\nimport * as blobUtil from 'blob-util'\nimport {uids} from '../constants/uids'\nimport { SETTINGS_SAVEAS } from '../constants/settings'\nimport OpenUrlDlg from './OpenUrlDlg'\nimport CinePlayer from './CinePlayer'\nimport { isMobile } from 'react-device-detect'\nimport { import as csTools } from 'cornerstone-tools'\nimport db from '../db/db'\nimport fs from '../fs/fs'\nimport {\n  clearStore, \n  dcmIsOpen, \n  activeDcm, \n  dcmTool, \n  activeMeasurements,\n  doFsRefresh} \nfrom '../actions'\nimport {\n  capitalize,\n  getFileName,\n  getSettingsOverlay,\n  isFileImage,\n  isFsFileImage,\n  isUrlImage,\n  getSettingsSaveInto\n} from '../functions'\n\nconst scrollToIndex = csTools('util/scrollToIndex');\n\n/*\nfunction getBlobUrl(url) {\n  const baseUrl = window.URL || window.webkitURL;\n  const blob = new Blob([`importScripts('${url}')`], {type: \"application/javascript\"});\n  return baseUrl.createObjectURL(blob);\n}\n\nlet webWorkerUrl = getBlobUrl(\n  \"https://unpkg.com/cornerstone-wado-image-loader@3.0.0/dist/cornerstoneWADOImageLoaderWebWorker.min.js\"\n)\nlet codecsUrl = getBlobUrl(\n  \"https://unpkg.com/cornerstone-wado-image-loader@3.0.0/dist/cornerstoneWADOImageLoaderCodecs.js\"\n  // \"https://unpkg.com/cornerstone-wado-image-loader/dist/cornerstoneWADOImageLoaderCodecs.js\"\n)\n// See componentDidMount line 110 for initialization, registration\n\nconst config = {\n  maxWebWorkers: 4, //\n  //startWebWorkersOnDemand: true, //\n  webWorkerPath: webWorkerUrl,\n  //webWorkerTaskPaths: [], //\n  taskConfiguration: {\n    decodeTask: {\n      //loadCodecsOnStartup: true, //\n      //initializeCodecsOnStartup: false, //\n      codecsPath: codecsUrl,\n      //usePDFJS: false, //\n      //strict: true //\n    }\n  }\n}\nvar config = {\n  maxWebWorkers: navigator.hardwareConcurrency || 1,\n  startWebWorkersOnDemand: false,\n}\n*/\ncornerstoneTools.external.cornerstone = cornerstone;\ncornerstoneTools.external.cornerstoneMath = cornerstoneMath;\ncornerstoneFileImageLoader.external.cornerstone = cornerstone;\ncornerstoneWebImageLoader.external.cornerstone = cornerstone;\ncornerstoneWADOImageLoader.external.cornerstone = cornerstone;\n//cornerstoneWADOImageLoader.webWorkerManager.initialize(config)\ncornerstoneWADOImageLoader.external.dicomParser = dicomParser;\ncornerstoneTools.external.Hammer = Hammer;\ncornerstoneTools.init();\n\n//console.log({ cornerstone })\n//console.log({ cornerstoneWADOImageLoader })\n//console.log({ dicomParser })\n\nclass DicomViewerForList extends React.Component {\n    constructor(props) {\n      super(props);\n      this.filename = '';\n      this.localfile = null;\n      this.localurl = null;\n      this.fsItem = null;\n      this.dicomImage = null;\n      this.imageId = null;\n      this.image = null;\n      this.isDicom = false;\n      this.numberOfFrames = 1;\n      this.measurements = [];\n      this.xSize = 0;\n      this.ySize = 0;\n      this.zSize = 0;\n      this.volume = null;\n      this.originImage = null;\n      this.mprPlane = ''\n    }\n\n    state = {\n      visibleOpenUrlDlg: false,\n      progress: null,\n      visibleCinePlayer: false,\n      errorOnOpenImage: null,\n      errorOnCors: false,\n      frame: 1,\n      inPlay: false,\n      viewport: null,\n    };\n\n    componentDidMount() {\n      this.props.runTool(this);\n      // this.props.runTool2(this);\n      this.props.changeTool(this);\n      cornerstone.events.addEventListener('cornerstoneimageloaded', this.onImageLoaded);\n      const { dcmRef } = this.props;\n      dcmRef(this)          \n      \n    }\n\n    componentWillUnmount() {\n      this.props.runTool(undefined);\n      // this.props.runTool2(undefined);\n      this.props.changeTool(undefined);\n      const { dcmRef } = this.props;\n      dcmRef(undefined)            \n    }\n\n    componentDidUpdate(previousProps) {\n      //console.log('dicomviewer - componentDidUpdate: ')\n      /*if (this.props.files !== null) {\n        console.log('this.props.files[0]: ', this.props.files[0])\n        console.log('this.props.files: ', this.props.files)\n      }*/\n      /*if (this.props.volume !== null) {\n        console.log('volume set: ', this.props.volume)\n        this.volume = this.props.volume\n      }*/\n      const isOpen = this.props.isOpen[this.props.index];\n      if (this.props.layout !== previousProps.layout && isOpen) {\n        cornerstone.resize(this.dicomImage)\n      }\n    }\n  \n    onOpenUrl = (e) => {\n      const eventData = e.detail;\n      this.setState({ progress: eventData.percentComplete })\n    };\n\n    showOpenUrlDlg = (url) => {\n      this.setState({ visibleOpenUrlDlg: true }, () => {\n        cornerstone.events.addEventListener('cornerstoneimageloadprogress', this.onOpenUrl);\n        this.loadImage(undefined, url)\n      })\n    };\n  \n    hideOpenUrlDlg = () => {\n      this.setState({ visibleOpenUrlDlg: false, progress: null })\n    };\n\n    measurementSave = (measure) => {\n      this.measurements.push(measure) \n    };\n\n    measurementClear = () => {\n      this.measurements.splice(0, this.measurements.length)\n    };\n\n    measurementRemove = (index) => {\n      //console.log('this.measurements: ', this.measurements)\n      this.measurements.splice(index, 1)\n    };\n\n    getTransferSyntax = () => {\n      const value = this.image.data.string('x00020010');\n      return value + ' [' + uids[value] + ']'\n    };\n\n    getSopClass = () => {\n      const value = this.image.data.string('x00080016');\n      return value + ' [' + uids[value] + ']'\n    };\n\n    getSopInstanceUID = () => {\n      const value = this.image.data.string('x00080018');\n      return value\n    };\n\n    getPixelRepresentation = () => {\n      const value = this.image.data.uint16('x00280103');\n      if (value === undefined) return;\n      return value + (value === 0 ? ' (unsigned)' : ' (signed)')\n    };\n\n    getPlanarConfiguration = () => {\n      const value = this.image.data.uint16('x00280006');\n      if (value === undefined) return;\n      return value + (value === 0 ? ' (pixel)' : ' (plane)')\n    };\n   \n    onImageLoaded = (e) => {\n      //console.log('cornerstoneimageloaded: ')\n    };\n\n    // Listen for changes to the viewport so we can update the text overlays in the corner\n    onImageRendered = (e) => {\n      //console.log('cornerstoneimagerendered: ', e.target)\n      //console.log('cornerstoneimagerendered, plane: ', this.mprPlane)\n\n      //const viewport = cornerstone.getViewport(this.dicomImage)\n      const viewport = cornerstone.getViewport(e.target);\n\n      //console.log('viewport: ', viewport)\n\n      //if (this.props.activeDcm !== null)\n      //  console.log('viewport activeDcm: ', cornerstone.getViewport(this.props.activeDcm.element))\n\n      document.getElementById(\n        `mrtopleft-${this.props.index}`\n      ).textContent = this.mprIsOrthogonalView() ? `${capitalize(this.mprPlane)}` : `${this.PatientsName}`;\n\n      document.getElementById(\n        `mrtopright-${this.props.index}`\n      ).textContent = `${viewport.displayedArea.brhc.x}x${viewport.displayedArea.brhc.y}`;\n\n      document.getElementById(\n        `mrbottomleft-${this.props.index}`\n      ).textContent = `WW/WC: ${Math.round(viewport.voi.windowWidth)}/${Math.round(viewport.voi.windowCenter)}`;\n\n      document.getElementById(\n        `mrbottomright-${this.props.index}`\n      ).textContent = `Zoom: ${Math.round(viewport.scale.toFixed(2)*100)}%`;\n\n      document.getElementById(\n        `mrtopcenter-${this.props.index}`\n      ).textContent = ``;\n      document.getElementById(\n        `mrbottomcenter-${this.props.index}`\n      ).textContent = ``;\n      document.getElementById(\n        `mrleftcenter-${this.props.index}`\n      ).textContent = ``;\n      document.getElementById(\n        `mrrightcenter-${this.props.index}`\n      ).textContent = ``;\n\n      if (this.mprPlane === 'sagittal') {\n        document.getElementById(\n          `mrtopcenter-${this.props.index}`\n        ).textContent = `S`;\n        document.getElementById(\n          `mrbottomcenter-${this.props.index}`\n        ).textContent = `I`;\n        document.getElementById(\n          `mrleftcenter-${this.props.index}`\n        ).textContent = `A`;\n        document.getElementById(\n          `mrrightcenter-${this.props.index}`\n        ).textContent = `P`  \n\n      } else if (this.mprPlane === 'axial') {\n        document.getElementById(\n          `mrtopcenter-${this.props.index}`\n        ).textContent = `A`;\n        document.getElementById(\n          `mrbottomcenter-${this.props.index}`\n        ).textContent = `P`;\n        document.getElementById(\n          `mrleftcenter-${this.props.index}`\n        ).textContent = `R`;\n        document.getElementById(\n          `mrrightcenter-${this.props.index}`\n        ).textContent = `L`    \n\n      } else if (this.mprPlane === 'coronal') {\n        document.getElementById(\n          `mrtopcenter-${this.props.index}`\n        ).textContent = `S`;\n        document.getElementById(\n          `mrbottomcenter-${this.props.index}`\n        ).textContent = `I`;\n        document.getElementById(\n          `mrleftcenter-${this.props.index}`\n        ).textContent = `R`;\n        document.getElementById(\n          `mrrightcenter-${this.props.index}`\n        ).textContent = `L`                    \n      }    \n\n      if (this.isDicom && this.state.visibleCinePlayer && this.numberOfFrames > 1) {\n        document.getElementById(\n          `frameLabel-${this.props.index}`\n        ).textContent = `${this.state.frame} / ${this.numberOfFrames}`;\n        if (this.state.inPlay) {\n          let frame = this.state.frame === this.numberOfFrames ? 1 : this.state.frame+1;\n          this.setState({frame: frame})\n        }\n      }\n    };\n\n    onMeasurementModified = (e) => {\n      //console.log('cornerstonetoolsmeasurementmodified: ', e.detail.measurementData)\n      \n    };\n\n    onMeasurementAdded = (e) => {\n      //console.log('cornerstonetoolsmeasurementadded: ', e.detail.measurementData)\n      if (this.props.tool !== \"Angle\") return;\n      const measure = {\n        tool: this.props.tool,\n        note: '',\n        data: e.detail.measurementData\n      };\n      this.measurementSave(measure);\n      this.props.setActiveMeasurements(this.measurements)      \n    };\n\n    onMeasurementCompleted = (e) => {\n      //console.log('cornerstonetoolsmeasurementcompleted: ', e.detail.measurementData)\n      const measure = {\n        tool: this.props.tool,\n        note: '',\n        data: e.detail.measurementData\n      };\n      if (this.props.tool === \"FreehandRoi\") {\n        setTimeout(() => {\n          this.measurementSave(measure);\n          this.props.setActiveMeasurements(this.measurements)\n        }, 500)\n      } else {\n        this.measurementSave(measure);\n        this.props.setActiveMeasurements(this.measurements)\n      }\n    };\n    \n    onErrorOpenImageClose = () => {\n      this.setState({errorOnOpenImage: null})\n    };\n\n    onErrorCorsClose = () => {\n      this.setState({errorOnCors: false})\n    };\n\n    /*overlayImage = () => {\n      const viewport = cornerstone.getViewport(this.dicomImage)\n\n      if (this.isDicom) document.getElementById(\n        `mrtopleft-${this.props.index}`\n      ).textContent = `${this.PatientsName}`\n\n      document.getElementById(\n        `mrtopright-${this.props.index}`\n      ).textContent = `${viewport.displayedArea.brhc.x}x${viewport.displayedArea.brhc.y}`\n\n      document.getElementById(\n        `mrbottomleft-${this.props.index}`\n      ).textContent = `WW/WC: ${Math.round(viewport.voi.windowWidth)}/${Math.round(viewport.voi.windowCenter)}`\n\n      document.getElementById(\n        `mrbottomright-${this.props.index}`\n      ).textContent = `Zoom: ${Math.round(viewport.scale.toFixed(2)*100)}%`\n\n      if (this.isDicom && this.state.visibleCinePlayer && this.numberOfFrames > 1) {\n        document.getElementById(\n          `frameLabel-${this.props.index}`\n        ).textContent = `${this.state.frame} / ${this.numberOfFrames}`\n        if (this.state.inPlay) {\n          let frame = this.state.frame === this.numberOfFrames ? 1 : this.state.frame+1\n          this.setState({frame: frame})\n        }\n      }\n    }*/\n\n    displayImageFromFilesByImage = (index, image) => {\n\n      const element = this.dicomImage;\n      cornerstone.enable(element);\n      cornerstone.displayImage(element, image);\n    }\n    displayImageFromFiles = (index) => {\n      // console.log('displayImageFromFiles: ', index);\n      // console.log('files: ', this.props.files);\n\n      const image = this.props.files[index].image;\n      const imageId = this.props.files[index].imageId;\n      this.filename = this.props.files[index].name;\n\n      const element = this.dicomImage;\n      element.addEventListener(\"cornerstonenewimage\", this.onNewImage);\n      element.addEventListener(\"cornerstoneimagerendered\", this.onImageRendered);\n      element.addEventListener(\"cornerstonetoolsmeasurementadded\", this.onMeasurementAdded);\n      element.addEventListener(\"cornerstonetoolsmeasurementmodified\", this.onMeasurementModified);\n      element.addEventListener(\"cornerstonetoolsmeasurementcompleted\", this.onMeasurementCompleted);\n      cornerstone.enable(element);\n\n      this.image = image;\n\n      this.isDicom = true;\n      \n      this.PatientsName = image.data.string('x00100010');\n      this.sopInstanceUid = this.getSopInstanceUID();\n\n      let stack = { currentImageIdIndex: 0, imageIds: \"\" };\n      this.numberOfFrames = image.data.intString('x00280008');\n      if (this.numberOfFrames > 0) {\n        let imageIds = [];\n        for(var i=0; i < this.numberOfFrames; ++i) {\n          imageIds.push(imageId + \"?frame=\"+i)\n        }\t\n        stack.imageIds = imageIds\n      }\n\n      cornerstone.displayImage(element, image);\n\n      /*const viewport = cornerstone.getViewport(this.dicomImage)\n      const lut =  cornerstone.generateLut(this.image, viewport.voi.windowWidth, viewport.voi.windowCenter, viewport.invert, viewport.modalityLUT, viewport.voiLUT)\n      this.props.setLutStore(lut)*/\n      this.mprPlanePosition();\n      \n      this.enableTool();\n\n      if (this.numberOfFrames > 1) {\n        cornerstoneTools.addStackStateManager(element, ['stack', 'playClip']);    \n        cornerstoneTools.addToolState(element, 'stack', stack);\n        this.setState({frame: 1})\n      }\n\n      // Load the possible measurements from DB and save in the store \n      db.measurement.where('sopinstanceuid').equals(this.sopInstanceUid).each(measure => {\n        console.log('load measure from db: ', measure);\n        this.measurementSave(measure);\n        cornerstoneTools.addToolState(element, measure.tool, measure.data);\n        this.runTool(measure.tool);\n        cornerstone.updateImage(element);\n        cornerstoneTools.setToolEnabled(measure.tool)\n      }).then(() => {\n        this.props.setActiveMeasurements(this.measurements);\n        this.props.setActiveDcm({image: this.image, element: this.dicomImage, isDicom: this.isDicom});\n        this.props.setIsOpenStore({index: this.props.index, value: true})        \n      })   \n      \n      //this.overlayImage()\n      \n    };\n\n    loadImageFromCanvas = (canvas) => {\n      console.log('loadImageFromCanvas, dcmViewer: ', this.props.index);\n\n      const element = this.dicomImage;\n      element.addEventListener(\"cornerstonenewimage\", this.onNewImage);\n      element.addEventListener(\"cornerstoneimagerendered\", this.onImageRendered);\n      element.addEventListener(\"cornerstonetoolsmeasurementadded\", this.onMeasurementAdded);\n      element.addEventListener(\"cornerstonetoolsmeasurementmodified\", this.onMeasurementModified);\n      element.addEventListener(\"cornerstonetoolsmeasurementcompleted\", this.onMeasurementCompleted);\n      cornerstone.enable(element);\n\n      const imageId = cornerstoneFileImageLoader.fileManager.addCanvas(canvas);\n\n      cornerstone.loadImage(imageId).then(image => {\n        //this.t1 = performance.now()\n        //console.log(`performance load image: ${this.t1-this.t0} milliseconds`)\n\n        console.log('loadImageFromCanvas, image: ', image);\n\n        this.image = image;\n\n        this.isDicom = false;\n\n        cornerstone.displayImage(element, image);\n\n        this.enableTool();\n\n        //this.props.setActiveDcm({image: this.image, element: this.dicomImage, isDicom: this.isDicom})\n        this.props.setIsOpenStore({index: this.props.index, value: true})\n\n        //this.t2 = performance.now()\n        //console.log(`performance: ${this.t2-this.t1} milliseconds`)\n\n        //this.overlayImage()\n\n      }, (e) => {\n        console.log('error', e);\n        this.setState({errorOnOpenImage: \"This is not a valid canvas.\"})\n      })\n    };\n\n    loadImageFromCustomObject = (columns, rows, pixelData) => {\n      //console.log('loadImageFromCustomObject: ')\n\n      const element = this.dicomImage;\n      element.addEventListener(\"cornerstonenewimage\", this.onNewImage);\n      element.addEventListener(\"cornerstoneimagerendered\", this.onImageRendered);\n      element.addEventListener(\"cornerstonetoolsmeasurementadded\", this.onMeasurementAdded);\n      element.addEventListener(\"cornerstonetoolsmeasurementmodified\", this.onMeasurementModified);\n      element.addEventListener(\"cornerstonetoolsmeasurementcompleted\", this.onMeasurementCompleted);\n      cornerstone.enable(element);\n      \n      let customObj = {\n        rows: rows,\n        columns: columns,\n        pixelData: pixelData,\n        image: this.originImage,\n      };\n\n      const imageId = cornerstoneFileImageLoader.fileManager.addCustom(customObj);\n\n      cornerstone.loadImage(imageId).then(image => {\n        //console.log('loadImageFromCustomObject, image: ', image)\n\n        this.image = image;\n\n        this.isDicom = true;\n\n        cornerstone.displayImage(element, image);\n\n        //this.enableTool()\n\n        this.props.setIsOpenStore({index: this.props.index, value: true})\n\n      }, (e) => {\n        console.log('error', e);\n        this.setState({errorOnOpenImage: \"This is not a valid canvas.\"})\n      })\n    };\n\n    loadImage = (localfile, url=undefined, fsItem=undefined) => {\n      console.log('loadImage, localfile: ', localfile);\n      console.log('loadImage, fsItem: ', fsItem);\n      console.log('loadImage, url: ', url);\n\n      if (localfile === undefined && url === undefined && fsItem === undefined) return;\n      \n      if (fsItem !== undefined) {\n        this.fsItem = fsItem\n      } else if (localfile !== undefined) {\n        this.localfile = localfile\n      } else {\n        this.localurl = url\n      }\n \n      const element = this.dicomImage;\n\n      element.addEventListener(\"cornerstonenewimage\", this.onNewImage);\n      element.addEventListener(\"cornerstoneimagerendered\", this.onImageRendered);\n      element.addEventListener(\"cornerstonetoolsmeasurementadded\", this.onMeasurementAdded);\n      element.addEventListener(\"cornerstonetoolsmeasurementmodified\", this.onMeasurementModified);\n      element.addEventListener(\"cornerstonetoolsmeasurementcompleted\", this.onMeasurementCompleted);\n\n      let imageId = undefined;\n\n      cornerstone.enable(element);\n\n      let size = 0;\n\n      if (localfile === undefined && isUrlImage(url)) { // check if it's a simple image [jpeg or png] from url\n        //console.log('image: ', file)\n        cornerstone.loadImage(url).then(image => {\n          //console.log('loadImage, image from url: ', image)\n\n          this.hideOpenUrlDlg();\n\n          this.image = image;\n\n          this.isDicom = false;\n\n          cornerstone.displayImage(element, image);\n          \n          this.enableTool();\n\n          this.props.setActiveDcm({image: this.image, element: this.dicomImage, isDicom: this.isDicom});\n          this.props.isOpenStore(true)\n\n        }, (e) => {\n          console.log('error', e);\n          this.setState({errorOnOpenImage: \"This is not a valid JPG or PNG file.\"})\n        })\n\n      } else if ((localfile !== undefined && isFileImage(localfile)) || (fsItem !== undefined && isFsFileImage(fsItem))) { // otherwise try to open as local image file (JPEG, PNG) \n        if (fsItem !== undefined) {\n          imageId = cornerstoneFileImageLoader.fileManager.addBuffer(fsItem.data)\n        } else {\n          imageId = cornerstoneFileImageLoader.fileManager.add(localfile)\n        }\n        cornerstone.loadImage(imageId).then(image => {\n          // console.log('loadImage, image from local: ', image);\n\n          this.image = image;\n          this.isDicom = false;\n          this.PatientsName = '';\n          // console.log(\"image data:\" + image.data);\n          cornerstone.displayImage(element, image);\n          \n          this.enableTool();\n\n          this.props.setActiveDcm({image: this.image, element: this.dicomImage, isDicom: this.isDicom});\n          //this.props.isOpenStore(true)\n          this.props.setIsOpenStore({index: this.props.index, value: true})\n\n        }, (e) => {\n          console.log('error', e);\n          this.setState({errorOnOpenImage: \"This is not a valid JPG or PNG file.\"})\n        })\n\n      } else { // otherwise try to open as Dicom file\n\n        if (fsItem !== undefined) {\n          imageId = cornerstoneWADOImageLoader.wadouri.fileManager.addBuffer(fsItem.data);\n          this.filename = fsItem.name;\n          size = fsItem.size\n        } else if (localfile !== undefined) {\n          imageId = cornerstoneWADOImageLoader.wadouri.fileManager.add(localfile);\n          this.filename = localfile.name;\n          size = localfile.size\n        } else { // it's a web dicom image\n          imageId = \"wadouri:\"+url\n        }\n  \n        // console.log('loadImage, imageId: ', imageId);\n\n        cornerstone.loadAndCacheImage(imageId).then(image => {\n          console.log('loadImage, image: ', image);\n          // let pixelDataElement = image.data.elements.x7fe00010;\n          // console.log('loadImage, pixelDataElement: ', pixelDataElement);\n          // console.log('loadImage, getPixelData: ', image.getPixelData());\n\n\n          this.hideOpenUrlDlg();\n\n          this.image = image;\n\n          this.isDicom = true;\n\n          let dataSet = dicomParser.parseDicom(image.data.byteArray);\n          console.log('image dataset -----: ' + dataSet.string('x00200011'));\n          console.log('Series Number: ' + image.data.string('x00200011'));\n          \n\n          this.PatientsName = image.data.string('x00100010');\n          console.log('PatientsName: ' + this.PatientsName);\n          this.sopInstanceUid = this.getSopInstanceUID();\n\n          let stack = { currentImageIdIndex: 0, imageIds: \"\" };\n          this.numberOfFrames = image.data.intString('x00280008');\n          if (this.numberOfFrames > 0) {\n            let imageIds = [];\n            for(var i=0; i < this.numberOfFrames; ++i) {\n              imageIds.push(imageId + \"?frame=\"+i)\n            }\t\n            stack.imageIds = imageIds\n          }\n\n          cornerstone.displayImage(element, image);\n          //cornerstoneTools.mouseInput.enable(element);\n          //cornerstoneTools.mouseWheelInput.enable(element);\n\n          this.enableTool();\n\n          /*const viewport = cornerstone.getViewport(this.dicomImage)\n          const lut =  cornerstone.generateLut(this.image, viewport.voi.windowWidth, viewport.voi.windowCenter, viewport.invert, viewport.modalityLUT, viewport.voiLUT)\n          console.log('lut: ', lut)*/\n\n          if (this.numberOfFrames > 1) {\n            cornerstoneTools.addStackStateManager(element, ['stack', 'playClip']);    \n            cornerstoneTools.addToolState(element, 'stack', stack);\n            //cornerstoneTools.setToolActive('StackScrollMouseWheel', { })\n            this.setState({frame: 1})\n          }\n  \n          // Load the possible measurements from DB and save in the store \n          db.measurement.where('sopinstanceuid').equals(this.sopInstanceUid).each(measure => {\n            console.log('load measure from db: ', measure);\n            //this.props.measurementStore(measure)\n            this.measurementSave(measure);\n            cornerstoneTools.addToolState(element, measure.tool, measure.data);\n            this.runTool(measure.tool);\n            cornerstone.updateImage(element);\n            cornerstoneTools.setToolEnabled(measure.tool)\n          }).then(() => {\n            //console.log('this.measurements: ', this.measurements)\n            this.props.setActiveMeasurements(this.measurements);\n            this.props.setActiveDcm({name: this.filename, size: size, image: this.image, element: this.dicomImage, isDicom: this.isDicom});\n            this.props.setIsOpenStore({index: this.props.index, value: true})            \n          });\n\n\n\n\n\n\n        }, (e) => {\n          console.log('error', e);\n          this.hideOpenUrlDlg();\n          //console.log('toString: ', e.error.toString())\n          const error = e.error.toString();\n          if (error === '[object XMLHttpRequest]') {\n            this.setState({errorOnCors: true})\n          } else {\n            const pos = error.indexOf(\":\");\n            this.setState({errorOnOpenImage: pos < 0 ? e.error : error.substring(pos+1)})            \n          } \n        })\n      }\n    };\n  \n    enableTool = (toolName, mouseButtonNumber) => {\n      // Enable all tools we want to use with this element\n      const WwwcTool = cornerstoneTools.WwwcTool;\n      const LengthTool = cornerstoneTools['LengthTool'];\n      const PanTool = cornerstoneTools.PanTool;\n      const ZoomTouchPinchTool = cornerstoneTools.ZoomTouchPinchTool;\n      const ZoomTool = cornerstoneTools.ZoomTool;\n      const ProbeTool = cornerstoneTools.ProbeTool;\n      const EllipticalRoiTool = cornerstoneTools.EllipticalRoiTool;\n      const RectangleRoiTool = cornerstoneTools.RectangleRoiTool;\n      const FreehandRoiTool = cornerstoneTools.FreehandRoiTool;\n      const AngleTool = cornerstoneTools.AngleTool;\n      const MagnifyTool = cornerstoneTools.MagnifyTool;\n      const StackScrollMouseWheelTool = cornerstoneTools.StackScrollMouseWheelTool;\n\n      cornerstoneTools.addTool(MagnifyTool);\n      cornerstoneTools.addTool(AngleTool);\n      cornerstoneTools.addTool(WwwcTool);\n      cornerstoneTools.addTool(LengthTool);\n      cornerstoneTools.addTool(PanTool);\n      cornerstoneTools.addTool(ZoomTouchPinchTool);\n      cornerstoneTools.addTool(ZoomTool);\n      cornerstoneTools.addTool(ProbeTool);\n      cornerstoneTools.addTool(EllipticalRoiTool);\n      cornerstoneTools.addTool(RectangleRoiTool);\n      cornerstoneTools.addTool(FreehandRoiTool);\n      cornerstoneTools.addTool(StackScrollMouseWheelTool)      \n    };\n  \n    // helper function used by the tool button handlers to disable the active tool\n    // before making a new tool active\n    disableAllTools = () => {\n      cornerstoneTools.setToolEnabled('Length');\n      cornerstoneTools.setToolEnabled('Pan');\n      cornerstoneTools.setToolEnabled('Magnify');\n      cornerstoneTools.setToolEnabled('Angle');\n      cornerstoneTools.setToolEnabled('RectangleRoi');\n      cornerstoneTools.setToolEnabled('Wwwc');\n      cornerstoneTools.setToolEnabled('ZoomTouchPinch');\n      cornerstoneTools.setToolEnabled('Probe');\n      cornerstoneTools.setToolEnabled('EllipticalRoi');\n      cornerstoneTools.setToolEnabled('FreehandRoi');\n      cornerstoneTools.setToolEnabled('StackScrollMouseWheel')\n    };\n  \n    runTool2 = (index, image) => {\n      cornerstone.disable(this.dicomImage);\n      this.displayImageFromFilesByImage(index, image);\n    }\n\n    runTool = (toolName, opt) => {\n      //console.log('run tool: ', toolName)\n      // this.disableAllTools()\n      switch (toolName) {\n        case 'openImage': {\n          cornerstone.disable(this.dicomImage);\n          // this.displayImageFromFilesByImage(opt);\n          break\n        }\n        case 'openimage': {\n          //console.log('openimage: ', opt)\n          //console.log('openimage, this.dicomImage: ', this.dicomImage)\n          cornerstone.disable(this.dicomImage);\n          this.displayImageFromFiles(opt);\n          break   \n        }\n        case 'openLocalFs': {\n          console.log('openLocalFs: ', opt);\n          cornerstone.disable(this.dicomImage);\n          this.loadImage(opt);\n          break   \n        } \n        case 'openSandboxFs': {\n          //console.log('openSandboxFs: ', opt)\n          cornerstone.disable(this.dicomImage);\n          //this.setState({ file: opt })\n          this.loadImage(undefined, undefined, opt);\n          break   \n        }         \n        case 'openurl': {\n          //console.log('run tool opt: ', opt)  \n          this.showOpenUrlDlg(opt);\n          break                 \n        }\n        case 'clear': {\n          this.setState({ visibleCinePlayer: false });\n          this.mprPlane = '';\n          //this.props.clearingStore()\n          cornerstone.disable(this.dicomImage);\n          break\n        }  \n        case 'notool': {\n          this.disableAllTools();\n\n          //const element = this.dicomImage\n\n          //cornerstoneTools.clearToolState(element, 'Length')\n          \n          //const toolStateManager = cornerstoneTools.getElementToolStateManager(element)\n          //console.log('toolStateManager.toolState: ', toolStateManager.toolState)\n          /*\n          const toolState = toolStateManager.toolState\n          // const allTools = Object.keys(toolState).map(key => toolState[key])\n          let key = Object.keys(toolState)[0]\n          let allTools = toolState[key]\n          //console.log('allTools: ', allTools)\n\n          for (let [tool, data] of Object.entries(allTools)) {\n            //console.log(`${tool}: `, data)\n            let key = Object.keys(data)[0]\n            let tools = data[key]\n            //console.log('tools: ', tools)\n            tools.forEach(item => {\n              //console.log('tool: ', tool)\n              //console.log(item)\n              const measure = {\n                tool: tool,\n                note: '',\n                data: item\n              }\n              console.log('measure: ', measure)\n              this.props.measurementStore(measure)\n            })\n          }\n          */\n          //const toolState = toolStateManager.get(element, 'Length')\n          //console.log('toolState: ', toolState)\n\n          /*\n          const measurementData = {\n            visible: true,\n            active: true,\n            invalidated: true,\n            handles: {\n                start: {\n                    x: 100,\n                    y: 100,\n                    highlight: true,\n                    active: false\n                },\n                end: {\n                    x: 200,\n                    y: 200,\n                    highlight: true,\n                    active: true\n                },\n                textBox: {\n                    active: false,\n                    hasMoved: false,\n                    movesIndependently: false,\n                    drawnIndependently: true,\n                    allowedOutsideImage: true,\n                    hasBoundingBox: true\n                }\n              }\n          }\n          cornerstoneTools.addToolState(element, 'RectangleRoi', measurementData)    \n          cornerstoneTools.setToolActive('RectangleRoi', { mouseButtonMask: 1 })\n          */  \n          //cornerstone.updateImage(element)   \n          break\n        }\n        case 'Wwwc': {\n          cornerstoneTools.setToolActive('Wwwc', { mouseButtonMask: 1 });\n          break\n        }  \n        case 'Pan': {\n          cornerstoneTools.setToolActive('Pan', { mouseButtonMask: 1 });\n          break   \n        }  \n        case 'Zoom': {\n          cornerstoneTools.setToolActive(isMobile ? 'ZoomTouchPinch' : 'Zoom', { mouseButtonMask: 1 });\n          break\n        }\n        case 'Length': {\n          cornerstoneTools.setToolActive('Length', isMobile ? { isTouchActive: true } : { mouseButtonMask: 1 });\n          break  \n        }\n        case 'Probe': {\n            cornerstoneTools.setToolActive('Probe', { mouseButtonMask: 1 });\n          break\n        }\n        case 'EllipticalRoi': {\n          cornerstoneTools.setToolActive('EllipticalRoi', { mouseButtonMask: 1 });\n          break   \n        }\n        case 'RectangleRoi': {\n          cornerstoneTools.setToolActive('RectangleRoi', { mouseButtonMask: 1 });\n          break  \n        }\n        case 'Angle': {\n          cornerstoneTools.setToolActive('Angle', { mouseButtonMask: 1 });\n          break \n        }\n        case 'Magnify': {\n          cornerstoneTools.setToolActive('Magnify', { mouseButtonMask: 1 });\n          break  \n        }\n        case 'FreehandRoi': {\n          cornerstoneTools.setToolActive('FreehandRoi', { mouseButtonMask: 1 });\n          break \n        }\n        case 'Invert': {\n          const element = this.dicomImage;\n          const viewport = cornerstone.getViewport(element);\n          viewport.invert = !viewport.invert;\n          cornerstone.setViewport(element, viewport);\n          break \n        }         \n        case 'saveas': {\n            let type = localStorage.getItem(SETTINGS_SAVEAS);\n            if (getSettingsSaveInto() === 'local') {\n              // cornerstoneTools.SaveAs(this.dicomImage, `${this.filename}.${type}`, `image/${type}`)   \n              const element = this.dicomImage;\n              const viewport = cornerstone.getViewport(element);\n              const canvas = document.getElementsByClassName('cornerstone-canvas')[this.props.activeDcmIndex];\n              const zoom = viewport.scale.toFixed(2);\n              const cols = this.image.columns * zoom;\n              const rows = this.image.rows * zoom;\n\n              let myCanvas = document.createElement('canvas');\n              myCanvas = this.cropCanvas(canvas, \n                Math.round(canvas.width / 2 - cols / 2), \n                Math.round(canvas.height / 2 - rows / 2), \n                cols, rows);\n\n              let a = document.createElement(\"a\");\n              a.href = myCanvas.toDataURL(`image/${type}`);\n              a.download = `${this.filename}.${type}`;\n              document.body.appendChild(a); // Required for this to work in FireFox\n              a.click()           \n\n            } else { // store image into sandbox file system\n              const element = this.dicomImage;\n              const viewport = cornerstone.getViewport(element);\n              const canvas = document.getElementsByClassName('cornerstone-canvas')[this.props.activeDcmIndex];\n              const zoom = viewport.scale.toFixed(2);\n              const cols = this.image.columns * zoom;\n              const rows = this.image.rows * zoom;\n\n              let myCanvas = document.createElement('canvas');\n              myCanvas = this.cropCanvas(canvas, \n                Math.round(canvas.width / 2 - cols / 2), \n                Math.round(canvas.height / 2 - rows / 2), \n                cols, rows);\n              \n              blobUtil.canvasToBlob(myCanvas, `image/${type}`).then(blob => {\n                blobUtil.blobToArrayBuffer(blob).then(arrayBuffer => {\n                  const name = `${getFileName(this.filename)}-MPR-${this.mprPlane}`;\n                  let newName = name;\n                  let counter = 1;\n                  let done = false;\n                  do {\n                      let filename = `${newName}.${type}`;\n                      const checkName = this.props.fsCurrentList.find(e => e.name === filename);\n                      if (checkName === undefined) {\n                          fs.transaction('rw', fs.files, async () => {\n                              await fs.files.add({\n                                  parent: this.props.fsCurrentDir,\n                                  name: filename,\n                                  type: type,\n                                  size: arrayBuffer.byteLength,\n                                  data: arrayBuffer\n                              })\n                          }).then(() => {\n                            this.props.makeFsRefresh()\n                          });\n                          done = true\n                      } else {\n                          newName = `${name} - ${counter}`;\n                          counter++\n                      }\n                  } while (!done)\n                })\n              })\n            }  \n          break\n        }\n        case 'cine': {\n          this.setState({ visibleCinePlayer: !this.state.visibleCinePlayer });\n          break\n        }\n        case 'reset': {\n          this.reset();\n          break\n        }\n        case 'removetool': {\n          console.log('removetool index: ', opt);\n          const element = this.dicomImage;\n          cornerstoneTools.removeToolState(element, this.measurements[opt].tool, this.measurements[opt].data);\n          cornerstone.updateImage(element);\n          //this.props.measurementRemoveStore(opt)\n          this.measurementRemove(opt);\n          this.props.setActiveMeasurements(this.measurements);\n          break\n        }  \n        case 'removetools': {   \n          const element = this.dicomImage;\n          // for each measurement remove it \n          this.measurements.forEach(measure => {\n            cornerstoneTools.clearToolState(element, measure.tool)         \n          });\n          cornerstone.updateImage(element);\n          this.measurementClear();\n          // also remove all measurements from db\n          db.measurement.where('sopinstanceuid').equals(this.sopInstanceUid).delete();\n          this.props.setActiveMeasurements(this.measurements);\n          break\n        }  \n        case 'savetools': {\n          // first, remove eventually previous measurements from db\n          db.measurement.where('sopinstanceuid').equals(this.sopInstanceUid).delete();\n          // then save all the current measurements\n          this.measurements.forEach(measure => {\n            try {\n              db.measurement.add({\n                sopinstanceuid: this.sopInstanceUid, \n                tool: measure.tool,\n                note: measure.note,\n                data: measure.data\n              })\n            } catch(error) {\n              console.error(error)\n            }                       \n          });\n          break\n        }\n        default: {\n          break\n        }\n      }\n    };\n\n    cropCanvas = (canvas, x, y, width, height) => {\n      console.log(`canvas: ${canvas.width}, ${canvas.height}`);\n      console.log(`x, y: ${x}, ${y}`);\n      console.log(`width, height: ${width}, ${height}`);\n\n      // create a temp canvas\n      const newCanvas = document.createElement('canvas');\n      // set its dimensions\n      newCanvas.width = width;\n      newCanvas.height = height;\n      // draw the canvas in the new resized temp canvas \n      newCanvas.getContext('2d').drawImage(canvas, x, y, width, height, 0, 0, width, height);\n      return newCanvas\n    };\n\n    changeTool = (toolName, value) => {\n      console.log('change tool, value: ', toolName, value);\n\n      switch (toolName) {\n        case 'Wwwc':\n          if (value === 1) {\n            cornerstoneTools.setToolActive('Wwwc', { mouseButtonMask: 1 })\n          } else if (value === 0) {\n            cornerstoneTools.setToolPassive('Wwwc')\n          }\n          break;\n        case 'Pan':\n          if (value === 1) {\n            cornerstoneTools.setToolActive('Pan', { mouseButtonMask: 1 })\n          } else if (value === 0) {\n            cornerstoneTools.setToolPassive('Pan')\n          }\n          break;\n        case 'Zoom':\n          if (value === 1) {\n            cornerstoneTools.setToolActive(isMobile ? 'ZoomTouchPinch' : 'Zoom', { mouseButtonMask: 1 })\n          } else if (value === 0) {\n            cornerstoneTools.setToolPassive(isMobile ? 'ZoomTouchPinch' : 'Zoom')\n          }\n          break;\n        case 'Length':\n          if (value === 1) {\n            cornerstoneTools.setToolActive('Length', isMobile ? { isTouchActive: true } : { mouseButtonMask: 1 })\n          } else if (value === 0) {\n            cornerstoneTools.setToolPassive('Length')\n          }\n          break;\n        case 'Probe':\n          if (value === 1) {\n            cornerstoneTools.setToolActive('Probe', { mouseButtonMask: 1 })\n          } else if (value === 0) {\n            cornerstoneTools.setToolPassive('Probe')\n          }\n          break;\n        case 'Angle':\n          if (value === 1) {\n            cornerstoneTools.setToolActive('Angle', { mouseButtonMask: 1 })\n          } else if (value === 0) {\n            cornerstoneTools.setToolPassive('Angle')\n          }          \n          break;\n        case 'Magnify':\n          if (value === 1) {\n            cornerstoneTools.setToolActive('Magnify', { mouseButtonMask: 1 })\n          } else if (value === 0) {\n            cornerstoneTools.setToolPassive('Magnify')\n          }          \n          break;\n        case 'EllipticalRoi':\n          if (value === 1) {\n            cornerstoneTools.setToolActive('EllipticalRoi', { mouseButtonMask: 1 })\n          } else if (value === 0) {\n            cornerstoneTools.setToolPassive('EllipticalRoi')\n          }\n          break;\n        case 'RectangleRoi':\n          if (value === 1) {\n            cornerstoneTools.setToolActive('RectangleRoi', { mouseButtonMask: 1 })\n          } else if (value === 0) {\n            cornerstoneTools.setToolPassive('RectangleRoi')\n          }\n          break;\n        case 'FreehandRoi':\n          if (value === 1) {\n            cornerstoneTools.setToolActive('FreehandRoi', { mouseButtonMask: 1 })\n          } else if (value === 0) {\n            cornerstoneTools.setToolPassive('FreehandRoi')\n          }\n          break;\n        default:\n            break\n        }  \n    };\n\n    runCinePlayer = (cmdName) => {\n      //console.log('this.state.frame: ', this.state.frame)\n      const element = this.dicomImage;\n      switch (cmdName) {\n        case 'firstframe': {\n          let frame = 1;\n          this.setState({frame: frame});\n          scrollToIndex(element, 0);\n          break\n        }\n        case 'previousframe': {\n          if (this.state.frame > 1) {\n            let frame = this.state.frame-1;\n            this.setState({frame: frame});\n            scrollToIndex(element, frame-1)       \n          }\n          break\n        }\n        case 'play': {\n          cornerstoneTools.playClip(element, 30);\n          this.setState({inPlay: true});\n          break\n        }\n        case 'pause': {\n            cornerstoneTools.stopClip(element);\n            this.setState({inPlay: false});\n          break\n        }\n        case 'nextframe': {\n          if (this.state.frame < this.numberOfFrames) {\n            let frame = this.state.frame+1;\n            this.setState({frame: frame});\n            scrollToIndex(element, frame-1)\n          }\n          break  \n        }\n        case 'lastframe': {\n          let frame = this.numberOfFrames;\n          this.setState({frame: frame});\n          scrollToIndex(element, frame-1);\n          break    \n        }                       \n        default:\n          break\n      }\n    };\n\n    reset = () => {\n      const element = this.dicomImage;\n      const defaultViewport = cornerstone.getDefaultViewportForImage(element, this.image);\n      let viewport = cornerstone.getViewport(element);\n      viewport.voi.windowWidth = defaultViewport.voi.windowWidth;\n      viewport.voi.windowCenter = defaultViewport.voi.windowCenter;\n      viewport.invert = false;\n      cornerstone.setViewport(element, viewport)\n    };\n\n    // -------------------------------------------------------------------------------------------- MPR\n\n    mprPlanePosition = () => {\n      //console.log(\"mprPlanePosition: \")\n      try {\n        if (!this.isDicom) return this.mprPlane;\n        // console.log(\"image data:\" + this.image.data);\n        const imageOrientation = this.image.data.string('x00200037').split('\\\\');\n        let v = new Array(6).fill(0);\n        v[0] = parseFloat(imageOrientation[0]); // the x direction cosines of the first row X\n        v[1] = parseFloat(imageOrientation[1]); // the y direction cosines of the first row X\n        v[2] = parseFloat(imageOrientation[2]); // the z direction cosines of the first row X\n        v[3] = parseFloat(imageOrientation[3]); // the x direction cosines of the first column Y\n        v[4] = parseFloat(imageOrientation[4]); // the y direction cosines of the first column Y\n        v[5] = parseFloat(imageOrientation[5]); // the z direction cosines of the first column Y\n        v = v.map((x) => Math.round(x));\n        let p = [v[1]*v[5] - v[2]*v[4], v[2]*v[3] - v[0]*v[5], v[0]*v[4] - v[1]*v[3]]; // cross product of X x Y\n        p = p.map((x) => Math.abs(x));\n        if (p[0] === 1) {\n          this.mprPlane = 'sagittal'\n        } else if (p[1] === 1) {\n          this.mprPlane = 'coronal'\n        } else if (p[2] === 1) {\n          this.mprPlane = 'axial'\n        }\n      } catch(error) { // it's not possible to build MPR\n        this.mprPlane = ''\n      } \n      return this.mprPlane \n    };\n\n    transpose = (matrix) => {\n      return Object.keys(matrix[0]).map(colNumber => matrix.map(rowNumber => rowNumber[colNumber]));\n    };\n\n    mprRenderYZPlane = (filename, origin, x, mprData) => {\n      if (this.volume === null) return;\n      this.filename = filename;\n      cornerstone.disable(this.dicomImage);\n      //console.log(`mprRenderYZPlane, origin: ${origin}, x: ${x}`)\n      //console.log('mprRenderYZPlane, volume: ', this.volume)\n\n      if (origin === 'sagittal') \n        this.mprPlane = 'coronal';\n      else if (origin === 'axial') \n        this.mprPlane = 'sagittal';\n      else\n        this.mprPlane = 'sagittal';\n\n      this.xSize = this.props.files[0].columns;\n      this.ySize = this.props.files[0].rows;\n      this.zSize = mprData.zDim;\n\n      const i = Math.round(x / this.xSize * this.props.files.length);\n      this.originImage = this.props.files[i].image;\n\n      if (origin === 'sagittal') {\n        let xoffset = Math.floor(this.xSize / 2) - Math.floor(this.zSize / 2);\n        let plane = new Int16Array(this.xSize * this.ySize);\n        for (let y = 0; y < this.ySize; y++) \n          for (let z = 0; z < this.zSize; z++) \n            plane[z + this.ySize * y + xoffset] = this.volume[z][x + this.ySize * y];\n        this.loadImageFromCustomObject(this.xSize, this.ySize, plane)\n\n      } else if (origin === 'coronal') {\n        let xoffset = Math.floor(this.xSize / 2) - Math.floor(this.zSize / 2);\n        let plane = new Int16Array(this.xSize * this.ySize);\n        for (let y = 0; y < this.ySize; y++) \n          for (let z = 0; z < this.zSize; z++) \n            plane[z + this.ySize * y + xoffset] = this.volume[z][x + this.ySize * y];\n        this.loadImageFromCustomObject(this.xSize, this.ySize, plane)\n\n      } else { // axial\n        const yzPlane = this.mprBuildYZPlane(x);\n        this.loadImageFromCustomObject(this.ySize, this.zSize, yzPlane)\n      }\n    };\n\n    mprBuildYZPlane = (x) => {\n      //console.log(`mprBuildYZPlane, ySize: ${this.ySize}, zSize: ${this.zSize} `)\n      let plane = new Int16Array(this.ySize * this.zSize);\n      for (var y = 0; y < this.ySize; y++) \n        for (var z = 0; z < this.zSize; z++) \n          plane[y + this.ySize * z] = this.volume[z][x + this.ySize * y];\n      //console.log('mprBuildYZPlane, plane: ', plane)\n      return plane\n    };\n\n    mprRenderXZPlane = (filename, origin, y, mprData) => {\n      if (this.volume === null) return;\n      this.filename = filename;\n      cornerstone.disable(this.dicomImage);\n      //console.log(`mprRenderXZPlane, origin: ${origin}, y: ${y}`)\n      //console.log('mprRenderXZPlane, volume: ', this.volume)\n\n      if (origin === 'sagittal') \n        this.mprPlane = 'axial';\n      else if (origin === 'axial') \n        this.mprPlane = 'coronal';\n      else\n        this.mprPlane = 'axial';\n\n      this.xSize = this.props.files[0].columns;\n      this.ySize = this.props.files[0].rows;\n      this.zSize = mprData.zDim;\n\n      const i = Math.trunc(y / this.ySize * this.props.files.length);\n      this.originImage = this.props.files[i].image;\n\n      if (origin === 'sagittal') {\n        let xoffset = Math.floor(this.xSize / 2) - Math.floor(this.zSize / 2);\n        let plane = new Int16Array(this.xSize * this.ySize);\n        for (let x = 0; x < this.xSize; x++) \n          for (let z = 0; z < this.zSize; z++)\n            plane[z + this.xSize * x + xoffset] = this.volume[z][x + this.xSize * y];\n        this.loadImageFromCustomObject(this.xSize, this.ySize, plane)\n\n      } else {\n        const xzPlane = this.mprBuildXZPlane(y);\n        this.loadImageFromCustomObject(this.xSize, this.zSize, xzPlane)\n      }\n    };\n  \n    mprBuildXZPlane = (y) => {\n      //console.log(`mprBuildXZPlane, xSize: ${this.xSize}, zSize: ${this.zSize} `)\n      let plane = new Int16Array(this.xSize * this.zSize);\n      for (let x = 0; x < this.xSize; x++) \n        for (let z = 0; z < this.zSize; z++)\n          plane[x + this.xSize * z] = this.volume[z][x + this.xSize * y];\n      //console.log('mprBuildXZPlane, plane: ', plane)    \n      return plane\n    };\n\n    mprIsOrthogonalView = () => {\n      //console.log('mprIsOrthogonalView: ', this.mprPlane)\n      return (this.mprPlane !== '' && this.props.layout[0] === 1 && this.props.layout[1] === 3)\n    };\n\n    // -------------------------------------------------------------------------------------------- MPR\n    \n    dicomImageRef = el => {\n      this.dicomImage = el\n    };\n\n    onImageClick = () => {\n      console.log('onImageClick: ')\n    };\n    \n    render() {\n      //console.log('DicomViewer render: ')\n\n      //this.props.visible ? document.body.style = 'background: #000000;' : document.body.style = 'background: $md-grey-700;'\n\n      const isOpen = this.props.isOpen[this.props.index];\n      //const visibleHistogram = this.state.visibleHistogram\n      const visibleOpenUrlDlg = this.state.visibleOpenUrlDlg;\n      const errorOnOpenImage = this.state.errorOnOpenImage;\n      const progress = this.state.progress;\n\n      const styleContainer = {\n        width: '100%', \n        height: '100%', \n        border: this.props.activeDcmIndex === this.props.index && (this.props.layout[0] > 1 || this.props.layout[1] > 1) ? 'solid 1px #AAAAAA' : null,\n        position: 'relative',\n      };\n\n      const styleDicomImage = {\n        width: '100%', \n        height: '100%', \n        position: 'relative',\n      };\n\n      const overlay = getSettingsOverlay();\n\n      return ( \n        <div className=\"container\" style={styleContainer} >\n\n          {visibleOpenUrlDlg ? <OpenUrlDlg progress={progress} onClose={this.hideOpenUrlDlg} /> : null}\n\n          <Dialog\n            open={errorOnOpenImage !== null}\n            onClose={this.onErrorOpenImageClose}\n          >\n            <DialogTitle id=\"alert-dialog-title\">{\"Error on opening image\"}</DialogTitle>\n            <DialogContent>\n              <DialogContentText id=\"alert-dialog-description\">\n                {this.state.errorOnOpenImage}\n              </DialogContentText>\n            </DialogContent>\n            <DialogActions>\n              <Button onClick={this.onErrorOpenImageClose} autoFocus>\n                Ok\n              </Button>\n            </DialogActions>\n          </Dialog>\n\n          <Dialog\n            open={this.state.errorOnCors}\n            onClose={this.onErrorCorsClose}\n            aria-labelledby=\"alert-dialog-title\"\n            aria-describedby=\"alert-dialog-description\"\n          >\n            <DialogTitle id=\"alert-dialog-title\">{\"Error on loading image\"}</DialogTitle>\n            <DialogContent>\n              <DialogContentText id=\"alert-dialog-description\">\n                <Typography gutterBottom>\n                  CORS or Cross Origin Resource Sharing is a browser security policy \n                  that prevents javascript from loading data from a server with a different base URL \n                  than the server that served up the javascript file. \n                </Typography> \n                <Typography gutterBottom>\n                  See the &nbsp; \n                  <Link href=\"http://enable-cors.org/\" target='_blank' color='textPrimary'>\n                    Enable CORS site\n                  </Link>\n                  &nbsp; for information about CORS.                     \n                </Typography>                                \n              </DialogContentText>\n            </DialogContent>\n            <DialogActions>\n              <Button onClick={this.onErrorCorsClose} autoFocus>\n                Ok\n              </Button>\n            </DialogActions>\n          </Dialog>\n\n          <div\n            style={{\n              width: '100%', \n              height: '100%', \n              position: \"relative\",\n              color: '#FFFFFF',\n              textShadow: '1px 1px #000000'\n            }}\n            onContextMenu={() => false}\n            className=\"cornerstone-enabled-image\"\n          >\n            <div \n              ref={this.dicomImageRef} style={styleDicomImage}\n            >\n            </div>\n\n            <div\n              id={`mrtopleft-${this.props.index}`}\n              style={{ position: \"absolute\", top: 0, left: 3, display: isOpen && overlay ? \"\" : \"none\" }}\n            >\n              \n            </div>\n            <div\n              id={`mrtopright-${this.props.index}`}\n              style={{ position: \"absolute\", top: 0, right: 3, display: isOpen && overlay ? \"\" : \"none\" }}\n            >\n              \n            </div>\n            <div\n              id={`mrbottomright-${this.props.index}`}\n              style={{ position: \"absolute\", bottom: 0, right: 3, display: isOpen && overlay ? \"\" : \"none\" }}\n            >\n              \n            </div>\n            <div\n              id={`mrbottomleft-${this.props.index}`}\n              style={{ position: \"absolute\", bottom: 0, left: 3, display: isOpen && overlay ? \"\" : \"none\" }}\n            >\n              \n            </div>   \n\n            <div\n              id={`mrtopcenter-${this.props.index}`}\n              style={{ position: \"absolute\", top: 0, width: '60px', left: '50%', marginLeft: '0px', display: isOpen && overlay ? \"\" : \"none\" }}\n            >\n              \n            </div>\n\n            <div\n              id={`mrleftcenter-${this.props.index}`}\n              style={{ position: \"absolute\", top: '50%', width: '30px', left: 3, marginLeft: '0px', display: isOpen && overlay ? \"\" : \"none\" }}\n            >\n              \n            </div>    \n\n            <div\n              id={`mrrightcenter-${this.props.index}`}\n              style={{ position: \"absolute\", top: '50%', width: '30px', right: 3, marginRight: '-20px', display: isOpen && overlay ? \"\" : \"none\" }}\n            >\n              \n            </div>                \n\n            <div\n              id={`mrbottomcenter-${this.props.index}`}\n              style={{ position: \"absolute\", bottom: 0, width: '60px', left: '50%', marginLeft: '0px', display: isOpen && overlay ? \"\" : \"none\" }}\n            >\n              \n            </div>\n\n            { this.state.visibleCinePlayer && this.numberOfFrames > 1 ? (\n              <div style={{position:\"absolute\", width:'100%', bottom:0, textAlign:'center'}}>\n                <div style={{margin:'0 auto', width:'240px', backgroundColor:'rgba(136, 136, 136, 0.5)'}}>\n                  <CinePlayer runCinePlayer={this.runCinePlayer} inPlay={this.state.inPlay} />  \n                  <div \n                    id={`frameLabel-${this.props.index}`}\n                    style={{ width:230, margin:'0 auto', marginTop:-10, textAlign:\"center\" }}\n                  >\n                    {this.state.frame} / {this.numberOfFrames}\n                  </div> \n                </div>               \n              </div> \n              ) : null\n            }  \n            {/*<div style={{position:\"absolute\", width:'100%', height:'100%', top:0, left:0}}></div>*/}\n          </div>\n        </div>\n      )\n    }\n  }\n  \nconst mapStateToProps = (state) => {\n  return {\n    files: state.files,\n    url: state.url,\n    isOpen: state.isOpen,\n    tool: state.tool,\n    activeDcmIndex: state.activeDcmIndex,\n    activeDcm: state.activeDcm,\n    measurements: state.measurements,\n    layout: state.layout,\n    fsCurrentDir: state.fsCurrentDir,\n    fsCurrentList: state.fsCurrentList,\n    volume: state.volume,\n    lut: state.lut,\n    //sandboxedFile: state.sandboxedFile,\n  }\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    clearingStore: () => dispatch(clearStore()),\n    setIsOpenStore: (value) => dispatch(dcmIsOpen(value)),\n    toolStore: (tool) => dispatch(dcmTool(tool)),\n    setActiveDcm: (dcm) => dispatch(activeDcm(dcm)),\n    setActiveMeasurements: (measurements) => dispatch(activeMeasurements(measurements)),\n    makeFsRefresh: (dcm) => dispatch(doFsRefresh()),\n    //setLutStore: (lut) => dispatch(setLut(lut)),\n  }\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(DicomViewerForList)\n","import React from 'react'\nimport List from '@material-ui/core/List'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport Typography from '@material-ui/core/Typography'\nimport Icon from '@mdi/react'\nimport IconButton from '@material-ui/core/IconButton'\nimport { SETTINGS_DCMHEADER } from '../constants/settings'\nimport { toCsv } from '../functions'\nimport {\n    mdiContentSaveOutline\n} from '@mdi/js'\n\nconst DicomHeader = ({dcmViewer, classes, color}) => {\n    let header = [];\n    header.push({name: 'Transfer Syntax', value: dcmViewer.getTransferSyntax()});\n    header.push({name: 'SOP Class', value: dcmViewer.getSopClass()});\n    header.push({name: 'SOP Instance UID', value: dcmViewer.getSopInstanceUID()});\n    header.push({name: 'Modality', value: dcmViewer.image.data.string('x00080060')});\n    header.push({name: 'Manufacturer', value: dcmViewer.image.data.string('x00080070')});\n    header.push({name: 'Study Description', value: dcmViewer.image.data.string('x00081030')});\n    header.push({name: 'Series Description', value: dcmViewer.image.data.string('x0008103E')});\n    header.push({name: 'Patient Name', value: dcmViewer.image.data.string('x00100010')});\n    header.push({name: 'Frame Rate', value: dcmViewer.image.data.string('x00082144')});\n\n    header.push({name: 'MR Acquisition Type', value: dcmViewer.image.data.string('x00180023')});\n    header.push({name: 'Slice Thickness', value: dcmViewer.image.data.string('x00180050')});\n    header.push({name: 'Spacing Between Slice', value: dcmViewer.image.data.string('x00180088')});\n    header.push({name: 'Patient Position', value: dcmViewer.image.data.string('x00185100')});\n\n    header.push({name: 'Study ID', value: dcmViewer.image.data.string('x00200010')});\n    header.push({name: 'Series Number', value: dcmViewer.image.data.string('x00200011')});\n    header.push({name: 'Acquisition Number', value: dcmViewer.image.data.string('x00200012')});\n    header.push({name: 'Instance Number', value: dcmViewer.image.data.string('x00200013')});\n    header.push({name: 'Image Position (Patient)', value: dcmViewer.image.data.string('x00200032')});\n    header.push({name: 'Image Orientation (Patient)', value: dcmViewer.image.data.string('x00200037')});\n    header.push({name: 'Images in Acquisition', value: dcmViewer.image.data.string('x00201002')});\n    header.push({name: 'Slice Location', value: dcmViewer.image.data.string('x00201041')});\n\n    header.push({name: 'Samples per Pixel', value: dcmViewer.image.data.uint16('x00280002')});\n    header.push({name: 'Photometric Interpretation', value: dcmViewer.image.data.string('x00280004')});\n    header.push({name: 'Number of Frames', value: dcmViewer.image.data.string('x00280008')});\n    header.push({name: 'Planar Configuration', value: dcmViewer.getPlanarConfiguration()});\n    header.push({name: 'Rows', value: dcmViewer.image.data.uint16('x00280010')});\n    header.push({name: 'Columns', value: dcmViewer.image.data.uint16('x00280011')});\n    header.push({name: 'Pixel Spacing', value: dcmViewer.image.data.string('x00280030')});\n    header.push({name: 'Bits Allocated', value: dcmViewer.image.data.uint16('x00280100')});\n    header.push({name: 'Bits Stored', value: dcmViewer.image.data.uint16('x00280101')});\n    header.push({name: 'High Bit', value: dcmViewer.image.data.uint16('x00280102')});\n    header.push({name: 'Pixel Representation', value: dcmViewer.getPixelRepresentation()});\n    header.push({name: 'Window Center', value: dcmViewer.image.data.string('x00281050')});\n    header.push({name: 'Window Width', value: dcmViewer.image.data.string('x00281051')});\n    header.push({name: 'Rescale Intercept', value: dcmViewer.image.data.string('x00281052')});\n    header.push({name: 'Rescale Slope', value: dcmViewer.image.data.string('x00281053')});\n    header.push({name: 'Min Stored Pixel Value', value: dcmViewer.image.minPixelValue});\n    header.push({name: 'Max Stored Pixel Value', value: dcmViewer.image.maxPixelValue});\n\n    header.push({name: 'Image Orientation', value: dcmViewer.image.data.string('x00700042')});\n    header.push({name: 'Image Horizontal Flip', value: dcmViewer.image.data.string('x00700041')});\n\n    const listItems = header.map((item, index) => {\n        if (item.value !== undefined) \n            return (\n                <ListItem dense={true} key={index}>\n                    <ListItemText primary={item.name} secondary={item.value} />\n                </ListItem>\n            );\n        else return null\n    });\n\n    const saveHeader = () => {\n        let exportAs = localStorage.getItem(SETTINGS_DCMHEADER);\n        if (exportAs === null) {\n          exportAs = \"json\";\n          localStorage.setItem(SETTINGS_DCMHEADER, exportAs)\n        }  \n    \n        let fileData = '';\n        \n        if (exportAs === 'csv') {\n          fileData = toCsv(header)\n        } else {\n          const obj = header.reduce((o, item) => ({ ...o, [item.name]: item.value}), {});\n          fileData = JSON.stringify(obj)\n        }\n        \n        const element = document.createElement(\"a\");\n        const file = new Blob([fileData], {type: 'text/plain'});\n        element.href = URL.createObjectURL(file);\n        element.download = `${dcmViewer.localfile.name}.${exportAs}`;\n        document.body.appendChild(element); // Required for this to work in FireFox\n        element.click()\n    };\n\n    console.log('dcmViewer', dcmViewer);\n\n    return (\n        <div style={{marginTop: '48px'}}>\n        <Toolbar variant=\"dense\">\n          <Typography variant=\"subtitle1\" className={classes.title}>\n            Dicom Header\n          </Typography>\n          <div className={classes.grow} />\n          <IconButton color=\"inherit\" onClick={saveHeader}>\n            <Icon path={mdiContentSaveOutline} size={'1.2rem'} color={color} />\n          </IconButton>\n        </Toolbar>\n        <div>\n            <List dense={true} component=\"div\">\n                {listItems}             \n            </List>\n        </div>      \n      </div>\n\n    )\n};\n  \nexport default DicomHeader\n","import React, { PureComponent } from 'react'\nimport {connect} from 'react-redux'\nimport Button from '@material-ui/core/Button'\nimport CreateIcon from '@material-ui/icons/Create'\nimport DeleteIcon from '@material-ui/icons/Delete'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport IconButton from '@material-ui/core/IconButton'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport TextField from '@material-ui/core/TextField'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport { withStyles } from '@material-ui/core/styles'\n\nconst styles = theme => ({\n    listItemText:{\n        fontSize:'0.9em',\n    }\n})\n\nclass MeasureItem extends PureComponent {\n\n    constructor(props) {\n        super(props)\n        this.noteField = React.createRef()\n    \n      }\n\n    state = { \n        visibleDlgNote: false,\n        visibleDlgDelete: false,\n    }\n\n    showDlgNote = () => {\n        this.setState({ visibleDlgNote: true })\n    }\n    \n    hideDlgNote = () => {\n        this.setState({ visibleDlgNote: false })\n    }\n\n    showDlgDelete = () => {\n        this.setState({ visibleDlgDelete: true })\n    }\n    \n    hideDlgDelete = () => {\n        this.setState({ visibleDlgDelete: false })\n    }\n\n    handleOnChangeNote = event => {\n        this.setState({ note: event.target.value })\n    }\n\n    confirmNote = (index) => {\n        this.hideDlgNote()\n        this.props.measurements[index].note = this.noteField.value\n    }   \n\n    confirmDelete = (index) => {\n        this.hideDlgDelete()\n        this.props.toolRemove(index)\n    }\n\n    onEdit = () => {\n        this.showDlgNote()\n    }\n    \n    onDelete = () => {\n        this.showDlgDelete()\n    }\n    \n    render() {    \n        const { classes } = this.props\n\n        const item = this.props.item\n        let index = this.props.index\n        let pText = ''\n        let sText = ''\n        //console.log('item: ', item)\n        switch (item.tool) {\n            case 'Length':\n                pText = `${item.data.length.toFixed(2)} ${item.data.unit}`\n                sText = item.note\n                break\n            case 'Angle':\n                pText = `${item.data.rAngle} `\n                sText = item.note\n                break\n            case 'EllipticalRoi':\n                pText = <div>\n                            <div> A: {item.data.cachedStats.area.toFixed(2)} mm </div>\n                            <div> M: {item.data.cachedStats.mean.toFixed(2)} {item.data.unit} </div>\n                            <div> SD: {item.data.cachedStats.stdDev.toFixed(2)} {item.data.unit} </div>\n                        </div>\n                sText = item.note            \n                break    \n            case 'RectangleRoi':\n                pText = <div>\n                            <div> A: {item.data.cachedStats.area.toFixed(2)} mm </div>\n                            <div> M: {item.data.cachedStats.mean.toFixed(2)} {item.data.unit} </div>\n                            <div> SD: {item.data.cachedStats.stdDev.toFixed(2)} {item.data.unit} </div>\n                        </div>\n                sText = item.note\n                break          \n            case 'FreehandRoi':\n                //console.log('item: ', item.data.area)\n                //if (item.data.area !== undefined) {\n                pText = <div>\n                            <div> A: {item.data.area.toFixed(2)} mm </div>\n                            <div> M: {item.data.meanStdDev.mean.toFixed(2)} {item.data.unit} </div>\n                            <div> SD: {item.data.meanStdDev.stdDev.toFixed(2)} {item.data.unit} </div>\n                        </div>\n                sText = item.note\n                //}\n                break                                  \n            default:\n                break    \n        }\n\n        return (\n            <div>\n                <ListItem>\n                    <ListItemText classes={{primary:classes.listItemText}} primary={pText} secondary={sText} />\n                    <Toolbar>\n                        <IconButton edge=\"end\" onClick={() => this.onEdit(index)}>\n                            <CreateIcon />\n                        </IconButton>\n                        <IconButton edge=\"end\" onClick={() => this.onDelete(index)}>\n                            <DeleteIcon />\n                        </IconButton>\n                    </Toolbar>\n                </ListItem>\n                \n                { this.state.visibleDlgNote ?\n                    <Dialog\n                        open={this.state.visibleDlgNote}\n                        onClose={this.hideDlgNote}\n                        aria-labelledby=\"form-dialog-title\"\n                    >\n                        <DialogTitle id=\"form-dialog-title\">{\"Note for measurement:\"}</DialogTitle>\n                        <DialogContent>\n                            <TextField\n                                ref=\"noteField\"\n                                autoFocus\n                                margin=\"dense\"\n                                id=\"note\"\n                                fullWidth\n                                defaultValue={this.props.measurements[index].note}\n                                inputRef={input => (this.noteField = input)}\n                            />\n                        </DialogContent>\n                        <DialogActions>\n                            <Button onClick={this.hideDlgNote} >\n                                Cancel\n                            </Button>\n                            <Button onClick={() => this.confirmNote(index)} autoFocus>\n                                Ok\n                            </Button>\n                        </DialogActions>\n                    </Dialog>\n                : null }\n\n                <Dialog\n                    open={this.state.visibleDlgDelete}\n                    onClose={this.hideDlgNote}\n                    aria-labelledby=\"alert-dialog-title\"\n                >\n                    <DialogTitle id=\"alert-dialog-title\">{\"Are you sure to delete the measurement?\"}</DialogTitle>\n                    <DialogActions>\n                        <Button onClick={this.hideDlgDelete}>\n                            Cancel\n                        </Button>\n                        <Button onClick={() => this.confirmDelete(index)} autoFocus>\n                            Ok\n                        </Button>\n                    </DialogActions>\n                </Dialog>\n            </div>\n        )\n    }\n}\n\nconst mapStateToProps = (state) => {\n    return {\n        measurements: state.measurements,\n    }\n}\n\n//export default connect(mapStateToProps, )(MeasureItem)\nexport default connect(mapStateToProps)(withStyles(styles)(MeasureItem))\n","import React, { PureComponent } from 'react'\nimport {connect} from 'react-redux'\nimport Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport MeasureItem from './MeasureItem'\n\nclass Measurements extends PureComponent {\n\n  state = { \n    visibleClearMeasureDlg: false,\n  }\n\n  showClearMeasureDlg = () => {\n    this.setState({ visibleClearMeasureDlg: true })\n  }\n\n  hideClearMeasureDlg = () => {\n      this.setState({ visibleClearMeasureDlg: false })\n  }\n\n  confirmClearMeasureDlg = () => {\n    this.hideClearMeasureDlg()\n    this.dicomViewersRefs[this.props.activeDcmIndex].runTool('removetools')\n  }\n\n  render() {   \n    //const classes = this.props.classes\n\n    return (\n      <div>\n\n        <div>\n          { this.props.measurements !== null ?\n              this.props.measurements.map((item, index) => {\n                  return <MeasureItem item={item} index={index} toolRemove={this.props.toolRemove} key={index} />\n              }) \n            : null }\n        </div>\n        \n        <Dialog\n            open={this.state.visibleClearMeasureDlg}\n            onClose={this.hideClearMeasureDlg}\n            aria-labelledby=\"alert-dialog-title\"\n        >\n            <DialogTitle id=\"alert-dialog-title\">{\"Are you sure to remove all the measurements?\"}</DialogTitle>\n            <DialogActions>\n                <Button onClick={this.hideClearMeasureDlg}>\n                    Cancel\n                </Button>\n                <Button onClick={this.confirmClearMeasureDlg} autoFocus>\n                    Ok\n                </Button>\n            </DialogActions>\n        </Dialog>\n\n      </div>\n    )\n  }\n\n}\n\nconst mapStateToProps = (state) => {\n  return {\n    measurements: state.measurements,\n  }\n}\n\nexport default connect(mapStateToProps)(Measurements)\n","import React from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport AppBar from '@material-ui/core/AppBar'\nimport Checkbox from '@material-ui/core/Checkbox'\nimport CloseIcon from '@material-ui/icons/Close'\nimport Dialog from '@material-ui/core/Dialog'\nimport FormControlLabel from '@material-ui/core/FormControlLabel'\nimport FormControl from '@material-ui/core/FormControl'\nimport FormLabel from '@material-ui/core/FormLabel'\nimport IconButton from '@material-ui/core/IconButton'\nimport Radio from '@material-ui/core/Radio'\nimport RadioGroup from '@material-ui/core/RadioGroup'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport Typography from '@material-ui/core/Typography'\nimport { \n  getSettingsSaveAs, \n  setSettingsSaveAs, \n  getSettingsSaveInto,\n  setSettingsSaveInto,\n  getSettingsDcmHeader, \n  setSettingsDcmHeader, \n  getSettingsOverlay, \n  setSettingsOverlay,\n  getSettingsFsView,\n  setSettingsFsView,\n  getSettingsDicomdirView,\n  setSettingsDicomdirView,\n  getSettingsMprInterpolation,\n  setSettingsMprInterpolation,\n} from '../functions'\n\nconst useStyles = makeStyles(theme => ({\n  appBar: {\n    position: 'relative',\n    backgroundColor:'#3d9c9f'\n  },\n  formControl: {\n    margin: theme.spacing(3),\n  },\n  formLabel: {\n    fontSize: '0.85em',\n  },\n  radioControl: {\n    size: 'small',\n  },  \n  title: {\n    marginLeft: theme.spacing(2),\n    flex: 1,\n    fontSize: '0.95em',\n  },\n}))\n\n/*const Transition = React.forwardRef(function Transition(props, ref) {\n  return <Slide direction=\"right\" ref={ref} {...props} />;\n})*/\n\nconst Settings = ({ onClose }) => {\n  \n  let saveAs = getSettingsSaveAs()\n  let saveInto = getSettingsSaveInto()\n  let exportAs = getSettingsDcmHeader()\n  let overlay = getSettingsOverlay()\n  let fsView = getSettingsFsView()\n  let dicomdirView = getSettingsDicomdirView()\n  let mprInterpolation = getSettingsMprInterpolation()\n\n  //const isIndexedDB = false // 'indexedDB' in window\n  \n  const handleChangeSaveAs = event => {\n    setState({ ...state, 'saveAs': event.target.value })\n    setSettingsSaveAs(event.target.value)\n  }\n  \n  const handleChangeSaveInto = event => {\n    setState({ ...state, 'saveInto': event.target.value })\n    setSettingsSaveInto(event.target.value)\n  }\n\n  const handleChangeExportAs = event => {\n    setState({ ...state, 'exportAs': event.target.value })\n    setSettingsDcmHeader(event.target.value)\n  }\n\n  const handleChangeOverlay = event => {\n    setState({ ...state, 'overlay': event.target.checked })\n    setSettingsOverlay(event.target.checked)\n  }\n\n  const handleChangeFsView = event => {\n    setState({ ...state, 'fsView': event.target.value })\n    setSettingsFsView(event.target.value)\n  }\n\n  const handleChangeDicomdirView = event => {\n    setState({ ...state, 'dicomdirView': event.target.value })\n    setSettingsDicomdirView(event.target.value)\n  }  \n\n  const handleChangeMprInterpolation = event => {\n    setState({ ...state, 'mprInterpolation': event.target.value })\n    setSettingsMprInterpolation(event.target.value)\n  }  \n  const classes = useStyles()\n\n  const [state, setState] = React.useState({\n    saveAs: saveAs,\n    saveInto: saveInto,\n    exportAs: exportAs,\n    overlay: overlay,\n    fsView: fsView,\n    dicomdirView: dicomdirView,\n    mprInterpolation: mprInterpolation,\n  })\n\n  return (\n    <div>\n      <Dialog fullScreen open={true} onClose={onClose}> {/* TransitionComponent={Transition} */}\n        <AppBar className={classes.appBar} elevation={0}>\n          <Toolbar variant=\"dense\">\n            <IconButton edge=\"start\" color=\"inherit\" onClick={onClose} aria-label=\"close\">\n              <CloseIcon />\n            </IconButton>\n            <Typography variant=\"h6\" className={classes.title}>\n              Settings\n            </Typography>\n          </Toolbar>\n        </AppBar>\n        <div>\n          <div>\n          <FormControl component=\"fieldset\" className={classes.formControl}>\n            <FormControlLabel\n              control={\n                <Checkbox \n                  checked={state.overlay} \n                  onChange={handleChangeOverlay}\n                  value=\"overlay\" \n                  size='small'\n                />\n              }\n              label=\"Show overlay Information\"\n            />\n          </FormControl>\n          </div>\n          <div>\n          <FormControl component=\"fieldset\" className={classes.formControl}>\n            <FormLabel component=\"legend\" className={classes.formLabel}>Open sandbox file system from:</FormLabel>\n            <RadioGroup size='small' aria-label=\"filesystem\" name=\"filesystem\" value={state.fsView} onChange={handleChangeFsView}>\n              <FormControlLabel value=\"left\" control={<Radio size='small' />} label=\"left\" />\n              <FormControlLabel value=\"right\" control={<Radio size='small' />} label=\"right\" />\n              <FormControlLabel value=\"bottom\" control={<Radio size='small' />} label=\"bottom\" />\n            </RadioGroup>\n          </FormControl>    \n          </div>\n          <div>\n          <FormControl component=\"fieldset\" className={classes.formControl}>\n            <FormLabel component=\"legend\" className={classes.formLabel}>Open DICOMDIR panel from:</FormLabel>\n            <RadioGroup size='small' aria-label=\"dicomdir\" name=\"dicomdir\" value={state.dicomdirView} onChange={handleChangeDicomdirView}>\n              <FormControlLabel value=\"left\" control={<Radio size='small' />} label=\"left\" />\n              <FormControlLabel value=\"right\" control={<Radio size='small' />} label=\"right\" />\n              <FormControlLabel value=\"bottom\" control={<Radio size='small' />} label=\"bottom\" />\n            </RadioGroup>\n          </FormControl>                    \n          </div>\n          <div>\n          <FormControl component=\"fieldset\" className={classes.formControl}>\n            <FormLabel component=\"legend\" className={classes.formLabel}>Save screenshot as:</FormLabel>\n            <RadioGroup aria-label=\"saveas\" name=\"saveas\" value={state.saveAs} onChange={handleChangeSaveAs}>\n              <FormControlLabel value=\"jpeg\" control={<Radio size='small' />} label=\"JPEG\" />\n              <FormControlLabel value=\"png\" control={<Radio size='small' />} label=\"PNG\" />\n            </RadioGroup>\n          </FormControl>\n          </div>\n          <div>\n          <FormControl component=\"fieldset\" className={classes.formControl}>\n            <FormLabel component=\"legend\" className={classes.formLabel}>Save screenshot into:</FormLabel>\n            <RadioGroup aria-label=\"saveinto\" name=\"saveinto\" value={state.saveInto} onChange={handleChangeSaveInto}>\n              <FormControlLabel value=\"local\" control={<Radio size='small' />} label=\"local file system\" />\n              <FormControlLabel value=\"sandbox\" control={<Radio size='small' />} label=\"sandbox file system\" />\n            </RadioGroup>\n          </FormControl>          \n          </div>\n          <div>\n          <FormControl component=\"fieldset\" className={classes.formControl}>\n            <FormLabel component=\"legend\" className={classes.formLabel}>Export Dicom header as:</FormLabel>\n            <RadioGroup aria-label=\"exportas\" name=\"exportas\" value={exportAs} onChange={handleChangeExportAs}>\n              <FormControlLabel value=\"json\" control={<Radio size='small' />} label=\"JSON\" />\n              <FormControlLabel value=\"csv\" control={<Radio size='small' />} label=\"CSV\" />\n            </RadioGroup>\n          </FormControl> \n          </div> \n          <div>\n          <FormControl component=\"fieldset\" className={classes.formControl}>\n            <FormLabel component=\"legend\" className={classes.formLabel}>MPR interpolation method:</FormLabel>\n            <RadioGroup aria-label=\"mprinterpolation\" name=\"mprinterpolation\" value={mprInterpolation} onChange={handleChangeMprInterpolation}>\n              <FormControlLabel value=\"no\" control={<Radio size='small' />} label=\"No interpolation (duplicate planes)\" />\n              <FormControlLabel value=\"weightedlinear\" control={<Radio size='small' />} label=\"Weighted linear interpolation\" />\n            </RadioGroup>\n          </FormControl> \n          </div>            \n        </div>\n      </Dialog>\n    </div>\n  )\n\n}\n\nexport default Settings\n","import React from 'react'\nimport Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport Link from '@material-ui/core/Link'\nimport List from '@material-ui/core/List'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport Typography from '@material-ui/core/Typography'\nimport packageJson from '../../package.json'\n\nconst AboutDlg = ({ onClose }) => {\n\n    const urlRepository = \"https://github.com/webnamics/u-dicom-viewer/\"\n\n    const linkRepository = (\n        <Typography variant='body2'>\n            <Link\n                href={urlRepository}\n                target='_blank'\n                style={{ color: '#999999' }}\n            >\n                https://github.com/mmollaahmadi/dicom-viewer\n            </Link>\n        </Typography>\n    )\n\n    const version = (\n        <Typography variant='body2' style={{ color: '#999999' }}>\n            {packageJson.version}\n        </Typography>\n    )\n\n    return (\n      <div>\n        <Dialog onClose={onClose} open={true}>\n            <DialogTitle onClose={onClose} disableTypography={true}>\n                <Typography variant='h6'>\n                    About <strong>U</strong>niversal <strong>D</strong>icom <strong>V</strong>iewer\n                </Typography>\n            </DialogTitle>\n            <DialogContent>\n                <List>\n                    <ListItem>\n                        <ListItemText\n                            primary='Repository URL:'\n                            secondary={linkRepository}\n                        />\n                    </ListItem>\n                    <ListItem>\n                        <ListItemText\n                            primary='Version:'\n                            secondary={version}\n                        />\n                    </ListItem>\n                </List>\n            </DialogContent>\n            <DialogActions>\n                <Button autoFocus onClick={onClose}>\n                    Close\n                </Button>\n            </DialogActions>\n        </Dialog>\n      </div>\n    )\n}\n\nexport default AboutDlg\n","import React, { PureComponent } from 'react'\n//import Draggable from 'react-draggable'\n//import IconButton from '@material-ui/core/IconButton'\nimport Slider from '@material-ui/core/Slider'\n//import HighlightOffIcon from '@material-ui/icons/HighlightOff'\nimport {connect} from 'react-redux'\n//import * as cornerstone from 'cornerstone-core'\n// import { import as csTools } from 'cornerstone-tools'\n\n// const getRGBPixels = csTools('util/getRGBPixels')\n\nconst HIST_WIDTH = 256\nconst HIST_HEIGHT = 128\nconst N_BINS = 256\n\nconst style = {\n  width: '273px',\n  padding: '8px 8px 8px 8px',\n  backgroundColor: '#444444',\n}\n\nconst styleSlider = {\n  width: '255px',\n  marginTop: '-9px',\n}\n\nconst styleCanvasGradient = {\n  marginTop: '-9px',\n}\n\nconst styleTable = {\n  borderCollapse: 'collapse',\n  fontFamily: 'Courier, monospace',\n  fontSize: '67%',\n  width: '100%',\n}\n\nconst styleTableTd = {\n  tableLayout: 'fixed',\n  width: '25%',\n}\n\nclass Histogram extends PureComponent {\n    constructor(props) {\n      super(props)\n      this.canvasHistogram = React.createRef()\n      this.canvasGradient = React.createRef()\n    }\n\n    state = {\n      activeDrags: 0,\n      deltaPosition: {\n        x: 0, y: 0\n      },\n      controlledPosition: {\n        x: -400, y: 200\n      },\n      value: 128,\n      histCount: 0,\n      valueScale: 0,\n      minHist: 0,\n      maxHist: 0,\n      mean: 0,\n      stdDev: 0,\n    }\n\n    componentDidMount() {\n      //console.log('Histogram - componentDidMount: ')\n      //this.image = this.props.activeDcm.image\n      //this.element = this.props.activeDcm.element\n      //this.isDicom = this.props.activeDcm.isDicom\n      //this.pixelData = this.props.activeDcm.image.getPixelData()\n      const canvasH = this.canvasHistogram.current\n      const ctxH = this.canvasHistogram.current.getContext(\"2d\")\n      ctxH.translate(0, canvasH.height)\n      ctxH.scale(1, -1)\n\n      if (this.props.activeDcm.image)\n        this.updateCanvas()\n    }\n\n    componentDidUpdate() {\n      //console.log('Histogram - componentDidUpdate: ')\n      if (this.props.activeDcm === null) {\n        const ctxH = this.canvasHistogram.current.getContext(\"2d\")\n        ctxH.clearRect(0, 0, ctxH.canvas.width, ctxH.canvas.height)\n        return\n      }\n      this.updateCanvas()\n    }\n\n    getMousePos(canvas, evt) {\n      const rect = canvas.getBoundingClientRect()\n      return {\n        x: evt.clientX - rect.left,\n        y: evt.clientY - rect.top\n      }\n    }\n\n    getRGBPixelsImage(x, y, width, height) {\n      const pixelData = this.props.activeDcm.image.getPixelData()\n      const storedPixelData = []\n      x = Math.round(x)\n      y = Math.round(y)\n      let index = 0\n      let spIndex, row, column\n\n      for (row = 0; row < height; row++) {\n        for (column = 0; column < width; column++) {\n          spIndex = ((row + y) * this.props.activeDcm.image.rows + (column + x)) * 4\n          const red = pixelData[spIndex]\n          const green = pixelData[spIndex + 1]\n          const blue = pixelData[spIndex + 2]\n          const alpha = pixelData[spIndex + 3]\n\n          storedPixelData[index++] = red\n          storedPixelData[index++] = green\n          storedPixelData[index++] = blue\n          storedPixelData[index++] = alpha\n        }\n      }\n      return storedPixelData\n    }\n\n    getPixelsImage(x, y, width, height) {\n      const pixelData = this.props.activeDcm.image.getPixelData()\n      const storedPixelData = []\n      x = Math.round(x)\n      y = Math.round(y)\n      let index = 0\n      let spIndex, row, column\n\n      for (row = 0; row < height; row++) {\n        for (column = 0; column < width; column++) {\n          spIndex = ((row + y) * this.props.activeDcm.image.rows + (column + x))\n          storedPixelData[index++] = pixelData[spIndex]\n        }\n      }\n      return storedPixelData\n    }\n\n    getPixel(x, y) {\n      let sp = []\n      if (this.props.activeDcm.isDicom) {\n        if (this.props.activeDcm.image.color) {\n          //sp = getRGBPixels(this.element, x, y, 1, 1)\n          //sp = cornerstone.getStoredPixels(this.element, x, y, 1, 1)\n          sp = this.getRGBPixelsImage(x, y, 1, 1)\n        } else {\n          // sp = cornerstone.getStoredPixels(this.props.activeDcm.element, x, y, 1, 1)\n          sp = this.getPixelsImage(x, y, 1, 1)\n        }\n      } else {\n        sp = this.getRGBPixelsImage(x, y, 1, 1)\n      }\n      return sp[0]\n    }\n\n    updateCanvas() {\n      const image = this.props.activeDcm.image\n      //const element = this.props.element\n      const maxPixelValue = image.maxPixelValue\n      const minPixelValue = image.minPixelValue\n      //const k = Math.pow(2, this.props.bitsStored)\n      const minHist = minPixelValue+image.intercept\n      const maxHist = maxPixelValue+image.intercept\n      const lenHist = maxHist-minHist+1\n      const binSize = lenHist / N_BINS\n      let zero256 = Math.floor(Math.abs(minHist) / binSize)\n      let stepWW = Math.round(image.windowWidth / binSize / 2)\n      let stepWC = Math.round(image.windowCenter / binSize)\n\n      this.setState({minHist: minHist})\n      this.setState({maxHist: maxHist})\n      this.binSize = binSize\n\n      //console.log('activeDcm: ', this.props.activeDcm)\n      //console.log('image: ', )\n      //console.log('getPixelData: ', image.getPixelData())\n      //console.log('columns: ', image.columns)\n      //console.log('rows: ', image.rows)\n      //console.log('isDicom: ', this.props.activeDcm.isDicom)\n      //console.log('bitsStored: ', k)\n      //console.log('minHist: ', minHist)\n      //console.log('maxHist: ', maxHist)\n      //console.log('lenHist: ', lenHist)\n      //console.log('binSize: ', binSize)\n      //console.log('zeroHist: ', zero256)\n      //console.log('stepWW: ', stepWW)\n      //console.log('stepWC: ', stepWC)\n      //console.log('zero256-stepWW: ', zero256-stepWW)\n      //console.log('zero256+stepWW: ', zero256+stepWW)\n      //console.log('image.color: ', image.color)\n      //console.log('image.slope: ', image.slope)\n      //console.log('image.intercept: ', image.intercept)\n\n      let m = 0 // the mean\n      // build histogram\n      let hist = Array(lenHist).fill(0)\n      for (let y = 0; y < image.columns; y++) {\n        for (let x = 0; x < image.rows; x++) {\n          let sp = this.getPixel(x, y)\n          let mo = sp * image.slope + image.intercept\n          hist[mo-minHist] += 1\n          m += mo\n        }\n      }\n\n      m = m / (image.columns * image.rows)\n      this.setState({mean: m})\n\n      //console.log('hist: ', hist)\n      //console.log('mean: ', m)\n\n      // calculate standard deviation\n      let s = 0\n      for (let y = 0; y < image.columns; y++)\n        for (let x = 0; x < image.rows; x++) {\n          let sp = this.getPixel(x, y)\n          let mo = sp * image.slope + image.intercept\n          s += Math.pow(mo-m, 2)\n        }\n      s = Math.sqrt(s / (image.columns * image.rows))\n      this.setState({stdDev: s})\n\n      // binning the histogram\n      let hist256 = Array(N_BINS).fill(0)\n      let max = 0\n\n      if (binSize < 1) {\n        let binStep = Math.round(N_BINS / lenHist)\n        let iHist = 0\n        let i = 0\n        while (i < N_BINS) {\n          for (let j=0; j < binStep; j++) {\n            hist256[i] = iHist < lenHist ? hist[iHist] : 0\n            if (max < hist256[i]) max = hist256[i]\n            i++\n          }\n          iHist++\n        }\n\n        /*for (let i=0; i < N_BINS; i+=binStep) {\n          const k = Math.floor(i)\n          //console.log(`i: ${k} `)\n          for (let j=0; j < Math.round(binStep); j++) {\n            console.log(`i: ${k} - j: ${j} - iHist: ${iHist} - hist[iHist]: ${hist[iHist]}`)\n            hist256[k+j] = hist[iHist]\n          }\n          iHist++\n          if (max < hist256[k]) max = hist256[k]\n        }*/\n      } else {\n        let step = 0\n        for (let i=0; i < N_BINS; i++) {\n          for (let j=step; j < Math.round(step+binSize); j++) {\n            if (j >= lenHist) break\n            hist256[i] += hist[j]\n          }\n          if (max < hist256[i]) { max = hist256[i] }\n          step = Math.round(step+binSize)\n        }\n      }\n\n      this.hist256 = hist256\n\n      //console.log('hist256: ', hist256)\n      //console.log('max: ', max)\n\n      if (max / HIST_HEIGHT > 100) max = max / 5\n\n      const canvasH = this.canvasHistogram.current\n      const ctxH = this.canvasHistogram.current.getContext(\"2d\")\n      ctxH.clearRect(0, 0, ctxH.canvas.width, ctxH.canvas.height)\n\n      canvasH.addEventListener('pointermove', (evt) => {\n        const mousePos = this.getMousePos(canvasH, evt)\n        this.setState({histCount: hist256[mousePos.x]})\n        let p = Math.round(mousePos.x * this.binSize)\n        this.setState({valueScale: p+minHist})\n      }, true)\n\n      //console.log('value: ', (m-minHist)/binSize)\n      let value = Math.round((m-minHist)/binSize)\n      this.setState({value: value})\n      this.setState({valueScale: m})\n      this.setState({histCount: hist256[value]})\n\n      // draw WindowWidth area\n      ctxH.beginPath()\n      ctxH.fillStyle = 'rgba(210, 210, 210, 0.5)'\n      ctxH.fillRect(zero256-stepWW+stepWC, 0, stepWW*2, HIST_HEIGHT)\n\n      // draw histogram\n      ctxH.beginPath()\n      ctxH.strokeStyle = 'rgba(0, 0, 0, 1.0)'\n      for (let i = 0; i < N_BINS; i++) {\n        let h = Math.round((hist256[i]/max)*HIST_HEIGHT)\n        ctxH.moveTo(i, 0)\n        ctxH.lineTo(i, h)\n        ctxH.stroke()\n      }\n\n      // draw WindowCenter cursor\n      ctxH.beginPath()\n      ctxH.strokeStyle = 'rgba(140, 140, 140, 0.5)'\n      ctxH.moveTo(zero256+stepWC, 0)\n      ctxH.lineTo(zero256+stepWC, HIST_HEIGHT)\n      ctxH.lineWidth = 1\n      ctxH.stroke()\n\n      let lowX = zero256-stepWW+stepWC\n      let highX = zero256+stepWW+stepWC\n\n      // draw gradient scale\n      const canvasG = this.canvasGradient.current\n      const ctxG = canvasG.getContext(\"2d\")\n\n      ctxG.fillStyle = \"#000000\"\n      ctxG.fillRect(0, 0, lowX, 10)\n\n      let grd = ctxG.createLinearGradient(lowX, 0, highX+(lowX < 0 ? lowX : 0), 0)\n      grd.addColorStop(0, \"black\")\n      grd.addColorStop(1, \"white\")\n      ctxG.fillStyle = grd\n      ctxG.fillRect(lowX, 0, highX, 10)\n    }\n\n    handleChangeValue = (event, newValue) => {\n      //console.log('newValue: ', newValue)\n      //console.log('(newValue*this.binSize)+this.state.minHist: ', (newValue*this.binSize)+this.state.minHist)\n      //console.log('this.hist256[newValue]: ', this.hist256[newValue])\n      this.setState({value: newValue})\n      this.setState({valueScale: (newValue*this.binSize)+this.state.minHist})\n      this.setState({histCount: this.hist256[newValue]})\n    }\n\n    hide = () => {\n      this.props.onClose()\n    }\n\n    onDrag = (e, ui) => {\n      const {x, y} = this.state.deltaPosition;\n      this.setState({\n        deltaPosition: {\n          x: x + ui.deltaX,\n          y: y + ui.deltaY,\n        }\n      })\n    }\n\n    onStart = () => {\n      this.setState({activeDrags: this.state.activeDrags+1})\n    }\n\n    onStop = () => {\n      this.setState({activeDrags: this.state.activeDrags-1})\n    }\n\n    render() {\n      return (\n        <div style={style}>\n          <div>\n            <canvas\n              ref={this.canvasHistogram}\n              width={HIST_WIDTH}\n              height={HIST_HEIGHT}\n              style={{backgroundColor: \"#FFFFFF\", cursor:'crosshair'}}\n            />\n          </div>\n          <div style={styleCanvasGradient}>\n            <canvas ref={this.canvasGradient} width={HIST_WIDTH} height={10} style={{backgroundColor: \"#FFFFFF\"}} />\n          </div>\n          <div style={styleSlider}>\n            <Slider\n              value={this.state.value}\n              onChange={this.handleChangeValue}\n              aria-labelledby=\"continuous-slider\"\n              color=\"secondary\"\n              min={0}\n              max={255}\n            />\n          </div>\n          <div>\n            <table style={styleTable}>\n              <tbody>\n                <tr>\n                  <td style={styleTableTd}>min:</td>\n                  <td style={styleTableTd}>{this.state.minHist}</td>\n                  <td style={styleTableTd}>max:</td>\n                  <td style={styleTableTd}>{this.state.maxHist}</td>\n                </tr>\n                <tr>\n                  <td>mean:</td>\n                  <td>{parseFloat(this.state.mean).toFixed(3)}</td>\n                  <td>std dev:</td>\n                  <td>{parseFloat(this.state.stdDev).toFixed(3)}</td>\n                </tr>\n                <tr>\n                  <td>count:</td>\n                  <td>{this.state.histCount}</td>\n                  <td>value:</td>\n                  <td>{parseFloat(this.state.valueScale).toFixed(3)}</td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n      </div>\n      )\n  }\n}\n\nconst mapStateToProps = (state) => {\n  return {\n    activeDcmIndex: state.activeDcmIndex,\n    activeDcm: state.activeDcm,\n  }\n}\n\nexport default connect(mapStateToProps)(Histogram)\n","import React, { PureComponent } from 'react'\n\nconst styleTable = {\n  borderCollapse: 'collapse',\n  width: '100px',\n  height: '100px',\n};\n\nconst styleTableTd = {\n  width: '25px',\n  height: '25px',\n  border: 'solid 1px #3d9c9f',\n};\n\nclass LayoutTool extends PureComponent {\n    constructor(props) {\n      super(props);\n      this.tableRef = React.createRef();\n      this.state = {\n        row: this.props.row,\n        col: this.props.col,\n      }\n    }\n\n    componentDidMount() {\n      this.initTable()\n    }\n\n    initTable = () => {\n      let row = this.state.row;\n      let col = this.state.col;\n      let rows = this.tableRef.current.rows;\n      for (let i=0; i <= row; i++) {\n        for(let j=0; j <= col; j++) {\n          rows[i].cells[j].bgColor = '#f8f8f8'\n        }\n      }\n    };\n\n    cellClick = (e) => {\n      let row = e.target.parentNode.rowIndex;\n      let col = e.target.cellIndex;\n\n      this.setState({row: row, col: col});\n\n      let rows = this.tableRef.current.rows;\n      for (let i=0; i <= 3; i++) {\n        for(let j=0; j <= 3; j++) {\n          rows[i].cells[j].bgColor = '#70c4c5'\n        }\n      }\n      for (let i=0; i <= row; i++) {\n        for(let j=0; j <= col; j++) {\n          rows[i].cells[j].bgColor = '#f8f8f8'\n        }\n      }\n      this.props.onChange(row+1, col+1)\n    };\n\n    renderTable() {\n      const rows = ['', '', '', ''];\n      return (\n        rows.map((row, i) => {\n          return (\n            <tr key={`${i}`}>\n               <td style={styleTableTd} onClick={this.cellClick} />\n               <td style={styleTableTd} onClick={this.cellClick} />\n               <td style={styleTableTd} onClick={this.cellClick} />\n               <td style={styleTableTd} onClick={this.cellClick} />\n            </tr>\n          )\n        })\n      )\n   }\n\n    render() {  \n      return (\n          <div>            \n            <table style={styleTable} ref={this.tableRef}>\n              <tbody>\n                {this.renderTable()}                   \n              </tbody>\n            </table>\n          </div>     \n      )\n    }\n\n}\n\nexport default LayoutTool\n","import React, { PureComponent } from 'react'\nimport {connect} from 'react-redux'\nimport Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport LinearProgress from '@material-ui/core/LinearProgress'\nimport * as cornerstone from \"cornerstone-core\"\nimport * as cornerstoneWADOImageLoader from \"cornerstone-wado-image-loader\"\nimport {\n  filesStore,\n} from '../actions'\nimport { \n  getFileNameCorrect,\n} from '../functions'\n\ncornerstoneWADOImageLoader.external.cornerstone = cornerstone\n\nclass OpenMultipleFilesDlg extends PureComponent {\n  constructor(props) {\n    super(props)\n    this.items = []\n    this.count = 0\n    this.step = 0\n    //this.slicesDistance = []\n  }\n\n  state = {\n    progress: 0,\n    cancel: false,\n  }  \n\n  componentDidMount() {\n    this.step = this.props.files.length / 50\n    this.nextProgress = this.step\n    this.t0 = performance.now()\n\n    for (let i=0; i<this.props.files.length; i++) {\n      const file = this.props.files[i]\n      if (this.state.cancel) {\n        this.props.setFilesStore(null)\n        this.close()\n        return\n      }\n      let imageId = null \n      \n      if (this.props.origin === 'local')\n        imageId = cornerstoneWADOImageLoader.wadouri.fileManager.add(file)\n      else // it's fs item\n        imageId = cornerstoneWADOImageLoader.wadouri.fileManager.addBuffer(file.data)  \n\n      cornerstone.loadImage(imageId).then((image) => {\n        //console.log('image: ', image)\n        //try {\n          const instanceNumber = this.getInstanceNumber(image)\n          const sliceDistance = this.getSliceDistance(image)\n          const sliceLocation = this.getSliceLocation(image)         \n\n          //this.slicesDistance.push(sliceDistance)\n          //console.log('sliceDistance: ', sliceDistance)\n  \n          let item = null\n          if (this.props.origin === 'local')\n            item = {\n              imageId: imageId, \n              instanceNumber: instanceNumber, \n              name: getFileNameCorrect(file.name), \n              image: image, \n              rows: this.getRows(image), \n              columns: this.getColumns(image), \n              sliceDistance: sliceDistance,\n              sliceLocation: sliceLocation,\n            }\n          else\n            item = {\n              imageId: imageId, \n              instanceNumber: instanceNumber, \n              name: file.name, \n              image: image, \n              rows: this.getRows(image), \n              columns: this.getColumns(image), \n              sliceDistance: sliceDistance,\n              sliceLocation: sliceLocation,            \n            }\n          this.items.push(item)\n          this.count++\n        //} catch(error) {\n        //  console.log('Error in reading multiple files: ', file)\n        //}\n        //console.log('this.count: ', this.count)\n        const progress = Math.floor(this.count*(100/this.props.files.length))\n        //\n        if (progress > this.nextProgress) {\n          this.nextProgress += this.step\n          this.setState({progress: progress})\n        }\n        if (this.count === this.props.files.length) {\n          this.items.sort((l, r) => {\n            return l.instanceNumber - r.instanceNumber\n            // return l.sliceDistance - r.sliceDistance\n            //return l.sliceLocation - r.sliceLocation\n          })\n          this.t1 = performance.now()\n          console.log(`performance load image: ${this.t1-this.t0} milliseconds`)\n          this.props.setFilesStore(this.items)\n          this.close()\n        }\n\t\t\t}, (e) => {\n        console.log('Error in reading multiple files: ', e)\n        this.count++\n      })\n      if (this.count === this.props.files.length) {\n        this.close()\n      }   \n    }\n\n  }\n  \n  getInstanceNumber = (image) => {\n\t\tconst value = image.data.string('x00200013')\n\t\tif (value === undefined) {\n\t\t\treturn\n\t\t}\n\t\treturn value\n  }\t\n\n  getSliceLocation = (image) => {\n\t\tconst value = image.data.string('x00201041')\n\t\tif (value === undefined) {\n\t\t\treturn\n\t\t}\n\t\treturn parseFloat(value)\n  }\t\n\n  getRows = (image) => {\n    const value = image.data.uint16('x00280010')\n\t\tif (value === undefined) {\n\t\t\treturn\n\t\t}\n\t\treturn value    \n  }\n\n  getColumns = (image) => {\n    const value = image.data.uint16('x00280011')\n\t\tif (value === undefined) {\n\t\t\treturn\n\t\t}\n\t\treturn value    \n  }  \n\n  // see https://stackoverflow.com/questions/37730772/get-distance-between-slices-in-dicom\n  //\n  getSliceDistance = (image) => {\n    try {\n      const ipp = image.data.string('x00200032').split('\\\\') // Image Position Patient\n      //console.log(\"imagePosition: \", ipp)\n      let topLeftCorner = new Array(3).fill(0)\n      topLeftCorner[0] = parseFloat(ipp[0]) // X pos of frame (Top left) in real space\n      topLeftCorner[1] = parseFloat(ipp[1]) // Y pos of frame (Top left) in real space\n      topLeftCorner[2] = parseFloat(ipp[2]) // Z pos of frame (Top left) in real space\n      //console.log(\"topLeftCorner: \", topLeftCorner)\n\n      const iop = image.data.string('x00200037').split('\\\\') // Image Orientation Patient\n      //console.log(\"values: \", iop)\n      let v = new Array(3).fill(0).map(() => new Array(3).fill(0))\n\n      v[0][0] = parseFloat(iop[0]) // the x direction cosines of the first row X\n      v[0][1] = parseFloat(iop[1]) // the y direction cosines of the first row X\n      v[0][2] = parseFloat(iop[2]) // the z direction cosines of the first row X\n      v[1][0] = parseFloat(iop[3]) // the x direction cosines of the first column Y\n      v[1][1] = parseFloat(iop[4]) // the y direction cosines of the first column Y\n      v[1][2] = parseFloat(iop[5]) // the z direction cosines of the first column Y \n\n      //console.log(\"v: \", v)\n\n      // calculate the slice normal from IOP\n      v[2][0] = v[0][1] * v[1][2] - v[0][2] * v[1][1]\n      v[2][1] = v[0][2] * v[1][0] - v[0][0] * v[1][2]\n      v[2][2] = v[0][0] * v[1][1] - v[0][1] * v[1][0]\n      \n      let dist = 0\n      for (let i = 0; i < 3; ++i) \n        dist += v[2][i] * topLeftCorner[i]\n        \n      return dist\n    } catch(error) {\n      return 0\n    }\n  }\n\n  \n  close = () => {\n    //console.log('this.slicesDistance: ', this.slicesDistance)\n    this.props.onClose()\n  }\n\n  cancel = () => {\n    this.setState({cancel: true}) \n  }\n\n  render() {\n    return (\n      <div>\n        <Dialog\n            open={true}\n            onClose={this.close}\n            aria-labelledby=\"alert-dialog-title\"\n        >\n            <DialogTitle id=\"alert-dialog-title\">{\"Opening multiple files ...\"}</DialogTitle>\n            <DialogContent>\n              <LinearProgress variant=\"determinate\" value={this.state.progress} color='secondary' />\n            </DialogContent>\n            <DialogActions>\n                <Button onClick={this.cancel}>\n                    Cancel\n                </Button>\n            </DialogActions>\n        </Dialog>\n      </div>\n    )\n  }\n}\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n      setFilesStore: (files) => dispatch(filesStore(files)),\n  }\n}\n\nexport default connect(null, mapDispatchToProps)(OpenMultipleFilesDlg)\n","import React, { PureComponent } from 'react'\nimport {connect} from 'react-redux'\nimport { withStyles } from '@material-ui/core/styles'\nimport Button from '@material-ui/core/Button'\nimport CircularProgress from '@material-ui/core/CircularProgress'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogContentText from '@material-ui/core/DialogContentText'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport Icon from '@mdi/react'\nimport IconButton from '@material-ui/core/IconButton'\nimport InputBase from '@material-ui/core/InputBase'\nimport LinearProgress from '@material-ui/core/LinearProgress'\nimport Paper from '@material-ui/core/Paper'\nimport Table from '@material-ui/core/Table'\nimport TableBody from '@material-ui/core/TableBody'\nimport TableCell from '@material-ui/core/TableCell'\nimport TableContainer from '@material-ui/core/TableContainer'\nimport TableHead from '@material-ui/core/TableHead'\nimport TableRow from '@material-ui/core/TableRow'\nimport TextField from '@material-ui/core/TextField'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport Tooltip from '@material-ui/core/Tooltip'\nimport Typography from '@material-ui/core/Typography'\n// import {List as ListVirtual} from 'react-virtualized'\nimport JSZip from 'jszip'\nimport { saveAs } from 'file-saver'\nimport fs from '../fs/fs'\nimport OpenMultipleFilesDlg from './OpenMultipleFilesDlg'\nimport {\n    getFileExt,\n    getFileExtReal,\n    getFileName,\n    formatBytes,\n    getSettingsFsView,\n    getFileNameCorrect,\n} from '../functions'\nimport {\n    //setFsCurrentId,\n    setFsCurrentDir,\n    setFsCurrentList,\n    setZippedFile,\n    fsFileStore,\n} from '../actions'\nimport {\n    mdiCheck,\n    mdiChevronLeft,\n    mdiClose,\n    mdiContentCopy,\n    mdiContentCut,\n    mdiContentPaste,\n    mdiContentSaveOutline,\n    mdiDeleteOutline,\n    mdiDotsHorizontal,\n    mdiExportVariant, \n    mdiFolderOutline,   \n    mdiFolderPlusOutline,\n    mdiCheckBoxOutline,\n    mdiSquareEditOutline,\n} from '@mdi/js'\n\nconst styles = theme => ({\n    table: {\n        minWidth: 250,\n    },\n    toolbarButtons: {\n        marginLeft: 'auto',\n        marginRight: -20,\n    },\n    leftButtons: {\n        marginLeft: -25,\n    },\n    textPaper: {\n        padding: '2px 4px',\n        display: 'flex',\n        alignItems: 'center',\n        width: 250,\n    },\n    textInput: {\n        marginLeft: theme.spacing(1),\n        flex: 1,\n    },\n    textButton: {\n        padding: 10,\n    },\n})\n\nclass FsUI extends PureComponent {\n    constructor(props) {\n        super(props)\n        this.files = []\n        this.cut = false\n        this.itemsCount = 0\n        this.saveAsField = React.createRef()\n      }\n\n    state = {\n        textFieldLabel: '',\n        textFieldValue: '',\n        selected: [],\n        selectedCopy: [],\n        visibleTextField: false,\n        visibleDeleteDlg: false,\n        visibleOthers: false,\n        visibleAlreadyExistDlg: false,\n        visibleOSaveAsDlg: false,\n        visibleWaiting: false,\n        visibleOpenMultipleFilesDlg: false,\n    }\n\n    componentDidMount() {\n        this.fsListDir(this.props.fsCurrentDir)\n    }\n\n    componentDidUpdate(previousProps) {\n        //console.log('componentDidUpdate: ', this.props)\n        if (this.props.fsZippedFile !== null) {\n            const zip = new JSZip()\n            zip.loadAsync(this.props.fsZippedFile).then((contents) => {\n                //console.log('zip file contents: ', contents)\n                contents.forEach((relativePath, zipEntry) => {\n                    //console.log('zipEntry: ', zipEntry)\n                    if (zipEntry.dir) { \n                        //console.log('dir relativePath: ', relativePath)\n                    } else {                  \n                        //console.log('file relativePath: ', relativePath)\n                        zip.file(relativePath).async('uint8array').then((content) => {\n                            this.fsAddItem(relativePath, content)\n                        })\n                    }\n                })\n            }).then(() => {\n                this.props.setFsZippedFile(null)\n                //this.fsListDir(this.props.fsCurrentDir)\n            })\n        } else {\n            this.fsListDir(this.props.fsCurrentDir)\n        }\n    }\n\n    fsBuildParent(parent, name) {\n        let newParent = ''\n        if (parent === '') {\n            if (name !== '') \n                newParent = name\n        } else {\n            if (name !== '') \n                newParent = `${parent}/${name}` \n            else\n                newParent = parent\n        }\n        return newParent\n    }\n\n    fsAddItem(filename, data) {\n        //console.log('fsAddItem filename: ', filename)\n        //console.log('fsAddItem data: ', data)\n        let components = filename.split('/')\n        const name = components.pop()\n        const parent = this.fsBuildParent(this.props.fsCurrentDir, components.join('/'))\n        //console.log(`add file, parent: ${parent}, name: ${name}`)\n        fs.transaction('rw', fs.files, async () => {\n            await fs.files.add({\n                parent: parent,\n                name: name,\n                type: getFileExt(name),\n                size: data.length,\n                data: data\n            })             \n        }).then(() => {\n            // store subdirectory\n            while (components.length > 0) {\n                const name = components.pop()\n                const parent = this.fsBuildParent(this.props.fsCurrentDir, components.join('/'))\n                //console.log(`put dir, parent: ${parent}, name: ${name}`)\n                fs.transaction('rw', fs.files, async () => {\n                    await fs.files.put({\n                        parent: parent,\n                        name: name,\n                        type: 'dir',\n                        size: '' \n                    }) \n                }).then(() => {\n                    this.fsListDir(this.props.fsCurrentDir)\n                })\n            }            \n        })\n    }\n\n    fsExistDir(dir, create = true) {\n        const item = this.props.fsCurrentList.find(e => e.name === dir)\n        if (item !== undefined) {\n            if (create) {\n                this.fsCreateDir(this.props.fsCurrentDir, dir)\n                return true\n            } else return false\n        } else return false\n    }\n\n    fsListDir(dir) {\n        //console.log('fsListDir: ', dir)\n        let listItems = []\n        fs.transaction('r', fs.files, async ()=> {\n            await fs.files.where({parent: dir, type: 'dir'}).sortBy('name').then((list) => { // first list all dirs\n                listItems = list\n            }).then(() => { // after list all files\n                fs.files.where({parent: dir}).and(item => item.type !== 'dir').sortBy('name').then((list) => {\n                    listItems = listItems.concat(list)\n                }).then(() => {\n                    this.props.setCurrentList(listItems)\n                    setTimeout(() => this.setState({visibleWaiting: false}), 2000)\n                })\n            })\n        })\n    }\n\n    fsCreateDir(parent, name) {\n        fs.files.add({parent: parent, name: name, type: 'dir', size: ''}).then(() => { \n            this.fsListDir(this.props.fsCurrentDir)\n        })\n    }\n\n    doSelectUnselect = () => {\n        let newSelected = []\n        if (this.state.selected.length > 0) { // unselect the files\n            this.setState({selected: newSelected})            \n        } else { // select only files not dir\n            this.props.fsCurrentList.forEach((item) => {\n                if (item.type !== 'dir') {\n                    newSelected.push(item.name)\n                }\n                this.setState({selected: newSelected}, () => {\n                    //console.log('this.state.selected: ', this.state.selected)\n                })\n                \n            })\n        }\n    }\n\n    openSelectedFilesRetrieveItems = async () => {\n        await fs.transaction('r', fs.files, async () => {\n            this.state.selected.forEach( async (name, index) => {\n                await fs.files.where({parent: this.props.fsCurrentDir, name: name}).first((item) => {\n                    console.log('item: ', item)\n                    if (item !== undefined && item.type !== 'dir') {\n                        this.files.push(item)\n                    } else if (item.type === 'dir') {\n                        fs.files.where('parent').startsWithIgnoreCase(item.name).each((e) => {\n                            if (e !== undefined && e.type !== 'dir') {\n                                console.log(' e: ', e) \n                                this.files.push(e)\n                            }\n                        })\n                    }\n                })\n             })\n        })\n    }\n\n    openSelectedFiles = () => {\n        if (this.state.selected.length === 0) return\n        this.files = []\n        this.openSelectedFilesRetrieveItems().then(() => {\n            console.log('this.files: ', this.files) \n            this.setState({visibleOpenMultipleFilesDlg: true})\n            this.setState({selected: []})  \n        })\n    }\n\n    hideOpenMultipleFilesDlg = () => {\n        this.setState({ visibleOpenMultipleFilesDlg: false })\n        if (this.props.files.length > 1) {\n            this.props.onOpenMultipleFilesCompleted()\n        } else this.props.onOpenImage(0)\n    }\n\n    createDir = () => {\n        this.setState({textFieldLabel: 'new folder name', visibleTextField: !this.state.visibleTextField})\n    }\n\n    renameItem = () => {\n        this.lastSelected = this.state.selected[this.state.selected.length-1]\n        this.setState({textFieldLabel: '', textFieldValue: this.lastSelected, visibleTextField: !this.state.visibleTextField})\n    }\n\n    previousDir = () => {\n        //console.log('this.state.parentDir: ', this.state.parentDir)\n        if (this.props.fsCurrentDir === '') return\n        const nextDir = this.props.fsCurrentDir.split('/').slice(0, -1).join('/')\n        this.props.setCurrentDir(nextDir)\n        this.fsListDir(nextDir)\n    }\n\n    confirmText = (e) => {\n        if (this.state.textFieldLabel === '') { // it's a rename\n            // check if the new name already exist\n            const check = this.props.fsCurrentList.find(e => e.name === this.state.textFieldValue)\n            if (check !== undefined) {\n                this.setState({visibleAlreadyExistDlg: true})\n                return\n            }\n            const item = this.props.fsCurrentList.find(e => e.name === this.lastSelected)\n            if (item !== undefined) {\n                if (item.type === 'dir') {\n                    const oldParent = this.fsBuildParent(item.parent, item.name)\n                    const newParent = this.fsBuildParent(item.parent, this.state.textFieldValue)\n                    // rename parent for all subitems\n                    fs.transaction('rw', fs.files, async () => {\n                        await fs.files.where({parent: oldParent}).each((e) => {\n                            fs.transaction('rw', fs.files, async () => { // since is a new primary key then add it as new item \n                                await fs.files.add({\n                                parent: newParent,\n                                name: e.name,\n                                type: e.type,\n                                size: e.size,\n                                data: e.data\n                                }).then(() => { // then delete old one\n                                    fs.files.where({parent: oldParent}).delete()\n                                })\n                            })\n                        })\n                    })\n                } \n                fs.transaction('rw', fs.files, async () => { // a new primary key, add it as new item \n                    await fs.files.add({\n                      parent: item.parent,\n                      name: this.state.textFieldValue,\n                      type: item.type,\n                      size: item.size,\n                      data: item.data\n                    }).then(() => { // then delete old one\n                        fs.files.where({parent: item.parent, name: item.name}).delete()\n                    })\n                })\n                this.setState({visibleTextField: false})\n                this.fsListDir(this.props.fsCurrentDir)                \n            }\n        } else { // it's a new directory\n            this.setState({visibleTextField: false}, () => {\n                this.fsCreateDir(this.props.fsCurrentDir, this.state.textFieldValue)\n            })\n        }\n    }\n\n    cancelDir = () => {\n         this.setState({visibleTextField: false})\n    }\n\n    saveItem = () => {\n        console.log('this.props.localFileStore: ', this.props.localFileStore)\n        console.log('this.props.fsFileStore: ', this.props.fsFileStore)\n        //console.log('this.props.activeDcm: ', this.props.activeDcm)\n\n        if (this.props.localFileStore !== null) {\n            const file = this.props.localFileStore\n            if (file === null) return\n            let reader = new FileReader()\n            reader.onload = (event) => {\n                let buffer = event.target.result\n                const ext = getFileExtReal(file.name)\n                //console.log('ext: ', ext)\n                const name = getFileName(getFileNameCorrect(file.name))   \n                //console.log('name: ', name)\n                let newName = name\n                let counter = 0\n                let done = false             \n                do {\n                    let filename = ext === '' ? newName : `${newName}.${ext}`\n                    const checkName = this.props.fsCurrentList.find(e => e.name === filename)\n                    if (checkName === undefined) {\n                        fs.transaction('rw', fs.files, async () => {\n                            await fs.files.add({\n                                parent: this.props.fsCurrentDir,\n                                name: filename,\n                                type: ext === '' ? getFileExt(name) : ext,\n                                size: file.size,\n                                data: buffer\n                            })\n                        }).then(() => {\n                            this.fsListDir(this.props.fsCurrentDir)\n                        })\n                        done = true\n                    } else {\n                        newName = `${name} - Copy`\n                        if (counter > 0) newName = `${newName} (${counter})`\n                        counter++\n                    }\n                } while (!done)\n            }\n            reader.readAsArrayBuffer(file)\n        } else if (this.props.fsFileStore !== null) {\n            const file = this.props.fsFileStore\n            let buffer = file.data\n            const ext = getFileExtReal(file.name)\n            const name = getFileName(getFileNameCorrect(file.name))   \n            let newName = name\n            let counter = 0\n            let done = false             \n            do {\n                let filename = ext === '' ? newName : `${newName}.${ext}`\n                const checkName = this.props.fsCurrentList.find(e => e.name === filename)\n                if (checkName === undefined) {\n                    fs.transaction('rw', fs.files, async () => {\n                        await fs.files.add({\n                            parent: this.props.fsCurrentDir,\n                            name: filename,\n                            type: getFileExt(name),\n                            size: file.size,\n                            data: buffer\n                        })\n                    }).then(() => {\n                        this.fsListDir(this.props.fsCurrentDir)\n                    })\n                    done = true\n                } else {\n                    newName = `${name} - Copy`\n                    if (counter > 0) newName = `${newName} (${counter})`\n                    counter++\n                }\n            } while (!done)           \n        }\n    }\n\n    copyItem = () => {\n        let newSelectedCopy = []\n        this.state.selected.forEach(name => {\n            const item = this.props.fsCurrentList.find(e => e.name === name)\n            if (item !== undefined) {\n                newSelectedCopy.push({parent: item.parent, name: item.name})\n            }\n        })\n        this.setState({selectedCopy: newSelectedCopy})\n    }\n\n    cutItem = () => {\n        let newSelectedCopy = []\n        this.state.selected.forEach(name => {\n            let item = this.props.fsCurrentList.find(e => e.name === name)\n            if (item !== undefined) {\n                newSelectedCopy.push({parent: item.parent, name: item.name})\n            }\n        })\n        this.setState({selectedCopy: newSelectedCopy})\n        this.cut = true\n    }\n\n    pasteItem = () => {\n        //console.log('this.state.selectedCopy: ', this.state.selectedCopy)\n        //console.log('this.props.fsCurrentList: ', this.props.fsCurrentList)\n        this.state.selectedCopy.forEach(async (selected, index) => {\n            await fs.files.where({parent: selected.parent, name: selected.name}).first((item) => {\n                if (item !== undefined) {\n                    //console.log('item: ', item)\n                    if (item.type === 'dir') {\n                        // create a new name\n                        let counter = 0\n                        let done = false\n                        let newName = item.name\n                        do {\n                            let filename = newName\n                            const checkName = this.props.fsCurrentList.find(e => e.name === filename)\n                            if (checkName === undefined) {\n                                done = true\n                            } else {\n                                newName = `${item.name} - Copy`\n                                if (counter > 0) newName = `${newName} (${counter})`\n                                counter++\n                            }\n                        } while (!done)   \n                        //console.log('this.props.fsCurrentDir: ', this.props.fsCurrentDir)\n                        //console.log('newName: ', newName)\n                        // copy the folder\n                        fs.files.add({\n                            parent: this.props.fsCurrentDir,\n                            name: newName,\n                            type: item.type,\n                            size: item.size,\n                            data: item.data\n                        })   \n                        // copy all subdirs and files\n                        const oldParent = this.fsBuildParent(item.parent, item.name) \n                        const newParent = this.fsBuildParent(this.props.fsCurrentDir, newName) \n                        //console.log('oldParent: ', oldParent)\n                        //console.log('newParent: ', newParent)\n                        let listItems = []\n                        fs.files.where('parent').startsWithIgnoreCase(oldParent).each((e) => {\n                            listItems.push(e)\n                        }).then(() => {\n                            listItems.forEach(e => {\n                                //console.log('listItems e: ', e)\n                                //const parent = e.parent.replace(oldParent, newParent)\n                                //console.log('parent: ', parent)\n                                fs.files.add({\n                                    parent: newParent,\n                                    name: e.name,\n                                    type: e.type,\n                                    size: e.size,\n                                    data: e.data\n                                })                          \n                            })                            \n                        })\n                    } else { // it's a file\n                        const ext = getFileExtReal(item.name)\n                        const name = getFileName(item.name)    \n                        let newName = name\n                        let counter = 0\n                        let done = false             \n                        do {\n                            let filename = ext === '' ? newName : `${newName}.${ext}`\n                            const checkName = this.props.fsCurrentList.find(e => e.name === filename)\n                            if (checkName === undefined) {\n                                fs.transaction('rw', fs.files, async () => {\n                                    await fs.files.add({\n                                        parent: this.props.fsCurrentDir,\n                                        name: filename,\n                                        type: item.type,\n                                        size: item.size,\n                                        data: item.data\n                                    })\n                                })\n                                done = true\n                            } else {\n                                newName = `${name} - Copy`\n                                if (counter > 0) newName = `${newName} (${counter})`\n                                counter++\n                            }\n                        } while (!done)\n                    }\n                }\n            })\n            if (index === this.state.selectedCopy.length-1) {\n                if (this.cut) {\n                    this.state.selectedCopy.forEach((selected) => {\n                        fs.files.where({parent: selected.parent, name: selected.name}).delete()\n                    })\n                    this.setState({selectedCopy: []})\n                    this.cut = false                    \n                }\n                this.fsListDir(this.props.fsCurrentDir)\n            }\n        })\n        this.setState({selected: []})\n    }\n\n    deleteItem = () => {\n        this.state.selected.forEach(name => {\n            let item = this.props.fsCurrentList.find(e => e.name === name)\n            if (item !== undefined) {\n                if (item.type === 'dir') { // delete also all subitems\n                    fs.files.where('parent').startsWithIgnoreCase(this.fsBuildParent(item.parent, item.name)).delete()\n                }\n                fs.files.where({parent: item.parent, name: item.name}).delete().then(() => {\n                    this.fsListDir(this.props.fsCurrentDir)\n                })\n            }\n        })\n        this.setState({selected: []}) \n    }\n\n    showOthers = () => {\n        this.setState({visibleOthers: !this.state.visibleOthers})\n    }\n\n    exportItem = () => {\n        if (this.state.selected.length === 0) return\n        this.setState({visibleOSaveAsDlg: true})\n    }\n\n    itemClick = (e, row) => {\n        //console.log('itemClick: ', row.name)\n        const selectedIndex = this.state.selected.indexOf(row.name)\n        //console.log('selectedIndex: ', selectedIndex)\n        let newSelected = []\n        if (selectedIndex === -1) {\n            newSelected = newSelected.concat(this.state.selected, row.name)\n        } else if (selectedIndex >= 0) {\n            newSelected = newSelected.concat(\n                this.state.selected.slice(0, selectedIndex),\n                this.state.selected.slice(selectedIndex + 1),\n            )\n        }\n        this.setState({selected: newSelected}, () => {\n            console.log('this.state.selected: ', this.state.selected)\n        })\n    }\n\n    itemDoubleClick = (e, item) => {\n        if (item.type === 'dir') {\n            this.setState({visibleWaiting: true})\n            this.props.setCurrentDir(this.fsBuildParent(item.parent, item.name))\n        } else if (item.name === 'DICOMDIR') {\n            this.props.onOpenDicomdir(item)\n        } else {\n            this.props.setFsFileStore(item)\n            this.props.onOpen(item)\n        }\n    }\n\n    showDeleteDlg = () => {\n        this.setState({ visibleDeleteDlg: true })\n      }\n    \n    hideDeleteDlg = () => {\n        this.setState({ visibleDeleteDlg: false })\n    }\n\n    confirmDeleteDlg = () => {\n        this.hideDeleteDlg()\n        this.deleteItem()\n    }\n\n    hideAlreadyExistDlg = () => {\n        this.setState({ visibleAlreadyExistDlg: false })\n    }  \n\n    hideSaveAs = () => {\n        this.setState({ visibleOSaveAsDlg: false })\n    }\n\n    closeSaveAs = () => {\n        const filename = `${this.saveAsField.value}.zip`\n        this.setState({ visibleOSaveAsDlg: false }, () => {\n            let zip = new JSZip()\n            let listItems = []\n            fs.files.where('parent').startsWithIgnoreCase(this.props.fsCurrentDir).each((e) => {\n                if (this.state.selected.indexOf(e.parent) >= 0 || this.state.selected.indexOf(e.name) >= 0)\n                    listItems.push(e)\n            }).then(() => {\n                listItems.forEach((e) => {\n                    if (e.type !== 'dir') {\n                        zip.folder(e.parent).file(e.name, e.data)\n                    }\n                })\n                zip.generateAsync({type:\"blob\"}).then(blob => {\n                    saveAs(blob, filename)\n                })\n            })\n        })\n    }    \n\n    mouseDown = (e, item) => {\n        this.timer = setTimeout(() => { \n            this.itemDoubleClick(e, item)\n        }, 500)\n    }\n\n    mouseUp = (e) => {\n        clearTimeout(this.timer)\n    }\n\n    render() {   \n        const { classes } = this.props\n        const isSelected = name => this.state.selected.indexOf(name) !== -1\n        const visibleTextField = this.state.visibleTextField\n        const visibleOthers = this.state.visibleOthers\n        const visibleDeleteDlg = this.state.visibleDeleteDlg\n        const visibleAlreadyExistDlg = this.state.visibleAlreadyExistDlg\n        const visibleOSaveAsDlg = this.state.visibleOSaveAsDlg\n        const visibleOpenMultipleFilesDlg = this.state.visibleOpenMultipleFilesDlg\n        const visibleWaiting = this.state.visibleWaiting\n\n        let styleComponent = null\n        if (getSettingsFsView() === 'bottom') {\n            styleComponent = {marginTop: '0px', height: '275px'}\n        } else {\n            styleComponent = {marginTop: '48px', width: '350px'}\n        }\n\n        let totalItemsCount = ''\n        if (this.state.selected.length > 0)\n            totalItemsCount = `(${this.state.selected.length} / ${this.props.fsCurrentList.length} items)`\n        else \n            totalItemsCount = `(${this.props.fsCurrentList.length} items)`\n\n        //console.log('this.props.fsCurrentDir: ', this.props.fsCurrentDir)\n\n        return (\n            <div style={styleComponent}>\n                { visibleTextField ? \n                    <Paper component=\"form\" className={classes.textPaper}>\n                        <InputBase\n                            autoFocus\n                            className={classes.textInput}\n                            placeholder={this.state.textFieldLabel}\n                            defaultValue={this.state.textFieldValue}\n                            onChange={(event) => {\n                                this.setState({textFieldValue: event.target.value})\n                            }}\n                        />\n                        <IconButton className={classes.textButton} onClick={this.confirmText}>\n                            <Icon path={mdiCheck} size={'1.2rem'} color={this.props.color} />\n                        </IconButton>\n                        <IconButton className={classes.textButton} onClick={this.cancelDir}>\n                            <Icon path={mdiClose} size={'1.2rem'} color={this.props.color} />\n                        </IconButton>                        \n                    </Paper>\n                  : \n                    <div>\n\n                        <div>\n                            <Toolbar variant=\"dense\">\n                                <div className={classes.leftButtons}>\n                                { visibleWaiting ?\n                                    <CircularProgress style={{marginLeft: '10px'}} size={20} color=\"secondary\" />\n                                  : \n                                    <Tooltip title=\"Previous folder\">\n                                        <IconButton color=\"inherit\" onClick={this.previousDir} >\n                                            <Icon path={mdiChevronLeft} size={'1.2rem'} color={this.props.color} />\n                                        </IconButton>       \n                                    </Tooltip>                                     \n                                }\n                    \n                                </div>\n                                <div className={classes.toolbarButtons}>\n                                    <Tooltip title=\"Select/unselect all files\">\n                                        <IconButton color=\"inherit\" onClick={this.doSelectUnselect}>\n                                            <Icon path={mdiCheckBoxOutline} size={'1.2rem'} color={this.props.color} />\n                                        </IconButton>\n                                    </Tooltip>    \n                                    <Tooltip title=\"Open selected files\">\n                                        <IconButton color=\"inherit\" onClick={this.openSelectedFiles}>\n                                            <Icon path={mdiFolderOutline} size={'1.2rem'} color={this.props.color} />\n                                        </IconButton>\n                                    </Tooltip>                            \n                                    <Tooltip title=\"Create a new directory\">\n                                        <IconButton color=\"inherit\" onClick={this.createDir}>\n                                            <Icon path={mdiFolderPlusOutline} size={'1.2rem'} color={this.props.color} />\n                                        </IconButton>\n                                    </Tooltip>\n                                    <Tooltip title=\"Rename the last selected item\">\n                                        <IconButton color=\"inherit\" onClick={this.renameItem}>\n                                            <Icon path={mdiSquareEditOutline} size={'1.2rem'} color={this.props.color} />\n                                        </IconButton> \n                                    </Tooltip>\n\n                                    <IconButton color=\"inherit\" onClick={this.showOthers}>\n                                        <Icon path={mdiDotsHorizontal} size={'1.2rem'} color={this.props.color} />\n                                    </IconButton>                           \n                                </div>            \n                            </Toolbar>\n                        </div> \n\n                        { visibleOthers ?\n                            <div>\n                                <Toolbar variant=\"dense\">\n                                    <div className={classes.toolbarButtons}>\n                                        <Tooltip title=\"Move the selected items to the clipboard\">                          \n                                            <IconButton color=\"inherit\" onClick={this.cutItem}>\n                                                <Icon path={mdiContentCut} size={'1.2rem'} color={this.props.color} />\n                                            </IconButton> \n                                        </Tooltip>  \n                                        <Tooltip title=\"Copy the selected items to the clipboard\">\n                                            <IconButton color=\"inherit\" onClick={this.copyItem}>\n                                                <Icon path={mdiContentCopy} size={'1.2rem'} color={this.props.color} />\n                                            </IconButton>\n                                        </Tooltip>\n                                        <Tooltip title=\"Paste clipboard contents to current location\">                             \n                                            <IconButton color=\"inherit\" onClick={this.pasteItem}>\n                                                <Icon path={mdiContentPaste} size={'1.2rem'} color={this.props.color} />\n                                            </IconButton>   \n                                        </Tooltip>  \n                                        <Tooltip title=\"Delete the selected items\">    \n                                            <IconButton color=\"inherit\" onClick={this.showDeleteDlg}>\n                                                <Icon path={mdiDeleteOutline} size={'1.2rem'} color={this.props.color} />\n                                            </IconButton>  \n                                        </Tooltip>                                    \n                                        <Tooltip title=\"Save the opened image to sandbox file system\"> \n                                            <IconButton color=\"inherit\" onClick={this.saveItem}>\n                                                <Icon path={mdiContentSaveOutline} size={'1.2rem'} color={this.props.color} />\n                                            </IconButton>      \n                                        </Tooltip>\n                                        <Tooltip title=\"Export the selected items as zipped archive\">\n                                            <IconButton color=\"inherit\" onClick={this.exportItem}>\n                                                <Icon path={mdiExportVariant} size={'1.2rem'} color={this.props.color} />\n                                            </IconButton>   \n                                        </Tooltip>     \n                                        {/*<IconButton color=\"inherit\" onClick={this.downloadItem}>\n                                            <Icon path={mdiDownload} size={'1.2rem'} color={this.props.color} />\n                                        </IconButton>*/}                                     \n                                    </div>            \n                                </Toolbar>\n                            </div>\n                        : null\n                        }\n\n                        <div>\n                            <div>\n                                <Typography \n                                    type=\"caption text\" \n                                    style={{fontSize: '0.75em', marginLeft: '15px', color: 'rgba(146, 146, 146, 1)', float: 'left'}}>\n                                        {'/'+this.props.fsCurrentDir+' '}\n                                </Typography>\n                            </div>\n                            <div>\n                                <Typography \n                                    type=\"caption text\" \n                                    style={{fontSize: '0.75em', marginRight: '5px', color: 'rgba(146, 146, 146, 1)', float: 'right'}}>\n                                        { totalItemsCount }\n                                </Typography>\n                            </div>\n                        </div>    \n\n                        { visibleWaiting ?\n                            <div style={{marginTop: '20px', position: 'absolute'}}>\n                                <LinearProgress color=\"secondary\" />\n                            </div>\n                          : null  \n                        }\n    \n                    </div>\n                    \n                }\n                <div style={{height: '200px'}}>\n                    <TableContainer component={Paper}>\n                        <Table className={classes.table} size=\"small\">\n                            <TableHead>\n                                <TableRow>\n                                    <TableCell>Name</TableCell>\n                                    <TableCell align=\"left\">Type</TableCell>\n                                    <TableCell align=\"left\">Size</TableCell>\n                                </TableRow>\n                            </TableHead>\n                            <TableBody>\n                            {this.props.fsCurrentList.map((row) => {\n                                const isItemSelected = isSelected(row.name)\n                                return (\n                                    <TableRow \n                                        key={`${row.parent}/${row.name}`} \n                                        role='button' \n                                        hover\n                                        selected={isItemSelected}\n                                        onClick={(e) => {this.itemClick(e, row)}}\n                                        onDoubleClick={(e) => {this.itemDoubleClick(e, row)}}\n                                        onTouchStart={(e) => this.mouseDown(e, row)} \n                                        onTouchEnd={(e) => this.mouseUp(e, row)}\n                                        onMouseDown={(e) => this.mouseDown(e, row)} \n                                        onMouseUp={(e) => this.mouseUp(e, row)}\n                                    >\n                                        <TableCell component=\"th\" scope=\"row\">\n                                            {row.name}\n                                        </TableCell>\n                                        <TableCell align=\"left\">{row.type}</TableCell>\n                                        <TableCell align=\"left\">{formatBytes(row.size)}</TableCell>\n                                    </TableRow>\n                                )\n                            })}\n                            </TableBody>\n                        </Table>\n                    </TableContainer>\n                </div>   \n\n                <Dialog\n                    open={visibleDeleteDlg}\n                    onClose={this.hideDeleteDlg}\n                >\n                    <DialogTitle>{\"Are you sure to delete selected items?\"}</DialogTitle>\n                    <DialogActions>\n                        <Button onClick={this.hideDeleteDlg}>\n                            Cancel\n                        </Button>\n                        <Button onClick={this.confirmDeleteDlg} autoFocus>\n                            Ok\n                        </Button>\n                    </DialogActions>\n                </Dialog>    \n\n                <Dialog\n                    open={visibleAlreadyExistDlg}\n                    onClose={this.hideAlreadyExistDlg}\n                >\n                    <DialogTitle>{\"An item with this name already exists!\"}</DialogTitle>\n                    <DialogActions>\n                        <Button onClick={this.hideAlreadyExistDlg} autoFocus>\n                            Ok\n                        </Button>\n                    </DialogActions>\n                </Dialog>    \n\n                <Dialog\n                    open={visibleOSaveAsDlg}\n                >\n                    <DialogTitle>Export archive</DialogTitle>\n                    <DialogContent>\n                        <DialogContentText>\n                            Specify a file name for the archive:\n                        </DialogContentText>\n                        <TextField\n                            autoFocus\n                            margin=\"dense\"\n                            id=\"id-open-url\"\n                            inputRef={input => (this.saveAsField = input)}\n                            fullWidth\n                        />\n                    </DialogContent>\n                    <DialogActions>\n                        <Button onClick={() => this.hideSaveAs()} >\n                            Cancel\n                        </Button>\n                        <Button onClick={() => this.closeSaveAs()}>\n                            Ok\n                        </Button>\n                    </DialogActions>\n                </Dialog>          \n\n                {visibleOpenMultipleFilesDlg ? <OpenMultipleFilesDlg onClose={this.hideOpenMultipleFilesDlg} files={this.files} origin={'fs'} /> : null}                    \n            </div>\n        )\n    }              \n}\n\nconst mapStateToProps = (state) => {\n    return {\n      files: state.files,\n      localFileStore: state.localFile,\n      fsFileStore: state.fsFile,  \n      activeDcm: state.activeDcm,\n      fsCurrentDir: state.fsCurrentDir,\n      fsCurrentList: state.fsCurrentList,\n      fsZippedFile: state.fsZippedFile,\n      fsRefresh: state.fsRefresh,\n    }\n}\n\nconst mapDispatchToProps = (dispatch) => {\n    return {\n        setCurrentDir: (dir) => dispatch(setFsCurrentDir(dir)),\n        setCurrentList: (list) => dispatch(setFsCurrentList(list)),\n        setFsZippedFile: (file) => dispatch(setZippedFile(file)),\n        setFsFileStore: (file) => dispatch(fsFileStore(file)),\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(withStyles(styles)(FsUI))\n","import React, { PureComponent } from 'react'\nimport {connect} from 'react-redux'\nimport axios from 'axios'\nimport Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport LinearProgress from '@material-ui/core/LinearProgress'\nimport {\n  setZippedFile,\n} from '../actions/index'\n\nconst CancelToken = axios.CancelToken\nconst source = CancelToken.source()\n\nclass DownloadZipDlg extends PureComponent {\n\n  state = {\n    loading: 0\n  }\n\n  componentDidMount(previousProps) {\n    this.requestDownloadZip()\n  }\n\n  hide = () => {\n    this.props.onClose()\n  }\n\n  cancel = () => {\n    source.cancel('Operation canceled by the user.')\n    this.hide()\n  }\n\n  requestDownloadZip = () => {\n    console.log('this.props.url', this.props.url)\n    this.setState({loading: 0})\n    axios({\n      method: 'get',\n      url: this.props.url,\n      responseType: 'arraybuffer',\n      cancelToken: source.token,\n      onDownloadProgress: (progressEvent) => {\n        const percentCompleted = Math.round((progressEvent.loaded * 100) / progressEvent.total)\n        this.setState({ loading: percentCompleted })\n        console.log('loading: ', percentCompleted)\n      },\n    }).then((response) => {\n        console.log('response: ', response)\n        this.props.setFsZippedFile(response.data)\n        this.hide()\n    }).catch((error) => {\n      console.log('error: ', error)\n    })\n  }\n  \n\n  render() {\n    return (\n      <div>\n        <Dialog\n            open={true}\n            onClose={this.hide}\n        >\n            <DialogTitle>{\"Downloading zip archive...\"}</DialogTitle>\n            <DialogContent>\n              <LinearProgress variant=\"determinate\" value={this.state.loading} color='secondary' />\n            </DialogContent>\n            <DialogActions>\n                <Button onClick={this.cancel}>\n                    Cancel\n                </Button>\n            </DialogActions>\n        </Dialog>\n      </div>\n    )\n  }\n}\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    setFsZippedFile: (file) => dispatch(setZippedFile(file))\n  }\n}\n\nexport default connect(null, mapDispatchToProps)(DownloadZipDlg)\n","import React from 'react'\n// import ListItem from \"@material-ui/core/ListItem\";\nimport * as cornerstone from \"cornerstone-core\"\n\nexport default class SeriesItem extends React.Component{\n  constructor(props){\n    super(props);\n    this.dicomImage = null;\n  }\n\n  dicomImageRef = el => {\n    this.dicomImage = el\n  };\n\n  componentDidMount(){\n    if(this.props.image){\n      const element = this.dicomImage;\n      cornerstone.enable(element);\n      cornerstone.displayImage(element, this.props.image);\n    }\n  }\n  render() {\n    const styleDicomImage = {\n        width: 'inherit',\n        height: '100%',\n        position: 'relative',\n      };\n\n    return(\n      <div ref={this.dicomImageRef} style={styleDicomImage}>\n      </div>\n    );\n  }\n}\n","import React, {PureComponent} from 'react'\nimport {withStyles} from '@material-ui/core/styles'\nimport {connect} from 'react-redux'\nimport Dicomdir from './components/Dicomdir'\nimport DicomViewer from './components/DicomViewer'\nimport DicomViewerForList from './components/DicomViewerForList'\nimport DicomHeader from './components/DicomHeader'\nimport Measurements from './components/Measurements'\nimport Settings from './components/Settings'\nimport AboutDlg from './components/AboutDlg'\nimport Histogram from './components/Histogram'\nimport LayoutTool from './components/LayoutTool'\nimport FsUI from './components/FsUI'\nimport DownloadZipDlg from './components/DownloadZipDlg'\nimport OpenMultipleFilesDlg from './components/OpenMultipleFilesDlg'\nimport AppBar from '@material-ui/core/AppBar'\nimport Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogContentText from '@material-ui/core/DialogContentText'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport Divider from '@material-ui/core/Divider'\nimport Drawer from '@material-ui/core/Drawer'\nimport ExpandLess from '@material-ui/icons/ExpandLess'\nimport ExpandMore from '@material-ui/icons/ExpandMore'\nimport Icon from '@mdi/react'\nimport IconButton from '@material-ui/core/IconButton'\nimport List from '@material-ui/core/List'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport Snackbar from '@material-ui/core/Snackbar'\nimport TextField from '@material-ui/core/TextField'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport Typography from '@material-ui/core/Typography'\nimport Grid from '@material-ui/core/Grid'\nimport GridList from '@material-ui/core/GridList';\nimport GridListTile from '@material-ui/core/GridListTile';\nimport GridListTileBar from '@material-ui/core/GridListTileBar';\n// import ListSubheader from '@material-ui/core/ListSubheader';\n// import InfoIcon from '@material-ui/icons/Info';\nimport Slide from '@material-ui/core/Slide';\n\n//import { FixedSizeList } from 'react-window'\n//import {List as ListVirtual} from 'react-virtualized'\n\nimport {\n  isMobile,\n  isTablet,\n} from 'react-device-detect'\nimport {\n  clearStore,\n  localFileStore,\n  dcmIsOpen,\n  activeDcm,\n  activeDcmIndex,\n  activeMeasurements,\n  setLayout,\n  dcmTool,\n  setDicomdir,\n  setZippedFile,\n  setVolume,\n  filesStore,\n} from './actions/index'\nimport {\n  //log,\n  getPixelSpacing,\n  getSpacingBetweenSlice,\n  getSliceThickness,\n  getSliceLocation,\n  //getFileNameCorrect,\n  getFileExtReal,\n  isInputDirSupported,\n  getSettingsFsView,\n  getSettingsDicomdirView,\n  getSettingsMprInterpolation,\n} from './functions'\nimport {\n  mdiAngleAcute,\n  mdiArrowAll,\n  mdiAxisArrow,\n  mdiCamera,\n  mdiChartHistogram,\n  mdiCheck,\n  mdiCheckboxIntermediate,\n  mdiContentSaveOutline,\n  mdiCursorDefault,\n  mdiCursorPointer,\n  mdiDelete,\n  mdiEllipse,\n  mdiEyedropper,\n  mdiFileCabinet,\n  mdiFileDocument,\n  mdiFileCad,\n  mdiFolder,\n  mdiFolderMultiple,\n  mdiGesture,\n  mdiViewGridPlusOutline,\n  mdiImageEdit,\n  mdiInformationOutline,\n  mdiInvertColors,\n  mdiMagnify,\n  mdiFolderOpen,\n  mdiRefresh,\n  mdiRectangle,\n  mdiRuler,\n  mdiSettings,\n  mdiToolbox,\n  //mdiTools,\n  mdiTrashCanOutline,\n  mdiVideo,\n  mdiWeb,\n\n  // mdiPlay,\n  // mdiPause,\n  // mdiSkipBackward,\n  // mdiSkipForward,\n  // mdiSkipNext,\n  // mdiSkipPrevious,\n  // mdiArrowLeft,\n  mdiArrowLeftCircle,\n  // mdiViewList,\n} from '@mdi/js'\n\nimport './App.css'\nimport Tooltip from \"@material-ui/core/Tooltip\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\n// import Menu from \"@material-ui/core/Menu\";\nimport Popper from \"@material-ui/core/Popper\";\nimport Grow from \"@material-ui/core/Grow\";\nimport Paper from \"@material-ui/core/Paper\";\nimport ClickAwayListener from \"@material-ui/core/ClickAwayListener\";\nimport MenuList from \"@material-ui/core/MenuList\";\nimport Card from \"@material-ui/core/Card\";\nimport * as cornerstoneWADOImageLoader from \"cornerstone-wado-image-loader\";\nimport * as cornerstone from \"cornerstone-core\";\n// import * as dicomParser from \"dicom-parser\";\nimport SeriesItem from \"./components/SeriesItem\";\n\n// log();\n\nlocalStorage.setItem(\"debug\", \"cornerstoneTools\");\n\nconst drawerWidth = 240;\nconst iconColor = '#FFFFFF';\nlet iconTool = null;\n\nconst styles = theme => ({\n  '@global': {\n    body: {\n      backgroundColor: theme.palette.common.black,\n    },\n  },\n\n  grow: {\n    flexGrow: 1,\n  },\n\n  root: {\n    display: 'flex',\n  },\n\n  menuButton: {\n    marginRight: theme.spacing(2),\n  },\n\n  title: {\n    // flexGrow: 1,\n    textAlign: 'center',\n    marginRight: theme.spacing(2),\n  },\n\n  appBar: {\n    position: 'relative',\n    backgroundColor: '#3d9c9f',\n    zIndex: theme.zIndex.drawer + 1,\n    transition: theme.transitions.create(['width', 'margin'], {\n      easing: theme.transitions.easing.sharp,\n      duration: theme.transitions.duration.leavingScreen,\n    }),\n  },\n\n  toolbarCard: {\n    zIndex: theme.zIndex.drawer + 1,\n    backgroundColor: '#3d9c9f',\n    position: 'absolute',\n    margin: '0 20% 0 20%',\n    transition: theme.transitions.create(['width', 'margin'], {\n      easing: theme.transitions.easing.sharp,\n      duration: theme.transitions.duration.leavingScreen,\n    }),\n    top: 'auto',\n    bottom: 0,\n    right: 0,\n    left: 0,\n  },\n\n  appBarShift: {\n    marginLeft: drawerWidth,\n    width: `calc(100% - ${drawerWidth}px)`,\n    transition: theme.transitions.create(['width', 'margin'], {\n      easing: theme.transitions.easing.sharp,\n      duration: theme.transitions.duration.enteringScreen,\n    }),\n  },\n\n  hide: {\n    display: 'none',\n  },\n\n  drawer: {\n    width: drawerWidth,\n    flexShrink: 0,\n    whiteSpace: 'nowrap',\n  },\n\n  drawerOpen: {\n    width: drawerWidth,\n    transition: theme.transitions.create('width', {\n      easing: theme.transitions.easing.sharp,\n      duration: theme.transitions.duration.enteringScreen,\n    }),\n  },\n\n  drawerClose: {\n    transition: theme.transitions.create('width', {\n      easing: theme.transitions.easing.sharp,\n      duration: theme.transitions.duration.leavingScreen,\n    }),\n    overflowX: 'hidden',\n    width: theme.spacing(7) + 1,\n    [theme.breakpoints.up('sm')]: {\n      width: theme.spacing(9) + 1,\n    },\n  },\n\n  // Loads information about the app bar, including app bar height\n  toolbar: theme.mixins.toolbar,\n\n  content: {\n    flexGrow: 1,\n    padding: theme.spacing(3),\n  },\n\n  listItemText: {\n    fontSize: '0.85em',\n    marginLeft: '-20px'\n  },\n\n\n  rootGridList: {\n    display: 'flex',\n    flexWrap: 'wrap',\n    justifyContent: 'space-around',\n    overflow: 'hidden',\n    height: '100%',\n    backgroundColor: '#e4e5e655',\n  },\n  gridList: {\n    width: 500,\n    height: '100vh',\n  },\n  icon: {\n    color: 'rgba(255, 255, 255, 0.54)',\n  },\n});\n\nclass App extends PureComponent {\n\n  constructor(props) {\n    super(props);\n    this.files = [];\n    this.file = null;\n    this.url = null;\n\n    this.dicomImage = null;\n    this.imageId = null;\n    this.image = null;\n\n    this.mprData = {};\n    this.mprPlane = '';\n\n    this.volume = [];\n    this.mprSliceIndex = [0, 0, 0];\n\n    this.fileOpen = React.createRef();\n    this.showFileOpen = this.showFileOpen.bind(this);\n\n    this.openDicomdir = React.createRef();\n    this.showOpenDicomdir = this.showOpenDicomdir.bind(this);\n\n    this.openFolder = React.createRef();\n    this.showOpenFolder = this.showOpenFolder.bind(this);\n\n    this.openUrlField = React.createRef();\n\n    this.dicomViewersRefs = [];\n    this.dicomViewers = [];\n    for (let i = 0; i < 16; i++) {\n      this.dicomViewers.push(this.setDcmViewer(i, 0))\n    }\n\n    this.seriesListDicomViewersRefs = [];\n    this.seriesListDicomViewers = [];\n\n    this.seriesCounter = 0;\n\n  }\n\n  state = {\n    anchorElLayout: null,\n    openMenu: false,\n    openImageEdit: false,\n    openTools: false,\n    openMpr: false,\n    openLayout: false,\n    visibleMainMenu: true,\n    visibleHeader: false,\n    visibleSettings: false,\n    visibleToolbar: true,\n    visibleOpenUrl: false,\n    visibleToolbox: false,\n    visibleMeasure: false,\n    visibleClearMeasureDlg: false,\n    visibleAbout: false,\n    visibleDicomdir: false,\n    visibleFileManager: false,\n    visibleZippedFileDlg: false,\n    visibleDownloadZipDlg: false,\n    visibleOpenMultipleFilesDlg: false,\n    toolState: 1,\n    sliceIndex: 0,\n    sliceMax: 1,\n    listOpenFilesScrolling: false,\n    visibleVolumeBuilding: false,\n    visibleMprOrthogonal: false,\n    visibleMprCoronal: false,\n    visibleMprSagittal: false,\n    visibleMprAxial: false,\n\n    anchorEl: null,\n    anchorElMpr: null,\n    anchorElImageEdit: null,\n    visibleSeries: false,\n\n    totalSeries: null,\n    seriesListDicomViewers: [],\n    seriesCounter: 0,\n\n    visibleExplorer: false,\n  };\n\n  setDcmViewer = (index, type) => {\n    if (type === 0) {\n      console.log('griddddddddddddd');\n      return (\n        <DicomViewer\n          dcmRef={(ref) => {\n            this.dicomViewersRefs[index] = ref\n          }}\n          index={index}\n          runTool={ref => (this.runTool = ref)}\n          // runTool2={ref => (this.runTool2 = ref)}\n          changeTool={ref => (this.changeTool = ref)}\n        />\n      )\n    } else if (type === 1) {\n      console.log('listttttttttttt');\n      return (\n        <DicomViewerForList\n          dcmRef={(ref) => {\n            this.seriesListDicomViewersRefs[index] = ref\n          }}\n          index={index}\n          runTool={ref => (this.runTool = ref)}\n          // runTool2={ref => (this.runTool2 = ref)}\n          changeTool={ref => (this.changeTool = ref)}\n          // files={this.state.totalSeries ? this.state.totalSeries[index].files : []}\n        />\n      )\n    }\n  };\n\n  getDcmViewerRef = (index) => {\n    return this.dicomViewersRefs[index]\n  };\n\n  getDcmViewer = (index) => {\n    return this.dicomViewers[index]\n  };\n\n  getActiveDcmViewer = () => {\n    return this.dicomViewersRefs[this.props.activeDcmIndex]\n  };\n\n  toggleFileManager = () => {\n    if (getSettingsFsView() === 'left') {\n      this.setState({visibleMainMenu: false, visibleFileManager: !this.state.visibleFileManager})\n    } else {\n      this.setState({visibleFileManager: !this.state.visibleFileManager})\n    }\n  };\n\n  showFileOpen() {\n    this.props.isOpenStore(false);\n    this.fileOpen.current.click()\n  }\n\n  handleOpenLocalFs = (filesSelected) => {\n    // console.log('handleOpenLocalFs:+++++++++++++++++ ', filesSelected)\n    if (filesSelected.length > 1) {\n      this.files = filesSelected;\n      this.changeLayout(1, 1);\n      this.mprPlane = '';\n      this.volume = [];\n      for (let i = 0; i < 16; i++)\n        if (this.dicomViewersRefs[i] !== undefined) {\n          // this.dicomViewersRefs[i].runTool('clear')\n        }\n      this.setState({\n        sliceIndex: 0,\n        sliceMax: 1,\n        visibleMprOrthogonal: false,\n        visibleMprCoronal: false,\n        visibleMprSagittal: false,\n        visibleMprAxial: false\n      }, () => {\n        this.setState({visibleOpenMultipleFilesDlg: true})\n      })\n    } else {\n      const file = filesSelected[0];\n      console.log('file: ', file);\n      if (file.type === 'application/x-zip-compressed' || file.type === 'application/zip') {\n        this.file = file;\n        this.url = null;\n        this.setState({visibleZippedFileDlg: true})\n      } else {\n        this.setState({sliceIndex: 0, sliceMax: 1});\n        this.props.setLocalFileStore(file);\n        this.dicomViewersRefs[this.props.activeDcmIndex].runTool('clear');\n        this.dicomViewersRefs[this.props.activeDcmIndex].runTool('openLocalFs', file)\n      }\n    }\n  };\n\n  handleOpenSandboxFs = (fsItem) => {\n    //this.hideMainMenu()\n    this.dicomViewersRefs[this.props.activeDcmIndex].runTool('clear');\n    // this.dicomViewersRefs[this.props.activeDcmIndex].runTool('openSandboxFs', fsItem)\n  };\n\n  handleOpenImage = (index) => {\n    // console.log('handleOpenImage+++++ : ', index)\n    const visibleMprOrthogonal = this.state.visibleMprOrthogonal;\n    const visibleMprSagittal = this.state.visibleMprSagittal;\n    const visibleMprCoronal = this.state.visibleMprCoronal;\n    const visibleMprAxial = this.state.visibleMprAxial;\n    const plane = this.mprPlanePosition();\n    //console.log('plane: ', plane)\n\n    if (visibleMprOrthogonal) {\n      if (this.props.activeDcmIndex === 0) {\n        this.dicomViewersRefs[0].runTool('openimage', index)\n\n      } else if (this.props.activeDcmIndex === 1) {\n        if (plane === 'sagittal') { // then open axial plane in second view\n          this.dicomViewersRefs[1].mprRenderXZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData)\n        } else if (plane === 'axial') { // then open coronal plane in second view\n          this.dicomViewersRefs[1].mprRenderXZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData)\n        } else { // plane is coronal, then open axial in second view\n          this.dicomViewersRefs[1].mprRenderXZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData)\n        }\n\n      } else if (this.props.activeDcmIndex === 2) {\n        if (plane === 'sagittal') { // then open axial plane in second view\n          this.dicomViewersRefs[2].mprRenderYZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData)\n        } else if (plane === 'axial') { // then open coronal plane in second view\n          this.dicomViewersRefs[2].mprRenderYZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData)\n        } else { // plane is coronal, then open axial in second view\n          this.dicomViewersRefs[2].mprRenderYZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData)\n        }\n      }\n\n    } else if ((plane === 'sagittal' && visibleMprSagittal) ||\n      (plane === 'axial' && visibleMprAxial) ||\n      (plane === 'coronal' && visibleMprCoronal))\n      this.dicomViewersRefs[this.props.activeDcmIndex].runTool('openimage', index);\n    else if (plane === 'sagittal' && visibleMprAxial)\n      this.dicomViewersRefs[this.props.activeDcmIndex].mprRenderXZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData);\n    else if (plane === 'sagittal' && visibleMprCoronal)\n      this.dicomViewersRefs[this.props.activeDcmIndex].mprRenderYZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData);\n    else if (plane === 'axial' && visibleMprSagittal)\n      this.dicomViewersRefs[this.props.activeDcmIndex].mprRenderYZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData);\n    else if (plane === 'axial' && visibleMprCoronal)\n      this.dicomViewersRefs[this.props.activeDcmIndex].mprRenderXZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData);\n    else if (plane === 'coronal' && visibleMprSagittal)\n      this.dicomViewersRefs[this.props.activeDcmIndex].mprRenderYZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData);\n    else if (plane === 'coronal' && visibleMprAxial)\n      this.dicomViewersRefs[this.props.activeDcmIndex].mprRenderXZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData);\n    else // it's not a possible MPR, then open as normal dicom file\n      this.dicomViewersRefs[this.props.activeDcmIndex].runTool('openimage', index)\n  };\n\n  /*\n    handleOpenMprXZImage = (index) => {\n      this.dicomViewersRefs[this.props.activeDcmIndex].mprRenderXZPlane(this.mprPlanePosition(), index)\n    }\n\n    handleOpenMprYZImage = (index) => {\n      this.dicomViewersRefs[this.props.activeDcmIndex].mprRenderYZPlane(this.mprPlanePosition(), index)\n    }\n  */\n  handleOpenFileDicomdir = (file) => {\n    this.dicomViewersRefs[this.props.activeDcmIndex].runTool('clear');\n    this.dicomViewersRefs[this.props.activeDcmIndex].runTool('openLocalFs', file)\n  };\n\n  showOpenFolder() {\n    this.openFolder.current.click()\n  }\n\n  showOpenDicomdir() {\n    this.openDicomdir.current.click()\n  }\n\n  async handleOpenFolder(files) {\n\n    let seriesNumberList = [];\n    let _totalSeries = [];\n    let _seriesCounter = 0;\n\n    for (let i = 0; i < files.length; i++) {\n\n      this.files.push(files[i]);\n\n      if (files[i] !== undefined) {\n\n        // extract image and data from file\n        let imageId = cornerstoneWADOImageLoader.wadouri.fileManager.add(files[i]);\n        let image = await cornerstone.loadImage(imageId).then((image) => {\n          return image;\n        });\n        let fileImageSeriesNumber = image.data.string('x00200011');\n\n        // if found new series do:\n        if (!seriesNumberList.includes(fileImageSeriesNumber)) {\n\n          seriesNumberList.push(fileImageSeriesNumber);\n\n          _totalSeries.push({\n            seriesNumber: fileImageSeriesNumber,\n            images: [image,],\n            files: [files[i],]\n          });\n\n          _seriesCounter++;\n        } else {\n          _totalSeries.forEach(ts => {\n            if (ts.seriesNumber === fileImageSeriesNumber) {\n              ts.images.push(image);\n              ts.files.push(files[i]);\n            }\n          });\n        }\n      } else {\n        console.log(\"file is undefinde\");\n      }\n    }\n\n    this.changeLayout(1, 1);\n    this.mprPlane = '';\n    this.volume = [];\n    for (let i = 0; i < 16; i++)\n      if (this.dicomViewersRefs[i] !== undefined) {\n        this.dicomViewersRefs[i].runTool('clear')\n      }\n    this.setState({\n      visibleExplorer: true,\n      totalSeries: _totalSeries,\n      seriesCounter: _seriesCounter,\n      seriesListDicomViewers: this.seriesListDicomViewers,\n      sliceIndex: 0,\n      sliceMax: 1,\n      visibleMprOrthogonal: false,\n      visibleMprCoronal: false,\n      visibleMprSagittal: false,\n      visibleMprAxial: false\n    }, () => {\n      this.setState({visibleOpenMultipleFilesDlg: true})\n    })\n  }\n\n  handleOpenDicomdir(files) {\n    this.setState({visibleDicomdir: false}, () => {\n      let dicomdir = null;\n      let datafiles = [];\n      for (let i = 0; i < files.length; i++) {\n        if (files[i].webkitRelativePath.includes('DICOMDIR')) {\n          dicomdir = files[i]\n        } else {\n          datafiles.push(files[i])\n        }\n      }\n      if (dicomdir !== null) {\n        this.props.setDicomdirStore({origin: 'local', dicomdir: dicomdir, files: datafiles});\n        this.toggleDicomdir()\n      }\n    })\n  }\n\n  handleOpenFsDicomdir = (fsItem) => {\n    this.props.setDicomdirStore({origin: 'fs', dicomdir: fsItem, files: []});\n    this.toggleDicomdir()\n  };\n\n  componentDidMount() {\n    // Need to set the renderNode since the drawer uses an overlay\n    //this.dialog = document.getElementById('drawer-routing-example-dialog')\n    window.scrollTo(0, 0)\n  }\n\n\n  showAppBar = () => {\n    window.scrollTo(0, 0)\n  };\n\n\n  toggleSeriesMenu = () => {\n    const visibleSeries = this.state.visibleSeries;\n    //const visibleFileManager = this.state.visibleFileManager\n    if (getSettingsFsView() === 'left') {\n      this.setState({visibleSeries: !visibleSeries, visibleFileManager: false})\n    } else {\n      this.setState({visibleSeries: !visibleSeries})\n    }\n  };\n  toggleMainMenu = () => {\n    const visibleMainMenu = this.state.visibleMainMenu;\n    //const visibleFileManager = this.state.visibleFileManager\n    if (getSettingsFsView() === 'left') {\n      this.setState({visibleMainMenu: !visibleMainMenu, visibleFileManager: false})\n    } else {\n      this.setState({visibleMainMenu: !visibleMainMenu})\n    }\n  };\n\n  showMainMenu = () => {\n    this.setState({visibleMainMenu: true})\n  };\n\n  hideMainMenu = () => {\n    this.setState({visibleMainMenu: false})\n  };\n\n  handleVisibility = (visibleMainMenu) => {\n    this.setState({visibleMainMenu})\n  };\n\n\n  toggleHeader = () => {\n    const visible = !this.state.visibleHeader;\n    this.setState({visibleHeader: visible});\n    if (visible)\n      this.setState({\n        visibleMeasure: false,\n        visibleToolbox: false,\n        visibleDicomdir: false,\n        visibleFileManager: false\n      })\n  };\n\n\n  toggleToolbox = () => {\n    const visible = !this.state.visibleToolbox;\n    this.setState({visibleToolbox: visible});\n    if (visible)\n      this.setState({\n        visibleMeasure: false,\n        visibleHeader: false,\n        visibleDicomdir: false,\n        visibleFileManager: false\n      })\n  };\n\n  saveMeasure = () => {\n    this.dicomViewersRefs[this.props.activeDcmIndex].runTool('savetools')\n  };\n\n  toggleMeasure = () => {\n    const visible = !this.state.visibleMeasure;\n    this.setState({visibleMeasure: visible});\n    if (visible)\n      this.setState({\n        visibleToolbox: false,\n        visibleHeader: false,\n        visibleDicomdir: false,\n        visibleFileManager: false\n      })\n  };\n\n  hideMeasure = () => {\n    this.setState({visibleMeasure: false})\n  };\n\n  handleVisibilityMeasure = (visibleMeasure) => {\n    this.setState({visibleMeasure})\n  };\n\n\n  toggleDicomdir = () => {\n    const visible = !this.state.visibleDicomdir;\n    console.log('toggleDicomdir: ', visible);\n    this.setState({visibleDicomdir: visible});\n    if (visible)\n      this.setState({\n        visibleMeasure: false,\n        visibleToolbox: false,\n        visibleHeader: false,\n        visibleFileManager: false\n      })\n  };\n\n\n  clearMeasure = () => {\n    this.showClearMeasureDlg()\n  };\n\n  showClearMeasureDlg = () => {\n    this.setState({visibleClearMeasureDlg: true})\n  };\n\n  hideClearMeasureDlg = () => {\n    this.setState({visibleClearMeasureDlg: false})\n  };\n\n  confirmClearMeasureDlg = () => {\n    this.hideClearMeasureDlg();\n    this.dicomViewersRefs[this.props.activeDcmIndex].runTool('removetools')\n  };\n\n\n  showZippedFileDlg = () => {\n    this.setState({visibleZippedFileDlg: true})\n  };\n\n  hideZippedFileDlg = () => {\n    this.setState({visibleZippedFileDlg: false})\n  };\n\n  confirmZippedFileDlg = () => {\n    this.hideZippedFileDlg();\n    this.setState({visibleFileManager: true}, () => {\n      console.log('this.url: ', this.url);\n      if (this.url !== null) {\n        this.setState({visibleDownloadZipDlg: true})\n      } else {\n        this.props.setFsZippedFile(this.file)\n      }\n    })\n  };\n\n\n  showAbout = () => {\n    this.setState({visibleAbout: !this.state.visibleAbout})\n  };\n\n  showSettings = () => {\n    this.setState({\n      visibleMainMenu: false,\n      visibleSettings: true,\n      visibleToolbar: false,\n      position: 'right'\n    })\n  };\n\n  hideSettings = () => {\n    this.setState({\n      visibleMainMenu: true,\n      visibleSettings: false,\n      visibleToolbar: true,\n      visibleFileManager: false,\n      visibleDicomdir: false,\n    })\n  };\n\n  handleVisibilitySettings = (visibleSettings) => {\n    this.setState({visibleSettings})\n  };\n\n  hideDownloadZipDlg = () => {\n    this.setState({visibleDownloadZipDlg: false})\n  };\n\n  hideOpenMultipleFilesDlg = () => {\n    this.setState({visibleOpenMultipleFilesDlg: false});\n    this.openMultipleFilesCompleted()\n  };\n\n  openMultipleFilesFromList = (index) => {\n    if (this.props.files !== null) {\n      // this.changeLayout(1, 1);\n\n      this.dicomViewersRefs[this.props.activeDcmIndex].runTool('Mohammad',this.state.totalSeries[index].files);\n      // this.dicomViewersRefs[this.props.activeDcmIndex].runTool(\n      //   'openimage',\n      //   0\n      // );\n\n      // this.seriesListDicomViewers = [];\n      // for (let i = 0; i < this.state.seriesCounter; i++) {\n      //   this.seriesListDicomViewers.push(this.setDcmViewer(i, 1))\n      // }\n\n      // this.state.totalSeries.forEach((ts, index) => {\n      //   console.log(\"index: \" + index);\n      //   console.log(\"refs \" + this.seriesListDicomViewersRefs.length);\n      //   this.seriesListDicomViewersRefs[index].runTool('openLocalFs', ts.files[0]);\n      // });\n\n      const sliceMax = this.props.files.length;\n      this.setState({sliceMax: sliceMax}, () => {\n        this.mprPlanePosition();\n        if (this.mprPlane === 'sagittal')\n          this.setState({\n            visibleMprOrthogonal: false,\n            visibleMprSagittal: true,\n            visibleMprAxial: false,\n            visibleMprCoronal: false\n          });\n        else if (this.mprPlane === 'coronal')\n          this.setState({\n            visibleMprOrthogonal: false,\n            visibleMprSagittal: false,\n            visibleMprAxial: false,\n            visibleMprCoronal: true\n          });\n        else\n          this.setState({\n            visibleMprOrthogonal: false,\n            visibleMprSagittal: false,\n            visibleMprAxial: true,\n            visibleMprCoronal: false\n          })\n      })\n    }\n  };\n\n  openMultipleFilesCompleted = () => {\n    if (this.props.files !== null) {\n      this.changeLayout(1, 1);\n\n      // if(opt === 1){\n        // this.dicomViewersRefs[this.props.activeDcmIndex].runTool('openimage', 0);\n      // }\n\n      // this.seriesListDicomViewers = [];\n      // for (let i = 0; i < this.state.seriesCounter; i++) {\n      //   this.seriesListDicomViewers.push(this.setDcmViewer(i, 1))\n      // }\n\n      // this.state.totalSeries.forEach((ts, index) => {\n      //   console.log(\"index: \" + index);\n      //   console.log(\"refs \" + this.seriesListDicomViewersRefs.length);\n      //   this.seriesListDicomViewersRefs[index].runTool('openLocalFs', ts.files[0]);\n      // });\n\n      const sliceMax = this.props.files.length;\n      this.setState({sliceMax: sliceMax}, () => {\n        // this.mprPlanePosition();\n        // if (this.mprPlane === 'sagittal')\n        //   this.setState({\n        //     visibleMprOrthogonal: false,\n        //     visibleMprSagittal: true,\n        //     visibleMprAxial: false,\n        //     visibleMprCoronal: false\n        //   });\n        // else if (this.mprPlane === 'coronal')\n        //   this.setState({\n        //     visibleMprOrthogonal: false,\n        //     visibleMprSagittal: false,\n        //     visibleMprAxial: false,\n        //     visibleMprCoronal: true\n        //   });\n        // else\n        //   this.setState({\n        //     visibleMprOrthogonal: false,\n        //     visibleMprSagittal: false,\n        //     visibleMprAxial: true,\n        //     visibleMprCoronal: false\n        //   })\n      })\n    }else {\n      console.log('openMultipleFilesCompleted, No DICOM files found.')\n      // console.log('openMultipleFilesCompleted, this.props.allFiles: ', this.props.allFiles)\n      //this.setState({titleMessage: 'Warning', textMessage: 'No DICOM files found.'}, () => {\n        //this.setState({ visibleMessage: true })\n      //})\n    }\n  };\n\n  showOpenUrl = () => {\n    this.setState({visibleOpenUrl: true})\n  };\n\n  hideOpenUrl = (openDlg) => {\n    this.setState({visibleOpenUrl: false},\n      () => {\n        if (openDlg) {\n          this.hideMainMenu();\n          this.file = null;\n          this.url = this.openUrlField.value;\n          //console.log('this.url :', this.url)\n          //const ext = getFileExtReal(this.url)\n          //console.log('ext :', ext)\n          if (getFileExtReal(this.url) === 'zip') {\n            this.setState({visibleZippedFileDlg: true})\n          } else {\n            return this.dicomViewersRefs[this.props.activeDcmIndex].runTool('openurl', this.openUrlField.value)\n          }\n        }\n      })\n  };\n\n  downloadOpenUrl = () => {\n    this.setState({visibleOpenUrl: false, visibleToolbar: true})\n  };\n\n  resetImage = () => {\n    this.dicomViewersRefs[this.props.activeDcmIndex].runTool('reset')\n  };\n\n  saveShot = () => {\n    this.dicomViewersRefs[this.props.activeDcmIndex].runTool('saveas')\n  };\n\n  cinePlayer = () => {\n    this.dicomViewersRefs[this.props.activeDcmIndex].runTool('cine')\n  };\n\n  clear = () => {\n    this.setState({\n      openImageEdit: false,\n      openTools: false,\n      openMpr: false,\n      visibleToolbox: false,\n      visibleMeasure: false,\n      visibleHeader: false,\n      visibleDicomdir: false\n    });\n    this.changeLayout(1, 1);\n    this.props.setFilesStore(null);\n    this.props.setDicomdirStore(null);\n    this.props.clearingStore();\n    this.dicomViewersRefs[this.props.activeDcmIndex].runTool('clear')\n  };\n\n  handleLayout = (event) => {\n    if (this.state.openLayout) {\n      this.setState({\n        anchorElLayout: null,\n        openLayout: false\n      });\n    } else {\n      this.setState({\n        anchorElLayout: event.currentTarget,\n        openLayout: true\n      });\n    }\n  };\n\n  closeLayout = () => {\n    this.setState({anchorElLayout: null, openLayout: false})\n  };\n\n  changeLayout = (row, col) => {\n    // if reduce the grid clear the unused views\n    if (row < this.props.layout[0] || col < this.props.layout[1]) {\n      this.layoutGridClick(0);\n      for (let i = 0; i < 4; i++) {\n        for (let j = 0; j < 4; j++) {\n          if ((i + 1 > row) || (j + 1 > col)) {\n            const index = i * 4 + j;\n            if (this.dicomViewersRefs[index] !== undefined) {\n              //this.dicomViewersRefs[index].runTool('clear')\n            }\n          }\n        }\n      }\n    }\n    console.log(\"change layout end: -----------\", this.props.layout[0]);\n    this.props.setLayoutStore(row, col)\n  };\n\n  toolExecute = (tool) => {\n    this.hideMainMenu();\n    switch (tool) {\n      case 'notool':\n        iconTool = null;\n        this.setState({toolState: null});\n        break;\n      case 'Wwwc':\n        iconTool = mdiArrowAll;\n        break;\n      case 'Pan':\n        iconTool = mdiCursorPointer;\n        break;\n      case 'Zoom':\n        iconTool = mdiMagnify;\n        break;\n      case 'Length':\n        iconTool = mdiRuler;\n        break;\n      case 'Probe':\n        iconTool = mdiEyedropper;\n        break;\n      case 'Angle':\n        iconTool = mdiAngleAcute;\n        break;\n      case 'EllipticalRoi':\n        iconTool = mdiEllipse;\n        break;\n      case 'RectangleRoi':\n        iconTool = mdiRectangle;\n        break;\n      case 'FreehandRoi':\n        iconTool = mdiGesture;\n        break;\n\n      default:\n        break\n    }\n    this.props.toolStore(tool);\n    this.dicomViewersRefs[this.props.activeDcmIndex].runTool(tool)\n  };\n\n  toolChange = () => {\n    const toolState = 1 - this.state.toolState;\n    this.setState({toolState: toolState}, () => {\n      this.changeTool.changeTool(this.props.tool, toolState)\n    })\n  };\n\n  toolRemove = (index) => {\n    this.dicomViewersRefs[this.props.activeDcmIndex].runTool('removetool', index)\n  };\n\n  toggleOpenMenu = (event) => {\n    if (this.state.openMenu) {\n      this.setState({\n        openMenu: !this.state.openMenu,\n        anchorEl: null,\n      });\n    } else {\n      this.setState({\n        openMenu: !this.state.openMenu,\n        anchorEl: event.currentTarget,\n      });\n    }\n  };\n\n  toggleImageEdit = (event) => {\n    if (this.state.anchorElImageEdit) {\n      this.setState({\n        openImageEdit: !this.state.openImageEdit,\n        anchorElImageEdit: null,\n      });\n    } else {\n      this.setState({\n        openImageEdit: !this.state.openImageEdit,\n        anchorElImageEdit: event.currentTarget,\n      });\n    }\n  };\n\n  toggleTools = () => {\n    this.setState({openTools: !this.state.openTools})\n  };\n\n  toggleMpr = (event) => {\n    if (this.state.openMpr) {\n      this.setState({openMpr: !this.state.openMpr, anchorElMpr: null});\n    } else {\n      this.setState({openMpr: !this.state.openMpr, anchorElMpr: event.currentTarget});\n    }\n\n  };\n\n  layoutListClick = (index) => {\n    // if (isMobile && index === this.props.activeDcmIndex) return;\n\n    console.log(\"indexxxxxxxxxx : \" + index);\n\n    this.mprSliceIndex[this.props.activeDcmIndex] = this.state.sliceIndex;\n\n    this.files = this.state.totalSeries[index].files;\n    this.openMultipleFilesFromList(index);\n    // this.props.setActiveDcmIndex(index);\n\n    // if (this.state.visibleMprOrthogonal) {\n    //   if (index === 0) {\n    //     const sliceMax = this.props.files === null ? 1 : this.props.files.length;\n    //     this.setState({sliceMax: sliceMax, sliceIndex: this.mprSliceIndex[0]})\n\n    //   } else if (index === 1) {\n    //     const sliceMax = this.props.files[0].image.columns;\n    //     this.setState({sliceMax: sliceMax, sliceIndex: this.mprSliceIndex[1]})\n\n    //   } else if (index === 2) {\n    //     const sliceMax = this.props.files[0].image.rows;\n    //     this.setState({sliceMax: sliceMax, sliceIndex: this.mprSliceIndex[2]})\n    //   }\n    // }\n\n    // const dcmViewer = this.getDcmViewerRef(index);\n    // //console.log('dcmViewer:', dcmViewer)\n    // this.props.setActiveMeasurements(dcmViewer.measurements);\n    // this.props.setActiveDcm({\n    //   image: dcmViewer.image,\n    //   element: dcmViewer.dicomImage,\n    //   isDicom: dcmViewer.isDicom\n    // })\n  };\n\n  layoutGridClick = (index) => {\n    if (isMobile && index === this.props.activeDcmIndex) return;\n\n    this.mprSliceIndex[this.props.activeDcmIndex] = this.state.sliceIndex;\n\n    this.props.setActiveDcmIndex(index);\n\n    if (this.state.visibleMprOrthogonal) {\n      if (index === 0) {\n        const sliceMax = this.props.files === null ? 1 : this.props.files.length;\n        this.setState({sliceMax: sliceMax, sliceIndex: this.mprSliceIndex[0]})\n\n      } else if (index === 1) {\n        const sliceMax = this.props.files[0].image.columns;\n        this.setState({sliceMax: sliceMax, sliceIndex: this.mprSliceIndex[1]})\n\n      } else if (index === 2) {\n        const sliceMax = this.props.files[0].image.rows;\n        this.setState({sliceMax: sliceMax, sliceIndex: this.mprSliceIndex[2]})\n      }\n    }\n\n    const dcmViewer = this.getDcmViewerRef(index);\n    //console.log('dcmViewer:', dcmViewer)\n    this.props.setActiveMeasurements(dcmViewer.measurements);\n    this.props.setActiveDcm({\n      image: dcmViewer.image,\n      element: dcmViewer.dicomImage,\n      isDicom: dcmViewer.isDicom\n    })\n  };\n\n  layoutGridTouch = (index) => {\n    if (!isMobile && index === this.props.activeDcmIndex) return;\n\n    this.mprSliceIndex[this.props.activeDcmIndex] = this.state.sliceIndex;\n\n    this.props.setActiveDcmIndex(index);\n\n    if (this.state.visibleMprOrthogonal) {\n      if (index === 0) {\n        const sliceMax = this.props.files === null ? 1 : this.props.files.length;\n        this.setState({sliceMax: sliceMax, sliceIndex: this.mprSliceIndex[0]})\n\n      } else if (index === 1) {\n        const sliceMax = this.props.files[0].image.columns;\n        this.setState({sliceMax: sliceMax, sliceIndex: this.mprSliceIndex[1]})\n\n      } else if (index === 2) {\n        const sliceMax = this.props.files[0].image.rows;\n        this.setState({sliceMax: sliceMax, sliceIndex: this.mprSliceIndex[2]})\n      }\n    }\n\n    const dcmViewer = this.getDcmViewerRef(index);\n    this.props.setActiveMeasurements(dcmViewer.measurements);\n    this.props.setActiveDcm({image: dcmViewer.image, element: dcmViewer.dicomImage, isDicom: dcmViewer.isDicom})\n  };\n\n  buildLayoutGrid = () => {\n    let dicomviewers = [];\n    for (let i = 0; i < this.props.layout[0]; i++) {\n      for (let j = 0; j < this.props.layout[1]; j++) {\n        const styleLayoutGrid = {\n          border: this.props.layout[0] === 1 && this.props.layout[1] === 1 ? 'solid 1px #000000' : 'solid 1px #444444',\n        };\n        const index = i * 4 + j;\n        dicomviewers.push(\n          <div\n            key={index}\n            style={styleLayoutGrid}\n            onClick={() => this.layoutGridClick(index)}\n            onTouchStart={() => this.layoutGridTouch(index)}\n          >\n            {this.getDcmViewer(index)}\n          </div>\n        )\n      }\n    }\n\n    return (\n      <div\n        id=\"dicomviewer-grid\"\n        style={{\n          display: 'grid',\n          gridTemplateRows: `repeat(${this.props.layout[0]}, ${100 / this.props.layout[0]}%)`,\n          gridTemplateColumns: `repeat(${this.props.layout[1]}, ${100 / this.props.layout[1]}%)`,\n          height: '100%',\n          width: '100%',\n        }}\n      >\n        {dicomviewers}\n      </div>\n    )\n  };\n\n  buildLayoutList = () => {\n    let dicomviewers = [];\n    for (let i = 0; i < this.state.seriesCounter; i++) {\n      // const styleLayoutGrid = {\n        // border: 'solid 1px #fff',\n        // width: '100%',\n        // height: '100px',\n        // marginTop: '5px',\n      // };\n\n      // this.seriesListDicomViewers[i].runTool2(i, this.state.totalSeries[i].images[0]);\n\n      dicomviewers.push(\n        <ListItem button onClick={() => this.layoutListClick(i)}>\n          <row style={{width: 'inherit'}}>\n            {/*< div\n              key={i}\n              style={styleLayoutGrid}\n              // onClick={() => this.layoutListClick(i)}\n              // onTouchStart={() => this.layoutGridTouch(i)}\n            >\n              {this.seriesListDicomViewers[i]}\n            </div>*/}\n            <SeriesItem image={this.state.totalSeries[i] ? this.state.totalSeries[i].images[0] : null}/>\n            <p\n              style={{padding: 0, margin: '5px 10px 5px 10px', color: '#e4e5e6'}}\n            >\n              series number: {this.state.totalSeries[i] ? this.state.totalSeries[i].seriesNumber : \"{ts.seriesNumber}\"}\n            </p>\n          </row>\n        </ListItem>\n      );\n    }\n\n    return (\n      <div\n        id=\"dicomviewer-grid1\"\n        style={{\n          display: 'flex',\n          // gridTemplateRows: `repeat(${this.props.layout[0]}, ${100 / this.props.layout[0]}%)`,\n          // gridTemplateColumns: `repeat(${this.props.layout[1]}, ${100 / this.props.layout[1]}%)`,\n          height: '100%',\n          width: 'inherit',\n        }}\n      >\n        <List dense={true}>\n          {dicomviewers}\n        </List>\n      </div>\n    );\n  };\n\n  getFileName = (dcmViewer) => {\n    return dcmViewer.filename\n    /*if (dcmViewer.fsItem !== null) {\n    return dcmViewer.fsItem.name\n    } else if (dcmViewer.localfile !== null) {\n    return getFileNameCorrect(dcmViewer.localfile.name)\n    } else {\n    return dcmViewer.localurl.substring(dcmViewer.localurl.lastIndexOf('/')+1)\n    }*/\n  };\n\n  getStringVisiblePlane = () => {\n    if (this.state.visibleMprOrthogonal)\n      return 'orthogonal';\n    else if (this.state.visibleMprSagittal)\n      return 'sagittal';\n    else if (this.state.visibleMprAxial)\n      return 'axial';\n    else if (this.state.visibleMprCoronal)\n      return 'coronal'\n  };\n\n  appBarTitle = (classes, isOpen, dcmViewer) => {\n    if (isMobile && !isTablet) {\n      if (isOpen)\n        return null;\n      else\n        return (\n          <Typography variant=\"overline\" className={classes.title}>\n            <strong>U</strong>niversal <strong>D</strong>icom <strong>V</strong>iewer\n          </Typography>\n        )\n    } else {\n      if (isOpen) {\n        const plane = this.getStringVisiblePlane();\n        if (this.state.sliceMax > 1 && this.mprPlane !== plane && this.mprPlane !== '') {\n          return (\n            <Typography variant=\"overline\" className={classes.title}>\n              {'MPR ' + plane}\n            </Typography>\n          )\n        }\n        return (\n          <Typography variant=\"overline\" className={classes.title}>\n            {this.getFileName(dcmViewer)}\n          </Typography>\n        )\n      } else if (this.props.dicomdir !== null) {\n        return (\n          <Typography variant=\"overline\" className={classes.title}>\n            {this.props.dicomdir.dicomdir.webkitRelativePath}\n          </Typography>\n        )\n      } else\n        return (\n          <Typography variant=\"overline\" className={classes.title}>\n            <strong>U</strong>niversal <strong>D</strong>icom <strong>V</strong>iewer\n          </Typography>\n        )\n    }\n  };\n\n  // ---------------------------------------------------------------------------------------------- MPR\n\n  getImageOrientationZ = (image) => {\n    const iop = image.data.string('x00200037').split('\\\\'); // Image Orientation Patient\n\n    let v = new Array(3).fill(0).map(() => new Array(3).fill(0));\n\n    v[0][0] = parseFloat(iop[0]); // the x direction cosines of the first row X\n    v[0][1] = parseFloat(iop[1]); // the y direction cosines of the first row X\n    v[0][2] = parseFloat(iop[2]); // the z direction cosines of the first row X\n    v[1][0] = parseFloat(iop[3]); // the x direction cosines of the first column Y\n    v[1][1] = parseFloat(iop[4]); // the y direction cosines of the first column Y\n    v[1][2] = parseFloat(iop[5]); // the z direction cosines of the first column Y\n    //console.log('getImageOrientationZ: ', v[1][2])\n    return v[1][2]\n  };\n\n  mprBuildVolume = () => {\n    if (this.volume.length > 0) return;\n\n    this.t0 = performance.now();\n\n    const files = this.props.files;\n    const xPixelSpacing = getPixelSpacing(files[0].image, 0);\n    const spacingBetweenSlice = getSpacingBetweenSlice(files[0].image);\n    const sliceThickness = getSliceThickness(files[0].image);\n    const length = files[0].image.getPixelData().length;\n    const sliceLocation = getSliceLocation(files[0].image);\n    this.volume = [];\n    // see https://stackoverflow.com/questions/58412358/dicom-multiplanar-image-reconstruction\n    this.mprData.zDim = Math.round(files.length * spacingBetweenSlice / xPixelSpacing);\n\n    //console.log('this.mprData.zDim: ', this.mprData.zDim)\n    //console.log('spacingBetweenSlice: ', spacingBetweenSlice)\n    //console.log('sliceThickness: ', sliceThickness)\n    //console.log('xPixelSpacing: ', xPixelSpacing)\n    //console.log('getSliceLocation: ', sliceLocation)\n\n    // If spacing between slices is less than slice thickness, the images are not optimal for 3D reconstruction.\n    // Try an alternative algorithm based on slice distance.\n    let zDimMethod2 = false;\n    if (spacingBetweenSlice < sliceThickness && sliceLocation === undefined) {\n      let max = 0;\n      let min = 0;\n      for (let i = 0; i < files.length; i++) {\n        if (files[i].sliceDistance > max)\n          max = files[i].sliceDistance;\n        if (files[i].sliceDistance < min)\n          min = files[i].sliceDistance\n      }\n      this.mprData.zDim = Math.round(Math.abs(max - min) / xPixelSpacing);\n      //console.log('method2, this.mprData.zDim: ', this.mprData.zDim)\n      zDimMethod2 = true\n    }\n\n    if (files.length === this.mprData.zDim) { // slices contiguous\n      for (let i = 0, len = files.length; i < len; i++) {\n        this.volume.push(files[i].image.getPixelData())\n      }\n\n    } else if (files.length < this.mprData.zDim) { // gap between slices\n\n      let emptyPlane = new Int16Array(length).fill(0);\n      for (let i = 0, len = this.mprData.zDim; i < len; i++) {\n        this.volume.push(emptyPlane)\n      }\n\n      let order = [];\n\n      for (let i = 0; i < files.length; i++) {\n        order.push({\n          iFile: i,\n          instanceNumber: files[i].instanceNumber,\n          sliceDistance: files[i].sliceDistance,\n          sliceLocation: files[i].sliceLocation\n        })\n      }\n\n      if (zDimMethod2) {\n        // eliminate eventually duplicates\n        order = order.reduce((previous, current) => {\n          let object = previous.filter(object => object.sliceDistance === current.sliceDistance);\n          if (object.length === 0) {\n            previous.push(current)\n          }\n          return previous\n        }, []);\n\n        order.sort((l, r) => {\n          // return r.sliceDistance - l.sliceDistance\n          return l.instanceNumber - r.instanceNumber\n        })\n        //console.log('order: ', order)\n      } else {\n        // const reorder = files[0].sliceDistance < files[1].sliceDistance\n        const reorder = files[0].sliceLocation < files[1].sliceLocation;\n        if (reorder) {\n          order.sort((l, r) => {\n            // return l.instanceNumber - r.instanceNumber\n            // return r.sliceDistance - l.sliceDistance\n            return r.sliceLocation - l.sliceLocation\n          })\n          //console.log('reorder: ')\n        }\n      }\n      /*if (this.getImageOrientationZ(files[0].image) < 0) {\n      order.sort((l, r) => {\n      return r.instanceNumber - l.instanceNumber\n      // return r.sliceDistance - l.sliceDistance\n      })\n      console.log('reorder 2: ')\n      }*/\n\n      let intervals = [0];\n      this.volume[0] = files[order[0].iFile].image.getPixelData();\n      this.volume[this.mprData.zDim - 1] = files[order[order.length - 1].iFile].image.getPixelData();\n      const step = (this.mprData.zDim - 2) / (order.length - 2);\n      let i = 0;\n      for (let k = 1; k <= order.length - 2; k++) {\n        i = Math.ceil(i + step);\n        //console.log(`i: ${i},  k: ${k},  order[k].iFile: ${order[k].iFile}`)\n        this.volume[i] = files[order[k].iFile].image.getPixelData(); // order[k-1].iFile\n        intervals.push(i)\n      }\n      intervals.push(this.mprData.zDim - 1);\n      console.log('intervals: ', intervals);\n\n      //console.log('this.volume: ', this.volume)\n\n      const interpolationMethod = getSettingsMprInterpolation();\n\n      if (interpolationMethod === 'no') {\n        // build missing planes without interpolation, simple duplicate\n        for (let i = 0; i < intervals.length - 1; i++) {\n          //console.log(`intervals: ${intervals[i]} - ${intervals[i+1]}`)\n          for (let j = intervals[i] + 1; j <= intervals[i + 1] - 1; j++) {\n            //console.log(`j: ${j}`)\n            this.volume[j] = this.volume[intervals[i + 1]]\n          }\n        }\n\n      } else if (interpolationMethod === 'weightedlinear') {\n        // build the interpolate planes between original planes\n        for (let i = 0; i < intervals.length - 1; i++) {\n          //console.log(`intervals: ${intervals[i]} - ${intervals[i+1]}`)\n          const step = intervals[i + 1] - intervals[i];\n\n          for (let j = intervals[i] + 1; j < intervals[i + 1]; j++) {\n            //console.log(`i: ${i}, intervals[i]: ${intervals[i]}, j: ${j}`)\n\n            let p = new Int16Array(length);\n            const w = (j - intervals[i]) / step;\n\n            for (let k = 0; k < length - 1; k++) {\n              // simple linear interpolation\n              // const p0 = this.volume[intervals[i]][k]\n              // const p1 = this.volume[intervals[i+1]][k]\n              // p[k] = (p0+p1)/2\n\n              // weighted linear interpolation\n              const p0 = this.volume[intervals[i]][k] * (1 - w);\n              const p1 = this.volume[intervals[i + 1]][k] * w;\n              p[k] = p0 + p1;\n              if (p0 === undefined || p1 === undefined) {\n                console.log('undefined')\n              }\n              // weighted bilinear interpolation\n              /*if (k-1 > 0 && k+1 < length) {\n              const p0 = this.volume[intervals[i]][k] * (1-w) * 0.5 + this.volume[intervals[i]][k-1] * (1-w) * 0.25 + this.volume[intervals[i]][k+1] * (1-w) * 0.25\n              const p1 = this.volume[intervals[i+1]][k] * w * 0.5 + this.volume[intervals[i+1]][k-1] * w * 0.25 + this.volume[intervals[i+1]][k+1] * w * 0.25\n              p[k] = p0+p1\n              } else if (k-1 < 0) {\n              const p0 = this.volume[intervals[i]][k] * (1-w) * 0.75 + this.volume[intervals[i]][k+1] * (1-w) * 0.25\n              const p1 = this.volume[intervals[i+1]][k] * w * 0.5 + this.volume[intervals[i+1]][k+1] * w * 0.25\n              p[k] = p0+p1\n              } else { // k+1 > length\n              const p0 = this.volume[intervals[i]][k] * (1-w) * 0.75 + this.volume[intervals[i]][k-1] * (1-w) * 0.25\n              const p1 = this.volume[intervals[i+1]][k] * w * 0.5 + this.volume[intervals[i+1]][k-1] * w * 0.25\n              p[k] = p0+p1\n              }*/\n            }\n\n            this.volume[j] = p\n          }\n        }\n      }\n\n      this.t1 = performance.now();\n      console.log(`performance volume building: ${this.t1 - this.t0} milliseconds`)\n\n    } else { // overlapping slices\n      this.mprData.zStep = files.length / this.mprData.zDim;\n      //console.log('this.mprData.zStep: ', this.mprData.zStep)\n      for (let i = 0, len = this.mprData.zDim; i < len; i++) {\n        const k = Math.round(i * this.mprData.zStep);\n        this.volume.push(files[k].image.getPixelData())\n      }\n    }\n\n    if (this.state.visibleMprOrthogonal) {\n      this.changeToOrthogonalView()\n\n    } else if (this.state.visibleMprSagittal) {\n      this.changeToSagittalView()\n\n    } else if (this.state.visibleMprCoronal) {\n      this.changeToCoronalView()\n\n    } else { // axial\n      this.changeToAxialView()\n    }\n  };\n\n  changeToOrthogonalView = () => {\n    this.changeLayout(1, 3);\n\n    this.setState({visibleVolumeBuilding: false}, () => {\n      const plane = this.mprPlanePosition();\n\n      const index = Math.round(this.props.files.length / 2);\n\n      if (this.dicomViewersRefs[0].volume === null)\n        this.dicomViewersRefs[0].volume = this.volume;\n\n      this.mprSliceIndex[0] = index;\n      this.dicomViewersRefs[0].runTool('openimage', index);\n\n      if (this.dicomViewersRefs[1].volume === null)\n        this.dicomViewersRefs[1].volume = this.volume;\n      const xzIndex = Math.round(this.props.files[0].image.columns / 2);\n      this.mprSliceIndex[1] = xzIndex;\n      this.dicomViewersRefs[1].mprRenderXZPlane(this.dicomViewersRefs[0].filename, plane, xzIndex, this.mprData);\n\n      if (this.dicomViewersRefs[2].volume === null)\n        this.dicomViewersRefs[2].volume = this.volume;\n      const yzIndex = Math.round(this.props.files[0].image.rows / 2);\n      this.mprSliceIndex[2] = yzIndex;\n      this.dicomViewersRefs[2].mprRenderYZPlane(this.dicomViewersRefs[0].filename, plane, yzIndex, this.mprData)\n    })\n\n  };\n\n  changeToSagittalView = () => {\n    this.changeLayout(1, 1);\n\n    this.setState({visibleVolumeBuilding: false}, () => {\n      const plane = this.mprPlanePosition();\n\n      if (this.dicomViewersRefs[this.props.activeDcmIndex].volume === null)\n        this.dicomViewersRefs[this.props.activeDcmIndex].volume = this.volume;\n      //console.log('mprSagittal, this.mprPlanePosition(): ', plane)\n\n      if (plane === 'sagittal') {\n        const sliceMax = this.props.files === null ? 1 : this.props.files.length;\n        const index = Math.round(sliceMax / 2);\n        this.setState({sliceIndex: index, sliceMax: sliceMax});\n        this.dicomViewersRefs[this.props.activeDcmIndex].runTool('openimage', index)\n\n      } else if (plane === 'axial') {\n        const sliceMax = this.props.files[0].image.columns;\n        const index = Math.round(sliceMax / 2);\n        this.setState({sliceIndex: index, sliceMax: sliceMax});\n        this.dicomViewersRefs[this.props.activeDcmIndex].mprRenderYZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData)\n\n      } else {\n        const sliceMax = this.props.files[0].image.rows;\n        const index = Math.round(sliceMax / 2);\n        this.setState({sliceIndex: index, sliceMax: sliceMax});\n        this.dicomViewersRefs[this.props.activeDcmIndex].mprRenderXZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData)\n      }\n    })\n  };\n\n  changeToCoronalView = () => {\n    this.changeLayout(1, 1);\n\n    this.setState({visibleVolumeBuilding: false}, () => {\n      const plane = this.mprPlanePosition();\n\n      if (this.dicomViewersRefs[this.props.activeDcmIndex].volume === null)\n        this.dicomViewersRefs[this.props.activeDcmIndex].volume = this.volume;\n      //console.log('mprCoronal, this.mprPlanePosition(): ', plane)\n\n      if (plane === 'coronal') {\n        const sliceMax = this.props.files === null ? 1 : this.props.files.length;\n        const index = Math.round(sliceMax / 2);\n        this.setState({sliceIndex: index, sliceMax: sliceMax});\n        this.dicomViewersRefs[this.props.activeDcmIndex].runTool('openimage', index)\n\n      } else if (plane === 'axial') {\n        const sliceMax = this.props.files[0].image.columns;\n        const index = Math.round(sliceMax / 2);\n        this.setState({sliceIndex: index, sliceMax: sliceMax});\n        this.dicomViewersRefs[this.props.activeDcmIndex].mprRenderXZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData)\n\n      } else { // plane is sagittal\n        const sliceMax = this.props.files[0].image.rows;\n        const index = Math.round(sliceMax / 2);\n        this.setState({sliceIndex: index, sliceMax: sliceMax});\n        this.dicomViewersRefs[this.props.activeDcmIndex].mprRenderYZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData)\n      }\n    })\n  };\n\n  changeToAxialView = () => {\n    this.changeLayout(1, 1);\n\n    this.setState({visibleVolumeBuilding: false}, () => {\n      const plane = this.mprPlanePosition();\n\n      if (this.dicomViewersRefs[this.props.activeDcmIndex].volume === null)\n        this.dicomViewersRefs[this.props.activeDcmIndex].volume = this.volume;\n      //console.log('mprAxial, this.mprPlanePosition(): ', plane)\n\n      if (plane === 'axial') {\n        const sliceMax = this.props.files === null ? 1 : this.props.files.length;\n        const index = Math.round(sliceMax / 2);\n        this.setState({sliceIndex: index, sliceMax: sliceMax});\n        this.dicomViewersRefs[this.props.activeDcmIndex].runTool('openimage', index)\n\n      } else if (plane === 'sagittal') {\n        const sliceMax = this.props.files[0].image.columns;\n        const index = Math.round(sliceMax / 2);\n        this.setState({sliceIndex: index, sliceMax: sliceMax});\n        this.dicomViewersRefs[this.props.activeDcmIndex].mprRenderXZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData)\n\n      } else {\n        const sliceMax = this.props.files[0].image.rows;\n        const index = Math.round(sliceMax / 2);\n        this.setState({sliceIndex: index, sliceMax: sliceMax});\n        this.dicomViewersRefs[this.props.activeDcmIndex].mprRenderYZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData)\n      }\n    })\n  };\n\n  mprPlanePosition = () => {\n    if (this.mprPlane === '') {\n      this.mprPlane = this.dicomViewersRefs[this.props.activeDcmIndex].mprPlanePosition()\n    }\n    return this.mprPlane\n  };\n\n  mprOrthogonal = () => {\n    const visibleMprOrthogonal = this.state.visibleMprOrthogonal;\n    if (!visibleMprOrthogonal) {\n      const index = Math.round(this.props.files.length / 2);\n      //console.log('mprOrthogonal, index: ', index)\n      this.setState({sliceIndex: index});\n      this.setState({\n        visibleMprOrthogonal: true,\n        visibleMprCoronal: false,\n        visibleMprSagittal: false,\n        visibleMprAxial: false\n      }, () => {\n        if (this.volume.length === 0) {\n          this.setState({visibleVolumeBuilding: true}, () => {\n            setTimeout(() => {\n              this.mprBuildVolume()\n            }, 100)\n          })\n        } else {\n          this.changeToOrthogonalView()\n        }\n      })\n    }\n  };\n\n  mprSagittal = () => {\n    const visibleMprSagittal = this.state.visibleMprSagittal;\n    if (!visibleMprSagittal) {\n      this.setState({\n        visibleMprOrthogonal: false,\n        visibleMprSagittal: true,\n        visibleMprCoronal: false,\n        visibleMprAxial: false\n      }, () => {\n        if (this.volume.length === 0) {\n          this.setState({visibleVolumeBuilding: true}, () => {\n            setTimeout(() => {\n              this.mprBuildVolume()\n            }, 100)\n          })\n        } else {\n          this.changeToSagittalView()\n        }\n      })\n    }\n  };\n\n  mprCoronal = () => {\n    const visibleMprCoronal = this.state.visibleMprCoronal;\n    if (!visibleMprCoronal) {\n      this.setState({\n        visibleMprOrthogonal: false,\n        visibleMprSagittal: false,\n        visibleMprCoronal: true,\n        visibleMprAxial: false\n      }, () => {\n        if (this.volume.length === 0) {\n          this.setState({visibleVolumeBuilding: true}, () => {\n            setTimeout(() => {\n              this.mprBuildVolume()\n            }, 100)\n          })\n        } else {\n          this.changeToCoronalView()\n        }\n      })\n    }\n  };\n\n  mprAxial = () => {\n    const visibleMprAxial = this.state.visibleMprAxial;\n    if (!visibleMprAxial) {\n      this.setState({\n        visibleMprOrthogonal: false,\n        visibleMprSagittal: false,\n        visibleMprCoronal: false,\n        visibleMprAxial: true\n      }, () => {\n        if (this.volume.length === 0) {\n          this.setState({visibleVolumeBuilding: true}, () => {\n            setTimeout(() => {\n              this.mprBuildVolume()\n            }, 100)\n          })\n        } else {\n          this.changeToAxialView()\n        }\n      })\n    }\n  };\n\n  // ---------------------------------------------------------------------------------------------- MPR end\n\n  listOpenFilesFirstFrame = () => {\n    const index = 0;\n    //this.props.setLocalFileStore(this.files[index])\n    this.setState({sliceIndex: index}, () => {\n      this.handleOpenImage(index)\n    })\n  };\n\n  listOpenFilesPreviousFrame = () => {\n    let index = this.state.sliceIndex;\n    index = index === 0 ? this.state.sliceMax - 1 : index - 1;\n    //this.props.setLocalFileStore(this.files[index])\n    this.setState({sliceIndex: index}, () => {\n      this.handleOpenImage(index)\n    })\n  };\n\n  listOpenFilesNextFrame = () => {\n    let index = this.state.sliceIndex;\n    index = index === this.state.sliceMax - 1 ? 0 : index + 1;\n    //this.props.setLocalFileStore(this.files[index])\n    this.setState({sliceIndex: index}, () => {\n      this.handleOpenImage(index)\n    })\n  };\n\n  listOpenFilesLastFrame = () => {\n    const index = this.state.sliceMax - 1;\n    //this.props.setLocalFileStore(this.files[index])\n    this.setState({sliceIndex: index}, () => {\n      this.handleOpenImage(index)\n    })\n  };\n\n  listOpenFilesScrolling = () => {\n    const scrolling = this.state.listOpenFilesScrolling;\n    this.setState({listOpenFilesScrolling: !scrolling}, () => {\n      if (scrolling) {\n        clearInterval(this.timerScrolling)\n      } else {\n        this.timerScrolling = setInterval(() => {\n          this.listOpenFilesNextFrame()\n        }, 500)\n      }\n    })\n  };\n\n  handleSliceChange = (event, value) => {\n    console.log('slice value: ', Math.floor(value));\n    this.setState({sliceIndex: Math.floor(value)}, () => {\n      let index = this.state.sliceIndex;\n      this.props.setLocalFileStore(this.files[index]);\n      this.handleOpenImage(index)\n    })\n  };\n\n  dicomImageRef = el => {\n    this.dicomImage = el\n  };\n\n  render() {\n    //console.log('App render: ')\n\n    const {classes} = this.props;\n\n    const primaryClass = {primary: classes.listItemText};\n    const iconSize = '1.2rem';\n\n    const isOpen = this.props.isOpen[this.props.activeDcmIndex];\n    const isDicomdir = this.props.dicomdir !== null;\n    const isMultipleFiles = this.props.files === null ? false : this.props.files.length > 1;\n\n    const openMenu = this.state.openMenu;\n    const openImageEdit = this.state.openImageEdit;\n    // const openTools = this.state.openTools;\n    const openMpr = this.state.openMpr && isMultipleFiles && this.mprPlane !== '';\n    // const visibleMainMenu = this.state.visibleMainMenu;\n    const visibleHeader = this.state.visibleHeader;\n    const visibleSettings = this.state.visibleSettings;\n    const visibleAbout = this.state.visibleAbout;\n    const visibleMeasure = this.state.visibleMeasure;\n    const visibleToolbox = this.state.visibleToolbox;\n    const visibleDicomdir = this.state.visibleDicomdir;\n    const visibleFileManager = this.state.visibleFileManager;\n    const visibleClearMeasureDlg = this.state.visibleClearMeasureDlg;\n    const visibleZippedFileDlg = this.state.visibleZippedFileDlg;\n    const visibleDownloadZipDlg = this.state.visibleDownloadZipDlg;\n    const visibleOpenMultipleFilesDlg = this.state.visibleOpenMultipleFilesDlg;\n    // const visibleLayout = Boolean(this.state.anchorElLayout);\n    const visibleVolumeBuilding = this.state.visibleVolumeBuilding;\n    const visibleMprOrthogonal = this.state.visibleMprOrthogonal;\n    const visibleMprCoronal = this.state.visibleMprCoronal;\n    const visibleMprSagittal = this.state.visibleMprSagittal;\n    const visibleMprAxial = this.state.visibleMprAxial;\n\n    let iconToolColor = this.state.toolState === 1 ? '#FFFFFF' : '#999999';\n\n    const dcmViewer = this.getActiveDcmViewer();\n\n    // const sliceMax = this.state.sliceMax;\n\n    const anchorEl = this.state.anchorEl;\n    const anchorElMpr = this.state.anchorElMpr;\n    const anchorElImageEdit = this.state.anchorElImageEdit;\n    const visibleSeries = this.state.visibleSeries;\n    const anchorElLayout = this.state.anchorElLayout;\n    // const openLayout = this.state.openLayout;\n\n    // let totalSeries = this.state.totalSeries;\n\n    //console.log('this.dicomViewersRefs: ', this.dicomViewersRefs)\n    //console.log('isMultipleFiles: ', isMultipleFiles)\n    //console.log('this.mprPlane: ', this.mprPlane)\n\n    const handleClick = (event) => {\n      this.setState({anchorElLayout: event.currentTarget});\n    };\n\n    const handleClose = () => {\n      this.setState({anchorElLayout: null});\n    };\n\n    return (\n      <div>\n        <AppBar className={classes.appBar} position='static' elevation={0}>\n          <Toolbar variant=\"dense\">\n            {/*<IconButton*/}\n            {/*  edge=\"start\"*/}\n            {/*  className={classes.menuButton}*/}\n            {/*  color=\"inherit\"*/}\n            {/*  aria-label=\"menu\"*/}\n            {/*  onClick={this.toggleSeriesMenu}>*/}\n            {/*  <Icon path={mdiViewList} size={iconSize} color={iconColor}/>*/}\n            {/*</IconButton>*/}\n\n            <Typography variant=\"overline\" className={classes.title}>\n              <strong>M</strong>ed<strong>K</strong>av\n            </Typography>\n\n            <Divider\n              orientation={\"vertical\"}\n              style={{display: 'list-item', backgroundColor: '#fff'}}\n              flexItem\n            />\n\n            <Tooltip title={\"File Manager\"} arrow>\n              <IconButton\n                button\n                onClick={() => this.toggleFileManager()}\n                style={{marginLeft: '16px'}}\n              >\n                <Icon path={mdiFileCabinet} size={iconSize} color={iconColor}/>\n              </IconButton>\n            </Tooltip>\n            <Tooltip title={\"Open\"} arrow>\n              <IconButton button onClick={(event) => this.toggleOpenMenu(event)}>\n                <Icon path={mdiFolderMultiple} size={iconSize} color={iconColor}/>\n                {openMenu ? <ExpandLess/> : <ExpandMore/>}\n              </IconButton>\n            </Tooltip>\n            <Popper\n              open={openMenu}\n              anchorEl={anchorEl}\n              role={undefined}\n              transition\n              disablePortal\n              style={{backgroundColor: '#70c4c5'}}\n              placement={'center-top'}\n            >\n              {({TransitionProps, placement}) => (\n                <Grow\n                  {...TransitionProps}\n                  style={{transformOrigin: placement === 'bottom' ? 'center top' : 'center bottom'}}\n                >\n                  <Paper\n                    style={{backgroundColor: '#70c4c5', borderRadius: '0 0 4px 4px'}}\n                  >\n                    <ClickAwayListener onClickAway={(event) => this.toggleOpenMenu(event)}>\n                      <MenuList\n                        autoFocusItem={openMenu}\n                        style={{padding: '0'}}\n                        id=\"menu-list-grow\"\n                        onKeyDown={(event) => this.toggleOpenMenu(event)}\n                      >\n\n                        <MenuItem disabled button onClick={() => this.showFileOpen()}>\n                          <ListItemIcon><Icon path={mdiFolder} size={'1.0rem'} color={iconColor}/></ListItemIcon>\n                          <ListItemText\n                            classes={primaryClass}\n                            primary={\n                              <Typography\n                                type=\"body1\"\n                                style={{\n                                  fontSize: '0.80em',\n                                  marginLeft: '-20px'\n                                }}>File</Typography>\n                            }/>\n                        </MenuItem>\n                        <MenuItem disabled button onClick={() => this.showOpenUrl()}>\n                          <ListItemIcon><Icon path={mdiWeb} size={'1.0rem'} color={iconColor}/></ListItemIcon>\n                          <ListItemText\n                            classes={primaryClass}\n                            primary={\n                              <Typography\n                                type=\"body1\"\n                                style={{fontSize: '0.80em', marginLeft: '-20px'}}>URL</Typography>\n                            }/>\n                        </MenuItem>\n                        {isInputDirSupported() && !isMobile ?\n                          <MenuItem button onClick={() => this.showOpenFolder()}>\n                            <ListItemIcon><Icon path={mdiFolderOpen} size={'1.0rem'} color={iconColor}/></ListItemIcon>\n                            <ListItemText\n                              classes={primaryClass}\n                              primary={\n                                <Typography\n                                  type=\"body1\"\n                                  style={{\n                                    fontSize: '0.80em',\n                                    marginLeft: '-20px'\n                                  }}>Folder</Typography>\n                              }/>\n                          </MenuItem>\n                          : null}\n                        {isInputDirSupported() && !isMobile ?\n                          <MenuItem disabled button onClick={() => this.showOpenDicomdir()}>\n                            <ListItemIcon><Icon path={mdiFolderOpen} size={'1.0rem'} color={iconColor}/></ListItemIcon>\n                            <ListItemText\n                              classes={primaryClass}\n                              primary={\n                                <Typography\n                                  type=\"body1\"\n                                  style={{\n                                    fontSize: '0.80em',\n                                    marginLeft: '-20px'\n                                  }}>DICOMDIR\n                                </Typography>\n                              }/>\n                          </MenuItem>\n                          : null}\n                      </MenuList>\n                    </ClickAwayListener>\n                  </Paper>\n                </Grow>\n              )}\n            </Popper>\n\n            <Tooltip title={\"Clear All\"} arrow>\n              <IconButton button onClick={() => this.clear()}>\n                <Icon path={mdiDelete} size={iconSize} color={iconColor}/>\n              </IconButton>\n            </Tooltip>\n            <Tooltip title={\"Layout\"} arrow>\n              <IconButton button onClick={handleClick}>\n                <Icon path={mdiViewGridPlusOutline} size={iconSize} color={iconColor}/>\n              </IconButton>\n            </Tooltip>\n            <Popper\n              open={Boolean(anchorElLayout)}\n              anchorEl={anchorElLayout}\n              role={undefined}\n              transition\n              disablePortal\n              style={{backgroundColor: '#70c4c5', marginTop: '3px'}}\n              placement={'center-top'}\n            >\n              {({TransitionProps, placement}) => (\n                <Grow\n                  {...TransitionProps}\n                  style={{transformOrigin: placement === 'bottom' ? 'center top' : 'center bottom'}}\n                >\n                  <Paper\n                    style={{\n                      backgroundColor: '#70c4c5',\n                      borderRadius: '0 0 4px 4px',\n                    }}\n                  >\n                    <ClickAwayListener onClickAway={handleClose}>\n                      <LayoutTool\n                        row={this.props.layout[0] - 1}\n                        col={this.props.layout[1] - 1}\n                        onChange={this.changeLayout}\n                      />\n                    </ClickAwayListener>\n                  </Paper>\n                </Grow>\n              )}\n            </Popper>\n\n\n            <Tooltip title={\"Settings\"} arrow>\n              <IconButton button onClick={() => this.showSettings()}>\n                <Icon path={mdiSettings} size={iconSize} color={iconColor}/>\n              </IconButton>\n            </Tooltip>\n\n\n            {/*{this.appBarTitle(classes, isOpen, dcmViewer)}*/}\n\n            <div className={classes.grow}/>\n            {!isOpen && !isDicomdir ? (\n              <IconButton onClick={this.showAbout}>\n                <Icon path={mdiInformationOutline} size={iconSize} color={iconColor}/>\n              </IconButton>\n            ) : null\n            }\n            {iconTool !== null && this.props.tool !== null && isOpen ? (\n              <IconButton onClick={this.toolChange}>\n                <Icon path={iconTool} size={iconSize} color={iconToolColor}/>\n              </IconButton>\n            ) : null\n            }\n            {isOpen && dcmViewer.numberOfFrames > 1 && isOpen ? (\n              <IconButton onClick={this.cinePlayer}>\n                <Icon path={mdiVideo} size={iconSize} color={iconColor}/>\n              </IconButton>\n            ) : null\n            }\n            {isOpen ? (\n              <IconButton onClick={this.resetImage}>\n                <Icon path={mdiRefresh} size={iconSize} color={iconColor}/>\n              </IconButton>\n            ) : null\n            }\n            {isOpen ? (\n              <IconButton color=\"inherit\" onClick={this.saveShot}>\n                <Icon path={mdiCamera} size={iconSize} color={iconColor}/>\n              </IconButton>\n            ) : null\n            }\n            {isOpen ? (\n              <IconButton color=\"inherit\" onClick={this.toggleToolbox}>\n                <Icon path={mdiToolbox} size={iconSize} color={iconColor}/>\n              </IconButton>\n            ) : null\n            }\n            {isOpen ? (\n              <IconButton color=\"inherit\" onClick={this.toggleMeasure}>\n                <Icon path={mdiFileCad} size={iconSize} color={iconColor}/>\n              </IconButton>\n            ) : null\n            }\n            {isOpen && dcmViewer.isDicom ? (\n              <IconButton color=\"inherit\" onClick={this.toggleHeader}>\n                <Icon path={mdiFileDocument} size={iconSize} color={iconColor}/>\n              </IconButton>\n            ) : null\n            }\n            {isDicomdir ? (\n              <IconButton color=\"inherit\" onClick={this.toggleDicomdir}>\n                <Icon path={mdiFolderOpen} size={iconSize} color={iconColor}/>\n              </IconButton>\n            ) : null\n            }\n            {isOpen ? (\n              <IconButton color=\"inherit\" onClick={this.toggleFileManager}>\n                <Icon path={mdiFileCabinet} size={iconSize} color={iconColor}/>\n              </IconButton>\n            ) : null\n            }\n          </Toolbar>\n        </AppBar>\n\n        <Slide direction=\"up\" in={this.state.visibleExplorer} mountOnEnter unmountOnExit>\n\n          <Card className={classes.toolbarCard} position='fixed' elevation={0}>\n          <Toolbar variant=\"dense\" style={{justifyContent: 'center'}}>\n\n            <Tooltip title={\"Histogram\"} placement={\"top\"} arrow>\n              <IconButton button onClick={() => this.toggleToolbox()} disabled={!isOpen}>\n                <Icon path={mdiChartHistogram} size={iconSize} color={iconColor}/>\n              </IconButton>\n            </Tooltip>\n\n            <Tooltip title={\"MPR\"} placement={\"top\"} arrow>\n              <IconButton button onClick={(event) => this.toggleMpr(event)}\n                          disabled={!isOpen || !isMultipleFiles || this.mprPlane === ''}>\n                <Icon path={mdiAxisArrow} size={iconSize} color={iconColor}/>\n                {openMpr ? <ExpandMore/> : <ExpandLess/>}\n              </IconButton>\n            </Tooltip>\n\n            <Popper\n              open={openMpr}\n              anchorEl={anchorElMpr}\n              role={undefined} transition disablePortal>\n              {({TransitionProps, placement}) => (\n                <Grow\n                  {...TransitionProps}\n                  style={{transformOrigin: placement === 'bottom' ? 'center top' : 'center bottom'}}\n                >\n                  <Paper>\n                    <ClickAwayListener onClickAway={() => this.toggleMpr()}>\n                      <MenuList dense={true} component=\"div\">\n                        <MenuItem button style={{paddingLeft: 40}} onClick={() => this.mprOrthogonal()}>\n                          {visibleMprOrthogonal ?\n                            <ListItemIcon style={{marginLeft: '-10px'}}>\n                              <Icon\n                                path={mdiCheck}\n                                size={'1.0rem'}\n                                color={iconColor}/></ListItemIcon> : null}\n                          <ListItemText\n                            style={visibleMprOrthogonal ? {marginLeft: '-7px'} : {marginLeft: '40px'}}\n                            classes={primaryClass}\n                            primary={\n                              <Typography\n                                type=\"body1\"\n                                style={{fontSize: '0.80em', marginLeft: '-23px'}}>Orthogonal</Typography>\n                            }/>\n                        </MenuItem>\n                        <MenuItem button style={{paddingLeft: 40}} onClick={() => this.mprCoronal()}>\n                          {visibleMprCoronal ?\n                            <ListItemIcon style={{marginLeft: '-10px'}}><Icon path={mdiCheck} size={'1.0rem'}\n                                                                              color={iconColor}/></ListItemIcon> : null}\n                          <ListItemText\n                            style={visibleMprCoronal ? {marginLeft: '-7px'} : {marginLeft: '40px'}}\n                            classes={primaryClass}\n                            primary={\n                              <Typography\n                                type=\"body1\"\n                                style={{fontSize: '0.80em', marginLeft: '-23px'}}>Coronal</Typography>\n                            }/>\n                        </MenuItem>\n                        <MenuItem button style={{paddingLeft: 40}} onClick={() => this.mprSagittal()}>\n                          {visibleMprSagittal ?\n                            <ListItemIcon style={{marginLeft: '-10px'}}><Icon path={mdiCheck} size={'1.0rem'}\n                                                                              color={iconColor}/></ListItemIcon> : null}\n                          <ListItemText\n                            style={visibleMprSagittal ? {marginLeft: '-7px'} : {marginLeft: '40px'}}\n                            classes={primaryClass}\n                            primary={\n                              <Typography type=\"body1\"\n                                          style={{fontSize: '0.80em', marginLeft: '-23px'}}>Sagittal</Typography>\n                            }/>\n                        </MenuItem>\n                        <MenuItem button style={{paddingLeft: 40}} onClick={() => this.mprAxial()}>\n                          {visibleMprAxial ?\n                            <ListItemIcon style={{marginLeft: '-10px'}}><Icon path={mdiCheck} size={'1.0rem'}\n                                                                              color={iconColor}/></ListItemIcon> : null}\n                          <ListItemText\n                            style={visibleMprAxial ? {marginLeft: '-7px'} : {marginLeft: '40px'}}\n                            classes={primaryClass}\n                            primary={\n                              <Typography type=\"body1\"\n                                          style={{fontSize: '0.80em', marginLeft: '-23px'}}>Axial</Typography>\n                            }/>\n                        </MenuItem>\n                      </MenuList>\n                    </ClickAwayListener>\n                  </Paper>\n                </Grow>\n              )}\n            </Popper>\n\n\n            <Tooltip title={\"Edit\"} placement={\"top\"} arrow>\n              <IconButton\n                button\n                onClick={(event) => this.toggleImageEdit(event)}\n                disabled={!isOpen}\n              >\n                <Icon path={mdiImageEdit} size={iconSize} color={iconColor}/>\n                {openImageEdit ? <ExpandMore/> : <ExpandLess/>}\n              </IconButton>\n            </Tooltip>\n            {/*<Menu*/}\n            {/*  id=\"simple-menu\"*/}\n            {/*  anchorEl={anchorElImageEdit}*/}\n            {/*  keepMounted*/}\n            {/*  open={Boolean(anchorElImageEdit)}*/}\n            {/*  onClose={handleClose}*/}\n            {/*  style={{marginTop:'-31px'}}*/}\n            {/*>*/}\n            {/*  <MenuList style={{backgroundColor:'#6c5c89'}}>*/}\n            {/*  <ClickAwayListener onClickAway={(event) => this.toggleImageEdit(event)}>*/}\n            {/*      <MenuItem button onClick={() => this.toolExecute('Invert')}>*/}\n            {/*        <ListItemIcon><Icon path={mdiInvertColors} size={iconSize} color={iconColor}/></ListItemIcon>*/}\n            {/*        <ListItemText classes={primaryClass} primary=\"Invert\"/>*/}\n            {/*      </MenuItem>*/}\n            {/*  </ClickAwayListener>*/}\n            {/*  </MenuList>*/}\n\n            {/*</Menu>*/}\n            <Popper\n              open={Boolean(anchorElImageEdit)}\n              anchorEl={anchorElImageEdit}\n              role={undefined}\n              transition\n              style={{backgroundColor: '#70c4c5'}}\n              placement={\"top\"}\n            >\n              {({TransitionProps, placement}) => (\n                <Grow\n                  {...TransitionProps}\n                  style={{transformOrigin: placement === 'bottom' ? 'center top' : 'center bottom'}}\n                >\n                  <Paper style={{backgroundColor: '#70c4c5'}}>\n                    <ClickAwayListener onClickAway={(event) => this.toggleImageEdit(event)}>\n                      <MenuList dense={true} component=\"div\" style={{padding: '0'}}>\n                        <MenuItem button onClick={() => this.toolExecute('Invert')}>\n                          <ListItemIcon><Icon path={mdiInvertColors} size={iconSize} color={iconColor}/></ListItemIcon>\n                          <ListItemText classes={primaryClass} primary=\"Invert\"/>\n                        </MenuItem>\n                      </MenuList>\n                    </ClickAwayListener>\n                  </Paper>\n                </Grow>\n              )}\n            </Popper>\n\n            <Divider orientation=\"vertical\" style={{display: 'list-item', backgroundColor: '#fff'}}/>\n\n            <Tooltip title={\"No tool\"} placement={\"top\"} arrow>\n              <IconButton button onClick={() => this.toolExecute('notool')}\n                          disabled={!isOpen}>\n                <Icon path={mdiCursorDefault} size={iconSize} color={iconColor}/>\n              </IconButton>\n            </Tooltip>\n            <Tooltip title={\"WW/WC\"} placement={\"top\"} arrow>\n              <IconButton button onClick={() => this.toolExecute('Wwwc')}\n                          disabled={!isOpen}>\n                <Icon path={mdiArrowAll} size={iconSize} color={iconColor}/>\n              </IconButton>\n            </Tooltip>\n            <Tooltip title={\"Pan\"} placement={\"top\"} arrow>\n              <IconButton button onClick={() => this.toolExecute('Pan')} disabled={!isOpen}>\n                <Icon path={mdiCursorPointer} size={iconSize} color={iconColor}/>\n              </IconButton>\n            </Tooltip>\n            <Tooltip title={\"Zoom\"} placement={\"top\"} arrow>\n              <IconButton button onClick={() => this.toolExecute('Zoom')}\n                          disabled={!isOpen}>\n                <Icon path={mdiMagnify} size={iconSize} color={iconColor}/>\n              </IconButton>\n            </Tooltip>\n            <Tooltip title={\"Magnify\"} placement={\"top\"} arrow>\n              <IconButton button onClick={() => this.toolExecute('Magnify')}\n                          disabled={!isOpen}>\n                <Icon path={mdiCheckboxIntermediate} size={iconSize}\n                      color={iconColor}/>\n              </IconButton>\n            </Tooltip>\n            <Tooltip title={\"Length\"} placement={\"top\"} arrow>\n              <IconButton button onClick={() => this.toolExecute('Length')}\n                          disabled={!isOpen}>\n                <Icon path={mdiRuler} size={iconSize} color={iconColor}/>\n              </IconButton>\n            </Tooltip>\n            <Tooltip title={\"Probe\"} placement={\"top\"} arrow>\n              <IconButton button onClick={() => this.toolExecute('Probe')}\n                          disabled={!isOpen}>\n                <Icon path={mdiEyedropper} size={iconSize} color={iconColor}/>\n              </IconButton>\n            </Tooltip>\n            <Tooltip title={\"Angle\"} placement={\"top\"} arrow>\n              <IconButton button onClick={() => this.toolExecute('Angle')}\n                          disabled={!isOpen}>\n                <Icon path={mdiAngleAcute} size={iconSize} color={iconColor}/>\n              </IconButton>\n            </Tooltip>\n            <Tooltip title={\"Elliptical Roi\"} placement={\"top\"} arrow>\n              <IconButton button onClick={() => this.toolExecute('EllipticalRoi')}\n                          disabled={!isOpen}>\n                <Icon path={mdiEllipse} size={iconSize} color={iconColor}/>\n              </IconButton>\n            </Tooltip>\n            <Tooltip title={\"Rectangle Roi\"} placement={\"top\"} arrow>\n              <IconButton button onClick={() => this.toolExecute('RectangleRoi')}\n                          disabled={!isOpen}>\n                <Icon path={mdiRectangle} size={iconSize} color={iconColor}/>\n              </IconButton>\n            </Tooltip>\n            <Tooltip title={\"Freehand Roi\"} placement={\"top\"} arrow>\n              <IconButton button onClick={() => this.toolExecute('FreehandRoi')}\n                          disabled={!isOpen}>\n                <Icon path={mdiGesture} size={iconSize} color={iconColor}/>\n              </IconButton>\n            </Tooltip>\n\n          </Toolbar>\n          </Card>\n        </Slide>\n        <Drawer\n          variant=\"persistent\"\n          open={visibleSeries}\n          style={{position: 'relative', zIndex: 1}}\n          onClose={this.toggleSeriesMenu}\n        >\n          <div className={classes.toolbar} style={{marginTop: '48px'}}>\n            <List dense={true}>\n              <ListItem button onClick={() => this.toggleSeriesMenu()}>\n                <ListItemIcon><Icon path={mdiArrowLeftCircle} size={iconSize} color={iconColor}/></ListItemIcon>\n                <ListItemText classes={primaryClass} primary='Hide Series'/>\n              </ListItem>\n              <Divider/>\n\n              {/*<SeriesList series={totalSeries}/>*/}\n              {/*} {totalSeries ? totalSeriesView : (<p style={{padding: 0, textAlign: 'center'}}>nothing</p>)}*/}\n              {this.buildLayoutList()}\n            </List>\n          </div>\n        </Drawer>\n        {/*<Drawer*/}\n        {/*  variant=\"persistent\"*/}\n        {/*  open={visibleMainMenu}*/}\n        {/*  style={{position: 'relative', zIndex: 1}}*/}\n        {/*  onClose={this.toggleMainMenu}*/}\n        {/*>*/}\n        {/*  <div className={classes.toolbar}>*/}\n        {/*    <List dense={true}>*/}\n        {/*      <ListItem button onClick={() => this.showAppBar()}>*/}\n        {/*        <ListItemIcon><MenuIcon/></ListItemIcon>*/}\n        {/*        <ListItemText primary='Tool Bar'/>*/}\n        {/*      </ListItem>*/}\n        {/*      <ListItem button onClick={() => this.toggleFileManager()}>*/}\n        {/*        <ListItemIcon><Icon path={mdiFileCabinet} size={iconSize} color={iconColor}/></ListItemIcon>*/}\n        {/*        <ListItemText classes={primaryClass} primary='File Manager'/>*/}\n        {/*      </ListItem>*/}\n\n        {/*      <ListItem button onClick={() => this.toggleOpenMenu()}>*/}\n        {/*        <ListItemIcon><Icon path={mdiFolderMultiple} size={iconSize} color={iconColor}/></ListItemIcon>*/}\n        {/*        <ListItemText classes={primaryClass} primary='Open ...'/>*/}\n        {/*        {openMenu ? <ExpandLess/> : <ExpandMore/>}*/}\n        {/*      </ListItem>*/}\n        {/*      <Collapse in={openMenu} timeout=\"auto\" unmountOnExit>*/}\n        {/*        <List dense={true} component=\"div\">*/}\n        {/*          <ListItem button style={{paddingLeft: 30}} onClick={() => this.showFileOpen()}>*/}\n        {/*            <ListItemIcon><Icon path={mdiFolder} size={'1.0rem'} color={iconColor}/></ListItemIcon>*/}\n        {/*            <ListItemText classes={primaryClass}*/}\n        {/*                          primary={*/}\n        {/*                            <Typography type=\"body1\"*/}\n        {/*                                        style={{fontSize: '0.80em', marginLeft: '-20px'}}>File</Typography>*/}\n        {/*                          }/>*/}\n        {/*          </ListItem>*/}\n        {/*          <ListItem button style={{paddingLeft: 30}} onClick={() => this.showOpenUrl()}>*/}\n        {/*            <ListItemIcon><Icon path={mdiWeb} size={'1.0rem'} color={iconColor}/></ListItemIcon>*/}\n        {/*            <ListItemText classes={primaryClass}*/}\n        {/*                          primary={*/}\n        {/*                            <Typography type=\"body1\"*/}\n        {/*                                        style={{fontSize: '0.80em', marginLeft: '-20px'}}>URL</Typography>*/}\n        {/*                          }/>*/}\n        {/*          </ListItem>*/}\n        {/*          {isInputDirSupported() && !isMobile ?*/}\n        {/*            <ListItem button style={{paddingLeft: 30}} onClick={() => this.showOpenFolder()}>*/}\n        {/*              <ListItemIcon><Icon path={mdiFolderOpen} size={'1.0rem'} color={iconColor}/></ListItemIcon>*/}\n        {/*              <ListItemText classes={primaryClass}*/}\n        {/*                            primary={*/}\n        {/*                              <Typography type=\"body1\"*/}\n        {/*                                          style={{fontSize: '0.80em', marginLeft: '-20px'}}>Folder</Typography>*/}\n        {/*                            }/>*/}\n        {/*            </ListItem>*/}\n        {/*            : null}*/}\n        {/*          {isInputDirSupported() && !isMobile ?*/}\n        {/*            <ListItem button style={{paddingLeft: 30}} onClick={() => this.showOpenDicomdir()}>*/}\n        {/*              <ListItemIcon><Icon path={mdiFolderOpen} size={'1.0rem'} color={iconColor}/></ListItemIcon>*/}\n        {/*              <ListItemText classes={primaryClass}*/}\n        {/*                            primary={*/}\n        {/*                              <Typography type=\"body1\" style={{*/}\n        {/*                                fontSize: '0.80em',*/}\n        {/*                                marginLeft: '-20px'*/}\n        {/*                              }}>DICOMDIR</Typography>*/}\n        {/*                            }/>*/}\n        {/*            </ListItem>*/}\n        {/*            : null}*/}\n        {/*        </List>*/}\n        {/*      </Collapse>*/}\n\n        {/*      <ListItem button onClick={() => this.clear()}>*/}\n        {/*        <ListItemIcon><Icon path={mdiDelete} size={iconSize} color={iconColor}/></ListItemIcon>*/}\n        {/*        <ListItemText classes={primaryClass} primary='Clear All'/>*/}\n        {/*      </ListItem>*/}\n        {/*      <ListItem button onClick={this.handleLayout}>*/}\n        {/*        <ListItemIcon><Icon path={mdiViewGridPlusOutline} size={iconSize} color={iconColor}/></ListItemIcon>*/}\n        {/*        <ListItemText classes={primaryClass} primary='Layout'/>*/}\n        {/*      </ListItem>*/}\n        {/*      <ListItem button onClick={() => this.showSettings()}>*/}\n        {/*        <ListItemIcon><Icon path={mdiSettings} size={iconSize} color={iconColor}/></ListItemIcon>*/}\n        {/*        <ListItemText classes={primaryClass} primary='Settings'/>*/}\n        {/*      </ListItem>*/}\n        {/*      <Divider/>*/}\n        {/*      <ListItem button onClick={() => this.toggleToolbox()} disabled={!isOpen}>*/}\n        {/*        <ListItemIcon><Icon path={mdiChartHistogram} size={iconSize} color={iconColor}/></ListItemIcon>*/}\n        {/*        <ListItemText classes={primaryClass} primary='Histogram'/>*/}\n        {/*      </ListItem>*/}\n        {/*      <ListItem button onClick={() => this.toggleMpr()}*/}\n        {/*                disabled={!isOpen || !isMultipleFiles || this.mprPlane === ''}>*/}\n        {/*        <ListItemIcon><Icon path={mdiAxisArrow} size={iconSize} color={iconColor}/></ListItemIcon>*/}\n        {/*        <ListItemText classes={primaryClass} primary='MPR'/>*/}\n        {/*        {openMpr ? <ExpandLess/> : <ExpandMore/>}*/}\n        {/*      </ListItem>*/}\n        {/*      <Collapse in={openMpr} timeout=\"auto\" unmountOnExit>*/}\n        {/*        <List dense={true} component=\"div\">*/}\n        {/*          <ListItem button style={{paddingLeft: 40}} onClick={() => this.mprOrthogonal()}>*/}\n        {/*            {visibleMprOrthogonal ?*/}\n        {/*              <ListItemIcon style={{marginLeft: '-10px'}}><Icon path={mdiCheck} size={'1.0rem'}*/}\n        {/*                                                                color={iconColor}/></ListItemIcon> : null}*/}\n        {/*            <ListItemText*/}\n        {/*              style={visibleMprOrthogonal ? {marginLeft: '-7px'} : {marginLeft: '40px'}}*/}\n        {/*              classes={primaryClass}*/}\n        {/*              primary={*/}\n        {/*                <Typography type=\"body1\"*/}\n        {/*                            style={{fontSize: '0.80em', marginLeft: '-23px'}}>Orthogonal</Typography>*/}\n        {/*              }/>*/}\n        {/*          </ListItem>*/}\n        {/*          <ListItem button style={{paddingLeft: 40}} onClick={() => this.mprCoronal()}>*/}\n        {/*            {visibleMprCoronal ?*/}\n        {/*              <ListItemIcon style={{marginLeft: '-10px'}}><Icon path={mdiCheck} size={'1.0rem'}*/}\n        {/*                                                                color={iconColor}/></ListItemIcon> : null}*/}\n        {/*            <ListItemText*/}\n        {/*              style={visibleMprCoronal ? {marginLeft: '-7px'} : {marginLeft: '40px'}}*/}\n        {/*              classes={primaryClass}*/}\n        {/*              primary={*/}\n        {/*                <Typography type=\"body1\" style={{fontSize: '0.80em', marginLeft: '-23px'}}>Coronal</Typography>*/}\n        {/*              }/>*/}\n        {/*          </ListItem>*/}\n        {/*          <ListItem button style={{paddingLeft: 40}} onClick={() => this.mprSagittal()}>*/}\n        {/*            {visibleMprSagittal ?*/}\n        {/*              <ListItemIcon style={{marginLeft: '-10px'}}><Icon path={mdiCheck} size={'1.0rem'}*/}\n        {/*                                                                color={iconColor}/></ListItemIcon> : null}*/}\n        {/*            <ListItemText*/}\n        {/*              style={visibleMprSagittal ? {marginLeft: '-7px'} : {marginLeft: '40px'}}*/}\n        {/*              classes={primaryClass}*/}\n        {/*              primary={*/}\n        {/*                <Typography type=\"body1\" style={{fontSize: '0.80em', marginLeft: '-23px'}}>Sagittal</Typography>*/}\n        {/*              }/>*/}\n        {/*          </ListItem>*/}\n        {/*          <ListItem button style={{paddingLeft: 40}} onClick={() => this.mprAxial()}>*/}\n        {/*            {visibleMprAxial ? <ListItemIcon style={{marginLeft: '-10px'}}><Icon path={mdiCheck} size={'1.0rem'}*/}\n        {/*                                                                                 color={iconColor}/></ListItemIcon> : null}*/}\n        {/*            <ListItemText*/}\n        {/*              style={visibleMprAxial ? {marginLeft: '-7px'} : {marginLeft: '40px'}}*/}\n        {/*              classes={primaryClass}*/}\n        {/*              primary={*/}\n        {/*                <Typography type=\"body1\" style={{fontSize: '0.80em', marginLeft: '-23px'}}>Axial</Typography>*/}\n        {/*              }/>*/}\n        {/*          </ListItem>*/}\n        {/*        </List>*/}\n        {/*      </Collapse>*/}\n        {/*      <ListItem button onClick={() => this.toggleImageEdit()} disabled={!isOpen}>*/}\n        {/*        <ListItemIcon><Icon path={mdiImageEdit} size={iconSize} color={iconColor}/></ListItemIcon>*/}\n        {/*        <ListItemText classes={primaryClass} primary='Edit'/>*/}\n        {/*        {openImageEdit ? <ExpandLess/> : <ExpandMore/>}*/}\n        {/*      </ListItem>*/}\n        {/*      <Collapse in={openImageEdit} timeout=\"auto\" unmountOnExit>*/}\n        {/*        <List dense={true} component=\"div\">*/}\n        {/*          <ListItem button style={{paddingLeft: 30}} onClick={() => this.toolExecute('Invert')}>*/}\n        {/*            <ListItemIcon><Icon path={mdiInvertColors} size={iconSize} color={iconColor}/></ListItemIcon>*/}\n        {/*            <ListItemText classes={primaryClass} primary=\"Invert\"/>*/}\n        {/*          </ListItem>*/}\n        {/*        </List>*/}\n        {/*      </Collapse>*/}\n        {/*      <ListItem button onClick={() => this.toggleTools()} disabled={!isOpen}>*/}\n        {/*        <ListItemIcon><Icon path={mdiTools} size={iconSize} color={iconColor}/></ListItemIcon>*/}\n        {/*        <ListItemText classes={primaryClass} primary='Tools'/>*/}\n        {/*        {openTools ? <ExpandLess/> : <ExpandMore/>}*/}\n        {/*      </ListItem>*/}\n        {/*      <Collapse in={openTools} timeout=\"auto\" unmountOnExit>*/}\n        {/*        <List dense={true} component=\"div\">*/}\n        {/*          <ListItem button style={{paddingLeft: 30}} onClick={() => this.toolExecute('notool')}*/}\n        {/*                    disabled={!isOpen}>*/}\n        {/*            <ListItemIcon><Icon path={mdiCursorDefault} size={iconSize} color={iconColor}/></ListItemIcon>*/}\n        {/*            <ListItemText classes={primaryClass} primary='No tool'/>*/}\n        {/*          </ListItem>*/}\n        {/*          <ListItem button style={{paddingLeft: 30}} onClick={() => this.toolExecute('Wwwc')}*/}\n        {/*                    disabled={!isOpen}>*/}\n        {/*            <ListItemIcon><Icon path={mdiArrowAll} size={iconSize} color={iconColor}/></ListItemIcon>*/}\n        {/*            <ListItemText classes={primaryClass} primary='WW/WC'/>*/}\n        {/*          </ListItem>*/}\n        {/*          <ListItem button style={{paddingLeft: 30}} onClick={() => this.toolExecute('Pan')} disabled={!isOpen}>*/}\n        {/*            <ListItemIcon><Icon path={mdiCursorPointer} size={iconSize} color={iconColor}/></ListItemIcon>*/}\n        {/*            <ListItemText classes={primaryClass} primary='Pan'/>*/}\n        {/*          </ListItem>*/}\n        {/*          <ListItem button style={{paddingLeft: 30}} onClick={() => this.toolExecute('Zoom')}*/}\n        {/*                    disabled={!isOpen}>*/}\n        {/*            <ListItemIcon><Icon path={mdiMagnify} size={iconSize} color={iconColor}/></ListItemIcon>*/}\n        {/*            <ListItemText classes={primaryClass} primary='Zoom'/>*/}\n        {/*          </ListItem>*/}\n        {/*          <ListItem button style={{paddingLeft: 30}} onClick={() => this.toolExecute('Magnify')}*/}\n        {/*                    disabled={!isOpen}>*/}\n        {/*            <ListItemIcon><Icon path={mdiCheckboxIntermediate} size={iconSize}*/}\n        {/*                                color={iconColor}/></ListItemIcon>*/}\n        {/*            <ListItemText classes={primaryClass} primary='Magnify'/>*/}\n        {/*          </ListItem>*/}\n        {/*          <ListItem button style={{paddingLeft: 30}} onClick={() => this.toolExecute('Length')}*/}\n        {/*                    disabled={!isOpen}>*/}\n        {/*            <ListItemIcon><Icon path={mdiRuler} size={iconSize} color={iconColor}/></ListItemIcon>*/}\n        {/*            <ListItemText classes={primaryClass} primary='Length'/>*/}\n        {/*          </ListItem>*/}\n        {/*          <ListItem button style={{paddingLeft: 30}} onClick={() => this.toolExecute('Probe')}*/}\n        {/*                    disabled={!isOpen}>*/}\n        {/*            <ListItemIcon><Icon path={mdiEyedropper} size={iconSize} color={iconColor}/></ListItemIcon>*/}\n        {/*            <ListItemText classes={primaryClass} primary='Probe'/>*/}\n        {/*          </ListItem>*/}\n        {/*          <ListItem button style={{paddingLeft: 30}} onClick={() => this.toolExecute('Angle')}*/}\n        {/*                    disabled={!isOpen}>*/}\n        {/*            <ListItemIcon><Icon path={mdiAngleAcute} size={iconSize} color={iconColor}/></ListItemIcon>*/}\n        {/*            <ListItemText classes={primaryClass} primary='Angle'/>*/}\n        {/*          </ListItem>*/}\n        {/*          <ListItem button style={{paddingLeft: 30}} onClick={() => this.toolExecute('EllipticalRoi')}*/}\n        {/*                    disabled={!isOpen}>*/}\n        {/*            <ListItemIcon><Icon path={mdiEllipse} size={iconSize} color={iconColor}/></ListItemIcon>*/}\n        {/*            <ListItemText classes={primaryClass} primary='Elliptical Roi'/>*/}\n        {/*          </ListItem>*/}\n        {/*          <ListItem button style={{paddingLeft: 30}} onClick={() => this.toolExecute('RectangleRoi')}*/}\n        {/*                    disabled={!isOpen}>*/}\n        {/*            <ListItemIcon><Icon path={mdiRectangle} size={iconSize} color={iconColor}/></ListItemIcon>*/}\n        {/*            <ListItemText classes={primaryClass} primary='Rectangle Roi'/>*/}\n        {/*          </ListItem>*/}\n        {/*          <ListItem button style={{paddingLeft: 30}} onClick={() => this.toolExecute('FreehandRoi')}*/}\n        {/*                    disabled={!isOpen}>*/}\n        {/*            <ListItemIcon><Icon path={mdiGesture} size={iconSize} color={iconColor}/></ListItemIcon>*/}\n        {/*            <ListItemText classes={primaryClass} primary='Freehand Roi'/>*/}\n        {/*          </ListItem>*/}\n        {/*        </List>*/}\n        {/*      </Collapse>*/}\n\n        {/*    </List>*/}\n\n        {/*    {isMultipleFiles ?*/}\n        {/*      <div>*/}\n        {/*        <Divider/>*/}\n        {/*        <div align='center'>*/}\n        {/*          <IconButton onClick={this.listOpenFilesFirstFrame} size='small'>*/}\n        {/*            <Icon path={mdiSkipBackward} size={'1.0rem'} color={iconColor}/>*/}\n        {/*          </IconButton>*/}\n        {/*          <IconButton onClick={this.listOpenFilesPreviousFrame} size='small'>*/}\n        {/*            <Icon path={mdiSkipPrevious} size={'1.0rem'} color={iconColor}/>*/}\n        {/*          </IconButton>*/}\n        {/*          <IconButton onClick={this.listOpenFilesScrolling} size='small'>*/}\n        {/*            <Icon path={this.state.listOpenFilesScrolling ? mdiPause : mdiPlay} size={'1.0rem'}*/}\n        {/*                  color={iconColor}/>*/}\n        {/*          </IconButton>*/}\n        {/*          <IconButton onClick={this.listOpenFilesNextFrame} size='small'>*/}\n        {/*            <Icon path={mdiSkipNext} size={'1.0rem'} color={iconColor}/>*/}\n        {/*          </IconButton>*/}\n        {/*          <IconButton onClick={this.listOpenFilesLastFrame} size='small'>*/}\n        {/*            <Icon path={mdiSkipForward} size={'1.0rem'} color={iconColor}/>*/}\n        {/*          </IconButton>*/}\n        {/*        </div>*/}\n        {/*        <div style={{textAlign: 'center'}}>*/}\n        {/*          <Typography type=\"body1\"*/}\n        {/*                      style={{fontSize: '0.80em'}}>{`${this.state.sliceIndex + 1} / ${sliceMax}`}</Typography>*/}\n        {/*        </div>*/}\n        {/*        <div style={{width: '130px', margin: 'auto'}}>*/}\n        {/*          <Slider*/}\n        {/*            style={{marginTop: '-4px'}}*/}\n        {/*            value={this.state.sliceIndex}*/}\n        {/*            onChange={this.handleSliceChange}*/}\n        {/*            color=\"secondary\"*/}\n        {/*            min={0}*/}\n        {/*            max={sliceMax - 1}*/}\n        {/*            step={100 / sliceMax}*/}\n        {/*          />*/}\n        {/*        </div>*/}\n        {/*      </div> : null*/}\n        {/*    }*/}\n\n        {/*  </div>*/}\n        {/*</Drawer>*/}\n\n        <Drawer\n          variant=\"persistent\"\n          anchor='right'\n          open={visibleHeader}\n          onClose={this.toggleHeader}\n        >\n          {visibleHeader ? <DicomHeader dcmViewer={dcmViewer} classes={classes} color={iconColor}/> : null}\n        </Drawer>\n\n        <Drawer\n          variant=\"persistent\"\n          anchor='right'\n          open={visibleMeasure}\n          onClose={this.toggleMeasure}\n        >\n          <div style={{marginTop: '48px'}}>\n            <Toolbar variant=\"dense\">\n              <Typography variant=\"subtitle1\" className={classes.title}>\n                Measurements&nbsp;&nbsp;\n              </Typography>\n              <div className={classes.grow}/>\n              <IconButton color=\"inherit\" onClick={this.saveMeasure} edge=\"end\">\n                <Icon path={mdiContentSaveOutline} size={iconSize} color={iconColor}/>\n              </IconButton>\n              <IconButton color=\"inherit\" onClick={this.clearMeasure} edge=\"end\">\n                <Icon path={mdiTrashCanOutline} size={iconSize} color={iconColor}/>\n              </IconButton>\n            </Toolbar>\n            <div>\n              {isOpen ? <Measurements dcmViewer={dcmViewer} toolRemove={this.toolRemove} classes={classes}/> : null}\n            </div>\n          </div>\n        </Drawer>\n\n        <Drawer\n          variant=\"persistent\"\n          anchor='right'\n          open={visibleToolbox}\n          onClose={this.toggleToolbox}\n        >\n          <div style={{marginTop: '48px'}}>\n            <div>\n              {isOpen ? <Histogram key={this.getFileName(dcmViewer)}/> : null}\n            </div>\n          </div>\n        </Drawer>\n\n        <Drawer\n          variant=\"persistent\"\n          anchor={getSettingsDicomdirView()}\n          open={visibleDicomdir}\n          onClose={this.toggleDicomdir}\n        >\n          <div>\n            <div>\n              {visibleDicomdir ?\n                <Dicomdir onOpenFile={this.handleOpenFileDicomdir} onOpenFs={this.handleOpenSandboxFs}/> : null}\n            </div>\n          </div>\n        </Drawer>\n\n        <Drawer\n          variant=\"persistent\"\n          anchor={getSettingsFsView()}\n          open={visibleFileManager}\n          onClose={this.toggleFileManager}\n        >\n          <div>\n            <div>\n              {visibleFileManager ?\n                <FsUI\n                  onOpen={this.handleOpenSandboxFs}\n                  onOpenImage={this.handleOpenImage}\n                  onOpenMultipleFilesCompleted={this.openMultipleFilesCompleted}\n                  onOpenDicomdir={this.handleOpenFsDicomdir}\n                  color={iconColor}\n                />\n                : null}\n            </div>\n          </div>\n        </Drawer>\n\n        {visibleSettings ? <Settings onClose={this.hideSettings}/> : null}\n\n        {visibleAbout ? <AboutDlg onClose={this.showAbout}/> : null}\n\n        {visibleDownloadZipDlg ? <DownloadZipDlg onClose={this.hideDownloadZipDlg} url={this.url}/> : null}\n\n        {visibleOpenMultipleFilesDlg ?\n          <OpenMultipleFilesDlg\n            onClose={this.hideOpenMultipleFilesDlg}\n            files={this.files}\n            origin={'local'}\n          /> : null}\n\n        <Dialog\n          open={visibleClearMeasureDlg}\n          onClose={this.hideClearMeasureDlg}\n        >\n          <DialogTitle>{\"Are you sure to remove all the measurements?\"}</DialogTitle>\n          <DialogActions>\n            <Button onClick={this.hideClearMeasureDlg}>\n              Cancel\n            </Button>\n            <Button onClick={this.confirmClearMeasureDlg} autoFocus>\n              Ok\n            </Button>\n          </DialogActions>\n        </Dialog>\n\n        <Dialog\n          open={visibleZippedFileDlg}\n          onClose={this.hideZippedFileDlg}\n        >\n          <DialogTitle>{\"This is a zipped file, would you import into sandbox file system?\"}</DialogTitle>\n          <DialogActions>\n            <Button onClick={this.hideZippedFileDlg}>\n              Cancel\n            </Button>\n            <Button onClick={this.confirmZippedFileDlg} autoFocus>\n              Ok\n            </Button>\n          </DialogActions>\n        </Dialog>\n\n        <Dialog\n          open={this.state.visibleOpenUrl}\n          aria-labelledby=\"form-dialog-title\"\n        >\n          <DialogTitle id=\"form-dialog-title\">{\"Open URL\"}</DialogTitle>\n          <DialogContent>\n            <DialogContentText id=\"alert-dialog-description\">\n              Insert an URL to download a DICOM or image file:\n            </DialogContentText>\n            <TextField\n              autoFocus\n              margin=\"dense\"\n              id=\"id-open-url\"\n              inputRef={input => (this.openUrlField = input)}\n              fullWidth\n            />\n          </DialogContent>\n          <DialogActions>\n            <Button onClick={() => this.hideOpenUrl(false)}>\n              Cancel\n            </Button>\n            <Button onClick={() => this.hideOpenUrl(true)} autoFocus>\n              Ok\n            </Button>\n          </DialogActions>\n        </Dialog>\n\n        {/*<Popover*/}\n        {/*  id={'id-layout'}*/}\n        {/*  open={visibleLayout}*/}\n        {/*  anchorEl={this.state.anchorElLayout}*/}\n        {/*  onClose={this.closeLayout}*/}\n        {/*  anchorOrigin={{*/}\n        {/*    vertical: 'center',*/}\n        {/*    horizontal: 'bottom',*/}\n        {/*  }}*/}\n        {/*  transformOrigin={{*/}\n        {/*    vertical: 'bottom',*/}\n        {/*    horizontal: 'left',*/}\n        {/*  }}*/}\n        {/*>*/}\n        {/*  <LayoutTool*/}\n        {/*    row={this.props.layout[0] - 1}*/}\n        {/*    col={this.props.layout[1] - 1}*/}\n        {/*    onChange={this.changeLayout}*/}\n        {/*  />*/}\n        {/*</Popover>*/}\n\n        <Snackbar\n          anchorOrigin={{\n            vertical: 'top',\n            horizontal: 'center',\n          }}\n          open={visibleVolumeBuilding}\n          autoHideDuration={6000}\n          message=\"Volume building, wait please ...\"\n        />\n\n        <Grid container>\n          <Grid item xs={2}>\n          <Slide direction=\"right\" in={this.state.visibleExplorer} mountOnEnter unmountOnExit>\n            <div className={classes.rootGridList}>\n              {/*<div style={{height: '100%', backgroundColor: '#e4e5e655'}}>*/}\n              <GridList cellHeight={180} className={classes.gridList}>\n                {/*<GridListTile key=\"Subheader\" cols={1} style={{height: 'auto', width:'100%'}}>\n                  <ListSubheader component=\"div\">Series List:</ListSubheader>\n                </GridListTile>*/}\n\n                {this.state.totalSeries ? this.state.totalSeries.map((tile, index) => (\n                  <GridListTile\n                    key={index}\n                    cols={1}\n                    style={{height: 'auto', width:'100%', padding:\"16px\"}}\n                    button onClick={() => this.layoutListClick(index)}\n                  >\n                    <row style={{width: '100%'}}>\n                      <SeriesItem image={tile ? tile.images[0] : null}/>\n                    </row>\n                    <GridListTileBar\n                    style={{height:'48px'}}\n                      subtitle={`series number: ${tile ? tile.seriesNumber : \"{ts.seriesNumber}\"}`}\n                      title={<span style={{fontSize:'10px'}}>number of items: {tile.files.length}</span>}\n                      // actionIcon={\n                      //   <IconButton aria-label={`info about ${tile.seriesNumber}`} className={classes.icon}>\n                      //     <InfoIcon/>\n                      //   </IconButton>\n                      // }\n                    />\n                  </GridListTile>\n                )) : null}\n                <GridListTile key=\"Subheader\" cols={1} style={{height: '54px', width:'100%'}}>\n                </GridListTile>\n              </GridList>\n              {this.buildLayoutList()}\n            </div>\n            </Slide>\n          </Grid>\n          <Grid item xs={10}>\n            <div style={{height: 'calc(100vh - 48px)'}}>\n              {this.buildLayoutGrid()}\n            </div>\n          </Grid>\n        </Grid>\n\n\n        <div>\n          <input\n            type=\"file\"\n            id=\"file_open\"\n            style={{display: \"none\"}}\n            ref={this.fileOpen}\n            onChange={e => this.handleOpenLocalFs(e.target.files)}\n            multiple\n          />\n        </div>\n\n        <div>\n          <input\n            type=\"file\"\n            id=\"file_dicomdir\"\n            style={{display: \"none\"}}\n            ref={this.openDicomdir}\n            onChange={e => this.handleOpenDicomdir(e.target.files)}\n            webkitdirectory=\"\" mozdirectory=\"\" directory=\"\" multiple\n          />\n        </div>\n\n        <div>\n          <input\n            type=\"file\"\n            id=\"file_folder\"\n            style={{display: \"none\"}}\n            ref={this.openFolder}\n            onChange={e => this.handleOpenFolder(e.target.files)}\n            webkitdirectory=\"\" mozdirectory=\"\" directory=\"\" multiple\n          />\n        </div>\n\n      </div>\n    )\n  }\n}\n\nconst mapStateToProps = (state) => {\n  return {\n    localFileStore: state.localFileStore,\n    files: state.files,\n    isOpen: state.isOpen,\n    tool: state.tool,\n    activeDcmIndex: state.activeDcmIndex,\n    measurements: state.measurements,\n    layout: state.layout,\n    dicomdir: state.dicomdir,\n    fsZippedFile: state.fsZippedFile,\n  }\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    clearingStore: () => dispatch(clearStore()),\n    setLocalFileStore: (file) => dispatch(localFileStore(file)),\n    toolStore: (tool) => dispatch(dcmTool(tool)),\n    isOpenStore: (value) => dispatch(dcmIsOpen(value)),\n    setActiveDcm: (dcm) => dispatch(activeDcm(dcm)),\n    setActiveDcmIndex: (index) => dispatch(activeDcmIndex(index)),\n    setActiveMeasurements: (measurements) => dispatch(activeMeasurements(measurements)),\n    setLayoutStore: (row, col) => dispatch(setLayout(row, col)),\n    setDicomdirStore: (dicomdir) => dispatch(setDicomdir(dicomdir)),\n    setFsZippedFile: (file) => dispatch(setZippedFile(file)),\n    setVolumeStore: (file) => dispatch(setVolume(file)),\n    setFilesStore: (files) => dispatch(filesStore(files)),\n  }\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(withStyles(styles)(App))\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import {createStore} from 'redux'\nimport storeReducer from '../reducers/index'\n\nlet initialState = {\n    localFile: null,\n    fsFile: null,\n    files: null,\n    isOpen: new Array(16).fill(false),\n    tool: null,\n    activeDcmIndex: 0,\n    activeDcm: null,\n    //images: [],\n    measurements: [],\n    layout: [1,1], // first element represents the rows, second the columns\n    dicomdir: null,\n    fsCurrentDir: '',\n    fsCurrentList: [],\n    fsZippedFile: null,\n    fsRefresh: false,\n    volume: null,\n    //lut: null,\n    //sandboxedFile: null,\n}\n\nconst store = createStore(storeReducer, initialState,\n    window.__REDUX_DEVTOOLS_EXTENSION__ && window.__REDUX_DEVTOOLS_EXTENSION__())\n\nexport default store\n","import {\n  CLEAR_STORE, \n  LOCALFILE_STORE,\n  FSFILE_STORE,\n  FILES_STORE,\n  DCM_IS_OPEN, \n  DCM_TOOL, \n  ACTIVE_DCM_INDEX, \n  ACTIVE_DCM, \n  //DCM_IMAGE,\n  ACTIVE_MEASUREMENTS,\n  LAYOUT,\n  DICOMDIR,\n  FSCURRENTDIR,\n  FSCURRENTLIST,\n  FSZIPPEDFILE,\n  FSREFRESH,\n  VOLUME_STORE,\n  //LUT_STORE,\n  //SANDBOXEDFILE_STORE,\n} from '../actions'\n\nexport default function storeReducer(state={}, action) {\n    //console.log('storeReducer: ', action)\n    switch(action.type) {\n      \n      case CLEAR_STORE:\n        return {\n          localFile: state.localFile,\n          fsFile: state.fsFile,\n          files: null, \n          isOpen: state.isOpen.map((el, i) => i === state.activeDcmIndex ? false : el),\n          tool: null,\n          activeDcmIndex: state.activeDcmIndex,\n          activeDcm: state.activeDcm,\n          //images: [],\n          measurements: null,\n          layout: state.layout,\n          dicomdir: state.dicomdir, \n          fsCurrentDir: state.fsCurrentDir,\n          fsCurrentList: state.fsCurrentList,\n          fsZippedFile: null,\n          fsRefresh: state.fsRefresh,\n          //sandboxedFile: state.sandboxedFile,\n          volume: null,\n          lut: null,\n        };\n\n      case LOCALFILE_STORE:\n          return {\n            ...state,\n            localFile: action.localFile,     \n            fsFile: null,   \n          };\n\n      case FSFILE_STORE:\n          return {\n            ...state,\n            localFile: null,     \n            fsFile: action.fsFile,   \n          };\n\n      case FILES_STORE:\n          return {\n            ...state,\n            files: action.files,  \n          };\n\n      case DCM_IS_OPEN:\n          return {\n            ...state,\n            isOpen: state.isOpen.map((el, i) => i === action.value.index ? action.value.value : el),\n            /*images: [\n              ...state.images\n            ],*/            \n            measurements: state.measurements,\n            layout: state.layout,    \n            dicomdir: state.dicomdir,    \n            fsCurrentDir: state.fsCurrentDir,\n            fsCurrentList: state.fsCurrentList,            \n          };\n\n      case DCM_TOOL:\n          return {\n            ...state,\n            tool: action.tool,\n            /*images: [\n              ...state.images\n            ],*/  \n            measurements: state.measurements,\n            layout: state.layout,\n            dicomdir: state.dicomdir,\n            fsCurrentDir: state.fsCurrentDir,\n            fsCurrentList: state.fsCurrentList,  \n          };\n\n      case ACTIVE_DCM_INDEX:\n          return {\n            ...state,\n            activeDcmIndex: action.activeDcmIndex,\n            /*images: [\n              ...state.images\n            ],*/  \n            measurements: state.measurements,\n            layout: state.layout,\n            dicomdir: state.dicomdir,\n            fsCurrentDir: state.fsCurrentDir,\n            fsCurrentList: state.fsCurrentList,  \n          };\n\n      case ACTIVE_DCM:\n          return {\n            ...state,\n            activeDcm: action.activeDcm,\n            /*images: [\n              ...state.images\n            ],*/  \n            measurements: state.measurements,\n            layout: state.layout,\n            dicomdir: state.dicomdir,\n            fsCurrentDir: state.fsCurrentDir,\n            fsCurrentList: state.fsCurrentList,  \n          };\n/*\n      case DCM_IMAGE:\n          return {\n            ...state,\n            images: [\n              ...state.images,\n              action.images,\n            ],  \n            measurements: state.measurements,\n            layout: state.layout,\n            dicomdir: state.dicomdir,\n            fsCurrentDir: state.fsCurrentDir,\n            fsCurrentList: state.fsCurrentList,  \n          } \n*/\n      case ACTIVE_MEASUREMENTS:\n        return {\n          ...state,\n          measurements: [...action.measurements],\n        };\n\n      case LAYOUT:\n            return {\n              ...state,\n              //images: [...state.images],\n              measurements: state.measurements,\n              layout: action.layout,\n              dicomdir: state.dicomdir,\n              fsCurrentDir: state.fsCurrentDir,\n              fsCurrentList: state.fsCurrentList,  \n            };\n\n      case DICOMDIR:\n            return {\n              ...state,\n              dicomdir: action.dicomdir\n            };\n\n      case FSCURRENTDIR:\n            return {\n              ...state,\n              fsCurrentDir: action.fsCurrentDir\n            };\n\n      case FSCURRENTLIST:\n            return {\n              ...state,\n              fsCurrentList: [...action.fsCurrentList]\n            };\n\n      case FSZIPPEDFILE:\n            return {\n              ...state,\n              fsZippedFile: action.fsZippedFile\n            };\n\n      case FSREFRESH:\n            return {\n              ...state,\n              fsRefresh: !state.fsRefresh\n            };\n\n      case VOLUME_STORE:\n        return {\n          ...state,\n          volume: action.volume,        \n        };\n/*\n      case LUT_STORE:\n        return {\n          ...state,\n          lut: action.lut,        \n        }                  \n\n      case SANDBOXEDFILE_STORE:\n        return {\n          ...state,\n          //localfile: null,\n          sandboxedFile: action.sandboxedFile,        \n        } \n*/\n      default:\n          return state\n    }\n  }\n  ","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport App from './App'\nimport * as serviceWorker from './serviceWorker'\nimport WebFontLoader from 'webfontloader'\nimport {Provider} from 'react-redux'\nimport store from './store'\nimport { MuiThemeProvider, createMuiTheme } from '@material-ui/core/styles'\n\nWebFontLoader.load({\n    google: {\n        families: ['Roboto:300,400,500,700', 'Material Icons'],\n    },\n})\n\n//store.subscribe(() => console.log('store updated:', store.getState()));\n\nconst theme = createMuiTheme({\n    overrides: {\n        MuiFormControlLabel: {\n            label: {\n                fontSize: '0.85em'\n            },\n        },\n        MuiFormLabel: {\n            root: { \n                '&$focused': {\n                    color:'#CCCCCC',\n                },   \n            }\n         \n        }\n    },\n    palette: {\n        primary: {\n            main: '#004d40',\n        },\n        secondary: {\n            main: '#888888',\n        },\n        type: 'dark',\n    },\n  })\n\n  \nReactDOM.render(\n    <Provider store={store}>\n        <MuiThemeProvider theme = { theme }>\n            <App />\n        </MuiThemeProvider>\n    </Provider>, \n    document.getElementById('root')\n)\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.register()\n "],"sourceRoot":""}