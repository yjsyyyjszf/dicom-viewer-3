{"ast":null,"code":"import { isAndroid, isFirefox, isMobile, isTablet } from 'react-device-detect';\nimport { SETTINGS_SAVEAS, SETTINGS_SAVEINTO, SETTINGS_DCMHEADER, SETTINGS_OVERLAY, SETTINGS_MEASUREMENT, SETTINGS_FSVIEW, SETTINGS_DICOMDIRVIEW, SETTINGS_MPRINTERPOLATION } from './constants/settings';\nexport function getPixelSpacing(image, index) {\n  const value = image.data.string('x00280030');\n\n  if (value === undefined) {\n    return;\n  }\n\n  const pixelSpacing = value.split('\\\\');\n  return pixelSpacing[index];\n}\nexport function getSpacingBetweenSlice(image) {\n  const value = image.data.string('x00180088');\n\n  if (value === undefined) {\n    return;\n  }\n\n  return parseFloat(value);\n}\nexport function getSliceThickness(image) {\n  const value = image.data.string('x00180050');\n\n  if (value === undefined) {\n    return;\n  }\n\n  return parseFloat(value);\n}\nexport function getSliceLocation(image) {\n  const value = image.data.string('x00201041');\n\n  if (value === undefined) {\n    return;\n  }\n\n  return parseFloat(value);\n}\nexport function capitalize(str) {\n  if (str === undefined) return '';else return str.charAt(0).toUpperCase() + str.slice(1);\n} // To see the console output set the key 'debug-u-dicom-viewer' in \n// 'Storage->Local Storage' panel of your browser Develop Tool\n\nexport function log() {\n  let log = localStorage.getItem('debug-u-dicom-viewer');\n\n  if (log === null) {\n    console.log = function () {};\n  }\n}\nexport function isInputDirSupported() {\n  var tmpInput = document.createElement('input');\n  if ('webkitdirectory' in tmpInput || 'mozdirectory' in tmpInput || 'odirectory' in tmpInput || 'msdirectory' in tmpInput || 'directory' in tmpInput) return true;\n  return false;\n}\nexport function isUrlImage(url) {\n  if (url === undefined || url === null) return false;\n  return url.match(/\\.(jpeg|jpg|png)$/) != null;\n}\nexport function isFileImage(file) {\n  if (file === undefined || file === null) return false;\n  const acceptedImageTypes = ['image/jpeg', 'image/png']; // 'image/gif', \n\n  return file && acceptedImageTypes.includes(file['type']);\n}\nexport function isFsFileImage(fsItem) {\n  console.log('isFsFileImage: ', fsItem);\n  if (fsItem === undefined || fsItem === null) return false;\n  return fsItem.type.toLowerCase() === 'jpeg' || fsItem.type.toLowerCase() === 'png';\n}\nexport function getFileNameCorrect(filename) {\n  if (isAndroid && isFirefox) {\n    // possible uncorrect .null extension is found in Android Firefox, it's a bug? CHECK IT\n    const ext = getFileExt(filename);\n\n    if (ext === 'null') {\n      return getFileName(filename);\n    }\n  }\n\n  return filename;\n}\nexport function getFileExt(file) {\n  const re = /(?:\\.([^.]+))?$/;\n  const ext = re.exec(file)[1];\n\n  if (ext === undefined) {\n    return 'dcm';\n  }\n\n  return ext;\n}\nexport function getFileExtReal(file) {\n  const re = /(?:\\.([^.]+))?$/;\n  const ext = re.exec(file)[1];\n\n  if (ext === undefined) {\n    return '';\n  }\n\n  return ext;\n}\nexport function getFileName(file) {\n  const name = file.replace(/\\.[^.$]+$/, '');\n\n  if (name === undefined) {\n    return '';\n  }\n\n  return name;\n}\nexport function formatBytes(bytes, decimals = 2) {\n  if (bytes === '') return '';\n  if (bytes === 0) return '0 Bytes';\n  const k = 1024;\n  const dm = decimals < 0 ? 0 : decimals;\n  const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];\n}\nexport function getSettingsSaveAs() {\n  let saveAs = localStorage.getItem(SETTINGS_SAVEAS);\n\n  if (saveAs === null) {\n    saveAs = \"png\";\n    localStorage.setItem(SETTINGS_SAVEAS, saveAs);\n  }\n\n  return saveAs;\n}\nexport function setSettingsSaveAs(value) {\n  localStorage.setItem(SETTINGS_SAVEAS, value);\n}\nexport function getSettingsSaveInto() {\n  let saveInto = localStorage.getItem(SETTINGS_SAVEINTO);\n\n  if (saveInto === null) {\n    saveInto = \"local\";\n    localStorage.setItem(SETTINGS_SAVEINTO, saveInto);\n  }\n\n  return saveInto;\n}\nexport function setSettingsSaveInto(value) {\n  localStorage.setItem(SETTINGS_SAVEINTO, value);\n}\nexport function getSettingsDcmHeader() {\n  let exportAs = localStorage.getItem(SETTINGS_DCMHEADER);\n\n  if (exportAs === null) {\n    exportAs = \"json\";\n    localStorage.setItem(SETTINGS_DCMHEADER, exportAs);\n  }\n\n  return exportAs;\n}\nexport function setSettingsDcmHeader(value) {\n  localStorage.setItem(SETTINGS_DCMHEADER, value);\n}\nexport function getSettingsOverlay() {\n  let overlay = localStorage.getItem(SETTINGS_OVERLAY);\n\n  if (overlay === null) {\n    overlay = \"1\";\n    localStorage.setItem(SETTINGS_OVERLAY, overlay);\n  }\n\n  return overlay === '1';\n}\nexport function setSettingsOverlay(value) {\n  localStorage.setItem(SETTINGS_OVERLAY, value ? '1' : '0');\n}\nexport function getSettingsMeasurement() {\n  let measurement = localStorage.getItem(SETTINGS_MEASUREMENT);\n\n  if (measurement === null) {\n    measurement = '1';\n    localStorage.setItem(SETTINGS_MEASUREMENT, measurement);\n  }\n\n  return measurement;\n}\nexport function setSettingsMeasurement(value) {\n  localStorage.setItem(SETTINGS_MEASUREMENT, value);\n}\nexport function getSettingsFsView() {\n  let view = localStorage.getItem(SETTINGS_FSVIEW);\n\n  if (view === null) {\n    view = isMobile && !isTablet ? 'bottom' : 'right';\n    localStorage.setItem(SETTINGS_FSVIEW, view);\n  }\n\n  return view;\n}\nexport function setSettingsFsView(value) {\n  localStorage.setItem(SETTINGS_FSVIEW, value);\n}\nexport function getSettingsDicomdirView() {\n  let view = localStorage.getItem(SETTINGS_DICOMDIRVIEW);\n\n  if (view === null) {\n    view = isMobile && !isTablet ? 'bottom' : 'right';\n    localStorage.setItem(SETTINGS_DICOMDIRVIEW, view);\n  }\n\n  return view;\n}\nexport function setSettingsDicomdirView(value) {\n  localStorage.setItem(SETTINGS_DICOMDIRVIEW, value);\n}\nexport function getSettingsMprInterpolation() {\n  let method = localStorage.getItem(SETTINGS_MPRINTERPOLATION);\n\n  if (method === null) {\n    method = 'weightedlinear';\n    localStorage.setItem(SETTINGS_MPRINTERPOLATION, method);\n  }\n\n  return method;\n}\nexport function setSettingsMprInterpolation(value) {\n  localStorage.setItem(SETTINGS_MPRINTERPOLATION, value);\n}\n/**\n * Converts a value to a string appropriate for entry into a CSV table.  E.g., a string value will be surrounded by quotes.\n * @param {string|number|object} theValue\n */\n\nfunction toCsvValue(theValue) {\n  let t = typeof theValue,\n      output;\n  let sDelimiter = '\"';\n\n  if (t === 'undefined' || t === null) {\n    output = '';\n  } else if (t === 'string') {\n    output = sDelimiter + theValue.replace(/\"/g, '\"\"') + sDelimiter;\n  } else {\n    output = sDelimiter + String(theValue).replace(/\"/g, '\"\"') + sDelimiter;\n  }\n\n  return output;\n}\n/**\n * Converts an array of objects (with identical schemas) into a CSV table.\n * @param {Array} objArray An array of objects.  Each object in the array must have the same property list.\n * @param {string} cDelimiter The column delimiter.  Defaults to a comma (,) if omitted.\n * @return {string} The CSV equivalent of objArray.\n */\n\n\nexport function toCsv(objArray, cDelimiter) {\n  var i,\n      l,\n      names = [],\n      name,\n      value,\n      obj,\n      row,\n      output = '',\n      n,\n      nl; // Initialize default parameters.\n\n  let sDelimiter = '\"';\n\n  if (typeof cDelimiter === 'undefined' || cDelimiter === null) {\n    cDelimiter = ',';\n  }\n\n  for (i = 0, l = objArray.length; i < l; i += 1) {\n    // Get the names of the properties.\n    obj = objArray[i];\n    row = '';\n\n    if (i === 0) {\n      // Loop through the names\n      for (name in obj) {\n        if (obj.hasOwnProperty(name)) {\n          names.push(name);\n          row += [sDelimiter, name.replace(/\"/g, '\"\"'), sDelimiter, cDelimiter].join('');\n        }\n      }\n\n      row = row.substring(0, row.length - 1);\n      output += row;\n    }\n\n    output += '\\n';\n    row = '';\n\n    for (n = 0, nl = names.length; n < nl; n += 1) {\n      name = names[n];\n      value = obj[name];\n\n      if (n > 0) {\n        row += cDelimiter;\n      }\n\n      row += toCsvValue(value);\n    }\n\n    output += row;\n  }\n\n  return output;\n}","map":{"version":3,"sources":["/media/mohammad/work/websites/cornerstone/dicom-viewer/src/functions.js"],"names":["isAndroid","isFirefox","isMobile","isTablet","SETTINGS_SAVEAS","SETTINGS_SAVEINTO","SETTINGS_DCMHEADER","SETTINGS_OVERLAY","SETTINGS_MEASUREMENT","SETTINGS_FSVIEW","SETTINGS_DICOMDIRVIEW","SETTINGS_MPRINTERPOLATION","getPixelSpacing","image","index","value","data","string","undefined","pixelSpacing","split","getSpacingBetweenSlice","parseFloat","getSliceThickness","getSliceLocation","capitalize","str","charAt","toUpperCase","slice","log","localStorage","getItem","console","isInputDirSupported","tmpInput","document","createElement","isUrlImage","url","match","isFileImage","file","acceptedImageTypes","includes","isFsFileImage","fsItem","type","toLowerCase","getFileNameCorrect","filename","ext","getFileExt","getFileName","re","exec","getFileExtReal","name","replace","formatBytes","bytes","decimals","k","dm","sizes","i","Math","floor","pow","toFixed","getSettingsSaveAs","saveAs","setItem","setSettingsSaveAs","getSettingsSaveInto","saveInto","setSettingsSaveInto","getSettingsDcmHeader","exportAs","setSettingsDcmHeader","getSettingsOverlay","overlay","setSettingsOverlay","getSettingsMeasurement","measurement","setSettingsMeasurement","getSettingsFsView","view","setSettingsFsView","getSettingsDicomdirView","setSettingsDicomdirView","getSettingsMprInterpolation","method","setSettingsMprInterpolation","toCsvValue","theValue","t","output","sDelimiter","String","toCsv","objArray","cDelimiter","l","names","obj","row","n","nl","length","hasOwnProperty","push","join","substring"],"mappings":"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","sourcesContent":["import { \n    isAndroid,\n    isFirefox,\n    isMobile, \n    isTablet \n  } from 'react-device-detect'\nimport { \n    SETTINGS_SAVEAS, \n    SETTINGS_SAVEINTO,\n    SETTINGS_DCMHEADER, \n    SETTINGS_OVERLAY, \n    SETTINGS_MEASUREMENT,\n    SETTINGS_FSVIEW,\n    SETTINGS_DICOMDIRVIEW,    \n    SETTINGS_MPRINTERPOLATION,\n} from './constants/settings'\n\n\nexport function getPixelSpacing(image, index) {\n    const value = image.data.string('x00280030')\n    if (value === undefined) {\n        return\n    }\n    const pixelSpacing = value.split('\\\\')\n    return pixelSpacing[index]\n}\n\nexport function getSpacingBetweenSlice(image) {\n    const value = image.data.string('x00180088')\n    if (value === undefined) {\n        return\n    }\n    return parseFloat(value)\n}\n\nexport function getSliceThickness(image) {\n    const value = image.data.string('x00180050')\n    if (value === undefined) {\n        return\n    }\n    return parseFloat(value)\n}\n\nexport function getSliceLocation(image) {\n    const value = image.data.string('x00201041')\n    if (value === undefined) {\n        return\n    }\n    return parseFloat(value)\n}\t\n\n  \nexport function capitalize(str) {\n    if (str === undefined) \n        return ''\n    else \n        return str.charAt(0).toUpperCase() + str.slice(1)\n}\n\n// To see the console output set the key 'debug-u-dicom-viewer' in \n// 'Storage->Local Storage' panel of your browser Develop Tool\nexport function log() {\n    let log = localStorage.getItem('debug-u-dicom-viewer')\n    if (log === null) {\n        console.log = function(){}\n    }\n}\n\nexport function isInputDirSupported() {\n    var tmpInput = document.createElement('input')\n    if ('webkitdirectory' in tmpInput \n        || 'mozdirectory' in tmpInput \n        || 'odirectory' in tmpInput \n        || 'msdirectory' in tmpInput \n        || 'directory' in tmpInput) return true\n    return false\n}\n\nexport function isUrlImage(url) {\n    if (url === undefined || url === null) return false\n    return(url.match(/\\.(jpeg|jpg|png)$/) != null)\n}\n\nexport function isFileImage(file) {\n    if (file === undefined || file === null) return false \n    const acceptedImageTypes = ['image/jpeg', 'image/png'] // 'image/gif', \n    return file && acceptedImageTypes.includes(file['type'])\n}\n\nexport function isFsFileImage(fsItem) {\n    console.log('isFsFileImage: ', fsItem)\n    if (fsItem === undefined || fsItem === null) return false\n    return fsItem.type.toLowerCase() === 'jpeg' || fsItem.type.toLowerCase() === 'png'\n}\n\nexport function getFileNameCorrect(filename) {\n    if (isAndroid && isFirefox) { // possible uncorrect .null extension is found in Android Firefox, it's a bug? CHECK IT\n        const ext = getFileExt(filename)\n        if (ext === 'null') {\n            return getFileName(filename)\n        }\n    }\n    return filename \n}\n\nexport function getFileExt(file) {\n    const re = /(?:\\.([^.]+))?$/\n    const ext = re.exec(file)[1]\n    if (ext === undefined) {\n        return 'dcm'\n    }\n    return ext\n}\n\nexport function getFileExtReal(file) {\n    const re = /(?:\\.([^.]+))?$/\n    const ext = re.exec(file)[1]\n    if (ext === undefined) {\n        return ''\n    }\n    return ext\n}\n\nexport function getFileName(file) {\n    const name = file.replace(/\\.[^.$]+$/, '')\n    if (name === undefined) {\n        return ''\n    }\n    return name    \n}\n\nexport function formatBytes(bytes, decimals = 2) {\n    if (bytes === '') return ''\n    if (bytes === 0) return '0 Bytes'\n    const k = 1024\n    const dm = decimals < 0 ? 0 : decimals\n    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']\n    const i = Math.floor(Math.log(bytes) / Math.log(k))\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i]\n}\n\nexport function getSettingsSaveAs() {\n    let saveAs = localStorage.getItem(SETTINGS_SAVEAS)\n    if (saveAs === null) {\n      saveAs = \"png\"\n      localStorage.setItem(SETTINGS_SAVEAS, saveAs)\n    }\n    return saveAs\n}\n\nexport function setSettingsSaveAs(value) {\n    localStorage.setItem(SETTINGS_SAVEAS, value)  \n}\n\nexport function getSettingsSaveInto() {\n    let saveInto = localStorage.getItem(SETTINGS_SAVEINTO)\n    if (saveInto === null) {\n        saveInto = \"local\"\n      localStorage.setItem(SETTINGS_SAVEINTO, saveInto)\n    }\n    return saveInto\n}\n\nexport function setSettingsSaveInto(value) {\n    localStorage.setItem(SETTINGS_SAVEINTO, value)  \n}\n\nexport function getSettingsDcmHeader() {\n    let exportAs = localStorage.getItem(SETTINGS_DCMHEADER)\n    if (exportAs === null) {\n      exportAs = \"json\"\n      localStorage.setItem(SETTINGS_DCMHEADER, exportAs)\n    }  \n    return exportAs\n}\n\nexport function setSettingsDcmHeader(value) {\n    localStorage.setItem(SETTINGS_DCMHEADER, value)  \n}\n\nexport function getSettingsOverlay() {\n    let overlay = localStorage.getItem(SETTINGS_OVERLAY)\n    if (overlay === null) {\n      overlay = \"1\"\n      localStorage.setItem(SETTINGS_OVERLAY, overlay)\n    }\n    return overlay === '1'\n}\n\nexport function setSettingsOverlay(value) {\n    localStorage.setItem(SETTINGS_OVERLAY, value ? '1' : '0')  \n}\n\nexport function getSettingsMeasurement() {\n    let measurement = localStorage.getItem(SETTINGS_MEASUREMENT)\n    if (measurement === null) {\n        measurement = '1'\n        localStorage.setItem(SETTINGS_MEASUREMENT, measurement)\n    }\n    return measurement\n}\n\nexport function setSettingsMeasurement(value) {\n    localStorage.setItem(SETTINGS_MEASUREMENT, value)  \n}\n\nexport function getSettingsFsView() {\n    let view = localStorage.getItem(SETTINGS_FSVIEW)\n    if (view === null) {\n        view = isMobile && !isTablet ? 'bottom' : 'right'\n        localStorage.setItem(SETTINGS_FSVIEW, view)\n    }\n    return view\n}\n\nexport function setSettingsFsView(value) {\n    localStorage.setItem(SETTINGS_FSVIEW, value)  \n}\n\nexport function getSettingsDicomdirView() {\n    let view = localStorage.getItem(SETTINGS_DICOMDIRVIEW)\n    if (view === null) {\n        view = isMobile && !isTablet ? 'bottom' : 'right'\n        localStorage.setItem(SETTINGS_DICOMDIRVIEW, view)\n    }\n    return view\n}\n\nexport function setSettingsDicomdirView(value) {\n    localStorage.setItem(SETTINGS_DICOMDIRVIEW, value)  \n}\n\nexport function getSettingsMprInterpolation() {\n    let method = localStorage.getItem(SETTINGS_MPRINTERPOLATION)\n    if (method === null) {\n        method = 'weightedlinear'\n        localStorage.setItem(SETTINGS_MPRINTERPOLATION, method)\n    }\n    return method\n}\n\nexport function setSettingsMprInterpolation(value) {\n    localStorage.setItem(SETTINGS_MPRINTERPOLATION, value)  \n}\n\n/**\n * Converts a value to a string appropriate for entry into a CSV table.  E.g., a string value will be surrounded by quotes.\n * @param {string|number|object} theValue\n */\nfunction toCsvValue(theValue) {\n    let t = typeof theValue,\n        output\n\n    let sDelimiter = '\"'\n\n    if (t === 'undefined' || t === null) {\n        output = ''\n    } else if (t === 'string') {\n        output = sDelimiter + theValue.replace(/\"/g, '\"\"') + sDelimiter\n    } else {\n        output = sDelimiter + String(theValue).replace(/\"/g, '\"\"') + sDelimiter\n    }\n\n    return output\n}\n\n/**\n * Converts an array of objects (with identical schemas) into a CSV table.\n * @param {Array} objArray An array of objects.  Each object in the array must have the same property list.\n * @param {string} cDelimiter The column delimiter.  Defaults to a comma (,) if omitted.\n * @return {string} The CSV equivalent of objArray.\n */\nexport function toCsv(objArray, cDelimiter) {\n    var i,\n        l,\n        names = [],\n        name,\n        value,\n        obj,\n        row,\n        output = '',\n        n,\n        nl\n\n    // Initialize default parameters.\n\n    let sDelimiter = '\"'\n    if (typeof cDelimiter === 'undefined' || cDelimiter === null) {\n        cDelimiter = ','\n    }\n\n    for (i = 0, l = objArray.length; i < l; i += 1) {\n        // Get the names of the properties.\n        obj = objArray[i]\n        row = ''\n        if (i === 0) {\n            // Loop through the names\n            for (name in obj) {\n                if (obj.hasOwnProperty(name)) {\n                    names.push(name)\n                    row += [\n                        sDelimiter,\n                        name.replace(/\"/g, '\"\"'),\n                        sDelimiter,\n                        cDelimiter,\n                    ].join('')\n                }\n            }\n            row = row.substring(0, row.length - 1)\n            output += row\n        }\n\n        output += '\\n'\n        row = ''\n        for (n = 0, nl = names.length; n < nl; n += 1) {\n            name = names[n]\n            value = obj[name]\n            if (n > 0) {\n                row += cDelimiter\n            }\n            row += toCsvValue(value)\n        }\n        output += row\n    }\n\n    return output\n}\n\n"]},"metadata":{},"sourceType":"module"}