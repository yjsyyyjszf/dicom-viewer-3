(window["webpackJsonpu-dicom-viewer"]=window["webpackJsonpu-dicom-viewer"]||[]).push([[0],{178:function(e){e.exports=JSON.parse('{"name":"u-dicom-viewer","version":"0.6.1","private":true,"homepage":"https://mmollaahmadi.github.io/dicom-viewer/","dependencies":{"@material-ui/core":"^4.8.3","@material-ui/icons":"^4.5.1","@material-ui/lab":"^4.0.0-alpha.39","@mdi/js":"^4.7.95","@mdi/react":"^1.2.1","@react-md/material-icons":"^2.0.0-alpha.0","axios":"^0.19.2","blob-util":"^2.0.2","cornerstone-core":"^2.3.0","cornerstone-file-image-loader":"^0.3.0","cornerstone-math":"^0.1.8","cornerstone-tools":"^4.9.1","cornerstone-wado-image-loader":"git+https://github.com/webnamics/cornerstoneWADOImageLoader.git","cornerstone-web-image-loader":"^2.1.1","daikon":"^1.2.42","dexie":"^2.0.4","dicom-parser":"^1.8.5","file-saver":"^2.0.2","gh-pages":"^2.2.0","hammerjs":"^2.0.8","jszip":"^3.2.2","lodash":"^4.17.15","lodash.template":"^4.5.0","material-table":"^1.55.0","react":"^16.9.0","react-device-detect":"^1.7.5","react-dom":"^16.9.0","react-icons":"^3.7.0","react-redux":"^7.1.3","react-resize-detector":"^4.2.1","react-rnd":"^10.1.4","react-router":"^5.0.1","react-router-dom":"^5.0.1","react-scripts":"3.1.1","react-virtualized":"^9.21.2","react-window":"^1.8.5","redux":"^4.0.5","serialize-javascript":"^2.1.2","set-value":"2.0.1","uuid":"^3.3.3","webfontloader":"^1.6.28"},"scripts":{"start":"react-scripts start","build":"react-scripts build","test":"react-scripts test","predeploy":"npm run build","deploy":"gh-pages -d build","eject":"react-scripts eject"},"eslintConfig":{"extends":"react-app"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"devDependencies":{"@babel/core":"^7.8.0","babel-core":"^6.26.3","babel-loader":"^8.0.6","npm-run-all":"^4.1.5"}}')},199:function(e,t,a){e.exports=a(267)},204:function(e,t,a){},217:function(e,t){},219:function(e,t){},266:function(e,t,a){},267:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(15),i=a.n(r),l=(a(204),a(13)),s=a.n(l),c=a(17),m=a(18),u=a(21),d=a(19),p=a(76),g=a(20),f=a(73),v=a(5),h=a(27),S=a(174),b=a(268),E=a(269),y=a(319),x=a(320),I=a(52),C=a(77),F=a.n(C),D=a(80),M=a.n(D),w=a(99),P=new w.a("fsDB");P.version(1).stores({files:"[parent+name], parent, name, type"}),P.open();var O=P,R=a(22);function T(e){return void 0===e?"":e.charAt(0).toUpperCase()+e.slice(1)}function k(){var e=document.createElement("input");return"webkitdirectory"in e||"mozdirectory"in e||"odirectory"in e||"msdirectory"in e||"directory"in e}function L(e){return void 0!==e&&null!==e&&null!=e.match(/\.(jpeg|jpg|png)$/)}function A(e){if(void 0===e||null===e)return!1;return e&&["image/jpeg","image/png"].includes(e.type)}function z(e){return console.log("isFsFileImage: ",e),void 0!==e&&null!==e&&("jpeg"===e.type.toLowerCase()||"png"===e.type.toLowerCase())}function V(e){if(R.isAndroid&&R.isFirefox&&"null"===B(e))return j(e);return e}function B(e){var t=/(?:\.([^.]+))?$/.exec(e)[1];return void 0===t?"dcm":t}function N(e){var t=/(?:\.([^.]+))?$/.exec(e)[1];return void 0===t?"":t}function j(e){var t=e.replace(/\.[^.$]+$/,"");return void 0===t?"":t}function U(){var e=localStorage.getItem("saveInto");return null===e&&(e="local",localStorage.setItem("saveInto",e)),e}function G(){var e=localStorage.getItem("overlay");return null===e&&(e="1",localStorage.setItem("overlay",e)),"1"===e}function Z(){var e=localStorage.getItem("fsView");return null===e&&(e=R.isMobile&&!R.isTablet?"bottom":"right",localStorage.setItem("fsView",e)),e}function W(){var e=localStorage.getItem("dicomdirView");return null===e&&(e=R.isMobile&&!R.isTablet?"bottom":"right",localStorage.setItem("dicomdirView",e)),e}function H(){var e=localStorage.getItem("mprInterpolation");return null===e&&(e="weightedlinear",localStorage.setItem("mprInterpolation",e)),e}function X(e){var t=typeof e;return"undefined"===t||null===t?"":"string"===t?'"'+e.replace(/"/g,'""')+'"':'"'+String(e).replace(/"/g,'""')+'"'}var _=function(e){return{type:"LOCALFILE_STORE",fsFile:e}},J=function(e){return{type:"FILES_STORE",files:e}},Y=function(e){return{type:"DCM_IS_OPEN",value:e}},q=function(e){return{type:"DCM_TOOL",tool:e}},Q=function(e){return{type:"ACTIVE_DCM",activeDcm:e}},K=function(e){return{type:"ACTIVE_MEASUREMENTS",measurements:e}},$=function(e){return{type:"FSZIPPEDFILE",fsZippedFile:e}},ee=function(e){return e.expanded?o.a.createElement(F.a,null):o.a.createElement(M.a,null)},te=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={data:[],expanded:[]},a.buildData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=a.output;null!==e&&(t[e].expanded=!t[e].expanded);var n=[],o=[],r=[],i=[];t.slice().reverse().forEach((function(e,t){"image"===e.key?n.unshift({id:e.id,key:e.key,path:e.path,value:e.value}):"series"===e.key?(o.unshift({id:e.id,key:e.key,number:e.number,value:e.value,expanded:e.expanded,children:n}),n=[]):"study"===e.key?(r.unshift({id:e.id,key:e.key,value:e.value,expanded:e.expanded,children:o}),o=[]):"patient"===e.key&&(i.unshift({id:e.id,key:e.key,value:e.value,expanded:e.expanded,children:r}),r=[])})),a.setState({data:i})},a.buildOutput=function(e){var t=e.elements.x00041220.items,a=[];return t&&t.forEach((function(e,t){var n=t.toString();"PATIENT"===e.dataSet.string("x00041430")?a.push({id:n,key:"patient",value:e.dataSet.string("x00100010"),expanded:!0}):"STUDY"===e.dataSet.string("x00041430")?a.push({id:n,key:"study",value:e.dataSet.string("x00081030"),expanded:!0}):"SERIES"===e.dataSet.string("x00041430")?a.push({id:n,key:"series",number:e.dataSet.string("x00200011"),value:e.dataSet.string("x00080060"),expanded:!0}):"IMAGE"===e.dataSet.string("x00041430")&&a.push({id:n,key:"image",path:e.dataSet.string("x00041500").replace(/\\/g,"/"),value:e.dataSet.string("x00041500").split("\\").pop(),expanded:!0})})),a},a.openDicomdir=function(e){var t=new FileReader;t.onload=function(e){var n=t.result,o=new Uint8Array(n),r=null,i=[];try{r=I.parseDicom(o),i=a.buildOutput(r)}catch(l){"undefined"!=typeof l.dataSet&&(i=a.buildOutput(l.dataSet))}a.output=i,a.buildData()},t.readAsArrayBuffer(e)},a.openDicomdirFs=function(e){var t=new Uint8Array(e.data),n=null,o=[];try{n=I.parseDicom(t),o=a.buildOutput(n)}catch(r){"undefined"!=typeof r.dataSet&&(o=a.buildOutput(r.dataSet))}a.output=o,a.buildData()},a.onClick=function(e){var t=a.output.find((function(t){return t.id===e}));if("image"===t.key)if("local"===a.props.dicomdir.origin){var n=a.props.dicomdir.files.find((function(e){return e.name===t.value}));a.props.onOpenFile(n)}else{var o=t.path.split("/"),r=o.pop();o.unshift(a.props.fsCurrentDir);var i=o.join("/");O.files.where({parent:i,name:r}).first((function(e){a.props.setFsFileStore(e),a.props.onOpenFs(e)}))}else a.buildData(e)},a.output=null,a}return Object(g.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){"local"===this.props.dicomdir.origin?this.openDicomdir(this.props.dicomdir.dicomdir):this.openDicomdirFs(this.props.dicomdir.dicomdir)}},{key:"render",value:function(){var e=this,t=this.props.classes,a=null;return a="bottom"===W()?{marginTop:"0px",height:"275px"}:{marginTop:"48px",width:"350px"},o.a.createElement("div",{style:a},o.a.createElement(b.a,null,this.state.data.map((function(a,r){var i=Object(S.a)({},a);return o.a.createElement(n.Fragment,{key:r},o.a.createElement(E.a,{button:!0,onClick:function(){return e.onClick(i.id)}},o.a.createElement(y.a,{primary:i.value,secondary:i.key,classes:{primary:t.listItemText,secondary:t.listItemText}}),o.a.createElement(ee,{expanded:i.expanded})),o.a.createElement(x.a,{in:i.expanded},i.children.map((function(a){return o.a.createElement(n.Fragment,{key:a.id},o.a.createElement(E.a,{key:a.id,button:!0,dense:!0,onClick:function(){return e.onClick(a.id)},className:t.study},o.a.createElement(y.a,{primary:a.value,secondary:a.key,classes:{primary:t.listItemText,secondary:t.listItemText}}),o.a.createElement(ee,{expanded:a.expanded})),o.a.createElement(x.a,{in:a.expanded},a.children.map((function(r){return o.a.createElement(n.Fragment,{key:r.id},o.a.createElement(E.a,{key:r.id,button:!0,dense:!0,onClick:function(){return e.onClick(r.id)},className:t.series},o.a.createElement(y.a,{primary:"".concat(r.value," (").concat(r.number,")"),secondary:r.key,classes:{primary:t.listItemText,secondary:t.listItemText}}),o.a.createElement(ee,{expanded:a.expanded})),o.a.createElement(x.a,{in:r.expanded},r.children.map((function(a){return o.a.createElement(E.a,{key:a.id,button:!0,dense:!0,onClick:function(){return e.onClick(a.id)},className:t.images},o.a.createElement(y.a,{primary:a.value,classes:{primary:t.listItemText}}))}))))}))))}))))}))))}}]),t}(n.PureComponent),ae=Object(h.b)((function(e){return{dicomdir:e.dicomdir,fsCurrentDir:e.fsCurrentDir}}),(function(e){return{setFsFileStore:function(t){return e(_(t))}}}))(Object(v.a)((function(e){return{study:{paddingLeft:e.spacing(3)},series:{paddingLeft:e.spacing(5)},images:{paddingLeft:e.spacing(7)},listItemText:{fontSize:"0.80em"}}}))(te)),ne=a(326),oe=a(321),re=a(325),ie=a(323),le=a(327),se=a(322),ce=a(328),me=a(60),ue=a(104),de=a.n(ue),pe=a(6),ge=a(2),fe=a(105),ve=a(41),he=a(106),Se=a(30),be=a(81),Ee={"1.2.840.10008.1.1":"Verification SOP Class","1.2.840.10008.1.2":"Implicit VR Little Endian: Default Transfer Syntax for DICOM","1.2.840.10008.1.2.1":"Explicit VR Little Endian","1.2.840.10008.1.2.1.99":"Deflated Explicit VR Little Endian","1.2.840.10008.1.2.2":"Explicit VR Big Endian (Retired)","1.2.840.10008.1.2.4.50":"JPEG Baseline (Process 1): Default Transfer Syntax for Lossy JPEG 8 Bit Image Compression","1.2.840.10008.1.2.4.51":"JPEG Extended (Process 2 & 4): Default Transfer Syntax for Lossy JPEG 12 Bit Image Compression (Process 4 only)","1.2.840.10008.1.2.4.52":"JPEG Extended (Process 3 & 5) (Retired)","1.2.840.10008.1.2.4.53":"JPEG Spectral Selection, Non-Hierarchical (Process 6 & 8) (Retired)","1.2.840.10008.1.2.4.54":"JPEG Spectral Selection, Non-Hierarchical (Process 7 & 9) (Retired)","1.2.840.10008.1.2.4.55":"JPEG Full Progression, Non-Hierarchical (Process 10 & 12) (Retired)","1.2.840.10008.1.2.4.56":"JPEG Full Progression, Non-Hierarchical (Process 11 & 13) (Retired)","1.2.840.10008.1.2.4.57":"JPEG Lossless, Non-Hierarchical (Process 14)","1.2.840.10008.1.2.4.58":"JPEG Lossless, Non-Hierarchical (Process 15) (Retired)","1.2.840.10008.1.2.4.59":"JPEG Extended, Hierarchical (Process 16 & 18) (Retired)","1.2.840.10008.1.2.4.60":"JPEG Extended, Hierarchical (Process 17 & 19) (Retired)","1.2.840.10008.1.2.4.61":"JPEG Spectral Selection, Hierarchical (Process 20 & 22) (Retired)","1.2.840.10008.1.2.4.62":"JPEG Spectral Selection, Hierarchical (Process 21 & 23) (Retired)","1.2.840.10008.1.2.4.63":"JPEG Full Progression, Hierarchical (Process 24 & 26) (Retired)","1.2.840.10008.1.2.4.64":"JPEG Full Progression, Hierarchical (Process 25 & 27) (Retired)","1.2.840.10008.1.2.4.65":"JPEG Lossless, Hierarchical (Process 28) (Retired)","1.2.840.10008.1.2.4.66":"JPEG Lossless, Hierarchical (Process 29) (Retired)","1.2.840.10008.1.2.4.70":"JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1]): Default Transfer Syntax for Lossless JPEG Image Compression","1.2.840.10008.1.2.4.80":"JPEG-LS Lossless Image Compression","1.2.840.10008.1.2.4.81":"JPEG-LS Lossy (Near-Lossless) Image Compression","1.2.840.10008.1.2.4.90":"JPEG 2000 Image Compression (Lossless Only)","1.2.840.10008.1.2.4.91":"JPEG 2000 Image Compression","1.2.840.10008.1.2.4.92":"JPEG 2000 Part 2 Multi-component Image Compression (Lossless Only)","1.2.840.10008.1.2.4.93":"JPEG 2000 Part 2 Multi-component Image Compression","1.2.840.10008.1.2.4.94":"JPIP Referenced","1.2.840.10008.1.2.4.95":"JPIP Referenced Deflate","1.2.840.10008.1.2.4.100":"MPEG2 Main Profile @ Main Level","1.2.840.10008.1.2.4.101":"MPEG2 Main Profile @ High Level","1.2.840.10008.1.2.4.102":"MPEG-4 AVC/H.264 High Profile / Level 4.1","1.2.840.10008.1.2.4.103":"MPEG-4 AVC/H.264 BD-compatible High Profile / Level 4.1","1.2.840.10008.1.2.4.104":"MPEG-4 AVC/H.264 High Profile / Level 4.2 For 2D Video","1.2.840.10008.1.2.4.105":"MPEG-4 AVC/H.264 High Profile / Level 4.2 For 3D Video","1.2.840.10008.1.2.4.106":"MPEG-4 AVC/H.264 Stereo High Profile / Level 4.2","1.2.840.10008.1.2.5":"RLE Lossless","1.2.840.10008.1.2.6.1":"RFC 2557 MIME encapsulation","1.2.840.10008.1.2.6.2":"XML Encoding","1.2.840.10008.1.3.10":"Media Storage Directory Storage","1.2.840.10008.1.4.1.1":"Talairach Brain Atlas Frame of Reference","1.2.840.10008.1.4.1.2":"SPM2 T1 Frame of Reference","1.2.840.10008.1.4.1.3":"SPM2 T2 Frame of Reference","1.2.840.10008.1.4.1.4":"SPM2 PD Frame of Reference","1.2.840.10008.1.4.1.5":"SPM2 EPI Frame of Reference","1.2.840.10008.1.4.1.6":"SPM2 FIL T1 Frame of Reference","1.2.840.10008.1.4.1.7":"SPM2 PET Frame of Reference","1.2.840.10008.1.4.1.8":"SPM2 TRANSM Frame of Reference","1.2.840.10008.1.4.1.9":"SPM2 SPECT Frame of Reference","1.2.840.10008.1.4.1.10":"SPM2 GRAY Frame of Reference","1.2.840.10008.1.4.1.11":"SPM2 WHITE Frame of Reference","1.2.840.10008.1.4.1.12":"SPM2 CSF Frame of Reference","1.2.840.10008.1.4.1.13":"SPM2 BRAINMASK Frame of Reference","1.2.840.10008.1.4.1.14":"SPM2 AVG305T1 Frame of Reference","1.2.840.10008.1.4.1.15":"SPM2 AVG152T1 Frame of Reference","1.2.840.10008.1.4.1.16":"SPM2 AVG152T2 Frame of Reference","1.2.840.10008.1.4.1.17":"SPM2 AVG152PD Frame of Reference","1.2.840.10008.1.4.1.18":"SPM2 SINGLESUBJT1 Frame of Reference","1.2.840.10008.1.4.2.1":"ICBM 452 T1 Frame of Reference","1.2.840.10008.1.4.2.2":"ICBM Single Subject MRI Frame of Reference","1.2.840.10008.1.5.1":"Hot Iron Color Palette SOP Instance","1.2.840.10008.1.5.2":"PET Color Palette SOP Instance","1.2.840.10008.1.5.3":"Hot Metal Blue Color Palette SOP Instance","1.2.840.10008.1.5.4":"PET 20 Step Color Palette SOP Instance","1.2.840.10008.1.9":"Basic Study Content Notification SOP Class (Retired)","1.2.840.10008.1.20.1":"Storage Commitment Push Model SOP Class","1.2.840.10008.1.20.1.1":"Storage Commitment Push Model SOP Instance","1.2.840.10008.1.20.2":"Storage Commitment Pull Model SOP Class (Retired)","1.2.840.10008.1.20.2.1":"Storage Commitment Pull Model SOP Instance (Retired)","1.2.840.10008.1.40":"Procedural Event Logging SOP Class","1.2.840.10008.1.40.1":"Procedural Event Logging SOP Instance","1.2.840.10008.1.42":"Substance Administration Logging SOP Class","1.2.840.10008.1.42.1":"Substance Administration Logging SOP Instance","1.2.840.10008.2.6.1":"DICOM UID Registry","1.2.840.10008.2.16.4":"DICOM Controlled Terminology","1.2.840.10008.3.1.1.1":"DICOM Application Context Name","1.2.840.10008.3.1.2.1.1":"Detached Patient Management SOP Class (Retired)","1.2.840.10008.3.1.2.1.4":"Detached Patient Management Meta SOP Class (Retired)","1.2.840.10008.3.1.2.2.1":"Detached Visit Management SOP Class (Retired)","1.2.840.10008.3.1.2.3.1":"Detached Study Management SOP Class (Retired)","1.2.840.10008.3.1.2.3.2":"Study Component Management SOP Class (Retired)","1.2.840.10008.3.1.2.3.3":"Modality Performed Procedure Step SOP Class","1.2.840.10008.3.1.2.3.4":"Modality Performed Procedure Step Retrieve SOP Class","1.2.840.10008.3.1.2.3.5":"Modality Performed Procedure Step Notification SOP Class","1.2.840.10008.3.1.2.5.1":"Detached Results Management SOP Class (Retired)","1.2.840.10008.3.1.2.5.4":"Detached Results Management Meta SOP Class (Retired)","1.2.840.10008.3.1.2.5.5":"Detached Study Management Meta SOP Class (Retired)","1.2.840.10008.3.1.2.6.1":"Detached Interpretation Management SOP Class (Retired)","1.2.840.10008.4.2":"Storage Service Class","1.2.840.10008.5.1.1.1":"Basic Film Session SOP Class","1.2.840.10008.5.1.1.2":"Basic Film Box SOP Class","1.2.840.10008.5.1.1.4":"Basic Grayscale Image Box SOP Class","1.2.840.10008.5.1.1.4.1":"Basic Color Image Box SOP Class","1.2.840.10008.5.1.1.4.2":"Referenced Image Box SOP Class (Retired)","1.2.840.10008.5.1.1.9":"Basic Grayscale Print Management Meta SOP Class","1.2.840.10008.5.1.1.9.1":"Referenced Grayscale Print Management Meta SOP Class (Retired)","1.2.840.10008.5.1.1.14":"Print Job SOP Class","1.2.840.10008.5.1.1.15":"Basic Annotation Box SOP Class","1.2.840.10008.5.1.1.16":"Printer SOP Class","1.2.840.10008.5.1.1.16.376":"Printer Configuration Retrieval SOP Class","1.2.840.10008.5.1.1.17":"Printer SOP Instance","1.2.840.10008.5.1.1.17.376":"Printer Configuration Retrieval SOP Instance","1.2.840.10008.5.1.1.18":"Basic Color Print Management Meta SOP Class","1.2.840.10008.5.1.1.18.1":"Referenced Color Print Management Meta SOP Class (Retired)","1.2.840.10008.5.1.1.22":"VOI LUT Box SOP Class","1.2.840.10008.5.1.1.23":"Presentation LUT SOP Class","1.2.840.10008.5.1.1.24":"Image Overlay Box SOP Class (Retired)","1.2.840.10008.5.1.1.24.1":"Basic Print Image Overlay Box SOP Class (Retired)","1.2.840.10008.5.1.1.25":"Print Queue SOP Instance (Retired)","1.2.840.10008.5.1.1.26":"Print Queue Management SOP Class (Retired)","1.2.840.10008.5.1.1.27":"Stored Print Storage SOP Class (Retired)","1.2.840.10008.5.1.1.29":"Hardcopy Grayscale Image Storage SOP Class (Retired)","1.2.840.10008.5.1.1.30":"Hardcopy Color Image Storage SOP Class (Retired)","1.2.840.10008.5.1.1.31":"Pull Print Request SOP Class (Retired)","1.2.840.10008.5.1.1.32":"Pull Stored Print Management Meta SOP Class (Retired)","1.2.840.10008.5.1.1.33":"Media Creation Management SOP Class UID","1.2.840.10008.5.1.1.40":"Display System SOP Class","1.2.840.10008.5.1.1.40.1":"Display System SOP Instance","1.2.840.10008.5.1.4.1.1.1":"Computed Radiography Image Storage","1.2.840.10008.5.1.4.1.1.1.1":"Digital X-Ray Image Storage - For Presentation","1.2.840.10008.5.1.4.1.1.1.1.1":"Digital X-Ray Image Storage - For Processing","1.2.840.10008.5.1.4.1.1.1.2":"Digital Mammography X-Ray Image Storage - For Presentation","1.2.840.10008.5.1.4.1.1.1.2.1":"Digital Mammography X-Ray Image Storage - For Processing","1.2.840.10008.5.1.4.1.1.1.3":"Digital Intra-Oral X-Ray Image Storage - For Presentation","1.2.840.10008.5.1.4.1.1.1.3.1":"Digital Intra-Oral X-Ray Image Storage - For Processing","1.2.840.10008.5.1.4.1.1.2":"CT Image Storage","1.2.840.10008.5.1.4.1.1.2.1":"Enhanced CT Image Storage","1.2.840.10008.5.1.4.1.1.2.2":"Legacy Converted Enhanced CT Image Storage","1.2.840.10008.5.1.4.1.1.3":"Ultrasound Multi-frame Image Storage (Retired)","1.2.840.10008.5.1.4.1.1.3.1":"Ultrasound Multi-frame Image Storage","1.2.840.10008.5.1.4.1.1.4":"MR Image Storage","1.2.840.10008.5.1.4.1.1.4.1":"Enhanced MR Image Storage","1.2.840.10008.5.1.4.1.1.4.2":"MR Spectroscopy Storage","1.2.840.10008.5.1.4.1.1.4.3":"Enhanced MR Color Image Storage","1.2.840.10008.5.1.4.1.1.4.4":"Legacy Converted Enhanced MR Image Storage","1.2.840.10008.5.1.4.1.1.5":"Nuclear Medicine Image Storage (Retired)","1.2.840.10008.5.1.4.1.1.6":"Ultrasound Image Storage (Retired)","1.2.840.10008.5.1.4.1.1.6.1":"Ultrasound Image Storage","1.2.840.10008.5.1.4.1.1.6.2":"Enhanced US Volume Storage","1.2.840.10008.5.1.4.1.1.7":"Secondary Capture Image Storage","1.2.840.10008.5.1.4.1.1.7.1":"Multi-frame Single Bit Secondary Capture Image Storage","1.2.840.10008.5.1.4.1.1.7.2":"Multi-frame Grayscale Byte Secondary Capture Image Storage","1.2.840.10008.5.1.4.1.1.7.3":"Multi-frame Grayscale Word Secondary Capture Image Storage","1.2.840.10008.5.1.4.1.1.7.4":"Multi-frame True Color Secondary Capture Image Storage","1.2.840.10008.5.1.4.1.1.8":"Standalone Overlay Storage (Retired)","1.2.840.10008.5.1.4.1.1.9":"Standalone Curve Storage (Retired)","1.2.840.10008.5.1.4.1.1.9.1":"Waveform Storage - Trial (Retired)","1.2.840.10008.5.1.4.1.1.9.1.1":"12-lead ECG Waveform Storage","1.2.840.10008.5.1.4.1.1.9.1.2":"General ECG Waveform Storage","1.2.840.10008.5.1.4.1.1.9.1.3":"Ambulatory ECG Waveform Storage","1.2.840.10008.5.1.4.1.1.9.2.1":"Hemodynamic Waveform Storage","1.2.840.10008.5.1.4.1.1.9.3.1":"Cardiac Electrophysiology Waveform Storage","1.2.840.10008.5.1.4.1.1.9.4.1":"Basic Voice Audio Waveform Storage","1.2.840.10008.5.1.4.1.1.9.4.2":"General Audio Waveform Storage","1.2.840.10008.5.1.4.1.1.9.5.1":"Arterial Pulse Waveform Storage","1.2.840.10008.5.1.4.1.1.9.6.1":"Respiratory Waveform Storage","1.2.840.10008.5.1.4.1.1.10":"Standalone Modality LUT Storage (Retired)","1.2.840.10008.5.1.4.1.1.11":"Standalone VOI LUT Storage (Retired)","1.2.840.10008.5.1.4.1.1.11.1":"Grayscale Softcopy Presentation State Storage SOP Class","1.2.840.10008.5.1.4.1.1.11.2":"Color Softcopy Presentation State Storage SOP Class","1.2.840.10008.5.1.4.1.1.11.3":"Pseudo-Color Softcopy Presentation State Storage SOP Class","1.2.840.10008.5.1.4.1.1.11.4":"Blending Softcopy Presentation State Storage SOP Class","1.2.840.10008.5.1.4.1.1.11.5":"XA/XRF Grayscale Softcopy Presentation State Storage","1.2.840.10008.5.1.4.1.1.12.1":"X-Ray Angiographic Image Storage","1.2.840.10008.5.1.4.1.1.12.1.1":"Enhanced XA Image Storage","1.2.840.10008.5.1.4.1.1.12.2":"X-Ray Radiofluoroscopic Image Storage","1.2.840.10008.5.1.4.1.1.12.2.1":"Enhanced XRF Image Storage","1.2.840.10008.5.1.4.1.1.12.3":"X-Ray Angiographic Bi-Plane Image Storage (Retired)","1.2.840.10008.5.1.4.1.1.13.1.1":"X-Ray 3D Angiographic Image Storage","1.2.840.10008.5.1.4.1.1.13.1.2":"X-Ray 3D Craniofacial Image Storage","1.2.840.10008.5.1.4.1.1.13.1.3":"Breast Tomosynthesis Image Storage","1.2.840.10008.5.1.4.1.1.13.1.4":"Breast Projection X-Ray Image Storage - For Presentation","1.2.840.10008.5.1.4.1.1.13.1.5":"Breast Projection X-Ray Image Storage - For Processing","1.2.840.10008.5.1.4.1.1.14.1":"Intravascular Optical Coherence Tomography Image Storage - For Presentation","1.2.840.10008.5.1.4.1.1.14.2":"Intravascular Optical Coherence Tomography Image Storage - For Processing","1.2.840.10008.5.1.4.1.1.20":"Nuclear Medicine Image Storage","1.2.840.10008.5.1.4.1.1.30":"Parametric Map Storage","1.2.840.10008.5.1.4.1.1.66":"Raw Data Storage","1.2.840.10008.5.1.4.1.1.66.1":"Spatial Registration Storage","1.2.840.10008.5.1.4.1.1.66.2":"Spatial Fiducials Storage","1.2.840.10008.5.1.4.1.1.66.3":"Deformable Spatial Registration Storage","1.2.840.10008.5.1.4.1.1.66.4":"Segmentation Storage","1.2.840.10008.5.1.4.1.1.66.5":"Surface Segmentation Storage","1.2.840.10008.5.1.4.1.1.67":"Real World Value Mapping Storage","1.2.840.10008.5.1.4.1.1.68.1":"Surface Scan Mesh Storage","1.2.840.10008.5.1.4.1.1.68.2":"Surface Scan Point Cloud Storage","1.2.840.10008.5.1.4.1.1.77.1":"VL Image Storage - Trial (Retired)","1.2.840.10008.5.1.4.1.1.77.2":"VL Multi-frame Image Storage - Trial (Retired)","1.2.840.10008.5.1.4.1.1.77.1.1":"VL Endoscopic Image Storage","1.2.840.10008.5.1.4.1.1.77.1.1.1":"Video Endoscopic Image Storage","1.2.840.10008.5.1.4.1.1.77.1.2":"VL Microscopic Image Storage","1.2.840.10008.5.1.4.1.1.77.1.2.1":"Video Microscopic Image Storage","1.2.840.10008.5.1.4.1.1.77.1.3":"VL Slide-Coordinates Microscopic Image Storage","1.2.840.10008.5.1.4.1.1.77.1.4":"VL Photographic Image Storage","1.2.840.10008.5.1.4.1.1.77.1.4.1":"Video Photographic Image Storage","1.2.840.10008.5.1.4.1.1.77.1.5.1":"Ophthalmic Photography 8 Bit Image Storage","1.2.840.10008.5.1.4.1.1.77.1.5.2":"Ophthalmic Photography 16 Bit Image Storage","1.2.840.10008.5.1.4.1.1.77.1.5.3":"Stereometric Relationship Storage","1.2.840.10008.5.1.4.1.1.77.1.5.4":"Ophthalmic Tomography Image Storage","1.2.840.10008.5.1.4.1.1.77.1.5.5":"Wide Field Ophthalmic Photography Stereographic Projection Image Storage","1.2.840.10008.5.1.4.1.1.77.1.5.6":"Wide Field Ophthalmic Photography 3D Coordinates Image Storage","1.2.840.10008.5.1.4.1.1.77.1.6":"VL Whole Slide Microscopy Image Storage","1.2.840.10008.5.1.4.1.1.78.1":"Lensometry Measurements Storage","1.2.840.10008.5.1.4.1.1.78.2":"Autorefraction Measurements Storage","1.2.840.10008.5.1.4.1.1.78.3":"Keratometry Measurements Storage","1.2.840.10008.5.1.4.1.1.78.4":"Subjective Refraction Measurements Storage","1.2.840.10008.5.1.4.1.1.78.5":"Visual Acuity Measurements Storage","1.2.840.10008.5.1.4.1.1.78.6":"Spectacle Prescription Report Storage","1.2.840.10008.5.1.4.1.1.78.7":"Ophthalmic Axial Measurements Storage","1.2.840.10008.5.1.4.1.1.78.8":"Intraocular Lens Calculations Storage","1.2.840.10008.5.1.4.1.1.79.1":"Macular Grid Thickness and Volume Report Storage","1.2.840.10008.5.1.4.1.1.80.1":"Ophthalmic Visual Field Static Perimetry Measurements Storage","1.2.840.10008.5.1.4.1.1.81.1":"Ophthalmic Thickness Map Storage","1.2.840.10008.5.1.4.1.1.82.1":"Corneal Topography Map Storage","1.2.840.10008.5.1.4.1.1.88.1":"Text SR Storage - Trial (Retired)","1.2.840.10008.5.1.4.1.1.88.2":"Audio SR Storage - Trial (Retired)","1.2.840.10008.5.1.4.1.1.88.3":"Detail SR Storage - Trial (Retired)","1.2.840.10008.5.1.4.1.1.88.4":"Comprehensive SR Storage - Trial (Retired)","1.2.840.10008.5.1.4.1.1.88.11":"Basic Text SR Storage","1.2.840.10008.5.1.4.1.1.88.22":"Enhanced SR Storage","1.2.840.10008.5.1.4.1.1.88.33":"Comprehensive SR Storage","1.2.840.10008.5.1.4.1.1.88.34":"Comprehensive 3D SR Storage","1.2.840.10008.5.1.4.1.1.88.35":"Extensible SR Storage","1.2.840.10008.5.1.4.1.1.88.40":"Procedure Log Storage","1.2.840.10008.5.1.4.1.1.88.50":"Mammography CAD SR Storage","1.2.840.10008.5.1.4.1.1.88.59":"Key Object Selection Document Storage","1.2.840.10008.5.1.4.1.1.88.65":"Chest CAD SR Storage","1.2.840.10008.5.1.4.1.1.88.67":"X-Ray Radiation Dose SR Storage","1.2.840.10008.5.1.4.1.1.88.68":"Radiopharmaceutical Radiation Dose SR Storage","1.2.840.10008.5.1.4.1.1.88.69":"Colon CAD SR Storage","1.2.840.10008.5.1.4.1.1.88.70":"Implantation Plan SR Storage","1.2.840.10008.5.1.4.1.1.104.1":"Encapsulated PDF Storage","1.2.840.10008.5.1.4.1.1.104.2":"Encapsulated CDA Storage","1.2.840.10008.5.1.4.1.1.128":"Positron Emission Tomography Image Storage","1.2.840.10008.5.1.4.1.1.128.1":"Legacy Converted Enhanced PET Image Storage","1.2.840.10008.5.1.4.1.1.129":"Standalone PET Curve Storage (Retired)","1.2.840.10008.5.1.4.1.1.130":"Enhanced PET Image Storage","1.2.840.10008.5.1.4.1.1.131":"Basic Structured Display Storage","1.2.840.10008.5.1.4.1.1.481.1":"RT Image Storage","1.2.840.10008.5.1.4.1.1.481.2":"RT Dose Storage","1.2.840.10008.5.1.4.1.1.481.3":"RT Structure Set Storage","1.2.840.10008.5.1.4.1.1.481.4":"RT Beams Treatment Record Storage","1.2.840.10008.5.1.4.1.1.481.5":"RT Plan Storage","1.2.840.10008.5.1.4.1.1.481.6":"RT Brachy Treatment Record Storage","1.2.840.10008.5.1.4.1.1.481.7":"RT Treatment Summary Record Storage","1.2.840.10008.5.1.4.1.1.481.8":"RT Ion Plan Storage","1.2.840.10008.5.1.4.1.1.481.9":"RT Ion Beams Treatment Record Storage","1.2.840.10008.5.1.4.1.1.501.1":"DICOS CT Image Storage","1.2.840.10008.5.1.4.1.1.501.2.1":"DICOS Digital X-Ray Image Storage - For Presentation","1.2.840.10008.5.1.4.1.1.501.2.2":"DICOS Digital X-Ray Image Storage - For Processing","1.2.840.10008.5.1.4.1.1.501.3":"DICOS Threat Detection Report Storage","1.2.840.10008.5.1.4.1.1.501.4":"DICOS 2D AIT Storage","1.2.840.10008.5.1.4.1.1.501.5":"DICOS 3D AIT Storage","1.2.840.10008.5.1.4.1.1.501.6":"DICOS Quadrupole Resonance (QR) Storage","1.2.840.10008.5.1.4.1.1.601.1":"Eddy Current Image Storage","1.2.840.10008.5.1.4.1.1.601.2":"Eddy Current Multi-frame Image Storage","1.2.840.10008.5.1.4.1.2.1.1":"Patient Root Query/Retrieve Information Model - FIND","1.2.840.10008.5.1.4.1.2.1.2":"Patient Root Query/Retrieve Information Model - MOVE","1.2.840.10008.5.1.4.1.2.1.3":"Patient Root Query/Retrieve Information Model - GET","1.2.840.10008.5.1.4.1.2.2.1":"Study Root Query/Retrieve Information Model - FIND","1.2.840.10008.5.1.4.1.2.2.2":"Study Root Query/Retrieve Information Model - MOVE","1.2.840.10008.5.1.4.1.2.2.3":"Study Root Query/Retrieve Information Model - GET","1.2.840.10008.5.1.4.1.2.3.1":"Patient/Study Only Query/Retrieve Information Model - FIND (Retired)","1.2.840.10008.5.1.4.1.2.3.2":"Patient/Study Only Query/Retrieve Information Model - MOVE (Retired)","1.2.840.10008.5.1.4.1.2.3.3":"Patient/Study Only Query/Retrieve Information Model - GET (Retired)","1.2.840.10008.5.1.4.1.2.4.2":"Composite Instance Root Retrieve - MOVE","1.2.840.10008.5.1.4.1.2.4.3":"Composite Instance Root Retrieve - GET","1.2.840.10008.5.1.4.1.2.5.3":"Composite Instance Retrieve Without Bulk Data - GET","1.2.840.10008.5.1.4.31":"Modality Worklist Information Model - FIND","1.2.840.10008.5.1.4.32":"General Purpose Worklist Management Meta SOP Class (Retired)","1.2.840.10008.5.1.4.32.1":"General Purpose Worklist Information Model - FIND (Retired)","1.2.840.10008.5.1.4.32.2":"General Purpose Scheduled Procedure Step SOP Class (Retired)","1.2.840.10008.5.1.4.32.3":"General Purpose Performed Procedure Step SOP Class (Retired)","1.2.840.10008.5.1.4.33":"Instance Availability Notification SOP Class","1.2.840.10008.5.1.4.34.1":"RT Beams Delivery Instruction Storage - Trial (Retired)","1.2.840.10008.5.1.4.34.2":"RT Conventional Machine Verification - Trial (Retired)","1.2.840.10008.5.1.4.34.3":"RT Ion Machine Verification - Trial (Retired)","1.2.840.10008.5.1.4.34.4":"Unified Worklist and Procedure Step Service Class - Trial (Retired)","1.2.840.10008.5.1.4.34.4.1":"Unified Procedure Step - Push SOP Class - Trial (Retired)","1.2.840.10008.5.1.4.34.4.2":"Unified Procedure Step - Watch SOP Class - Trial (Retired)","1.2.840.10008.5.1.4.34.4.3":"Unified Procedure Step - Pull SOP Class - Trial (Retired)","1.2.840.10008.5.1.4.34.4.4":"Unified Procedure Step - Event SOP Class - Trial (Retired)","1.2.840.10008.5.1.4.34.5":"UPS Global Subscription SOP Instance","1.2.840.10008.5.1.4.34.5.1":"UPS Filtered Global Subscription SOP Instance","1.2.840.10008.5.1.4.34.6":"Unified Worklist and Procedure Step Service Class","1.2.840.10008.5.1.4.34.6.1":"Unified Procedure Step - Push SOP Class","1.2.840.10008.5.1.4.34.6.2":"Unified Procedure Step - Watch SOP Class","1.2.840.10008.5.1.4.34.6.3":"Unified Procedure Step - Pull SOP Class","1.2.840.10008.5.1.4.34.6.4":"Unified Procedure Step - Event SOP Class","1.2.840.10008.5.1.4.34.7":"RT Beams Delivery Instruction Storage","1.2.840.10008.5.1.4.34.8":"RT Conventional Machine Verification","1.2.840.10008.5.1.4.34.9":"RT Ion Machine Verification","1.2.840.10008.5.1.4.37.1":"General Relevant Patient Information Query","1.2.840.10008.5.1.4.37.2":"Breast Imaging Relevant Patient Information Query","1.2.840.10008.5.1.4.37.3":"Cardiac Relevant Patient Information Query","1.2.840.10008.5.1.4.38.1":"Hanging Protocol Storage","1.2.840.10008.5.1.4.38.2":"Hanging Protocol Information Model - FIND","1.2.840.10008.5.1.4.38.3":"Hanging Protocol Information Model - MOVE","1.2.840.10008.5.1.4.38.4":"Hanging Protocol Information Model - GET","1.2.840.10008.5.1.4.39.1":"Color Palette Storage","1.2.840.10008.5.1.4.39.2":"Color Palette Information Model - FIND","1.2.840.10008.5.1.4.39.3":"Color Palette Information Model - MOVE","1.2.840.10008.5.1.4.39.4":"Color Palette Information Model - GET","1.2.840.10008.5.1.4.41":"Product Characteristics Query SOP Class","1.2.840.10008.5.1.4.42":"Substance Approval Query SOP Class","1.2.840.10008.5.1.4.43.1":"Generic Implant Template Storage","1.2.840.10008.5.1.4.43.2":"Generic Implant Template Information Model - FIND","1.2.840.10008.5.1.4.43.3":"Generic Implant Template Information Model - MOVE","1.2.840.10008.5.1.4.43.4":"Generic Implant Template Information Model - GET","1.2.840.10008.5.1.4.44.1":"Implant Assembly Template Storage","1.2.840.10008.5.1.4.44.2":"Implant Assembly Template Information Model - FIND","1.2.840.10008.5.1.4.44.3":"Implant Assembly Template Information Model - MOVE","1.2.840.10008.5.1.4.44.4":"Implant Assembly Template Information Model - GET","1.2.840.10008.5.1.4.45.1":"Implant Template Group Storage","1.2.840.10008.5.1.4.45.2":"Implant Template Group Information Model - FIND","1.2.840.10008.5.1.4.45.3":"Implant Template Group Information Model - MOVE","1.2.840.10008.5.1.4.45.4":"Implant Template Group Information Model - GET","1.2.840.10008.7.1.1":"Native DICOM Model","1.2.840.10008.7.1.2":"Abstract Multi-Dimensional Image Model","1.2.840.10008.8.1.1":"DICOM Content Mapping Resource","1.2.840.10008.15.0.3.1":"dicomDeviceName","1.2.840.10008.15.0.3.2":"dicomDescription","1.2.840.10008.15.0.3.3":"dicomManufacturer","1.2.840.10008.15.0.3.4":"dicomManufacturerModelName","1.2.840.10008.15.0.3.5":"dicomSoftwareVersion","1.2.840.10008.15.0.3.6":"dicomVendorData","1.2.840.10008.15.0.3.7":"dicomAETitle","1.2.840.10008.15.0.3.8":"dicomNetworkConnectionReference","1.2.840.10008.15.0.3.9":"dicomApplicationCluster","1.2.840.10008.15.0.3.10":"dicomAssociationInitiator","1.2.840.10008.15.0.3.11":"dicomAssociationAcceptor","1.2.840.10008.15.0.3.12":"dicomHostname","1.2.840.10008.15.0.3.13":"dicomPort","1.2.840.10008.15.0.3.14":"dicomSOPClass","1.2.840.10008.15.0.3.15":"dicomTransferRole","1.2.840.10008.15.0.3.16":"dicomTransferSyntax","1.2.840.10008.15.0.3.17":"dicomPrimaryDeviceType","1.2.840.10008.15.0.3.18":"dicomRelatedDeviceReference","1.2.840.10008.15.0.3.19":"dicomPreferredCalledAETitle","1.2.840.10008.15.0.3.20":"dicomTLSCyphersuite","1.2.840.10008.15.0.3.21":"dicomAuthorizedNodeCertificateReference","1.2.840.10008.15.0.3.22":"dicomThisNodeCertificateReference","1.2.840.10008.15.0.3.23":"dicomInstalled","1.2.840.10008.15.0.3.24":"dicomStationName","1.2.840.10008.15.0.3.25":"dicomDeviceSerialNumber","1.2.840.10008.15.0.3.26":"dicomInstitutionName","1.2.840.10008.15.0.3.27":"dicomInstitutionAddress","1.2.840.10008.15.0.3.28":"dicomInstitutionDepartmentName","1.2.840.10008.15.0.3.29":"dicomIssuerOfPatientID","1.2.840.10008.15.0.3.30":"dicomPreferredCallingAETitle","1.2.840.10008.15.0.3.31":"dicomSupportedCharacterSet","1.2.840.10008.15.0.4.1":"dicomConfigurationRoot","1.2.840.10008.15.0.4.2":"dicomDevicesRoot","1.2.840.10008.15.0.4.3":"dicomUniqueAETitlesRegistryRoot","1.2.840.10008.15.0.4.4":"dicomDevice","1.2.840.10008.15.0.4.5":"dicomNetworkAE","1.2.840.10008.15.0.4.6":"dicomNetworkConnection","1.2.840.10008.15.0.4.7":"dicomUniqueAETitle","1.2.840.10008.15.0.4.8":"dicomTransferCapability","1.2.840.10008.15.1.1":"Universal Coordinated Time"},ye=a(324),xe=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).hide=function(){a.props.onClose()},a.cancel=function(){window.stop(),a.hide()},a}return Object(g.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement(oe.a,{open:!0,onClose:this.hide,"aria-labelledby":"alert-dialog-title"},o.a.createElement(se.a,{id:"alert-dialog-title"},"Downloading file ..."),o.a.createElement(ie.a,null,o.a.createElement(ye.a,{variant:"determinate",value:this.props.progress,color:"secondary"})),o.a.createElement(re.a,null,o.a.createElement(ne.a,{onClick:this.cancel},"Cancel"))))}}]),t}(n.PureComponent),Ie=a(10),Ce=a.n(Ie),Fe=a(271),De=a(8),Me=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).firstframe=function(){a.props.runCinePlayer("firstframe")},a.previousframe=function(){a.props.runCinePlayer("previousframe")},a.play=function(){a.props.runCinePlayer("play")},a.pause=function(){a.props.runCinePlayer("pause")},a.nextframe=function(){a.props.runCinePlayer("nextframe")},a.lastframe=function(){a.props.runCinePlayer("lastframe")},a}return Object(g.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=null;return e=this.props.inPlay?o.a.createElement(Fe.a,{onClick:this.pause},o.a.createElement(Ce.a,{path:De.K,size:"1.5rem",color:"#FFFFFF"})):o.a.createElement(Fe.a,{onClick:this.play},o.a.createElement(Ce.a,{path:De.L,size:"1.5rem",color:"#FFFFFF"})),o.a.createElement("div",{style:{width:240,margin:"0 auto"}},o.a.createElement(Fe.a,{onClick:this.firstframe},o.a.createElement(Ce.a,{path:De.Q,size:"1.5rem",color:"#FFFFFF"})),o.a.createElement(Fe.a,{onClick:this.previousframe},o.a.createElement(Ce.a,{path:De.T,size:"1.5rem",color:"#FFFFFF"})),e,o.a.createElement(Fe.a,{onClick:this.nextframe},o.a.createElement(Ce.a,{path:De.S,size:"1.5rem",color:"#FFFFFF"})),o.a.createElement(Fe.a,{onClick:this.lastframe},o.a.createElement(Ce.a,{path:De.R,size:"1.5rem",color:"#FFFFFF"})))}}]),t}(n.PureComponent),we=new w.a("udvDB");we.version(1).stores({measurement:"++id, sopinstanceuid, tool"}),we.open();var Pe=we,Oe=Object(ge.import)("util/scrollToIndex");ge.external.cornerstone=pe,ge.external.cornerstoneMath=fe,ve.external.cornerstone=pe,he.external.cornerstone=pe,Se.external.cornerstone=pe,Se.external.dicomParser=I,ge.external.Hammer=de.a,ge.init();var Re=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={visibleOpenUrlDlg:!1,progress:null,visibleCinePlayer:!1,errorOnOpenImage:null,errorOnCors:!1,frame:1,inPlay:!1,viewport:null},a.onOpenUrl=function(e){var t=e.detail;a.setState({progress:t.percentComplete})},a.showOpenUrlDlg=function(e){a.setState({visibleOpenUrlDlg:!0},(function(){pe.events.addEventListener("cornerstoneimageloadprogress",a.onOpenUrl),a.loadImage(void 0,e)}))},a.hideOpenUrlDlg=function(){a.setState({visibleOpenUrlDlg:!1,progress:null})},a.measurementSave=function(e){a.measurements.push(e)},a.measurementClear=function(){a.measurements.splice(0,a.measurements.length)},a.measurementRemove=function(e){a.measurements.splice(e,1)},a.getTransferSyntax=function(){var e=a.image.data.string("x00020010");return e+" ["+Ee[e]+"]"},a.getSopClass=function(){var e=a.image.data.string("x00080016");return e+" ["+Ee[e]+"]"},a.getSopInstanceUID=function(){return a.image.data.string("x00080018")},a.getPixelRepresentation=function(){var e=a.image.data.uint16("x00280103");if(void 0!==e)return e+(0===e?" (unsigned)":" (signed)")},a.getPlanarConfiguration=function(){var e=a.image.data.uint16("x00280006");if(void 0!==e)return e+(0===e?" (pixel)":" (plane)")},a.onImageLoaded=function(e){},a.onImageRendered=function(e){var t=pe.getViewport(e.target);if(console.log("props.index : ",a.props.index),document.getElementById("mrtopleft-".concat(a.props.index)).textContent=a.mprIsOrthogonalView()?"".concat(T(a.mprPlane)):"".concat(a.PatientsName),document.getElementById("mrtopright-".concat(a.props.index)).textContent="".concat(t.displayedArea.brhc.x,"x").concat(t.displayedArea.brhc.y),document.getElementById("mrbottomleft-".concat(a.props.index)).textContent="WW/WC: ".concat(Math.round(t.voi.windowWidth),"/").concat(Math.round(t.voi.windowCenter)),document.getElementById("mrbottomright-".concat(a.props.index)).textContent="Zoom: ".concat(Math.round(100*t.scale.toFixed(2)),"%"),document.getElementById("mrtopcenter-".concat(a.props.index)).textContent="",document.getElementById("mrbottomcenter-".concat(a.props.index)).textContent="",document.getElementById("mrleftcenter-".concat(a.props.index)).textContent="",document.getElementById("mrrightcenter-".concat(a.props.index)).textContent="","sagittal"===a.mprPlane?(document.getElementById("mrtopcenter-".concat(a.props.index)).textContent="S",document.getElementById("mrbottomcenter-".concat(a.props.index)).textContent="I",document.getElementById("mrleftcenter-".concat(a.props.index)).textContent="A",document.getElementById("mrrightcenter-".concat(a.props.index)).textContent="P"):"axial"===a.mprPlane?(document.getElementById("mrtopcenter-".concat(a.props.index)).textContent="A",document.getElementById("mrbottomcenter-".concat(a.props.index)).textContent="P",document.getElementById("mrleftcenter-".concat(a.props.index)).textContent="R",document.getElementById("mrrightcenter-".concat(a.props.index)).textContent="L"):"coronal"===a.mprPlane&&(document.getElementById("mrtopcenter-".concat(a.props.index)).textContent="S",document.getElementById("mrbottomcenter-".concat(a.props.index)).textContent="I",document.getElementById("mrleftcenter-".concat(a.props.index)).textContent="R",document.getElementById("mrrightcenter-".concat(a.props.index)).textContent="L"),a.isDicom&&a.state.visibleCinePlayer&&a.numberOfFrames>1&&(document.getElementById("frameLabel-".concat(a.props.index)).textContent="".concat(a.state.frame," / ").concat(a.numberOfFrames),a.state.inPlay)){var n=a.state.frame===a.numberOfFrames?1:a.state.frame+1;a.setState({frame:n})}},a.onMeasurementModified=function(e){},a.onMeasurementAdded=function(e){if("Angle"===a.props.tool){var t={tool:a.props.tool,note:"",data:e.detail.measurementData};a.measurementSave(t),a.props.setActiveMeasurements(a.measurements)}},a.onMeasurementCompleted=function(e){var t={tool:a.props.tool,note:"",data:e.detail.measurementData};"FreehandRoi"===a.props.tool?setTimeout((function(){a.measurementSave(t),a.props.setActiveMeasurements(a.measurements)}),500):(a.measurementSave(t),a.props.setActiveMeasurements(a.measurements))},a.onErrorOpenImageClose=function(){a.setState({errorOnOpenImage:null})},a.onErrorCorsClose=function(){a.setState({errorOnCors:!1})},a.displayImageFromFilesByImage=function(e,t){var n=a.dicomImage;pe.enable(n),pe.displayImage(n,t)},a.displayImageFromFilesMohammad=function(e){for(var t=e,n=[],o=0;o<t.length;o++)n.push(Se.wadouri.fileManager.add(t[o])),console.log("file -- ",t[o]),console.log("files image id-- ",Se.wadouri.fileManager.add(t[o]));var r={currentImageIdIndex:0,imageIds:n};a.filename=t[0].name;var i=a.dicomImage;i.addEventListener("cornerstonenewimage",a.onNewImage),i.addEventListener("cornerstoneimagerendered",a.onImageRendered),i.addEventListener("cornerstonetoolsmeasurementadded",a.onMeasurementAdded),i.addEventListener("cornerstonetoolsmeasurementmodified",a.onMeasurementModified),i.addEventListener("cornerstonetoolsmeasurementcompleted",a.onMeasurementCompleted),pe.enable(i);var l=ge.StackScrollMouseWheelTool;pe.loadImage(n[0]).then((function(e){a.image=e,a.isDicom=!0,pe.displayImage(i,e),a.mprPlanePosition(),ge.addStackStateManager(i,["stack"]),ge.addToolState(i,"stack",r)})),ge.addTool(l),ge.setToolActive("StackScrollMouseWheel",{}),a.props.setActiveDcm({image:a.image,element:a.dicomImage,isDicom:a.isDicom}),a.props.setIsOpenStore({index:a.props.index,value:!0}),a.enableTool()},a.displayImageFromFiles=function(e){for(var t=null===a.files?a.props.files:a.files,n=[],o=0;o<t.length;o++)n.push(t[o].imageId);var r={currentImageIdIndex:0,imageIds:n},i=a.props.files[e].image;a.filename=a.props.files[e].name;var l=a.dicomImage;l.addEventListener("cornerstonenewimage",a.onNewImage),l.addEventListener("cornerstoneimagerendered",a.onImageRendered),l.addEventListener("cornerstonetoolsmeasurementadded",a.onMeasurementAdded),l.addEventListener("cornerstonetoolsmeasurementmodified",a.onMeasurementModified),l.addEventListener("cornerstonetoolsmeasurementcompleted",a.onMeasurementCompleted),pe.enable(l),a.image=i,a.isDicom=!0,a.PatientsName=i.data.string("x00100010"),a.sopInstanceUid=a.getSopInstanceUID();var s=ge.StackScrollMouseWheelTool;pe.loadImage(n[0]).then((function(e){pe.displayImage(l,e),ge.addStackStateManager(l,["stack"]),ge.addToolState(l,"stack",r)})),ge.addTool(s),ge.setToolActive("StackScrollMouseWheel",{}),a.enableTool(),Pe.measurement.where("sopinstanceuid").equals(a.sopInstanceUid).each((function(e){console.log("load measure from db: ",e),a.measurementSave(e),ge.addToolState(l,e.tool,e.data),a.runTool(e.tool),pe.updateImage(l),ge.setToolEnabled(e.tool)})).then((function(){a.props.setActiveMeasurements(a.measurements),a.props.setActiveDcm({image:a.image,element:a.dicomImage,isDicom:a.isDicom}),a.props.setIsOpenStore({index:a.props.index,value:!0})}))},a.loadImageFromCanvas=function(e){console.log("loadImageFromCanvas, dcmViewer: ",a.props.index);var t=a.dicomImage;t.addEventListener("cornerstonenewimage",a.onNewImage),t.addEventListener("cornerstoneimagerendered",a.onImageRendered),t.addEventListener("cornerstonetoolsmeasurementadded",a.onMeasurementAdded),t.addEventListener("cornerstonetoolsmeasurementmodified",a.onMeasurementModified),t.addEventListener("cornerstonetoolsmeasurementcompleted",a.onMeasurementCompleted),pe.enable(t);var n=ve.fileManager.addCanvas(e);pe.loadImage(n).then((function(e){console.log("loadImageFromCanvas, image: ",e),a.image=e,a.isDicom=!1,pe.displayImage(t,e),a.enableTool(),a.props.setIsOpenStore({index:a.props.index,value:!0})}),(function(e){console.log("error",e),a.setState({errorOnOpenImage:"This is not a valid canvas."})}))},a.loadImageFromCustomObject=function(e,t,n){var o=a.dicomImage;o.addEventListener("cornerstonenewimage",a.onNewImage),o.addEventListener("cornerstoneimagerendered",a.onImageRendered),o.addEventListener("cornerstonetoolsmeasurementadded",a.onMeasurementAdded),o.addEventListener("cornerstonetoolsmeasurementmodified",a.onMeasurementModified),o.addEventListener("cornerstonetoolsmeasurementcompleted",a.onMeasurementCompleted),pe.enable(o);var r={rows:t,columns:e,pixelData:n,image:a.originImage},i=ve.fileManager.addCustom(r);pe.loadImage(i).then((function(e){a.image=e,a.isDicom=!0,pe.displayImage(o,e),a.props.setIsOpenStore({index:a.props.index,value:!0})}),(function(e){console.log("error",e),a.setState({errorOnOpenImage:"This is not a valid canvas."})}))},a.loadImage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(console.log("loadImage, localfile: ",e),console.log("loadImage, fsItem: ",n),console.log("loadImage, url: ",t),void 0!==e||void 0!==t||void 0!==n){void 0!==n?a.fsItem=n:void 0!==e?a.localfile=e:a.localurl=t;var o=a.dicomImage;o.addEventListener("cornerstonenewimage",a.onNewImage),o.addEventListener("cornerstoneimagerendered",a.onImageRendered),o.addEventListener("cornerstonetoolsmeasurementadded",a.onMeasurementAdded),o.addEventListener("cornerstonetoolsmeasurementmodified",a.onMeasurementModified),o.addEventListener("cornerstonetoolsmeasurementcompleted",a.onMeasurementCompleted);var r=void 0;pe.enable(o);var i=0;void 0===e&&L(t)?pe.loadImage(t).then((function(e){a.hideOpenUrlDlg(),a.image=e,a.isDicom=!1,pe.displayImage(o,e),a.enableTool(),a.props.setActiveDcm({image:a.image,element:a.dicomImage,isDicom:a.isDicom}),a.props.isOpenStore(!0)}),(function(e){console.log("error",e),a.setState({errorOnOpenImage:"This is not a valid JPG or PNG file."})})):void 0!==e&&A(e)||void 0!==n&&z(n)?(r=void 0!==n?ve.fileManager.addBuffer(n.data):ve.fileManager.add(e),pe.loadImage(r).then((function(e){a.image=e,a.isDicom=!1,a.PatientsName="",pe.displayImage(o,e),a.enableTool(),a.props.setActiveDcm({image:a.image,element:a.dicomImage,isDicom:a.isDicom}),a.props.setIsOpenStore({index:a.props.index,value:!0})}),(function(e){console.log("error",e),a.setState({errorOnOpenImage:"This is not a valid JPG or PNG file."})}))):(void 0!==n?(r=Se.wadouri.fileManager.addBuffer(n.data),a.filename=n.name,i=n.size):void 0!==e?(r=Se.wadouri.fileManager.add(e),a.filename=e.name,i=e.size):r="wadouri:"+t,pe.loadAndCacheImage(r).then((function(e){console.log("loadImage, image: ",e),a.hideOpenUrlDlg(),a.image=e,a.isDicom=!0;var t=I.parseDicom(e.data.byteArray);console.log("image dataset -----: "+t.string("x00200011")),console.log("Series Number: "+e.data.string("x00200011")),a.PatientsName=e.data.string("x00100010"),console.log("PatientsName: "+a.PatientsName),a.sopInstanceUid=a.getSopInstanceUID();var n={currentImageIdIndex:0,imageIds:""};if(a.numberOfFrames=e.data.intString("x00280008"),a.numberOfFrames>0){for(var l=[],s=0;s<a.numberOfFrames;++s)l.push(r+"?frame="+s);n.imageIds=l}pe.displayImage(o,e),a.enableTool(),a.numberOfFrames>1&&(ge.addStackStateManager(o,["stack","playClip"]),ge.addToolState(o,"stack",n),a.setState({frame:1})),Pe.measurement.where("sopinstanceuid").equals(a.sopInstanceUid).each((function(e){console.log("load measure from db: ",e),a.measurementSave(e),ge.addToolState(o,e.tool,e.data),a.runTool(e.tool),pe.updateImage(o),ge.setToolEnabled(e.tool)})).then((function(){a.props.setActiveMeasurements(a.measurements),a.props.setActiveDcm({name:a.filename,size:i,image:a.image,element:a.dicomImage,isDicom:a.isDicom}),a.props.setIsOpenStore({index:a.props.index,value:!0})}))}),(function(e){console.log("error",e),a.hideOpenUrlDlg();var t=e.error.toString();if("[object XMLHttpRequest]"===t)a.setState({errorOnCors:!0});else{var n=t.indexOf(":");a.setState({errorOnOpenImage:n<0?e.error:t.substring(n+1)})}})))}},a.enableTool=function(e,t){var a=ge.WwwcTool,n=ge.LengthTool,o=ge.PanTool,r=ge.ZoomTouchPinchTool,i=ge.ZoomTool,l=ge.ProbeTool,s=ge.EllipticalRoiTool,c=ge.RectangleRoiTool,m=ge.FreehandRoiTool,u=ge.AngleTool,d=ge.MagnifyTool,p=ge.StackScrollMouseWheelTool;ge.addTool(d),ge.addTool(u),ge.addTool(a),ge.addTool(n),ge.addTool(o),ge.addTool(r),ge.addTool(i),ge.addTool(l),ge.addTool(s),ge.addTool(c),ge.addTool(m),ge.addTool(p)},a.disableAllTools=function(){ge.setToolEnabled("Length"),ge.setToolEnabled("Pan"),ge.setToolEnabled("Magnify"),ge.setToolEnabled("Angle"),ge.setToolEnabled("RectangleRoi"),ge.setToolEnabled("Wwwc"),ge.setToolEnabled("ZoomTouchPinch"),ge.setToolEnabled("Probe"),ge.setToolEnabled("EllipticalRoi"),ge.setToolEnabled("FreehandRoi"),ge.setToolEnabled("StackScrollMouseWheel")},a.runTool2=function(e,t){pe.disable(a.dicomImage),a.displayImageFromFilesByImage(e,t)},a.runTool=function(e,t){switch(e){case"openImage":pe.disable(a.dicomImage);break;case"openimage":pe.disable(a.dicomImage),a.displayImageFromFiles(t);break;case"Mohammad":pe.disable(a.dicomImage),a.displayImageFromFilesMohammad(t);break;case"openSandboxFs":console.log("openSandboxFs: ",t),pe.disable(a.dicomImage),a.setState({file:t}),a.loadImage(void 0,void 0,t);break;case"openurl":a.showOpenUrlDlg(t);break;case"clear":a.setState({visibleCinePlayer:!1}),a.mprPlane="",pe.disable(a.dicomImage);break;case"notool":a.disableAllTools();break;case"Wwwc":ge.setToolActive("Wwwc",{mouseButtonMask:1});break;case"Pan":ge.setToolActive("Pan",{mouseButtonMask:1});break;case"Zoom":ge.setToolActive(R.isMobile?"ZoomTouchPinch":"Zoom",{mouseButtonMask:1});break;case"Length":ge.setToolActive("Length",R.isMobile?{isTouchActive:!0}:{mouseButtonMask:1});break;case"Probe":ge.setToolActive("Probe",{mouseButtonMask:1});break;case"EllipticalRoi":ge.setToolActive("EllipticalRoi",{mouseButtonMask:1});break;case"RectangleRoi":ge.setToolActive("RectangleRoi",{mouseButtonMask:1});break;case"Angle":ge.setToolActive("Angle",{mouseButtonMask:1});break;case"Magnify":ge.setToolActive("Magnify",{mouseButtonMask:1});break;case"FreehandRoi":ge.setToolActive("FreehandRoi",{mouseButtonMask:1});break;case"Invert":var n=a.dicomImage,o=pe.getViewport(n);o.invert=!o.invert,pe.setViewport(n,o);break;case"saveas":var r=localStorage.getItem("saveAs");if("local"===U()){var i=a.dicomImage,l=pe.getViewport(i),c=document.getElementsByClassName("cornerstone-canvas")[a.props.activeDcmIndex],m=l.scale.toFixed(2),u=a.image.columns*m,d=a.image.rows*m,p=document.createElement("canvas");p=a.cropCanvas(c,Math.round(c.width/2-u/2),Math.round(c.height/2-d/2),u,d);var g=document.createElement("a");g.href=p.toDataURL("image/".concat(r)),g.download="".concat(a.filename,".").concat(r),document.body.appendChild(g),g.click()}else{var f=a.dicomImage,v=pe.getViewport(f),h=document.getElementsByClassName("cornerstone-canvas")[a.props.activeDcmIndex],S=v.scale.toFixed(2),b=a.image.columns*S,E=a.image.rows*S,y=document.createElement("canvas");y=a.cropCanvas(h,Math.round(h.width/2-b/2),Math.round(h.height/2-E/2),b,E),be.b(y,"image/".concat(r)).then((function(e){be.a(e).then((function(e){var t="".concat(j(a.filename),"-MPR-").concat(a.mprPlane),n=t,o=1,i=!1,l=function(){var l="".concat(n,".").concat(r);void 0===a.props.fsCurrentList.find((function(e){return e.name===l}))?(O.transaction("rw",O.files,(function(){return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.a.awrap(O.files.add({parent:a.props.fsCurrentDir,name:l,type:r,size:e.byteLength,data:e}));case 2:case"end":return t.stop()}}))})).then((function(){a.props.makeFsRefresh()})),i=!0):(n="".concat(t," - ").concat(o),o++)};do{l()}while(!i)}))}))}break;case"cine":a.setState({visibleCinePlayer:!a.state.visibleCinePlayer});break;case"reset":a.reset();break;case"removetool":console.log("removetool index: ",t);var x=a.dicomImage;ge.removeToolState(x,a.measurements[t].tool,a.measurements[t].data),pe.updateImage(x),a.measurementRemove(t),a.props.setActiveMeasurements(a.measurements);break;case"removetools":var I=a.dicomImage;a.measurements.forEach((function(e){ge.clearToolState(I,e.tool)})),pe.updateImage(I),a.measurementClear(),Pe.measurement.where("sopinstanceuid").equals(a.sopInstanceUid).delete(),a.props.setActiveMeasurements(a.measurements);break;case"savetools":Pe.measurement.where("sopinstanceuid").equals(a.sopInstanceUid).delete(),a.measurements.forEach((function(e){try{Pe.measurement.add({sopinstanceuid:a.sopInstanceUid,tool:e.tool,note:e.note,data:e.data})}catch(t){console.error(t)}}))}},a.cropCanvas=function(e,t,a,n,o){console.log("canvas: ".concat(e.width,", ").concat(e.height)),console.log("x, y: ".concat(t,", ").concat(a)),console.log("width, height: ".concat(n,", ").concat(o));var r=document.createElement("canvas");return r.width=n,r.height=o,r.getContext("2d").drawImage(e,t,a,n,o,0,0,n,o),r},a.changeTool=function(e,t){switch(console.log("change tool, value: ",e,t),e){case"Wwwc":1===t?ge.setToolActive("Wwwc",{mouseButtonMask:1}):0===t&&ge.setToolPassive("Wwwc");break;case"Pan":1===t?ge.setToolActive("Pan",{mouseButtonMask:1}):0===t&&ge.setToolPassive("Pan");break;case"Zoom":1===t?ge.setToolActive(R.isMobile?"ZoomTouchPinch":"Zoom",{mouseButtonMask:1}):0===t&&ge.setToolPassive(R.isMobile?"ZoomTouchPinch":"Zoom");break;case"Length":1===t?ge.setToolActive("Length",R.isMobile?{isTouchActive:!0}:{mouseButtonMask:1}):0===t&&ge.setToolPassive("Length");break;case"Probe":1===t?ge.setToolActive("Probe",{mouseButtonMask:1}):0===t&&ge.setToolPassive("Probe");break;case"Angle":1===t?ge.setToolActive("Angle",{mouseButtonMask:1}):0===t&&ge.setToolPassive("Angle");break;case"Magnify":1===t?ge.setToolActive("Magnify",{mouseButtonMask:1}):0===t&&ge.setToolPassive("Magnify");break;case"EllipticalRoi":1===t?ge.setToolActive("EllipticalRoi",{mouseButtonMask:1}):0===t&&ge.setToolPassive("EllipticalRoi");break;case"RectangleRoi":1===t?ge.setToolActive("RectangleRoi",{mouseButtonMask:1}):0===t&&ge.setToolPassive("RectangleRoi");break;case"FreehandRoi":1===t?ge.setToolActive("FreehandRoi",{mouseButtonMask:1}):0===t&&ge.setToolPassive("FreehandRoi")}},a.runCinePlayer=function(e){var t=a.dicomImage;switch(e){case"firstframe":a.setState({frame:1}),Oe(t,0);break;case"previousframe":if(a.state.frame>1){var n=a.state.frame-1;a.setState({frame:n}),Oe(t,n-1)}break;case"play":ge.playClip(t,30),a.setState({inPlay:!0});break;case"pause":ge.stopClip(t),a.setState({inPlay:!1});break;case"nextframe":if(a.state.frame<a.numberOfFrames){var o=a.state.frame+1;a.setState({frame:o}),Oe(t,o-1)}break;case"lastframe":var r=a.numberOfFrames;a.setState({frame:r}),Oe(t,r-1)}},a.reset=function(){var e=a.dicomImage,t=pe.getDefaultViewportForImage(e,a.image),n=pe.getViewport(e);n.voi.windowWidth=t.voi.windowWidth,n.voi.windowCenter=t.voi.windowCenter,n.invert=!1,pe.setViewport(e,n)},a.mprPlanePosition=function(){try{if(console.log("is dicom:   "+a.isDicom),!a.isDicom)return a.mprPlane;console.log("image data:   "+a.image.data);var e=a.image.data.string("x00200037").split("\\");console.log("image imageOrientation:   "+e);var t=new Array(6).fill(0);t[0]=parseFloat(e[0]),t[1]=parseFloat(e[1]),t[2]=parseFloat(e[2]),t[3]=parseFloat(e[3]),t[4]=parseFloat(e[4]),t[5]=parseFloat(e[5]);var n=[(t=t.map((function(e){return Math.round(e)})))[1]*t[5]-t[2]*t[4],t[2]*t[3]-t[0]*t[5],t[0]*t[4]-t[1]*t[3]];1===(n=n.map((function(e){return Math.abs(e)})))[0]?a.mprPlane="sagittal":1===n[1]?a.mprPlane="coronal":1===n[2]&&(a.mprPlane="axial")}catch(o){console.log("its not possible to build MPR"),a.mprPlane=""}return console.log("this.mprPlane: "+a.mprPlane),a.mprPlane},a.transpose=function(e){return Object.keys(e[0]).map((function(t){return e.map((function(e){return e[t]}))}))},a.mprRenderYZPlane=function(e,t,n,o){if(null!==a.volume){a.filename=e,pe.disable(a.dicomImage),a.mprPlane="sagittal"===t?"coronal":"sagittal",a.xSize=a.props.files[0].columns,a.ySize=a.props.files[0].rows,a.zSize=o.zDim;var r=Math.round(n/a.xSize*a.props.files.length);if(a.originImage=a.props.files[r].image,"sagittal"===t){for(var i=Math.floor(a.xSize/2)-Math.floor(a.zSize/2),l=new Int16Array(a.xSize*a.ySize),s=0;s<a.ySize;s++)for(var c=0;c<a.zSize;c++)l[c+a.ySize*s+i]=a.volume[c][n+a.ySize*s];a.loadImageFromCustomObject(a.xSize,a.ySize,l)}else if("coronal"===t){for(var m=Math.floor(a.xSize/2)-Math.floor(a.zSize/2),u=new Int16Array(a.xSize*a.ySize),d=0;d<a.ySize;d++)for(var p=0;p<a.zSize;p++)u[p+a.ySize*d+m]=a.volume[p][n+a.ySize*d];a.loadImageFromCustomObject(a.xSize,a.ySize,u)}else{var g=a.mprBuildYZPlane(n);a.loadImageFromCustomObject(a.ySize,a.zSize,g)}}},a.mprBuildYZPlane=function(e){for(var t=new Int16Array(a.ySize*a.zSize),n=0;n<a.ySize;n++)for(var o=0;o<a.zSize;o++)t[n+a.ySize*o]=a.volume[o][e+a.ySize*n];return t},a.mprRenderXZPlane=function(e,t,n,o){if(null!==a.volume){a.filename=e,pe.disable(a.dicomImage),a.mprPlane="sagittal"===t?"axial":"axial"===t?"coronal":"axial",a.xSize=a.props.files[0].columns,a.ySize=a.props.files[0].rows,a.zSize=o.zDim;var r=Math.trunc(n/a.ySize*a.props.files.length);if(a.originImage=a.props.files[r].image,"sagittal"===t){for(var i=Math.floor(a.xSize/2)-Math.floor(a.zSize/2),l=new Int16Array(a.xSize*a.ySize),s=0;s<a.xSize;s++)for(var c=0;c<a.zSize;c++)l[c+a.xSize*s+i]=a.volume[c][s+a.xSize*n];a.loadImageFromCustomObject(a.xSize,a.ySize,l)}else{var m=a.mprBuildXZPlane(n);a.loadImageFromCustomObject(a.xSize,a.zSize,m)}}},a.mprBuildXZPlane=function(e){for(var t=new Int16Array(a.xSize*a.zSize),n=0;n<a.xSize;n++)for(var o=0;o<a.zSize;o++)t[n+a.xSize*o]=a.volume[o][n+a.xSize*e];return t},a.mprIsOrthogonalView=function(){return console.log("---------------------------------------"),console.log("mprPlane: ",a.mprPlane),console.log("this.props.layout[0]: ",a.props.layout[0]),console.log("this.props.layout[1]: ",a.props.layout[1]),console.log("true"),console.log("---------------------------------------"),""!==a.mprPlane&&1===a.props.layout[0]&&3===a.props.layout[1]},a.dicomImageRef=function(e){a.dicomImage=e},a.onImageClick=function(){console.log("onImageClick: ")},a.filename="",a.localfile=null,a.localurl=null,a.fsItem=null,a.dicomImage=null,a.imageId=null,a.image=null,a.isDicom=!1,a.numberOfFrames=1,a.measurements=[],a.xSize=0,a.ySize=0,a.zSize=0,a.volume=null,a.originImage=null,a.mprPlane="",a}return Object(g.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){this.props.runTool(this),this.props.changeTool(this),pe.events.addEventListener("cornerstoneimageloaded",this.onImageLoaded),(0,this.props.dcmRef)(this)}},{key:"componentWillUnmount",value:function(){this.props.runTool(void 0),this.props.changeTool(void 0),(0,this.props.dcmRef)(void 0)}},{key:"componentDidUpdate",value:function(e){var t=this.props.isOpen[this.props.index];this.props.layout!==e.layout&&t&&pe.resize(this.dicomImage)}},{key:"render",value:function(){var e=this.props.isOpen[this.props.index];console.log("isOpen: "+e);var t=this.state.visibleOpenUrlDlg,a=this.state.errorOnOpenImage,n=this.state.progress,r={width:"100%",height:"100%",border:this.props.activeDcmIndex===this.props.index&&(this.props.layout[0]>1||this.props.layout[1]>1)?"solid 1px #AAAAAA":null,position:"relative"},i=G();return console.log("overlay: "+i),o.a.createElement("div",{className:"container",style:r},t?o.a.createElement(xe,{progress:n,onClose:this.hideOpenUrlDlg}):null,o.a.createElement(oe.a,{open:null!==a,onClose:this.onErrorOpenImageClose},o.a.createElement(se.a,{id:"alert-dialog-title"},"Error on opening image"),o.a.createElement(ie.a,null,o.a.createElement(le.a,{id:"alert-dialog-description"},this.state.errorOnOpenImage)),o.a.createElement(re.a,null,o.a.createElement(ne.a,{onClick:this.onErrorOpenImageClose,autoFocus:!0},"Ok"))),o.a.createElement(oe.a,{open:this.state.errorOnCors,onClose:this.onErrorCorsClose,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},o.a.createElement(se.a,{id:"alert-dialog-title"},"Error on loading image"),o.a.createElement(ie.a,null,o.a.createElement(le.a,{id:"alert-dialog-description"},o.a.createElement(me.a,{gutterBottom:!0},"CORS or Cross Origin Resource Sharing is a browser security policy that prevents javascript from loading data from a server with a different base URL than the server that served up the javascript file."),o.a.createElement(me.a,{gutterBottom:!0},"See the \xa0",o.a.createElement(ce.a,{href:"http://enable-cors.org/",target:"_blank",color:"textPrimary"},"Enable CORS site"),"\xa0 for information about CORS."))),o.a.createElement(re.a,null,o.a.createElement(ne.a,{onClick:this.onErrorCorsClose,autoFocus:!0},"Ok"))),o.a.createElement("div",{style:{width:"100%",height:"100%",position:"relative",color:"#FFFFFF",textShadow:"1px 1px #000000"},onContextMenu:function(){return!1},className:"cornerstone-enabled-image"},o.a.createElement("div",{ref:this.dicomImageRef,style:{width:"100%",height:"100%",position:"relative"}}),o.a.createElement("div",{id:"mrtopleft-".concat(this.props.index),style:{position:"absolute",top:0,left:3,display:e&&i?"":"none"}}),o.a.createElement("div",{id:"mrtopright-".concat(this.props.index),style:{position:"absolute",top:0,right:3,display:e&&i?"":"none"}}),o.a.createElement("div",{id:"mrbottomright-".concat(this.props.index),style:{position:"absolute",bottom:0,right:3,display:e&&i?"":"none"}}),o.a.createElement("div",{id:"mrbottomleft-".concat(this.props.index),style:{position:"absolute",bottom:0,left:3,display:e&&i?"":"none"}}),o.a.createElement("div",{id:"mrtopcenter-".concat(this.props.index),style:{position:"absolute",top:0,width:"60px",left:"50%",marginLeft:"0px",display:e&&i?"":"none"}}),o.a.createElement("div",{id:"mrleftcenter-".concat(this.props.index),style:{position:"absolute",top:"50%",width:"30px",left:3,marginLeft:"0px",display:e&&i?"":"none"}}),o.a.createElement("div",{id:"mrrightcenter-".concat(this.props.index),style:{position:"absolute",top:"50%",width:"30px",right:3,marginRight:"-20px",display:e&&i?"":"none"}}),o.a.createElement("div",{id:"mrbottomcenter-".concat(this.props.index),style:{position:"absolute",bottom:0,width:"60px",left:"50%",marginLeft:"0px",display:e&&i?"":"none"}}),this.state.visibleCinePlayer&&this.numberOfFrames>1?o.a.createElement("div",{style:{position:"absolute",width:"100%",bottom:0,textAlign:"center"}},o.a.createElement("div",{style:{margin:"0 auto",width:"240px",backgroundColor:"rgba(136, 136, 136, 0.5)"}},o.a.createElement(Me,{runCinePlayer:this.runCinePlayer,inPlay:this.state.inPlay}),o.a.createElement("div",{id:"frameLabel-".concat(this.props.index),style:{width:230,margin:"0 auto",marginTop:-10,textAlign:"center"}},this.state.frame," / ",this.numberOfFrames))):null))}}]),t}(o.a.Component),Te=Object(h.b)((function(e){return{files:e.files,url:e.url,isOpen:e.isOpen,tool:e.tool,activeDcmIndex:e.activeDcmIndex,activeDcm:e.activeDcm,measurements:e.measurements,layout:e.layout,fsCurrentDir:e.fsCurrentDir,fsCurrentList:e.fsCurrentList,volume:e.volume,lut:e.lut}}),(function(e){return{clearingStore:function(){return e({type:"CLEAR_STORE"})},setIsOpenStore:function(t){return e(Y(t))},toolStore:function(t){return e(q(t))},setActiveDcm:function(t){return e(Q(t))},setActiveMeasurements:function(t){return e(K(t))},makeFsRefresh:function(t){return e({type:"FSREFRESH"})}}}))(Re),ke=Object(ge.import)("util/scrollToIndex");ge.external.cornerstone=pe,ge.external.cornerstoneMath=fe,ve.external.cornerstone=pe,he.external.cornerstone=pe,Se.external.cornerstone=pe,Se.external.dicomParser=I,ge.external.Hammer=de.a,ge.init();var Le=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={visibleOpenUrlDlg:!1,progress:null,visibleCinePlayer:!1,errorOnOpenImage:null,errorOnCors:!1,frame:1,inPlay:!1,viewport:null},a.onOpenUrl=function(e){var t=e.detail;a.setState({progress:t.percentComplete})},a.showOpenUrlDlg=function(e){a.setState({visibleOpenUrlDlg:!0},(function(){pe.events.addEventListener("cornerstoneimageloadprogress",a.onOpenUrl),a.loadImage(void 0,e)}))},a.hideOpenUrlDlg=function(){a.setState({visibleOpenUrlDlg:!1,progress:null})},a.measurementSave=function(e){a.measurements.push(e)},a.measurementClear=function(){a.measurements.splice(0,a.measurements.length)},a.measurementRemove=function(e){a.measurements.splice(e,1)},a.getTransferSyntax=function(){var e=a.image.data.string("x00020010");return e+" ["+Ee[e]+"]"},a.getSopClass=function(){var e=a.image.data.string("x00080016");return e+" ["+Ee[e]+"]"},a.getSopInstanceUID=function(){return a.image.data.string("x00080018")},a.getPixelRepresentation=function(){var e=a.image.data.uint16("x00280103");if(void 0!==e)return e+(0===e?" (unsigned)":" (signed)")},a.getPlanarConfiguration=function(){var e=a.image.data.uint16("x00280006");if(void 0!==e)return e+(0===e?" (pixel)":" (plane)")},a.onImageLoaded=function(e){},a.onImageRendered=function(e){var t=pe.getViewport(e.target);if(document.getElementById("mrtopleft-".concat(a.props.index)).textContent=a.mprIsOrthogonalView()?"".concat(T(a.mprPlane)):"".concat(a.PatientsName),document.getElementById("mrtopright-".concat(a.props.index)).textContent="".concat(t.displayedArea.brhc.x,"x").concat(t.displayedArea.brhc.y),document.getElementById("mrbottomleft-".concat(a.props.index)).textContent="WW/WC: ".concat(Math.round(t.voi.windowWidth),"/").concat(Math.round(t.voi.windowCenter)),document.getElementById("mrbottomright-".concat(a.props.index)).textContent="Zoom: ".concat(Math.round(100*t.scale.toFixed(2)),"%"),document.getElementById("mrtopcenter-".concat(a.props.index)).textContent="",document.getElementById("mrbottomcenter-".concat(a.props.index)).textContent="",document.getElementById("mrleftcenter-".concat(a.props.index)).textContent="",document.getElementById("mrrightcenter-".concat(a.props.index)).textContent="","sagittal"===a.mprPlane?(document.getElementById("mrtopcenter-".concat(a.props.index)).textContent="S",document.getElementById("mrbottomcenter-".concat(a.props.index)).textContent="I",document.getElementById("mrleftcenter-".concat(a.props.index)).textContent="A",document.getElementById("mrrightcenter-".concat(a.props.index)).textContent="P"):"axial"===a.mprPlane?(document.getElementById("mrtopcenter-".concat(a.props.index)).textContent="A",document.getElementById("mrbottomcenter-".concat(a.props.index)).textContent="P",document.getElementById("mrleftcenter-".concat(a.props.index)).textContent="R",document.getElementById("mrrightcenter-".concat(a.props.index)).textContent="L"):"coronal"===a.mprPlane&&(document.getElementById("mrtopcenter-".concat(a.props.index)).textContent="S",document.getElementById("mrbottomcenter-".concat(a.props.index)).textContent="I",document.getElementById("mrleftcenter-".concat(a.props.index)).textContent="R",document.getElementById("mrrightcenter-".concat(a.props.index)).textContent="L"),a.isDicom&&a.state.visibleCinePlayer&&a.numberOfFrames>1&&(document.getElementById("frameLabel-".concat(a.props.index)).textContent="".concat(a.state.frame," / ").concat(a.numberOfFrames),a.state.inPlay)){var n=a.state.frame===a.numberOfFrames?1:a.state.frame+1;a.setState({frame:n})}},a.onMeasurementModified=function(e){},a.onMeasurementAdded=function(e){if("Angle"===a.props.tool){var t={tool:a.props.tool,note:"",data:e.detail.measurementData};a.measurementSave(t),a.props.setActiveMeasurements(a.measurements)}},a.onMeasurementCompleted=function(e){var t={tool:a.props.tool,note:"",data:e.detail.measurementData};"FreehandRoi"===a.props.tool?setTimeout((function(){a.measurementSave(t),a.props.setActiveMeasurements(a.measurements)}),500):(a.measurementSave(t),a.props.setActiveMeasurements(a.measurements))},a.onErrorOpenImageClose=function(){a.setState({errorOnOpenImage:null})},a.onErrorCorsClose=function(){a.setState({errorOnCors:!1})},a.displayImageFromFilesByImage=function(e,t){var n=a.dicomImage;pe.enable(n),pe.displayImage(n,t)},a.displayImageFromFiles=function(e){var t=a.props.files[e].image,n=a.props.files[e].imageId;a.filename=a.props.files[e].name;var o=a.dicomImage;o.addEventListener("cornerstonenewimage",a.onNewImage),o.addEventListener("cornerstoneimagerendered",a.onImageRendered),o.addEventListener("cornerstonetoolsmeasurementadded",a.onMeasurementAdded),o.addEventListener("cornerstonetoolsmeasurementmodified",a.onMeasurementModified),o.addEventListener("cornerstonetoolsmeasurementcompleted",a.onMeasurementCompleted),pe.enable(o),a.image=t,a.isDicom=!0,a.PatientsName=t.data.string("x00100010"),a.sopInstanceUid=a.getSopInstanceUID();var r={currentImageIdIndex:0,imageIds:""};if(a.numberOfFrames=t.data.intString("x00280008"),a.numberOfFrames>0){for(var i=[],l=0;l<a.numberOfFrames;++l)i.push(n+"?frame="+l);r.imageIds=i}pe.displayImage(o,t),a.mprPlanePosition(),a.enableTool(),a.numberOfFrames>1&&(ge.addStackStateManager(o,["stack","playClip"]),ge.addToolState(o,"stack",r),a.setState({frame:1})),Pe.measurement.where("sopinstanceuid").equals(a.sopInstanceUid).each((function(e){console.log("load measure from db: ",e),a.measurementSave(e),ge.addToolState(o,e.tool,e.data),a.runTool(e.tool),pe.updateImage(o),ge.setToolEnabled(e.tool)})).then((function(){a.props.setActiveMeasurements(a.measurements),a.props.setActiveDcm({image:a.image,element:a.dicomImage,isDicom:a.isDicom}),a.props.setIsOpenStore({index:a.props.index,value:!0})}))},a.loadImageFromCanvas=function(e){console.log("loadImageFromCanvas, dcmViewer: ",a.props.index);var t=a.dicomImage;t.addEventListener("cornerstonenewimage",a.onNewImage),t.addEventListener("cornerstoneimagerendered",a.onImageRendered),t.addEventListener("cornerstonetoolsmeasurementadded",a.onMeasurementAdded),t.addEventListener("cornerstonetoolsmeasurementmodified",a.onMeasurementModified),t.addEventListener("cornerstonetoolsmeasurementcompleted",a.onMeasurementCompleted),pe.enable(t);var n=ve.fileManager.addCanvas(e);pe.loadImage(n).then((function(e){console.log("loadImageFromCanvas, image: ",e),a.image=e,a.isDicom=!1,pe.displayImage(t,e),a.enableTool(),a.props.setIsOpenStore({index:a.props.index,value:!0})}),(function(e){console.log("error",e),a.setState({errorOnOpenImage:"This is not a valid canvas."})}))},a.loadImageFromCustomObject=function(e,t,n){var o=a.dicomImage;o.addEventListener("cornerstonenewimage",a.onNewImage),o.addEventListener("cornerstoneimagerendered",a.onImageRendered),o.addEventListener("cornerstonetoolsmeasurementadded",a.onMeasurementAdded),o.addEventListener("cornerstonetoolsmeasurementmodified",a.onMeasurementModified),o.addEventListener("cornerstonetoolsmeasurementcompleted",a.onMeasurementCompleted),pe.enable(o);var r={rows:t,columns:e,pixelData:n,image:a.originImage},i=ve.fileManager.addCustom(r);pe.loadImage(i).then((function(e){a.image=e,a.isDicom=!0,pe.displayImage(o,e),a.props.setIsOpenStore({index:a.props.index,value:!0})}),(function(e){console.log("error",e),a.setState({errorOnOpenImage:"This is not a valid canvas."})}))},a.loadImage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(console.log("loadImage, localfile: ",e),console.log("loadImage, fsItem: ",n),console.log("loadImage, url: ",t),void 0!==e||void 0!==t||void 0!==n){void 0!==n?a.fsItem=n:void 0!==e?a.localfile=e:a.localurl=t;var o=a.dicomImage;o.addEventListener("cornerstonenewimage",a.onNewImage),o.addEventListener("cornerstoneimagerendered",a.onImageRendered),o.addEventListener("cornerstonetoolsmeasurementadded",a.onMeasurementAdded),o.addEventListener("cornerstonetoolsmeasurementmodified",a.onMeasurementModified),o.addEventListener("cornerstonetoolsmeasurementcompleted",a.onMeasurementCompleted);var r=void 0;pe.enable(o);var i=0;void 0===e&&L(t)?pe.loadImage(t).then((function(e){a.hideOpenUrlDlg(),a.image=e,a.isDicom=!1,pe.displayImage(o,e),a.enableTool(),a.props.setActiveDcm({image:a.image,element:a.dicomImage,isDicom:a.isDicom}),a.props.isOpenStore(!0)}),(function(e){console.log("error",e),a.setState({errorOnOpenImage:"This is not a valid JPG or PNG file."})})):void 0!==e&&A(e)||void 0!==n&&z(n)?(r=void 0!==n?ve.fileManager.addBuffer(n.data):ve.fileManager.add(e),pe.loadImage(r).then((function(e){a.image=e,a.isDicom=!1,a.PatientsName="",pe.displayImage(o,e),a.enableTool(),a.props.setActiveDcm({image:a.image,element:a.dicomImage,isDicom:a.isDicom}),a.props.setIsOpenStore({index:a.props.index,value:!0})}),(function(e){console.log("error",e),a.setState({errorOnOpenImage:"This is not a valid JPG or PNG file."})}))):(void 0!==n?(r=Se.wadouri.fileManager.addBuffer(n.data),a.filename=n.name,i=n.size):void 0!==e?(r=Se.wadouri.fileManager.add(e),a.filename=e.name,i=e.size):r="wadouri:"+t,pe.loadAndCacheImage(r).then((function(e){console.log("loadImage, image: ",e),a.hideOpenUrlDlg(),a.image=e,a.isDicom=!0;var t=I.parseDicom(e.data.byteArray);console.log("image dataset -----: "+t.string("x00200011")),console.log("Series Number: "+e.data.string("x00200011")),a.PatientsName=e.data.string("x00100010"),console.log("PatientsName: "+a.PatientsName),a.sopInstanceUid=a.getSopInstanceUID();var n={currentImageIdIndex:0,imageIds:""};if(a.numberOfFrames=e.data.intString("x00280008"),a.numberOfFrames>0){for(var l=[],s=0;s<a.numberOfFrames;++s)l.push(r+"?frame="+s);n.imageIds=l}pe.displayImage(o,e),a.enableTool(),a.numberOfFrames>1&&(ge.addStackStateManager(o,["stack","playClip"]),ge.addToolState(o,"stack",n),a.setState({frame:1})),Pe.measurement.where("sopinstanceuid").equals(a.sopInstanceUid).each((function(e){console.log("load measure from db: ",e),a.measurementSave(e),ge.addToolState(o,e.tool,e.data),a.runTool(e.tool),pe.updateImage(o),ge.setToolEnabled(e.tool)})).then((function(){a.props.setActiveMeasurements(a.measurements),a.props.setActiveDcm({name:a.filename,size:i,image:a.image,element:a.dicomImage,isDicom:a.isDicom}),a.props.setIsOpenStore({index:a.props.index,value:!0})}))}),(function(e){console.log("error",e),a.hideOpenUrlDlg();var t=e.error.toString();if("[object XMLHttpRequest]"===t)a.setState({errorOnCors:!0});else{var n=t.indexOf(":");a.setState({errorOnOpenImage:n<0?e.error:t.substring(n+1)})}})))}},a.enableTool=function(e,t){var a=ge.WwwcTool,n=ge.LengthTool,o=ge.PanTool,r=ge.ZoomTouchPinchTool,i=ge.ZoomTool,l=ge.ProbeTool,s=ge.EllipticalRoiTool,c=ge.RectangleRoiTool,m=ge.FreehandRoiTool,u=ge.AngleTool,d=ge.MagnifyTool,p=ge.StackScrollMouseWheelTool;ge.addTool(d),ge.addTool(u),ge.addTool(a),ge.addTool(n),ge.addTool(o),ge.addTool(r),ge.addTool(i),ge.addTool(l),ge.addTool(s),ge.addTool(c),ge.addTool(m),ge.addTool(p)},a.disableAllTools=function(){ge.setToolEnabled("Length"),ge.setToolEnabled("Pan"),ge.setToolEnabled("Magnify"),ge.setToolEnabled("Angle"),ge.setToolEnabled("RectangleRoi"),ge.setToolEnabled("Wwwc"),ge.setToolEnabled("ZoomTouchPinch"),ge.setToolEnabled("Probe"),ge.setToolEnabled("EllipticalRoi"),ge.setToolEnabled("FreehandRoi"),ge.setToolEnabled("StackScrollMouseWheel")},a.runTool2=function(e,t){pe.disable(a.dicomImage),a.displayImageFromFilesByImage(e,t)},a.runTool=function(e,t){switch(e){case"openImage":pe.disable(a.dicomImage);break;case"openimage":pe.disable(a.dicomImage),a.displayImageFromFiles(t);break;case"openLocalFs":console.log("openLocalFs: ",t),pe.disable(a.dicomImage),a.loadImage(t);break;case"openSandboxFs":pe.disable(a.dicomImage),a.loadImage(void 0,void 0,t);break;case"openurl":a.showOpenUrlDlg(t);break;case"clear":a.setState({visibleCinePlayer:!1}),a.mprPlane="",pe.disable(a.dicomImage);break;case"notool":a.disableAllTools();break;case"Wwwc":ge.setToolActive("Wwwc",{mouseButtonMask:1});break;case"Pan":ge.setToolActive("Pan",{mouseButtonMask:1});break;case"Zoom":ge.setToolActive(R.isMobile?"ZoomTouchPinch":"Zoom",{mouseButtonMask:1});break;case"Length":ge.setToolActive("Length",R.isMobile?{isTouchActive:!0}:{mouseButtonMask:1});break;case"Probe":ge.setToolActive("Probe",{mouseButtonMask:1});break;case"EllipticalRoi":ge.setToolActive("EllipticalRoi",{mouseButtonMask:1});break;case"RectangleRoi":ge.setToolActive("RectangleRoi",{mouseButtonMask:1});break;case"Angle":ge.setToolActive("Angle",{mouseButtonMask:1});break;case"Magnify":ge.setToolActive("Magnify",{mouseButtonMask:1});break;case"FreehandRoi":ge.setToolActive("FreehandRoi",{mouseButtonMask:1});break;case"Invert":var n=a.dicomImage,o=pe.getViewport(n);o.invert=!o.invert,pe.setViewport(n,o);break;case"saveas":var r=localStorage.getItem("saveAs");if("local"===U()){var i=a.dicomImage,l=pe.getViewport(i),c=document.getElementsByClassName("cornerstone-canvas")[a.props.activeDcmIndex],m=l.scale.toFixed(2),u=a.image.columns*m,d=a.image.rows*m,p=document.createElement("canvas");p=a.cropCanvas(c,Math.round(c.width/2-u/2),Math.round(c.height/2-d/2),u,d);var g=document.createElement("a");g.href=p.toDataURL("image/".concat(r)),g.download="".concat(a.filename,".").concat(r),document.body.appendChild(g),g.click()}else{var f=a.dicomImage,v=pe.getViewport(f),h=document.getElementsByClassName("cornerstone-canvas")[a.props.activeDcmIndex],S=v.scale.toFixed(2),b=a.image.columns*S,E=a.image.rows*S,y=document.createElement("canvas");y=a.cropCanvas(h,Math.round(h.width/2-b/2),Math.round(h.height/2-E/2),b,E),be.b(y,"image/".concat(r)).then((function(e){be.a(e).then((function(e){var t="".concat(j(a.filename),"-MPR-").concat(a.mprPlane),n=t,o=1,i=!1,l=function(){var l="".concat(n,".").concat(r);void 0===a.props.fsCurrentList.find((function(e){return e.name===l}))?(O.transaction("rw",O.files,(function(){return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.a.awrap(O.files.add({parent:a.props.fsCurrentDir,name:l,type:r,size:e.byteLength,data:e}));case 2:case"end":return t.stop()}}))})).then((function(){a.props.makeFsRefresh()})),i=!0):(n="".concat(t," - ").concat(o),o++)};do{l()}while(!i)}))}))}break;case"cine":a.setState({visibleCinePlayer:!a.state.visibleCinePlayer});break;case"reset":a.reset();break;case"removetool":console.log("removetool index: ",t);var x=a.dicomImage;ge.removeToolState(x,a.measurements[t].tool,a.measurements[t].data),pe.updateImage(x),a.measurementRemove(t),a.props.setActiveMeasurements(a.measurements);break;case"removetools":var I=a.dicomImage;a.measurements.forEach((function(e){ge.clearToolState(I,e.tool)})),pe.updateImage(I),a.measurementClear(),Pe.measurement.where("sopinstanceuid").equals(a.sopInstanceUid).delete(),a.props.setActiveMeasurements(a.measurements);break;case"savetools":Pe.measurement.where("sopinstanceuid").equals(a.sopInstanceUid).delete(),a.measurements.forEach((function(e){try{Pe.measurement.add({sopinstanceuid:a.sopInstanceUid,tool:e.tool,note:e.note,data:e.data})}catch(t){console.error(t)}}))}},a.cropCanvas=function(e,t,a,n,o){console.log("canvas: ".concat(e.width,", ").concat(e.height)),console.log("x, y: ".concat(t,", ").concat(a)),console.log("width, height: ".concat(n,", ").concat(o));var r=document.createElement("canvas");return r.width=n,r.height=o,r.getContext("2d").drawImage(e,t,a,n,o,0,0,n,o),r},a.changeTool=function(e,t){switch(console.log("change tool, value: ",e,t),e){case"Wwwc":1===t?ge.setToolActive("Wwwc",{mouseButtonMask:1}):0===t&&ge.setToolPassive("Wwwc");break;case"Pan":1===t?ge.setToolActive("Pan",{mouseButtonMask:1}):0===t&&ge.setToolPassive("Pan");break;case"Zoom":1===t?ge.setToolActive(R.isMobile?"ZoomTouchPinch":"Zoom",{mouseButtonMask:1}):0===t&&ge.setToolPassive(R.isMobile?"ZoomTouchPinch":"Zoom");break;case"Length":1===t?ge.setToolActive("Length",R.isMobile?{isTouchActive:!0}:{mouseButtonMask:1}):0===t&&ge.setToolPassive("Length");break;case"Probe":1===t?ge.setToolActive("Probe",{mouseButtonMask:1}):0===t&&ge.setToolPassive("Probe");break;case"Angle":1===t?ge.setToolActive("Angle",{mouseButtonMask:1}):0===t&&ge.setToolPassive("Angle");break;case"Magnify":1===t?ge.setToolActive("Magnify",{mouseButtonMask:1}):0===t&&ge.setToolPassive("Magnify");break;case"EllipticalRoi":1===t?ge.setToolActive("EllipticalRoi",{mouseButtonMask:1}):0===t&&ge.setToolPassive("EllipticalRoi");break;case"RectangleRoi":1===t?ge.setToolActive("RectangleRoi",{mouseButtonMask:1}):0===t&&ge.setToolPassive("RectangleRoi");break;case"FreehandRoi":1===t?ge.setToolActive("FreehandRoi",{mouseButtonMask:1}):0===t&&ge.setToolPassive("FreehandRoi")}},a.runCinePlayer=function(e){var t=a.dicomImage;switch(e){case"firstframe":a.setState({frame:1}),ke(t,0);break;case"previousframe":if(a.state.frame>1){var n=a.state.frame-1;a.setState({frame:n}),ke(t,n-1)}break;case"play":ge.playClip(t,30),a.setState({inPlay:!0});break;case"pause":ge.stopClip(t),a.setState({inPlay:!1});break;case"nextframe":if(a.state.frame<a.numberOfFrames){var o=a.state.frame+1;a.setState({frame:o}),ke(t,o-1)}break;case"lastframe":var r=a.numberOfFrames;a.setState({frame:r}),ke(t,r-1)}},a.reset=function(){var e=a.dicomImage,t=pe.getDefaultViewportForImage(e,a.image),n=pe.getViewport(e);n.voi.windowWidth=t.voi.windowWidth,n.voi.windowCenter=t.voi.windowCenter,n.invert=!1,pe.setViewport(e,n)},a.mprPlanePosition=function(){try{if(!a.isDicom)return a.mprPlane;var e=a.image.data.string("x00200037").split("\\"),t=new Array(6).fill(0);t[0]=parseFloat(e[0]),t[1]=parseFloat(e[1]),t[2]=parseFloat(e[2]),t[3]=parseFloat(e[3]),t[4]=parseFloat(e[4]),t[5]=parseFloat(e[5]);var n=[(t=t.map((function(e){return Math.round(e)})))[1]*t[5]-t[2]*t[4],t[2]*t[3]-t[0]*t[5],t[0]*t[4]-t[1]*t[3]];1===(n=n.map((function(e){return Math.abs(e)})))[0]?a.mprPlane="sagittal":1===n[1]?a.mprPlane="coronal":1===n[2]&&(a.mprPlane="axial")}catch(o){a.mprPlane=""}return a.mprPlane},a.transpose=function(e){return Object.keys(e[0]).map((function(t){return e.map((function(e){return e[t]}))}))},a.mprRenderYZPlane=function(e,t,n,o){if(null!==a.volume){a.filename=e,pe.disable(a.dicomImage),a.mprPlane="sagittal"===t?"coronal":"sagittal",a.xSize=a.props.files[0].columns,a.ySize=a.props.files[0].rows,a.zSize=o.zDim;var r=Math.round(n/a.xSize*a.props.files.length);if(a.originImage=a.props.files[r].image,"sagittal"===t){for(var i=Math.floor(a.xSize/2)-Math.floor(a.zSize/2),l=new Int16Array(a.xSize*a.ySize),s=0;s<a.ySize;s++)for(var c=0;c<a.zSize;c++)l[c+a.ySize*s+i]=a.volume[c][n+a.ySize*s];a.loadImageFromCustomObject(a.xSize,a.ySize,l)}else if("coronal"===t){for(var m=Math.floor(a.xSize/2)-Math.floor(a.zSize/2),u=new Int16Array(a.xSize*a.ySize),d=0;d<a.ySize;d++)for(var p=0;p<a.zSize;p++)u[p+a.ySize*d+m]=a.volume[p][n+a.ySize*d];a.loadImageFromCustomObject(a.xSize,a.ySize,u)}else{var g=a.mprBuildYZPlane(n);a.loadImageFromCustomObject(a.ySize,a.zSize,g)}}},a.mprBuildYZPlane=function(e){for(var t=new Int16Array(a.ySize*a.zSize),n=0;n<a.ySize;n++)for(var o=0;o<a.zSize;o++)t[n+a.ySize*o]=a.volume[o][e+a.ySize*n];return t},a.mprRenderXZPlane=function(e,t,n,o){if(null!==a.volume){a.filename=e,pe.disable(a.dicomImage),a.mprPlane="sagittal"===t?"axial":"axial"===t?"coronal":"axial",a.xSize=a.props.files[0].columns,a.ySize=a.props.files[0].rows,a.zSize=o.zDim;var r=Math.trunc(n/a.ySize*a.props.files.length);if(a.originImage=a.props.files[r].image,"sagittal"===t){for(var i=Math.floor(a.xSize/2)-Math.floor(a.zSize/2),l=new Int16Array(a.xSize*a.ySize),s=0;s<a.xSize;s++)for(var c=0;c<a.zSize;c++)l[c+a.xSize*s+i]=a.volume[c][s+a.xSize*n];a.loadImageFromCustomObject(a.xSize,a.ySize,l)}else{var m=a.mprBuildXZPlane(n);a.loadImageFromCustomObject(a.xSize,a.zSize,m)}}},a.mprBuildXZPlane=function(e){for(var t=new Int16Array(a.xSize*a.zSize),n=0;n<a.xSize;n++)for(var o=0;o<a.zSize;o++)t[n+a.xSize*o]=a.volume[o][n+a.xSize*e];return t},a.mprIsOrthogonalView=function(){return""!==a.mprPlane&&1===a.props.layout[0]&&3===a.props.layout[1]},a.dicomImageRef=function(e){a.dicomImage=e},a.onImageClick=function(){console.log("onImageClick: ")},a.filename="",a.localfile=null,a.localurl=null,a.fsItem=null,a.dicomImage=null,a.imageId=null,a.image=null,a.isDicom=!1,a.numberOfFrames=1,a.measurements=[],a.xSize=0,a.ySize=0,a.zSize=0,a.volume=null,a.originImage=null,a.mprPlane="",a}return Object(g.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){this.props.runTool(this),this.props.changeTool(this),pe.events.addEventListener("cornerstoneimageloaded",this.onImageLoaded),(0,this.props.dcmRef)(this)}},{key:"componentWillUnmount",value:function(){this.props.runTool(void 0),this.props.changeTool(void 0),(0,this.props.dcmRef)(void 0)}},{key:"componentDidUpdate",value:function(e){var t=this.props.isOpen[this.props.index];this.props.layout!==e.layout&&t&&pe.resize(this.dicomImage)}},{key:"render",value:function(){var e=this.props.isOpen[this.props.index],t=this.state.visibleOpenUrlDlg,a=this.state.errorOnOpenImage,n=this.state.progress,r={width:"100%",height:"100%",border:this.props.activeDcmIndex===this.props.index&&(this.props.layout[0]>1||this.props.layout[1]>1)?"solid 1px #AAAAAA":null,position:"relative"},i=G();return o.a.createElement("div",{className:"container",style:r},t?o.a.createElement(xe,{progress:n,onClose:this.hideOpenUrlDlg}):null,o.a.createElement(oe.a,{open:null!==a,onClose:this.onErrorOpenImageClose},o.a.createElement(se.a,{id:"alert-dialog-title"},"Error on opening image"),o.a.createElement(ie.a,null,o.a.createElement(le.a,{id:"alert-dialog-description"},this.state.errorOnOpenImage)),o.a.createElement(re.a,null,o.a.createElement(ne.a,{onClick:this.onErrorOpenImageClose,autoFocus:!0},"Ok"))),o.a.createElement(oe.a,{open:this.state.errorOnCors,onClose:this.onErrorCorsClose,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},o.a.createElement(se.a,{id:"alert-dialog-title"},"Error on loading image"),o.a.createElement(ie.a,null,o.a.createElement(le.a,{id:"alert-dialog-description"},o.a.createElement(me.a,{gutterBottom:!0},"CORS or Cross Origin Resource Sharing is a browser security policy that prevents javascript from loading data from a server with a different base URL than the server that served up the javascript file."),o.a.createElement(me.a,{gutterBottom:!0},"See the \xa0",o.a.createElement(ce.a,{href:"http://enable-cors.org/",target:"_blank",color:"textPrimary"},"Enable CORS site"),"\xa0 for information about CORS."))),o.a.createElement(re.a,null,o.a.createElement(ne.a,{onClick:this.onErrorCorsClose,autoFocus:!0},"Ok"))),o.a.createElement("div",{style:{width:"100%",height:"100%",position:"relative",color:"#FFFFFF",textShadow:"1px 1px #000000"},onContextMenu:function(){return!1},className:"cornerstone-enabled-image"},o.a.createElement("div",{ref:this.dicomImageRef,style:{width:"100%",height:"100%",position:"relative"}}),o.a.createElement("div",{id:"mrtopleft-".concat(this.props.index),style:{position:"absolute",top:0,left:3,display:e&&i?"":"none"}}),o.a.createElement("div",{id:"mrtopright-".concat(this.props.index),style:{position:"absolute",top:0,right:3,display:e&&i?"":"none"}}),o.a.createElement("div",{id:"mrbottomright-".concat(this.props.index),style:{position:"absolute",bottom:0,right:3,display:e&&i?"":"none"}}),o.a.createElement("div",{id:"mrbottomleft-".concat(this.props.index),style:{position:"absolute",bottom:0,left:3,display:e&&i?"":"none"}}),o.a.createElement("div",{id:"mrtopcenter-".concat(this.props.index),style:{position:"absolute",top:0,width:"60px",left:"50%",marginLeft:"0px",display:e&&i?"":"none"}}),o.a.createElement("div",{id:"mrleftcenter-".concat(this.props.index),style:{position:"absolute",top:"50%",width:"30px",left:3,marginLeft:"0px",display:e&&i?"":"none"}}),o.a.createElement("div",{id:"mrrightcenter-".concat(this.props.index),style:{position:"absolute",top:"50%",width:"30px",right:3,marginRight:"-20px",display:e&&i?"":"none"}}),o.a.createElement("div",{id:"mrbottomcenter-".concat(this.props.index),style:{position:"absolute",bottom:0,width:"60px",left:"50%",marginLeft:"0px",display:e&&i?"":"none"}}),this.state.visibleCinePlayer&&this.numberOfFrames>1?o.a.createElement("div",{style:{position:"absolute",width:"100%",bottom:0,textAlign:"center"}},o.a.createElement("div",{style:{margin:"0 auto",width:"240px",backgroundColor:"rgba(136, 136, 136, 0.5)"}},o.a.createElement(Me,{runCinePlayer:this.runCinePlayer,inPlay:this.state.inPlay}),o.a.createElement("div",{id:"frameLabel-".concat(this.props.index),style:{width:230,margin:"0 auto",marginTop:-10,textAlign:"center"}},this.state.frame," / ",this.numberOfFrames))):null))}}]),t}(o.a.Component),Ae=Object(h.b)((function(e){return{files:e.files,url:e.url,isOpen:e.isOpen,tool:e.tool,activeDcmIndex:e.activeDcmIndex,activeDcm:e.activeDcm,measurements:e.measurements,layout:e.layout,fsCurrentDir:e.fsCurrentDir,fsCurrentList:e.fsCurrentList,volume:e.volume,lut:e.lut}}),(function(e){return{clearingStore:function(){return e({type:"CLEAR_STORE"})},setIsOpenStore:function(t){return e(Y(t))},toolStore:function(t){return e(q(t))},setActiveDcm:function(t){return e(Q(t))},setActiveMeasurements:function(t){return e(K(t))},makeFsRefresh:function(t){return e({type:"FSREFRESH"})}}}))(Le),ze=a(23),Ve=a(329),Be=function(e){var t=e.dcmViewer,a=e.classes,n=e.color,r=[];r.push({name:"Transfer Syntax",value:t.getTransferSyntax()}),r.push({name:"SOP Class",value:t.getSopClass()}),r.push({name:"SOP Instance UID",value:t.getSopInstanceUID()}),r.push({name:"Modality",value:t.image.data.string("x00080060")}),r.push({name:"Manufacturer",value:t.image.data.string("x00080070")}),r.push({name:"Study Description",value:t.image.data.string("x00081030")}),r.push({name:"Series Description",value:t.image.data.string("x0008103E")}),r.push({name:"Patient Name",value:t.image.data.string("x00100010")}),r.push({name:"Frame Rate",value:t.image.data.string("x00082144")}),r.push({name:"MR Acquisition Type",value:t.image.data.string("x00180023")}),r.push({name:"Slice Thickness",value:t.image.data.string("x00180050")}),r.push({name:"Spacing Between Slice",value:t.image.data.string("x00180088")}),r.push({name:"Patient Position",value:t.image.data.string("x00185100")}),r.push({name:"Study ID",value:t.image.data.string("x00200010")}),r.push({name:"Series Number",value:t.image.data.string("x00200011")}),r.push({name:"Acquisition Number",value:t.image.data.string("x00200012")}),r.push({name:"Instance Number",value:t.image.data.string("x00200013")}),r.push({name:"Image Position (Patient)",value:t.image.data.string("x00200032")}),r.push({name:"Image Orientation (Patient)",value:t.image.data.string("x00200037")}),r.push({name:"Images in Acquisition",value:t.image.data.string("x00201002")}),r.push({name:"Slice Location",value:t.image.data.string("x00201041")}),r.push({name:"Samples per Pixel",value:t.image.data.uint16("x00280002")}),r.push({name:"Photometric Interpretation",value:t.image.data.string("x00280004")}),r.push({name:"Number of Frames",value:t.image.data.string("x00280008")}),r.push({name:"Planar Configuration",value:t.getPlanarConfiguration()}),r.push({name:"Rows",value:t.image.data.uint16("x00280010")}),r.push({name:"Columns",value:t.image.data.uint16("x00280011")}),r.push({name:"Pixel Spacing",value:t.image.data.string("x00280030")}),r.push({name:"Bits Allocated",value:t.image.data.uint16("x00280100")}),r.push({name:"Bits Stored",value:t.image.data.uint16("x00280101")}),r.push({name:"High Bit",value:t.image.data.uint16("x00280102")}),r.push({name:"Pixel Representation",value:t.getPixelRepresentation()}),r.push({name:"Window Center",value:t.image.data.string("x00281050")}),r.push({name:"Window Width",value:t.image.data.string("x00281051")}),r.push({name:"Rescale Intercept",value:t.image.data.string("x00281052")}),r.push({name:"Rescale Slope",value:t.image.data.string("x00281053")}),r.push({name:"Min Stored Pixel Value",value:t.image.minPixelValue}),r.push({name:"Max Stored Pixel Value",value:t.image.maxPixelValue}),r.push({name:"Image Orientation",value:t.image.data.string("x00700042")}),r.push({name:"Image Horizontal Flip",value:t.image.data.string("x00700041")});var i=r.map((function(e,t){return void 0!==e.value?o.a.createElement(E.a,{dense:!0,key:t},o.a.createElement(y.a,{primary:e.name,secondary:e.value})):null}));return console.log("dcmViewer",t),o.a.createElement("div",{style:{marginTop:"48px"}},o.a.createElement(Ve.a,{variant:"dense"},o.a.createElement(me.a,{variant:"subtitle1",className:a.title},"Dicom Header"),o.a.createElement("div",{className:a.grow}),o.a.createElement(Fe.a,{color:"inherit",onClick:function(){var e=localStorage.getItem("exportAs");null===e&&(e="json",localStorage.setItem("exportAs",e));var a="";if("csv"===e)a=function(e,t){var a,n,o,r,i,l,s,c=[],m="",u='"';for("undefined"!==typeof t&&null!==t||(t=","),a=0,n=e.length;a<n;a+=1){if(r=e[a],i="",0===a){for(o in r)r.hasOwnProperty(o)&&(c.push(o),i+=[u,o.replace(/"/g,'""'),u,t].join(""));m+=i=i.substring(0,i.length-1)}for(m+="\n",i="",l=0,s=c.length;l<s;l+=1)l>0&&(i+=t),i+=X(r[o=c[l]]);m+=i}return m}(r);else{var n=r.reduce((function(e,t){return Object(ze.a)({},e,Object(f.a)({},t.name,t.value))}),{});a=JSON.stringify(n)}var o=document.createElement("a"),i=new Blob([a],{type:"text/plain"});o.href=URL.createObjectURL(i),o.download="".concat(t.localfile.name,".").concat(e),document.body.appendChild(o),o.click()}},o.a.createElement(Ce.a,{path:De.o,size:"1.2rem",color:n}))),o.a.createElement("div",null,o.a.createElement(b.a,{dense:!0,component:"div"},i)))},Ne=a(175),je=a.n(Ne),Ue=a(176),Ge=a.n(Ue),Ze=a(355),We=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={visibleDlgNote:!1,visibleDlgDelete:!1},a.showDlgNote=function(){a.setState({visibleDlgNote:!0})},a.hideDlgNote=function(){a.setState({visibleDlgNote:!1})},a.showDlgDelete=function(){a.setState({visibleDlgDelete:!0})},a.hideDlgDelete=function(){a.setState({visibleDlgDelete:!1})},a.handleOnChangeNote=function(e){a.setState({note:e.target.value})},a.confirmNote=function(e){a.hideDlgNote(),a.props.measurements[e].note=a.noteField.value},a.confirmDelete=function(e){a.hideDlgDelete(),a.props.toolRemove(e)},a.onEdit=function(){a.showDlgNote()},a.onDelete=function(){a.showDlgDelete()},a.noteField=o.a.createRef(),a}return Object(g.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this,t=this.props.classes,a=this.props.item,n=this.props.index,r="",i="";switch(a.tool){case"Length":r="".concat(a.data.length.toFixed(2)," ").concat(a.data.unit),i=a.note;break;case"Angle":r="".concat(a.data.rAngle," \xb0"),i=a.note;break;case"EllipticalRoi":case"RectangleRoi":r=o.a.createElement("div",null,o.a.createElement("div",null," A: ",a.data.cachedStats.area.toFixed(2)," mm\xb2 "),o.a.createElement("div",null," M: ",a.data.cachedStats.mean.toFixed(2)," ",a.data.unit," "),o.a.createElement("div",null," SD: ",a.data.cachedStats.stdDev.toFixed(2)," ",a.data.unit," ")),i=a.note;break;case"FreehandRoi":r=o.a.createElement("div",null,o.a.createElement("div",null," A: ",a.data.area.toFixed(2)," mm\xb2 "),o.a.createElement("div",null," M: ",a.data.meanStdDev.mean.toFixed(2)," ",a.data.unit," "),o.a.createElement("div",null," SD: ",a.data.meanStdDev.stdDev.toFixed(2)," ",a.data.unit," ")),i=a.note}return o.a.createElement("div",null,o.a.createElement(E.a,null,o.a.createElement(y.a,{classes:{primary:t.listItemText},primary:r,secondary:i}),o.a.createElement(Ve.a,null,o.a.createElement(Fe.a,{edge:"end",onClick:function(){return e.onEdit(n)}},o.a.createElement(je.a,null)),o.a.createElement(Fe.a,{edge:"end",onClick:function(){return e.onDelete(n)}},o.a.createElement(Ge.a,null)))),this.state.visibleDlgNote?o.a.createElement(oe.a,{open:this.state.visibleDlgNote,onClose:this.hideDlgNote,"aria-labelledby":"form-dialog-title"},o.a.createElement(se.a,{id:"form-dialog-title"},"Note for measurement:"),o.a.createElement(ie.a,null,o.a.createElement(Ze.a,{ref:"noteField",autoFocus:!0,margin:"dense",id:"note",fullWidth:!0,defaultValue:this.props.measurements[n].note,inputRef:function(t){return e.noteField=t}})),o.a.createElement(re.a,null,o.a.createElement(ne.a,{onClick:this.hideDlgNote},"Cancel"),o.a.createElement(ne.a,{onClick:function(){return e.confirmNote(n)},autoFocus:!0},"Ok"))):null,o.a.createElement(oe.a,{open:this.state.visibleDlgDelete,onClose:this.hideDlgNote,"aria-labelledby":"alert-dialog-title"},o.a.createElement(se.a,{id:"alert-dialog-title"},"Are you sure to delete the measurement?"),o.a.createElement(re.a,null,o.a.createElement(ne.a,{onClick:this.hideDlgDelete},"Cancel"),o.a.createElement(ne.a,{onClick:function(){return e.confirmDelete(n)},autoFocus:!0},"Ok"))))}}]),t}(n.PureComponent),He=Object(h.b)((function(e){return{measurements:e.measurements}}))(Object(v.a)((function(e){return{listItemText:{fontSize:"0.9em"}}}))(We)),Xe=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).state={visibleClearMeasureDlg:!1},a.showClearMeasureDlg=function(){a.setState({visibleClearMeasureDlg:!0})},a.hideClearMeasureDlg=function(){a.setState({visibleClearMeasureDlg:!1})},a.confirmClearMeasureDlg=function(){a.hideClearMeasureDlg(),a.dicomViewersRefs[a.props.activeDcmIndex].runTool("removetools")},a}return Object(g.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement("div",null,o.a.createElement("div",null,null!==this.props.measurements?this.props.measurements.map((function(t,a){return o.a.createElement(He,{item:t,index:a,toolRemove:e.props.toolRemove,key:a})})):null),o.a.createElement(oe.a,{open:this.state.visibleClearMeasureDlg,onClose:this.hideClearMeasureDlg,"aria-labelledby":"alert-dialog-title"},o.a.createElement(se.a,{id:"alert-dialog-title"},"Are you sure to remove all the measurements?"),o.a.createElement(re.a,null,o.a.createElement(ne.a,{onClick:this.hideClearMeasureDlg},"Cancel"),o.a.createElement(ne.a,{onClick:this.confirmClearMeasureDlg,autoFocus:!0},"Ok"))))}}]),t}(n.PureComponent),_e=Object(h.b)((function(e){return{measurements:e.measurements}}))(Xe),Je=a(183),Ye=a(333),qe=a(334),Qe=a(357),Ke=a(177),$e=a.n(Ke),et=a(335),tt=a(330),at=a(331),nt=a(356),ot=a(358),rt=Object(Ye.a)((function(e){return{appBar:{position:"relative",backgroundColor:"#3d9c9f"},formControl:{margin:e.spacing(3)},formLabel:{fontSize:"0.85em"},radioControl:{size:"small"},title:{marginLeft:e.spacing(2),flex:1,fontSize:"0.95em"}}})),it=function(e){var t=e.onClose,a=function(){var e=localStorage.getItem("saveAs");return null===e&&(e="png",localStorage.setItem("saveAs",e)),e}(),n=U(),r=function(){var e=localStorage.getItem("exportAs");return null===e&&(e="json",localStorage.setItem("exportAs",e)),e}(),i=G(),l=Z(),s=W(),c=H(),m=rt(),u=o.a.useState({saveAs:a,saveInto:n,exportAs:r,overlay:i,fsView:l,dicomdirView:s,mprInterpolation:c}),d=Object(Je.a)(u,2),p=d[0],g=d[1];return o.a.createElement("div",null,o.a.createElement(oe.a,{fullScreen:!0,open:!0,onClose:t}," ",o.a.createElement(qe.a,{className:m.appBar,elevation:0},o.a.createElement(Ve.a,{variant:"dense"},o.a.createElement(Fe.a,{edge:"start",color:"inherit",onClick:t,"aria-label":"close"},o.a.createElement($e.a,null)),o.a.createElement(me.a,{variant:"h6",className:m.title},"Settings"))),o.a.createElement("div",null,o.a.createElement("div",null,o.a.createElement(tt.a,{component:"fieldset",className:m.formControl},o.a.createElement(et.a,{control:o.a.createElement(Qe.a,{checked:p.overlay,onChange:function(e){var t;g(Object(ze.a)({},p,{overlay:e.target.checked})),t=e.target.checked,localStorage.setItem("overlay",t?"1":"0")},value:"overlay",size:"small"}),label:"Show overlay Information"}))),o.a.createElement("div",null,o.a.createElement(tt.a,{component:"fieldset",className:m.formControl},o.a.createElement(at.a,{component:"legend",className:m.formLabel},"Open sandbox file system from:"),o.a.createElement(ot.a,{size:"small","aria-label":"filesystem",name:"filesystem",value:p.fsView,onChange:function(e){var t;g(Object(ze.a)({},p,{fsView:e.target.value})),t=e.target.value,localStorage.setItem("fsView",t)}},o.a.createElement(et.a,{value:"left",control:o.a.createElement(nt.a,{size:"small"}),label:"left"}),o.a.createElement(et.a,{value:"right",control:o.a.createElement(nt.a,{size:"small"}),label:"right"}),o.a.createElement(et.a,{value:"bottom",control:o.a.createElement(nt.a,{size:"small"}),label:"bottom"})))),o.a.createElement("div",null,o.a.createElement(tt.a,{component:"fieldset",className:m.formControl},o.a.createElement(at.a,{component:"legend",className:m.formLabel},"Open DICOMDIR panel from:"),o.a.createElement(ot.a,{size:"small","aria-label":"dicomdir",name:"dicomdir",value:p.dicomdirView,onChange:function(e){var t;g(Object(ze.a)({},p,{dicomdirView:e.target.value})),t=e.target.value,localStorage.setItem("dicomdirView",t)}},o.a.createElement(et.a,{value:"left",control:o.a.createElement(nt.a,{size:"small"}),label:"left"}),o.a.createElement(et.a,{value:"right",control:o.a.createElement(nt.a,{size:"small"}),label:"right"}),o.a.createElement(et.a,{value:"bottom",control:o.a.createElement(nt.a,{size:"small"}),label:"bottom"})))),o.a.createElement("div",null,o.a.createElement(tt.a,{component:"fieldset",className:m.formControl},o.a.createElement(at.a,{component:"legend",className:m.formLabel},"Save screenshot as:"),o.a.createElement(ot.a,{"aria-label":"saveas",name:"saveas",value:p.saveAs,onChange:function(e){var t;g(Object(ze.a)({},p,{saveAs:e.target.value})),t=e.target.value,localStorage.setItem("saveAs",t)}},o.a.createElement(et.a,{value:"jpeg",control:o.a.createElement(nt.a,{size:"small"}),label:"JPEG"}),o.a.createElement(et.a,{value:"png",control:o.a.createElement(nt.a,{size:"small"}),label:"PNG"})))),o.a.createElement("div",null,o.a.createElement(tt.a,{component:"fieldset",className:m.formControl},o.a.createElement(at.a,{component:"legend",className:m.formLabel},"Save screenshot into:"),o.a.createElement(ot.a,{"aria-label":"saveinto",name:"saveinto",value:p.saveInto,onChange:function(e){var t;g(Object(ze.a)({},p,{saveInto:e.target.value})),t=e.target.value,localStorage.setItem("saveInto",t)}},o.a.createElement(et.a,{value:"local",control:o.a.createElement(nt.a,{size:"small"}),label:"local file system"}),o.a.createElement(et.a,{value:"sandbox",control:o.a.createElement(nt.a,{size:"small"}),label:"sandbox file system"})))),o.a.createElement("div",null,o.a.createElement(tt.a,{component:"fieldset",className:m.formControl},o.a.createElement(at.a,{component:"legend",className:m.formLabel},"Export Dicom header as:"),o.a.createElement(ot.a,{"aria-label":"exportas",name:"exportas",value:r,onChange:function(e){var t;g(Object(ze.a)({},p,{exportAs:e.target.value})),t=e.target.value,localStorage.setItem("exportAs",t)}},o.a.createElement(et.a,{value:"json",control:o.a.createElement(nt.a,{size:"small"}),label:"JSON"}),o.a.createElement(et.a,{value:"csv",control:o.a.createElement(nt.a,{size:"small"}),label:"CSV"})))),o.a.createElement("div",null,o.a.createElement(tt.a,{component:"fieldset",className:m.formControl},o.a.createElement(at.a,{component:"legend",className:m.formLabel},"MPR interpolation method:"),o.a.createElement(ot.a,{"aria-label":"mprinterpolation",name:"mprinterpolation",value:c,onChange:function(e){var t;g(Object(ze.a)({},p,{mprInterpolation:e.target.value})),t=e.target.value,localStorage.setItem("mprInterpolation",t)}},o.a.createElement(et.a,{value:"no",control:o.a.createElement(nt.a,{size:"small"}),label:"No interpolation (duplicate planes)"}),o.a.createElement(et.a,{value:"weightedlinear",control:o.a.createElement(nt.a,{size:"small"}),label:"Weighted linear interpolation"})))))))},lt=a(178),st=function(e){var t=e.onClose,a=o.a.createElement(me.a,{variant:"body2"},o.a.createElement(ce.a,{href:"https://github.com/webnamics/u-dicom-viewer/",target:"_blank",style:{color:"#999999"}},"https://github.com/mmollaahmadi/dicom-viewer")),n=o.a.createElement(me.a,{variant:"body2",style:{color:"#999999"}},lt.version);return o.a.createElement("div",null,o.a.createElement(oe.a,{onClose:t,open:!0},o.a.createElement(se.a,{onClose:t,disableTypography:!0},o.a.createElement(me.a,{variant:"h6"},"About ",o.a.createElement("strong",null,"U"),"niversal ",o.a.createElement("strong",null,"D"),"icom ",o.a.createElement("strong",null,"V"),"iewer")),o.a.createElement(ie.a,null,o.a.createElement(b.a,null,o.a.createElement(E.a,null,o.a.createElement(y.a,{primary:"Repository URL:",secondary:a})),o.a.createElement(E.a,null,o.a.createElement(y.a,{primary:"Version:",secondary:n})))),o.a.createElement(re.a,null,o.a.createElement(ne.a,{autoFocus:!0,onClick:t},"Close"))))},ct=a(359),mt={width:"273px",padding:"8px 8px 8px 8px",backgroundColor:"#444444"},ut={width:"255px",marginTop:"-9px"},dt={marginTop:"-9px"},pt={borderCollapse:"collapse",fontFamily:"Courier, monospace",fontSize:"67%",width:"100%"},gt={tableLayout:"fixed",width:"25%"},ft=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={activeDrags:0,deltaPosition:{x:0,y:0},controlledPosition:{x:-400,y:200},value:128,histCount:0,valueScale:0,minHist:0,maxHist:0,mean:0,stdDev:0},a.handleChangeValue=function(e,t){a.setState({value:t}),a.setState({valueScale:t*a.binSize+a.state.minHist}),a.setState({histCount:a.hist256[t]})},a.hide=function(){a.props.onClose()},a.onDrag=function(e,t){var n=a.state.deltaPosition,o=n.x,r=n.y;a.setState({deltaPosition:{x:o+t.deltaX,y:r+t.deltaY}})},a.onStart=function(){a.setState({activeDrags:a.state.activeDrags+1})},a.onStop=function(){a.setState({activeDrags:a.state.activeDrags-1})},a.canvasHistogram=o.a.createRef(),a.canvasGradient=o.a.createRef(),a}return Object(g.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){var e=this.canvasHistogram.current,t=this.canvasHistogram.current.getContext("2d");t.translate(0,e.height),t.scale(1,-1),this.props.activeDcm.image&&this.updateCanvas()}},{key:"componentDidUpdate",value:function(){if(null!==this.props.activeDcm)this.updateCanvas();else{var e=this.canvasHistogram.current.getContext("2d");e.clearRect(0,0,e.canvas.width,e.canvas.height)}}},{key:"getMousePos",value:function(e,t){var a=e.getBoundingClientRect();return{x:t.clientX-a.left,y:t.clientY-a.top}}},{key:"getRGBPixelsImage",value:function(e,t,a,n){var o=this.props.activeDcm.image.getPixelData(),r=[];e=Math.round(e),t=Math.round(t);var i,l,s,c=0;for(l=0;l<n;l++)for(s=0;s<a;s++){var m=o[i=4*((l+t)*this.props.activeDcm.image.rows+(s+e))],u=o[i+1],d=o[i+2],p=o[i+3];r[c++]=m,r[c++]=u,r[c++]=d,r[c++]=p}return r}},{key:"getPixelsImage",value:function(e,t,a,n){var o=this.props.activeDcm.image.getPixelData(),r=[];e=Math.round(e),t=Math.round(t);var i,l,s,c=0;for(l=0;l<n;l++)for(s=0;s<a;s++)i=(l+t)*this.props.activeDcm.image.rows+(s+e),r[c++]=o[i];return r}},{key:"getPixel",value:function(e,t){return(this.props.activeDcm.isDicom?this.props.activeDcm.image.color?this.getRGBPixelsImage(e,t,1,1):this.getPixelsImage(e,t,1,1):this.getRGBPixelsImage(e,t,1,1))[0]}},{key:"updateCanvas",value:function(){var e=this,t=this.props.activeDcm.image,a=t.maxPixelValue,n=t.minPixelValue+t.intercept,o=a+t.intercept,r=o-n+1,i=r/256,l=Math.floor(Math.abs(n)/i),s=Math.round(t.windowWidth/i/2),c=Math.round(t.windowCenter/i);this.setState({minHist:n}),this.setState({maxHist:o}),this.binSize=i;for(var m=0,u=Array(r).fill(0),d=0;d<t.columns;d++)for(var p=0;p<t.rows;p++){var g=this.getPixel(p,d)*t.slope+t.intercept;u[g-n]+=1,m+=g}m/=t.columns*t.rows,this.setState({mean:m});for(var f=0,v=0;v<t.columns;v++)for(var h=0;h<t.rows;h++){var S=this.getPixel(h,v)*t.slope+t.intercept;f+=Math.pow(S-m,2)}f=Math.sqrt(f/(t.columns*t.rows)),this.setState({stdDev:f});var b=Array(256).fill(0),E=0;if(i<1)for(var y=Math.round(256/r),x=0,I=0;I<256;){for(var C=0;C<y;C++)b[I]=x<r?u[x]:0,E<b[I]&&(E=b[I]),I++;x++}else for(var F=0,D=0;D<256;D++){for(var M=F;M<Math.round(F+i)&&!(M>=r);M++)b[D]+=u[M];E<b[D]&&(E=b[D]),F=Math.round(F+i)}this.hist256=b,E/128>100&&(E/=5);var w=this.canvasHistogram.current,P=this.canvasHistogram.current.getContext("2d");P.clearRect(0,0,P.canvas.width,P.canvas.height),w.addEventListener("pointermove",(function(t){var a=e.getMousePos(w,t);e.setState({histCount:b[a.x]});var o=Math.round(a.x*e.binSize);e.setState({valueScale:o+n})}),!0);var O=Math.round((m-n)/i);this.setState({value:O}),this.setState({valueScale:m}),this.setState({histCount:b[O]}),P.beginPath(),P.fillStyle="rgba(210, 210, 210, 0.5)",P.fillRect(l-s+c,0,2*s,128),P.beginPath(),P.strokeStyle="rgba(0, 0, 0, 1.0)";for(var R=0;R<256;R++){var T=Math.round(b[R]/E*128);P.moveTo(R,0),P.lineTo(R,T),P.stroke()}P.beginPath(),P.strokeStyle="rgba(140, 140, 140, 0.5)",P.moveTo(l+c,0),P.lineTo(l+c,128),P.lineWidth=1,P.stroke();var k=l-s+c,L=l+s+c,A=this.canvasGradient.current.getContext("2d");A.fillStyle="#000000",A.fillRect(0,0,k,10);var z=A.createLinearGradient(k,0,L+(k<0?k:0),0);z.addColorStop(0,"black"),z.addColorStop(1,"white"),A.fillStyle=z,A.fillRect(k,0,L,10)}},{key:"render",value:function(){return o.a.createElement("div",{style:mt},o.a.createElement("div",null,o.a.createElement("canvas",{ref:this.canvasHistogram,width:256,height:128,style:{backgroundColor:"#FFFFFF",cursor:"crosshair"}})),o.a.createElement("div",{style:dt},o.a.createElement("canvas",{ref:this.canvasGradient,width:256,height:10,style:{backgroundColor:"#FFFFFF"}})),o.a.createElement("div",{style:ut},o.a.createElement(ct.a,{value:this.state.value,onChange:this.handleChangeValue,"aria-labelledby":"continuous-slider",color:"secondary",min:0,max:255})),o.a.createElement("div",null,o.a.createElement("table",{style:pt},o.a.createElement("tbody",null,o.a.createElement("tr",null,o.a.createElement("td",{style:gt},"min:"),o.a.createElement("td",{style:gt},this.state.minHist),o.a.createElement("td",{style:gt},"max:"),o.a.createElement("td",{style:gt},this.state.maxHist)),o.a.createElement("tr",null,o.a.createElement("td",null,"mean:"),o.a.createElement("td",null,parseFloat(this.state.mean).toFixed(3)),o.a.createElement("td",null,"std dev:"),o.a.createElement("td",null,parseFloat(this.state.stdDev).toFixed(3))),o.a.createElement("tr",null,o.a.createElement("td",null,"count:"),o.a.createElement("td",null,this.state.histCount),o.a.createElement("td",null,"value:"),o.a.createElement("td",null,parseFloat(this.state.valueScale).toFixed(3)))))))}}]),t}(n.PureComponent),vt=Object(h.b)((function(e){return{activeDcmIndex:e.activeDcmIndex,activeDcm:e.activeDcm}}))(ft),ht={borderCollapse:"collapse",width:"100px",height:"100px"},St={width:"25px",height:"25px",border:"solid 1px #3d9c9f"},bt=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).initTable=function(){for(var e=a.state.row,t=a.state.col,n=a.tableRef.current.rows,o=0;o<=e;o++)for(var r=0;r<=t;r++)n[o].cells[r].bgColor="#f8f8f8"},a.cellClick=function(e){var t=e.target.parentNode.rowIndex,n=e.target.cellIndex;a.setState({row:t,col:n});for(var o=a.tableRef.current.rows,r=0;r<=3;r++)for(var i=0;i<=3;i++)o[r].cells[i].bgColor="#70c4c5";for(var l=0;l<=t;l++)for(var s=0;s<=n;s++)o[l].cells[s].bgColor="#f8f8f8";a.props.onChange(t+1,n+1)},a.tableRef=o.a.createRef(),a.state={row:a.props.row,col:a.props.col},a}return Object(g.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){this.initTable()}},{key:"renderTable",value:function(){var e=this;return["","","",""].map((function(t,a){return o.a.createElement("tr",{key:"".concat(a)},o.a.createElement("td",{style:St,onClick:e.cellClick}),o.a.createElement("td",{style:St,onClick:e.cellClick}),o.a.createElement("td",{style:St,onClick:e.cellClick}),o.a.createElement("td",{style:St,onClick:e.cellClick}))}))}},{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement("table",{style:ht,ref:this.tableRef},o.a.createElement("tbody",null,this.renderTable())))}}]),t}(n.PureComponent),Et=a(336),yt=a(360),xt=a(111),It=a(339),Ct=a(343),Ft=a(342),Dt=a(338),Mt=a(340),wt=a(341),Pt=a(337),Ot=a(125),Rt=a.n(Ot),Tt=a(179);Se.external.cornerstone=pe;var kt=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={progress:0,cancel:!1},a.getInstanceNumber=function(e){var t=e.data.string("x00200013");if(void 0!==t)return t},a.getSliceLocation=function(e){var t=e.data.string("x00201041");if(void 0!==t)return parseFloat(t)},a.getRows=function(e){var t=e.data.uint16("x00280010");if(void 0!==t)return t},a.getColumns=function(e){var t=e.data.uint16("x00280011");if(void 0!==t)return t},a.getSliceDistance=function(e){try{var t=e.data.string("x00200032").split("\\"),a=new Array(3).fill(0);a[0]=parseFloat(t[0]),a[1]=parseFloat(t[1]),a[2]=parseFloat(t[2]);var n=e.data.string("x00200037").split("\\"),o=new Array(3).fill(0).map((function(){return new Array(3).fill(0)}));o[0][0]=parseFloat(n[0]),o[0][1]=parseFloat(n[1]),o[0][2]=parseFloat(n[2]),o[1][0]=parseFloat(n[3]),o[1][1]=parseFloat(n[4]),o[1][2]=parseFloat(n[5]),o[2][0]=o[0][1]*o[1][2]-o[0][2]*o[1][1],o[2][1]=o[0][2]*o[1][0]-o[0][0]*o[1][2],o[2][2]=o[0][0]*o[1][1]-o[0][1]*o[1][0];for(var r=0,i=0;i<3;++i)r+=o[2][i]*a[i];return r}catch(l){return 0}},a.close=function(){a.props.onClose()},a.cancel=function(){a.setState({cancel:!0})},a.items=[],a.count=0,a.step=0,a}return Object(g.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.step=this.props.files.length/50,this.nextProgress=this.step,this.t0=performance.now();for(var t=function(t){var a=e.props.files[t];if(e.state.cancel)return e.props.setFilesStore(null),e.close(),{v:void 0};var n=null;n="local"===e.props.origin?Se.wadouri.fileManager.add(a):Se.wadouri.fileManager.addBuffer(a.data),pe.loadImage(n).then((function(t){var o=e.getInstanceNumber(t),r=e.getSliceDistance(t),i=e.getSliceLocation(t),l=null;l="local"===e.props.origin?{imageId:n,instanceNumber:o,name:V(a.name),image:t,rows:e.getRows(t),columns:e.getColumns(t),sliceDistance:r,sliceLocation:i}:{imageId:n,instanceNumber:o,name:a.name,image:t,rows:e.getRows(t),columns:e.getColumns(t),sliceDistance:r,sliceLocation:i},e.items.push(l),e.count++;var s=Math.floor(e.count*(100/e.props.files.length));s>e.nextProgress&&(e.nextProgress+=e.step,e.setState({progress:s})),e.count===e.props.files.length&&(e.items.sort((function(e,t){return e.instanceNumber-t.instanceNumber})),e.t1=performance.now(),console.log("performance load image: ".concat(e.t1-e.t0," milliseconds")),e.props.setFilesStore(e.items),e.close())}),(function(t){console.log("Error in reading multiple files: ",t),e.count++})),e.count===e.props.files.length&&e.close()},a=0;a<this.props.files.length;a++){var n=t(a);if("object"===typeof n)return n.v}}},{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement(oe.a,{open:!0,onClose:this.close,"aria-labelledby":"alert-dialog-title"},o.a.createElement(se.a,{id:"alert-dialog-title"},"Opening multiple files ..."),o.a.createElement(ie.a,null,o.a.createElement(ye.a,{variant:"determinate",value:this.state.progress,color:"secondary"})),o.a.createElement(re.a,null,o.a.createElement(ne.a,{onClick:this.cancel},"Cancel"))))}}]),t}(n.PureComponent),Lt=Object(h.b)(null,(function(e){return{setFilesStore:function(t){return e(J(t))}}}))(kt),At=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={textFieldLabel:"",textFieldValue:"",selected:[],selectedCopy:[],visibleTextField:!1,visibleDeleteDlg:!1,visibleOthers:!1,visibleAlreadyExistDlg:!1,visibleOSaveAsDlg:!1,visibleWaiting:!1,visibleOpenMultipleFilesDlg:!1},a.doSelectUnselect=function(){var e=[];a.state.selected.length>0?a.setState({selected:e}):a.props.fsCurrentList.forEach((function(t){"dir"!==t.type&&e.push(t.name),a.setState({selected:e},(function(){}))}))},a.openSelectedFilesRetrieveItems=function(){return s.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.awrap(O.transaction("r",O.files,(function(){return s.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:a.state.selected.forEach((function(e,t){return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.a.awrap(O.files.where({parent:a.props.fsCurrentDir,name:e}).first((function(e){console.log("item: ",e),void 0!==e&&"dir"!==e.type?a.files.push(e):"dir"===e.type&&O.files.where("parent").startsWithIgnoreCase(e.name).each((function(e){void 0!==e&&"dir"!==e.type&&(console.log(" e: ",e),a.files.push(e))}))})));case 2:case"end":return t.stop()}}))}));case 1:case"end":return e.stop()}}))})));case 2:case"end":return e.stop()}}))},a.openSelectedFiles=function(){0!==a.state.selected.length&&(a.files=[],a.openSelectedFilesRetrieveItems().then((function(){console.log("this.files: ",a.files),a.setState({visibleOpenMultipleFilesDlg:!0}),a.setState({selected:[]})})))},a.hideOpenMultipleFilesDlg=function(){a.setState({visibleOpenMultipleFilesDlg:!1}),a.props.files.length>1?a.props.onOpenMultipleFilesCompleted():a.props.onOpenImage(0)},a.createDir=function(){a.setState({textFieldLabel:"new folder name",visibleTextField:!a.state.visibleTextField})},a.renameItem=function(){a.lastSelected=a.state.selected[a.state.selected.length-1],a.setState({textFieldLabel:"",textFieldValue:a.lastSelected,visibleTextField:!a.state.visibleTextField})},a.previousDir=function(){if(""!==a.props.fsCurrentDir){var e=a.props.fsCurrentDir.split("/").slice(0,-1).join("/");a.props.setCurrentDir(e),a.fsListDir(e)}},a.confirmText=function(e){if(""===a.state.textFieldLabel){if(void 0!==a.props.fsCurrentList.find((function(e){return e.name===a.state.textFieldValue})))return void a.setState({visibleAlreadyExistDlg:!0});var t=a.props.fsCurrentList.find((function(e){return e.name===a.lastSelected}));if(void 0!==t){if("dir"===t.type){var n=a.fsBuildParent(t.parent,t.name),o=a.fsBuildParent(t.parent,a.state.textFieldValue);O.transaction("rw",O.files,(function(){return s.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.awrap(O.files.where({parent:n}).each((function(e){O.transaction("rw",O.files,(function(){return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.a.awrap(O.files.add({parent:o,name:e.name,type:e.type,size:e.size,data:e.data}).then((function(){O.files.where({parent:n}).delete()})));case 2:case"end":return t.stop()}}))}))})));case 2:case"end":return e.stop()}}))}))}O.transaction("rw",O.files,(function(){return s.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.awrap(O.files.add({parent:t.parent,name:a.state.textFieldValue,type:t.type,size:t.size,data:t.data}).then((function(){O.files.where({parent:t.parent,name:t.name}).delete()})));case 2:case"end":return e.stop()}}))})),a.setState({visibleTextField:!1}),a.fsListDir(a.props.fsCurrentDir)}}else a.setState({visibleTextField:!1},(function(){a.fsCreateDir(a.props.fsCurrentDir,a.state.textFieldValue)}))},a.cancelDir=function(){a.setState({visibleTextField:!1})},a.saveItem=function(){if(console.log("this.props.localFileStore: ",a.props.localFileStore),console.log("this.props.fsFileStore: ",a.props.fsFileStore),null!==a.props.localFileStore){var e=a.props.localFileStore;if(null===e)return;var t=new FileReader;t.onload=function(t){var n=t.target.result,o=N(e.name),r=j(V(e.name)),i=r,l=0,c=!1,m=function(){var t=""===o?i:"".concat(i,".").concat(o);void 0===a.props.fsCurrentList.find((function(e){return e.name===t}))?(O.transaction("rw",O.files,(function(){return s.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,s.a.awrap(O.files.add({parent:a.props.fsCurrentDir,name:t,type:""===o?B(r):o,size:e.size,data:n}));case 2:case"end":return i.stop()}}))})).then((function(){a.fsListDir(a.props.fsCurrentDir)})),c=!0):(i="".concat(r," - Copy"),l>0&&(i="".concat(i," (").concat(l,")")),l++)};do{m()}while(!c)},t.readAsArrayBuffer(e)}else null!==a.props.fsFileStore&&function(){var e=a.props.fsFileStore,t=e.data,n=N(e.name),o=j(V(e.name)),r=o,i=0,l=!1,c=function(){var c=""===n?r:"".concat(r,".").concat(n);void 0===a.props.fsCurrentList.find((function(e){return e.name===c}))?(O.transaction("rw",O.files,(function(){return s.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,s.a.awrap(O.files.add({parent:a.props.fsCurrentDir,name:c,type:B(o),size:e.size,data:t}));case 2:case"end":return n.stop()}}))})).then((function(){a.fsListDir(a.props.fsCurrentDir)})),l=!0):(r="".concat(o," - Copy"),i>0&&(r="".concat(r," (").concat(i,")")),i++)};do{c()}while(!l)}()},a.copyItem=function(){var e=[];a.state.selected.forEach((function(t){var n=a.props.fsCurrentList.find((function(e){return e.name===t}));void 0!==n&&e.push({parent:n.parent,name:n.name})})),a.setState({selectedCopy:e})},a.cutItem=function(){var e=[];a.state.selected.forEach((function(t){var n=a.props.fsCurrentList.find((function(e){return e.name===t}));void 0!==n&&e.push({parent:n.parent,name:n.name})})),a.setState({selectedCopy:e}),a.cut=!0},a.pasteItem=function(){a.state.selectedCopy.forEach((function(e,t){return s.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,s.a.awrap(O.files.where({parent:e.parent,name:e.name}).first((function(e){if(void 0!==e)if("dir"===e.type){var t=0,n=!1,o=e.name,r=function(){var r=o;void 0===a.props.fsCurrentList.find((function(e){return e.name===r}))?n=!0:(o="".concat(e.name," - Copy"),t>0&&(o="".concat(o," (").concat(t,")")),t++)};do{r()}while(!n);O.files.add({parent:a.props.fsCurrentDir,name:o,type:e.type,size:e.size,data:e.data});var i=a.fsBuildParent(e.parent,e.name),l=a.fsBuildParent(a.props.fsCurrentDir,o),c=[];O.files.where("parent").startsWithIgnoreCase(i).each((function(e){c.push(e)})).then((function(){c.forEach((function(e){O.files.add({parent:l,name:e.name,type:e.type,size:e.size,data:e.data})}))}))}else{var m=N(e.name),u=j(e.name),d=u,p=0,g=!1,f=function(){var t=""===m?d:"".concat(d,".").concat(m);void 0===a.props.fsCurrentList.find((function(e){return e.name===t}))?(O.transaction("rw",O.files,(function(){return s.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,s.a.awrap(O.files.add({parent:a.props.fsCurrentDir,name:t,type:e.type,size:e.size,data:e.data}));case 2:case"end":return n.stop()}}))})),g=!0):(d="".concat(u," - Copy"),p>0&&(d="".concat(d," (").concat(p,")")),p++)};do{f()}while(!g)}})));case 2:t===a.state.selectedCopy.length-1&&(a.cut&&(a.state.selectedCopy.forEach((function(e){O.files.where({parent:e.parent,name:e.name}).delete()})),a.setState({selectedCopy:[]}),a.cut=!1),a.fsListDir(a.props.fsCurrentDir));case 3:case"end":return n.stop()}}))})),a.setState({selected:[]})},a.deleteItem=function(){a.state.selected.forEach((function(e){var t=a.props.fsCurrentList.find((function(t){return t.name===e}));void 0!==t&&("dir"===t.type&&O.files.where("parent").startsWithIgnoreCase(a.fsBuildParent(t.parent,t.name)).delete(),O.files.where({parent:t.parent,name:t.name}).delete().then((function(){a.fsListDir(a.props.fsCurrentDir)})))})),a.setState({selected:[]})},a.showOthers=function(){a.setState({visibleOthers:!a.state.visibleOthers})},a.exportItem=function(){0!==a.state.selected.length&&a.setState({visibleOSaveAsDlg:!0})},a.itemClick=function(e,t){var n=a.state.selected.indexOf(t.name),o=[];-1===n?o=o.concat(a.state.selected,t.name):n>=0&&(o=o.concat(a.state.selected.slice(0,n),a.state.selected.slice(n+1))),a.setState({selected:o},(function(){console.log("this.state.selected: ",a.state.selected)}))},a.itemDoubleClick=function(e,t){"dir"===t.type?(a.setState({visibleWaiting:!0}),a.props.setCurrentDir(a.fsBuildParent(t.parent,t.name))):"DICOMDIR"===t.name?a.props.onOpenDicomdir(t):(a.props.setFsFileStore(t),a.props.onOpen(t))},a.showDeleteDlg=function(){a.setState({visibleDeleteDlg:!0})},a.hideDeleteDlg=function(){a.setState({visibleDeleteDlg:!1})},a.confirmDeleteDlg=function(){a.hideDeleteDlg(),a.deleteItem()},a.hideAlreadyExistDlg=function(){a.setState({visibleAlreadyExistDlg:!1})},a.hideSaveAs=function(){a.setState({visibleOSaveAsDlg:!1})},a.closeSaveAs=function(){var e="".concat(a.saveAsField.value,".zip");a.setState({visibleOSaveAsDlg:!1},(function(){var t=new Rt.a,n=[];O.files.where("parent").startsWithIgnoreCase(a.props.fsCurrentDir).each((function(e){(a.state.selected.indexOf(e.parent)>=0||a.state.selected.indexOf(e.name)>=0)&&n.push(e)})).then((function(){n.forEach((function(e){"dir"!==e.type&&t.folder(e.parent).file(e.name,e.data)})),t.generateAsync({type:"blob"}).then((function(t){Object(Tt.saveAs)(t,e)}))}))}))},a.mouseDown=function(e,t){a.timer=setTimeout((function(){a.itemDoubleClick(e,t)}),500)},a.mouseUp=function(e){clearTimeout(a.timer)},a.files=[],a.cut=!1,a.itemsCount=0,a.saveAsField=o.a.createRef(),a}return Object(g.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){this.fsListDir(this.props.fsCurrentDir)}},{key:"componentDidUpdate",value:function(e){var t=this;if(null!==this.props.fsZippedFile){var a=new Rt.a;a.loadAsync(this.props.fsZippedFile).then((function(e){e.forEach((function(e,n){n.dir||a.file(e).async("uint8array").then((function(a){t.fsAddItem(e,a)}))}))})).then((function(){t.props.setFsZippedFile(null)}))}else this.fsListDir(this.props.fsCurrentDir)}},{key:"fsBuildParent",value:function(e,t){var a="";return""===e?""!==t&&(a=t):a=""!==t?"".concat(e,"/").concat(t):e,a}},{key:"fsAddItem",value:function(e,t){var a=this,n=e.split("/"),o=n.pop(),r=this.fsBuildParent(this.props.fsCurrentDir,n.join("/"));O.transaction("rw",O.files,(function(){return s.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.awrap(O.files.add({parent:r,name:o,type:B(o),size:t.length,data:t}));case 2:case"end":return e.stop()}}))})).then((function(){for(var e=function(){var e=n.pop(),t=a.fsBuildParent(a.props.fsCurrentDir,n.join("/"));O.transaction("rw",O.files,(function(){return s.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,s.a.awrap(O.files.put({parent:t,name:e,type:"dir",size:""}));case 2:case"end":return a.stop()}}))})).then((function(){a.fsListDir(a.props.fsCurrentDir)}))};n.length>0;)e()}))}},{key:"fsExistDir",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this.props.fsCurrentList.find((function(t){return t.name===e}));return void 0!==a&&(!!t&&(this.fsCreateDir(this.props.fsCurrentDir,e),!0))}},{key:"fsListDir",value:function(e){var t=this,a=[];O.transaction("r",O.files,(function(){return s.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,s.a.awrap(O.files.where({parent:e,type:"dir"}).sortBy("name").then((function(e){a=e})).then((function(){O.files.where({parent:e}).and((function(e){return"dir"!==e.type})).sortBy("name").then((function(e){a=a.concat(e)})).then((function(){t.props.setCurrentList(a),setTimeout((function(){return t.setState({visibleWaiting:!1})}),2e3)}))})));case 2:case"end":return n.stop()}}))}))}},{key:"fsCreateDir",value:function(e,t){var a=this;O.files.add({parent:e,name:t,type:"dir",size:""}).then((function(){a.fsListDir(a.props.fsCurrentDir)}))}},{key:"render",value:function(){var e=this,t=this.props.classes,a=this.state.visibleTextField,n=this.state.visibleOthers,r=this.state.visibleDeleteDlg,i=this.state.visibleAlreadyExistDlg,l=this.state.visibleOSaveAsDlg,s=this.state.visibleOpenMultipleFilesDlg,c=this.state.visibleWaiting,m=null;m="bottom"===Z()?{marginTop:"0px",height:"275px"}:{marginTop:"48px",width:"350px"};var u="";return u=this.state.selected.length>0?"(".concat(this.state.selected.length," / ").concat(this.props.fsCurrentList.length," items)"):"(".concat(this.props.fsCurrentList.length," items)"),o.a.createElement("div",{style:m},a?o.a.createElement(xt.a,{component:"form",className:t.textPaper},o.a.createElement(yt.a,{autoFocus:!0,className:t.textInput,placeholder:this.state.textFieldLabel,defaultValue:this.state.textFieldValue,onChange:function(t){e.setState({textFieldValue:t.target.value})}}),o.a.createElement(Fe.a,{className:t.textButton,onClick:this.confirmText},o.a.createElement(Ce.a,{path:De.g,size:"1.2rem",color:this.props.color})),o.a.createElement(Fe.a,{className:t.textButton,onClick:this.cancelDir},o.a.createElement(Ce.a,{path:De.k,size:"1.2rem",color:this.props.color}))):o.a.createElement("div",null,o.a.createElement("div",null,o.a.createElement(Ve.a,{variant:"dense"},o.a.createElement("div",{className:t.leftButtons},c?o.a.createElement(Et.a,{style:{marginLeft:"10px"},size:20,color:"secondary"}):o.a.createElement(Pt.a,{title:"Previous folder"},o.a.createElement(Fe.a,{color:"inherit",onClick:this.previousDir},o.a.createElement(Ce.a,{path:De.j,size:"1.2rem",color:this.props.color})))),o.a.createElement("div",{className:t.toolbarButtons},o.a.createElement(Pt.a,{title:"Select/unselect all files"},o.a.createElement(Fe.a,{color:"inherit",onClick:this.doSelectUnselect},o.a.createElement(Ce.a,{path:De.h,size:"1.2rem",color:this.props.color}))),o.a.createElement(Pt.a,{title:"Open selected files"},o.a.createElement(Fe.a,{color:"inherit",onClick:this.openSelectedFiles},o.a.createElement(Ce.a,{path:De.D,size:"1.2rem",color:this.props.color}))),o.a.createElement(Pt.a,{title:"Create a new directory"},o.a.createElement(Fe.a,{color:"inherit",onClick:this.createDir},o.a.createElement(Ce.a,{path:De.E,size:"1.2rem",color:this.props.color}))),o.a.createElement(Pt.a,{title:"Rename the last selected item"},o.a.createElement(Fe.a,{color:"inherit",onClick:this.renameItem},o.a.createElement(Ce.a,{path:De.U,size:"1.2rem",color:this.props.color}))),o.a.createElement(Fe.a,{color:"inherit",onClick:this.showOthers},o.a.createElement(Ce.a,{path:De.t,size:"1.2rem",color:this.props.color}))))),n?o.a.createElement("div",null,o.a.createElement(Ve.a,{variant:"dense"},o.a.createElement("div",{className:t.toolbarButtons},o.a.createElement(Pt.a,{title:"Move the selected items to the clipboard"},o.a.createElement(Fe.a,{color:"inherit",onClick:this.cutItem},o.a.createElement(Ce.a,{path:De.m,size:"1.2rem",color:this.props.color}))),o.a.createElement(Pt.a,{title:"Copy the selected items to the clipboard"},o.a.createElement(Fe.a,{color:"inherit",onClick:this.copyItem},o.a.createElement(Ce.a,{path:De.l,size:"1.2rem",color:this.props.color}))),o.a.createElement(Pt.a,{title:"Paste clipboard contents to current location"},o.a.createElement(Fe.a,{color:"inherit",onClick:this.pasteItem},o.a.createElement(Ce.a,{path:De.n,size:"1.2rem",color:this.props.color}))),o.a.createElement(Pt.a,{title:"Delete the selected items"},o.a.createElement(Fe.a,{color:"inherit",onClick:this.showDeleteDlg},o.a.createElement(Ce.a,{path:De.s,size:"1.2rem",color:this.props.color}))),o.a.createElement(Pt.a,{title:"Save the opened image to sandbox file system"},o.a.createElement(Fe.a,{color:"inherit",onClick:this.saveItem},o.a.createElement(Ce.a,{path:De.o,size:"1.2rem",color:this.props.color}))),o.a.createElement(Pt.a,{title:"Export the selected items as zipped archive"},o.a.createElement(Fe.a,{color:"inherit",onClick:this.exportItem},o.a.createElement(Ce.a,{path:De.v,size:"1.2rem",color:this.props.color})))))):null,o.a.createElement("div",null,o.a.createElement("div",null,o.a.createElement(me.a,{type:"caption text",style:{fontSize:"0.75em",marginLeft:"15px",color:"rgba(146, 146, 146, 1)",float:"left"}},"/"+this.props.fsCurrentDir+" ")),o.a.createElement("div",null,o.a.createElement(me.a,{type:"caption text",style:{fontSize:"0.75em",marginRight:"5px",color:"rgba(146, 146, 146, 1)",float:"right"}},u))),c?o.a.createElement("div",{style:{marginTop:"20px",position:"absolute"}},o.a.createElement(ye.a,{color:"secondary"})):null),o.a.createElement("div",{style:{height:"200px"}},o.a.createElement(Dt.a,{component:xt.a},o.a.createElement(It.a,{className:t.table,size:"small"},o.a.createElement(Mt.a,null,o.a.createElement(wt.a,null,o.a.createElement(Ft.a,null,"Name"),o.a.createElement(Ft.a,{align:"left"},"Type"),o.a.createElement(Ft.a,{align:"left"},"Size"))),o.a.createElement(Ct.a,null,this.props.fsCurrentList.map((function(t){var a,n=(a=t.name,-1!==e.state.selected.indexOf(a));return o.a.createElement(wt.a,{key:"".concat(t.parent,"/").concat(t.name),role:"button",hover:!0,selected:n,onClick:function(a){e.itemClick(a,t)},onDoubleClick:function(a){e.itemDoubleClick(a,t)},onTouchStart:function(a){return e.mouseDown(a,t)},onTouchEnd:function(a){return e.mouseUp(a,t)},onMouseDown:function(a){return e.mouseDown(a,t)},onMouseUp:function(a){return e.mouseUp(a,t)}},o.a.createElement(Ft.a,{component:"th",scope:"row"},t.name),o.a.createElement(Ft.a,{align:"left"},t.type),o.a.createElement(Ft.a,{align:"left"},function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(""===e)return"";if(0===e)return"0 Bytes";var a=1024,n=t<0?0:t,o=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],r=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,r)).toFixed(n))+" "+o[r]}(t.size)))})))))),o.a.createElement(oe.a,{open:r,onClose:this.hideDeleteDlg},o.a.createElement(se.a,null,"Are you sure to delete selected items?"),o.a.createElement(re.a,null,o.a.createElement(ne.a,{onClick:this.hideDeleteDlg},"Cancel"),o.a.createElement(ne.a,{onClick:this.confirmDeleteDlg,autoFocus:!0},"Ok"))),o.a.createElement(oe.a,{open:i,onClose:this.hideAlreadyExistDlg},o.a.createElement(se.a,null,"An item with this name already exists!"),o.a.createElement(re.a,null,o.a.createElement(ne.a,{onClick:this.hideAlreadyExistDlg,autoFocus:!0},"Ok"))),o.a.createElement(oe.a,{open:l},o.a.createElement(se.a,null,"Export archive"),o.a.createElement(ie.a,null,o.a.createElement(le.a,null,"Specify a file name for the archive:"),o.a.createElement(Ze.a,{autoFocus:!0,margin:"dense",id:"id-open-url",inputRef:function(t){return e.saveAsField=t},fullWidth:!0})),o.a.createElement(re.a,null,o.a.createElement(ne.a,{onClick:function(){return e.hideSaveAs()}},"Cancel"),o.a.createElement(ne.a,{onClick:function(){return e.closeSaveAs()}},"Ok"))),s?o.a.createElement(Lt,{onClose:this.hideOpenMultipleFilesDlg,files:this.files,origin:"fs"}):null)}}]),t}(n.PureComponent),zt=Object(h.b)((function(e){return{files:e.files,localFileStore:e.localFile,fsFileStore:e.fsFile,activeDcm:e.activeDcm,fsCurrentDir:e.fsCurrentDir,fsCurrentList:e.fsCurrentList,fsZippedFile:e.fsZippedFile,fsRefresh:e.fsRefresh}}),(function(e){return{setCurrentDir:function(t){return e(function(e){return{type:"FSCURRENTDIR",fsCurrentDir:e}}(t))},setCurrentList:function(t){return e(function(e){return{type:"FSCURRENTLIST",fsCurrentList:e}}(t))},setFsZippedFile:function(t){return e($(t))},setFsFileStore:function(t){return e(_(t))}}}))(Object(v.a)((function(e){return{table:{minWidth:250},toolbarButtons:{marginLeft:"auto",marginRight:-20},leftButtons:{marginLeft:-25},textPaper:{padding:"2px 4px",display:"flex",alignItems:"center",width:250},textInput:{marginLeft:e.spacing(1),flex:1},textButton:{padding:10}}}))(At)),Vt=a(126),Bt=a.n(Vt),Nt=Bt.a.CancelToken.source(),jt=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).state={loading:0},a.hide=function(){a.props.onClose()},a.cancel=function(){Nt.cancel("Operation canceled by the user."),a.hide()},a.requestDownloadZip=function(){console.log("this.props.url",a.props.url),a.setState({loading:0}),Bt()({method:"get",url:a.props.url,responseType:"arraybuffer",cancelToken:Nt.token,onDownloadProgress:function(e){var t=Math.round(100*e.loaded/e.total);a.setState({loading:t}),console.log("loading: ",t)}}).then((function(e){console.log("response: ",e),a.props.setFsZippedFile(e.data),a.hide()})).catch((function(e){console.log("error: ",e)}))},a}return Object(g.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(e){this.requestDownloadZip()}},{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement(oe.a,{open:!0,onClose:this.hide},o.a.createElement(se.a,null,"Downloading zip archive..."),o.a.createElement(ie.a,null,o.a.createElement(ye.a,{variant:"determinate",value:this.state.loading,color:"secondary"})),o.a.createElement(re.a,null,o.a.createElement(ne.a,{onClick:this.cancel},"Cancel"))))}}]),t}(n.PureComponent),Ut=Object(h.b)(null,(function(e){return{setFsZippedFile:function(t){return e($(t))}}}))(jt),Gt=a(344),Zt=a(349),Wt=a(347),Ht=a(361),Xt=a(350),_t=a(351),Jt=a(352),Yt=a(353),qt=a(274),Qt=(a(266),a(346)),Kt=a(273),$t=a(272),ea=a(345),ta=a(332),aa=a(348),na=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).dicomImageRef=function(e){a.dicomImage=e},a.dicomImage=null,a}return Object(g.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){if(this.props.image){var e=this.dicomImage;pe.enable(e),pe.displayImage(e,this.props.image)}}},{key:"render",value:function(){return o.a.createElement("div",{ref:this.dicomImageRef,style:{width:"inherit",height:"100%",position:"relative"}})}}]),t}(o.a.Component);localStorage.setItem("debug","cornerstoneTools");var oa=null,ra=function(e){function t(e){var a;Object(c.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={anchorElLayout:null,openMenu:!1,openImageEdit:!1,openTools:!1,openMpr:!1,openLayout:!1,visibleMainMenu:!0,visibleHeader:!1,visibleSettings:!1,visibleToolbar:!0,visibleOpenUrl:!1,visibleToolbox:!1,visibleMeasure:!1,visibleClearMeasureDlg:!1,visibleAbout:!1,visibleDicomdir:!1,visibleFileManager:!1,visibleZippedFileDlg:!1,visibleDownloadZipDlg:!1,visibleOpenMultipleFilesDlg:!1,toolState:1,sliceIndex:0,sliceMax:1,listOpenFilesScrolling:!1,visibleVolumeBuilding:!1,visibleMprOrthogonal:!1,visibleMprCoronal:!1,visibleMprSagittal:!1,visibleMprAxial:!1,anchorEl:null,anchorElMpr:null,anchorElImageEdit:null,visibleSeries:!1,totalSeries:null,seriesListDicomViewers:[],seriesCounter:0,visibleExplorer:!1},a.setDcmViewer=function(e,t){return 0===t?(console.log("griddddddddddddd"),o.a.createElement(Te,{dcmRef:function(t){a.dicomViewersRefs[e]=t},index:e,runTool:function(e){return a.runTool=e},changeTool:function(e){return a.changeTool=e}})):1===t?(console.log("listttttttttttt"),o.a.createElement(Ae,{dcmRef:function(t){a.seriesListDicomViewersRefs[e]=t},index:e,runTool:function(e){return a.runTool=e},changeTool:function(e){return a.changeTool=e}})):void 0},a.getDcmViewerRef=function(e){return a.dicomViewersRefs[e]},a.getDcmViewer=function(e){return a.dicomViewers[e]},a.getActiveDcmViewer=function(){return a.dicomViewersRefs[a.props.activeDcmIndex]},a.toggleFileManager=function(){"left"===Z()?a.setState({visibleMainMenu:!1,visibleFileManager:!a.state.visibleFileManager}):a.setState({visibleFileManager:!a.state.visibleFileManager})},a.handleOpenLocalFs=function(e){if(e.length>1){a.files=e,a.changeLayout(1,1),a.mprPlane="",a.volume=[];for(var t=0;t<16;t++)a.dicomViewersRefs[t];a.setState({sliceIndex:0,sliceMax:1,visibleMprOrthogonal:!1,visibleMprCoronal:!1,visibleMprSagittal:!1,visibleMprAxial:!1},(function(){a.setState({visibleOpenMultipleFilesDlg:!0})}))}else{var n=e[0];console.log("file: ",n),"application/x-zip-compressed"===n.type||"application/zip"===n.type?(a.file=n,a.url=null,a.setState({visibleZippedFileDlg:!0})):(a.setState({sliceIndex:0,sliceMax:1}),a.props.setLocalFileStore(n),a.dicomViewersRefs[a.props.activeDcmIndex].runTool("clear"),a.dicomViewersRefs[a.props.activeDcmIndex].runTool("openLocalFs",n))}},a.handleOpenSandboxFs=function(e){a.dicomViewersRefs[a.props.activeDcmIndex].runTool("clear")},a.handleOpenImage=function(e){var t=a.state.visibleMprOrthogonal,n=a.state.visibleMprSagittal,o=a.state.visibleMprCoronal,r=a.state.visibleMprAxial,i=a.mprPlanePosition();t?0===a.props.activeDcmIndex?a.dicomViewersRefs[0].runTool("openimage",e):1===a.props.activeDcmIndex?a.dicomViewersRefs[1].mprRenderXZPlane(a.dicomViewersRefs[0].filename,i,e,a.mprData):2===a.props.activeDcmIndex&&a.dicomViewersRefs[2].mprRenderYZPlane(a.dicomViewersRefs[0].filename,i,e,a.mprData):"sagittal"===i&&n||"axial"===i&&r||"coronal"===i&&o?a.dicomViewersRefs[a.props.activeDcmIndex].runTool("openimage",e):"sagittal"===i&&r?a.dicomViewersRefs[a.props.activeDcmIndex].mprRenderXZPlane(a.dicomViewersRefs[0].filename,i,e,a.mprData):"sagittal"===i&&o?a.dicomViewersRefs[a.props.activeDcmIndex].mprRenderYZPlane(a.dicomViewersRefs[0].filename,i,e,a.mprData):"axial"===i&&n?a.dicomViewersRefs[a.props.activeDcmIndex].mprRenderYZPlane(a.dicomViewersRefs[0].filename,i,e,a.mprData):"axial"===i&&o?a.dicomViewersRefs[a.props.activeDcmIndex].mprRenderXZPlane(a.dicomViewersRefs[0].filename,i,e,a.mprData):"coronal"===i&&n?a.dicomViewersRefs[a.props.activeDcmIndex].mprRenderYZPlane(a.dicomViewersRefs[0].filename,i,e,a.mprData):"coronal"===i&&r?a.dicomViewersRefs[a.props.activeDcmIndex].mprRenderXZPlane(a.dicomViewersRefs[0].filename,i,e,a.mprData):a.dicomViewersRefs[a.props.activeDcmIndex].runTool("openimage",e)},a.handleOpenFileDicomdir=function(e){a.dicomViewersRefs[a.props.activeDcmIndex].runTool("clear"),a.dicomViewersRefs[a.props.activeDcmIndex].runTool("openLocalFs",e)},a.handleOpenFsDicomdir=function(e){a.props.setDicomdirStore({origin:"fs",dicomdir:e,files:[]}),a.toggleDicomdir()},a.showAppBar=function(){window.scrollTo(0,0)},a.toggleSeriesMenu=function(){var e=a.state.visibleSeries;"left"===Z()?a.setState({visibleSeries:!e,visibleFileManager:!1}):a.setState({visibleSeries:!e})},a.toggleMainMenu=function(){var e=a.state.visibleMainMenu;"left"===Z()?a.setState({visibleMainMenu:!e,visibleFileManager:!1}):a.setState({visibleMainMenu:!e})},a.showMainMenu=function(){a.setState({visibleMainMenu:!0})},a.hideMainMenu=function(){a.setState({visibleMainMenu:!1})},a.handleVisibility=function(e){a.setState({visibleMainMenu:e})},a.toggleHeader=function(){var e=!a.state.visibleHeader;a.setState({visibleHeader:e}),e&&a.setState({visibleMeasure:!1,visibleToolbox:!1,visibleDicomdir:!1,visibleFileManager:!1})},a.toggleToolbox=function(){var e=!a.state.visibleToolbox;a.setState({visibleToolbox:e}),e&&a.setState({visibleMeasure:!1,visibleHeader:!1,visibleDicomdir:!1,visibleFileManager:!1})},a.saveMeasure=function(){a.dicomViewersRefs[a.props.activeDcmIndex].runTool("savetools")},a.toggleMeasure=function(){var e=!a.state.visibleMeasure;a.setState({visibleMeasure:e}),e&&a.setState({visibleToolbox:!1,visibleHeader:!1,visibleDicomdir:!1,visibleFileManager:!1})},a.hideMeasure=function(){a.setState({visibleMeasure:!1})},a.handleVisibilityMeasure=function(e){a.setState({visibleMeasure:e})},a.toggleDicomdir=function(){var e=!a.state.visibleDicomdir;console.log("toggleDicomdir: ",e),a.setState({visibleDicomdir:e}),e&&a.setState({visibleMeasure:!1,visibleToolbox:!1,visibleHeader:!1,visibleFileManager:!1})},a.clearMeasure=function(){a.showClearMeasureDlg()},a.showClearMeasureDlg=function(){a.setState({visibleClearMeasureDlg:!0})},a.hideClearMeasureDlg=function(){a.setState({visibleClearMeasureDlg:!1})},a.confirmClearMeasureDlg=function(){a.hideClearMeasureDlg(),a.dicomViewersRefs[a.props.activeDcmIndex].runTool("removetools")},a.showZippedFileDlg=function(){a.setState({visibleZippedFileDlg:!0})},a.hideZippedFileDlg=function(){a.setState({visibleZippedFileDlg:!1})},a.confirmZippedFileDlg=function(){a.hideZippedFileDlg(),a.setState({visibleFileManager:!0},(function(){console.log("this.url: ",a.url),null!==a.url?a.setState({visibleDownloadZipDlg:!0}):a.props.setFsZippedFile(a.file)}))},a.showAbout=function(){a.setState({visibleAbout:!a.state.visibleAbout})},a.showSettings=function(){a.setState({visibleMainMenu:!1,visibleSettings:!0,visibleToolbar:!1,position:"right"})},a.hideSettings=function(){a.setState({visibleMainMenu:!0,visibleSettings:!1,visibleToolbar:!0,visibleFileManager:!1,visibleDicomdir:!1})},a.handleVisibilitySettings=function(e){a.setState({visibleSettings:e})},a.hideDownloadZipDlg=function(){a.setState({visibleDownloadZipDlg:!1})},a.hideOpenMultipleFilesDlg=function(){a.setState({visibleOpenMultipleFilesDlg:!1}),a.openMultipleFilesCompleted()},a.openMultipleFilesFromList=function(e){if(null!==a.props.files){a.dicomViewersRefs[a.props.activeDcmIndex].runTool("Mohammad",a.state.totalSeries[e].files);var t=a.props.files.length;a.setState({sliceMax:t},(function(){a.mprPlanePosition(),"sagittal"===a.mprPlane?a.setState({visibleMprOrthogonal:!1,visibleMprSagittal:!0,visibleMprAxial:!1,visibleMprCoronal:!1}):"coronal"===a.mprPlane?a.setState({visibleMprOrthogonal:!1,visibleMprSagittal:!1,visibleMprAxial:!1,visibleMprCoronal:!0}):a.setState({visibleMprOrthogonal:!1,visibleMprSagittal:!1,visibleMprAxial:!0,visibleMprCoronal:!1})}))}},a.openMultipleFilesCompleted=function(){if(null!==a.props.files){a.changeLayout(1,1);var e=a.props.files.length;a.setState({sliceMax:e},(function(){}))}else console.log("openMultipleFilesCompleted, No DICOM files found.")},a.showOpenUrl=function(){a.setState({visibleOpenUrl:!0})},a.hideOpenUrl=function(e){a.setState({visibleOpenUrl:!1},(function(){if(e){if(a.hideMainMenu(),a.file=null,a.url=a.openUrlField.value,"zip"!==N(a.url))return a.dicomViewersRefs[a.props.activeDcmIndex].runTool("openurl",a.openUrlField.value);a.setState({visibleZippedFileDlg:!0})}}))},a.downloadOpenUrl=function(){a.setState({visibleOpenUrl:!1,visibleToolbar:!0})},a.resetImage=function(){a.dicomViewersRefs[a.props.activeDcmIndex].runTool("reset")},a.saveShot=function(){a.dicomViewersRefs[a.props.activeDcmIndex].runTool("saveas")},a.cinePlayer=function(){a.dicomViewersRefs[a.props.activeDcmIndex].runTool("cine")},a.clear=function(){a.setState({openImageEdit:!1,openTools:!1,openMpr:!1,visibleToolbox:!1,visibleMeasure:!1,visibleHeader:!1,visibleDicomdir:!1}),a.changeLayout(1,1),a.props.setFilesStore(null),a.props.setDicomdirStore(null),a.props.clearingStore(),a.dicomViewersRefs[a.props.activeDcmIndex].runTool("clear")},a.handleLayout=function(e){a.state.openLayout?a.setState({anchorElLayout:null,openLayout:!1}):a.setState({anchorElLayout:e.currentTarget,openLayout:!0})},a.closeLayout=function(){a.setState({anchorElLayout:null,openLayout:!1})},a.changeLayout=function(e,t){if(e<a.props.layout[0]||t<a.props.layout[1]){a.layoutGridClick(0);for(var n=0;n<4;n++)for(var o=0;o<4;o++)if(n+1>e||o+1>t){var r=4*n+o;a.dicomViewersRefs[r]}}console.log("change layout end: -----------",a.props.layout[0]),a.props.setLayoutStore(e,t)},a.toolExecute=function(e){switch(a.hideMainMenu(),e){case"notool":oa=null,a.setState({toolState:null});break;case"Wwwc":oa=De.b;break;case"Pan":oa=De.q;break;case"Zoom":oa=De.J;break;case"Length":oa=De.O;break;case"Probe":oa=De.w;break;case"Angle":oa=De.a;break;case"EllipticalRoi":oa=De.u;break;case"RectangleRoi":oa=De.M;break;case"FreehandRoi":oa=De.F}a.props.toolStore(e),a.dicomViewersRefs[a.props.activeDcmIndex].runTool(e)},a.toolChange=function(){var e=1-a.state.toolState;a.setState({toolState:e},(function(){a.changeTool.changeTool(a.props.tool,e)}))},a.toolRemove=function(e){a.dicomViewersRefs[a.props.activeDcmIndex].runTool("removetool",e)},a.toggleOpenMenu=function(e){a.state.openMenu?a.setState({openMenu:!a.state.openMenu,anchorEl:null}):a.setState({openMenu:!a.state.openMenu,anchorEl:e.currentTarget})},a.toggleImageEdit=function(e){a.state.anchorElImageEdit?a.setState({openImageEdit:!a.state.openImageEdit,anchorElImageEdit:null}):a.setState({openImageEdit:!a.state.openImageEdit,anchorElImageEdit:e.currentTarget})},a.toggleTools=function(){a.setState({openTools:!a.state.openTools})},a.toggleMpr=function(e){a.state.openMpr?a.setState({openMpr:!a.state.openMpr,anchorElMpr:null}):a.setState({openMpr:!a.state.openMpr,anchorElMpr:e.currentTarget})},a.layoutListClick=function(e){console.log("indexxxxxxxxxx : "+e),a.mprSliceIndex[a.props.activeDcmIndex]=a.state.sliceIndex,a.files=a.state.totalSeries[e].files,a.openMultipleFilesFromList(e)},a.layoutGridClick=function(e){if(!R.isMobile||e!==a.props.activeDcmIndex){if(a.mprSliceIndex[a.props.activeDcmIndex]=a.state.sliceIndex,a.props.setActiveDcmIndex(e),a.state.visibleMprOrthogonal)if(0===e){var t=null===a.props.files?1:a.props.files.length;a.setState({sliceMax:t,sliceIndex:a.mprSliceIndex[0]})}else if(1===e){var n=a.props.files[0].image.columns;a.setState({sliceMax:n,sliceIndex:a.mprSliceIndex[1]})}else if(2===e){var o=a.props.files[0].image.rows;a.setState({sliceMax:o,sliceIndex:a.mprSliceIndex[2]})}var r=a.getDcmViewerRef(e);a.props.setActiveMeasurements(r.measurements),a.props.setActiveDcm({image:r.image,element:r.dicomImage,isDicom:r.isDicom})}},a.layoutGridTouch=function(e){if(R.isMobile||e!==a.props.activeDcmIndex){if(a.mprSliceIndex[a.props.activeDcmIndex]=a.state.sliceIndex,a.props.setActiveDcmIndex(e),a.state.visibleMprOrthogonal)if(0===e){var t=null===a.props.files?1:a.props.files.length;a.setState({sliceMax:t,sliceIndex:a.mprSliceIndex[0]})}else if(1===e){var n=a.props.files[0].image.columns;a.setState({sliceMax:n,sliceIndex:a.mprSliceIndex[1]})}else if(2===e){var o=a.props.files[0].image.rows;a.setState({sliceMax:o,sliceIndex:a.mprSliceIndex[2]})}var r=a.getDcmViewerRef(e);a.props.setActiveMeasurements(r.measurements),a.props.setActiveDcm({image:r.image,element:r.dicomImage,isDicom:r.isDicom})}},a.buildLayoutGrid=function(){for(var e=[],t=0;t<a.props.layout[0];t++)for(var n=function(n){var r={border:1===a.props.layout[0]&&1===a.props.layout[1]?"solid 1px #000000":"solid 1px #444444"},i=4*t+n;e.push(o.a.createElement("div",{key:i,style:r,onClick:function(){return a.layoutGridClick(i)},onTouchStart:function(){return a.layoutGridTouch(i)}},a.getDcmViewer(i)))},r=0;r<a.props.layout[1];r++)n(r);return o.a.createElement("div",{id:"dicomviewer-grid",style:{display:"grid",gridTemplateRows:"repeat(".concat(a.props.layout[0],", ").concat(100/a.props.layout[0],"%)"),gridTemplateColumns:"repeat(".concat(a.props.layout[1],", ").concat(100/a.props.layout[1],"%)"),height:"100%",width:"100%"}},e)},a.buildLayoutList=function(){for(var e=[],t=function(t){e.push(o.a.createElement(E.a,{button:!0,onClick:function(){return a.layoutListClick(t)}},o.a.createElement("row",{style:{width:"inherit"}},o.a.createElement(na,{image:a.state.totalSeries[t]?a.state.totalSeries[t].images[0]:null}),o.a.createElement("p",{style:{padding:0,margin:"5px 10px 5px 10px",color:"#e4e5e6"}},"series number: ",a.state.totalSeries[t]?a.state.totalSeries[t].seriesNumber:"{ts.seriesNumber}"))))},n=0;n<a.state.seriesCounter;n++)t(n);return o.a.createElement("div",{id:"dicomviewer-grid1",style:{display:"flex",height:"100%",width:"inherit"}},o.a.createElement(b.a,{dense:!0},e))},a.getFileName=function(e){return e.filename},a.getStringVisiblePlane=function(){return a.state.visibleMprOrthogonal?"orthogonal":a.state.visibleMprSagittal?"sagittal":a.state.visibleMprAxial?"axial":a.state.visibleMprCoronal?"coronal":void 0},a.appBarTitle=function(e,t,n){if(R.isMobile&&!R.isTablet)return t?null:o.a.createElement(me.a,{variant:"overline",className:e.title},o.a.createElement("strong",null,"U"),"niversal ",o.a.createElement("strong",null,"D"),"icom ",o.a.createElement("strong",null,"V"),"iewer");if(t){var r=a.getStringVisiblePlane();return a.state.sliceMax>1&&a.mprPlane!==r&&""!==a.mprPlane?o.a.createElement(me.a,{variant:"overline",className:e.title},"MPR "+r):o.a.createElement(me.a,{variant:"overline",className:e.title},a.getFileName(n))}return null!==a.props.dicomdir?o.a.createElement(me.a,{variant:"overline",className:e.title},a.props.dicomdir.dicomdir.webkitRelativePath):o.a.createElement(me.a,{variant:"overline",className:e.title},o.a.createElement("strong",null,"U"),"niversal ",o.a.createElement("strong",null,"D"),"icom ",o.a.createElement("strong",null,"V"),"iewer")},a.getImageOrientationZ=function(e){var t=e.data.string("x00200037").split("\\"),a=new Array(3).fill(0).map((function(){return new Array(3).fill(0)}));return a[0][0]=parseFloat(t[0]),a[0][1]=parseFloat(t[1]),a[0][2]=parseFloat(t[2]),a[1][0]=parseFloat(t[3]),a[1][1]=parseFloat(t[4]),a[1][2]=parseFloat(t[5]),a[1][2]},a.mprBuildVolume=function(){if(!(a.volume.length>0)){a.t0=performance.now();var e=a.props.files,t=function(e,t){var a=e.data.string("x00280030");if(void 0!==a)return a.split("\\")[t]}(e[0].image,0),n=function(e){var t=e.data.string("x00180088");if(void 0!==t)return parseFloat(t)}(e[0].image),o=function(e){var t=e.data.string("x00180050");if(void 0!==t)return parseFloat(t)}(e[0].image),r=e[0].image.getPixelData().length,i=function(e){var t=e.data.string("x00201041");if(void 0!==t)return parseFloat(t)}(e[0].image);a.volume=[],a.mprData.zDim=Math.round(e.length*n/t);var l=!1;if(n<o&&void 0===i){for(var s=0,c=0,m=0;m<e.length;m++)e[m].sliceDistance>s&&(s=e[m].sliceDistance),e[m].sliceDistance<c&&(c=e[m].sliceDistance);a.mprData.zDim=Math.round(Math.abs(s-c)/t),l=!0}if(e.length===a.mprData.zDim)for(var u=0,d=e.length;u<d;u++)a.volume.push(e[u].image.getPixelData());else if(e.length<a.mprData.zDim){for(var p=new Int16Array(r).fill(0),g=0,f=a.mprData.zDim;g<f;g++)a.volume.push(p);for(var v=[],h=0;h<e.length;h++)v.push({iFile:h,instanceNumber:e[h].instanceNumber,sliceDistance:e[h].sliceDistance,sliceLocation:e[h].sliceLocation});if(l)(v=v.reduce((function(e,t){return 0===e.filter((function(e){return e.sliceDistance===t.sliceDistance})).length&&e.push(t),e}),[])).sort((function(e,t){return e.instanceNumber-t.instanceNumber}));else e[0].sliceLocation<e[1].sliceLocation&&v.sort((function(e,t){return t.sliceLocation-e.sliceLocation}));var S=[0];a.volume[0]=e[v[0].iFile].image.getPixelData(),a.volume[a.mprData.zDim-1]=e[v[v.length-1].iFile].image.getPixelData();for(var b=(a.mprData.zDim-2)/(v.length-2),E=0,y=1;y<=v.length-2;y++)E=Math.ceil(E+b),a.volume[E]=e[v[y].iFile].image.getPixelData(),S.push(E);S.push(a.mprData.zDim-1),console.log("intervals: ",S);var x=H();if("no"===x)for(var I=0;I<S.length-1;I++)for(var C=S[I]+1;C<=S[I+1]-1;C++)a.volume[C]=a.volume[S[I+1]];else if("weightedlinear"===x)for(var F=0;F<S.length-1;F++)for(var D=S[F+1]-S[F],M=S[F]+1;M<S[F+1];M++){for(var w=new Int16Array(r),P=(M-S[F])/D,O=0;O<r-1;O++){var R=a.volume[S[F]][O]*(1-P),T=a.volume[S[F+1]][O]*P;w[O]=R+T,void 0!==R&&void 0!==T||console.log("undefined")}a.volume[M]=w}a.t1=performance.now(),console.log("performance volume building: ".concat(a.t1-a.t0," milliseconds"))}else{a.mprData.zStep=e.length/a.mprData.zDim;for(var k=0,L=a.mprData.zDim;k<L;k++){var A=Math.round(k*a.mprData.zStep);a.volume.push(e[A].image.getPixelData())}}a.state.visibleMprOrthogonal?a.changeToOrthogonalView():a.state.visibleMprSagittal?a.changeToSagittalView():a.state.visibleMprCoronal?a.changeToCoronalView():a.changeToAxialView()}},a.changeToOrthogonalView=function(){a.changeLayout(1,3),a.setState({visibleVolumeBuilding:!1},(function(){var e=a.mprPlanePosition(),t=Math.round(a.props.files.length/2);null===a.dicomViewersRefs[0].volume&&(a.dicomViewersRefs[0].volume=a.volume),a.mprSliceIndex[0]=t,a.dicomViewersRefs[0].runTool("openimage",t),null===a.dicomViewersRefs[1].volume&&(a.dicomViewersRefs[1].volume=a.volume);var n=Math.round(a.props.files[0].image.columns/2);a.mprSliceIndex[1]=n,a.dicomViewersRefs[1].mprRenderXZPlane(a.dicomViewersRefs[0].filename,e,n,a.mprData),null===a.dicomViewersRefs[2].volume&&(a.dicomViewersRefs[2].volume=a.volume);var o=Math.round(a.props.files[0].image.rows/2);a.mprSliceIndex[2]=o,a.dicomViewersRefs[2].mprRenderYZPlane(a.dicomViewersRefs[0].filename,e,o,a.mprData)}))},a.changeToSagittalView=function(){a.changeLayout(1,1),a.setState({visibleVolumeBuilding:!1},(function(){var e=a.mprPlanePosition();if(null===a.dicomViewersRefs[a.props.activeDcmIndex].volume&&(a.dicomViewersRefs[a.props.activeDcmIndex].volume=a.volume),"sagittal"===e){var t=null===a.props.files?1:a.props.files.length,n=Math.round(t/2);a.setState({sliceIndex:n,sliceMax:t}),a.dicomViewersRefs[a.props.activeDcmIndex].runTool("openimage",n)}else if("axial"===e){var o=a.props.files[0].image.columns,r=Math.round(o/2);a.setState({sliceIndex:r,sliceMax:o}),a.dicomViewersRefs[a.props.activeDcmIndex].mprRenderYZPlane(a.dicomViewersRefs[0].filename,e,r,a.mprData)}else{var i=a.props.files[0].image.rows,l=Math.round(i/2);a.setState({sliceIndex:l,sliceMax:i}),a.dicomViewersRefs[a.props.activeDcmIndex].mprRenderXZPlane(a.dicomViewersRefs[0].filename,e,l,a.mprData)}}))},a.changeToCoronalView=function(){a.changeLayout(1,1),a.setState({visibleVolumeBuilding:!1},(function(){var e=a.mprPlanePosition();if(null===a.dicomViewersRefs[a.props.activeDcmIndex].volume&&(a.dicomViewersRefs[a.props.activeDcmIndex].volume=a.volume),"coronal"===e){var t=null===a.props.files?1:a.props.files.length,n=Math.round(t/2);a.setState({sliceIndex:n,sliceMax:t}),a.dicomViewersRefs[a.props.activeDcmIndex].runTool("openimage",n)}else if("axial"===e){var o=a.props.files[0].image.columns,r=Math.round(o/2);a.setState({sliceIndex:r,sliceMax:o}),a.dicomViewersRefs[a.props.activeDcmIndex].mprRenderXZPlane(a.dicomViewersRefs[0].filename,e,r,a.mprData)}else{var i=a.props.files[0].image.rows,l=Math.round(i/2);a.setState({sliceIndex:l,sliceMax:i}),a.dicomViewersRefs[a.props.activeDcmIndex].mprRenderYZPlane(a.dicomViewersRefs[0].filename,e,l,a.mprData)}}))},a.changeToAxialView=function(){a.changeLayout(1,1),a.setState({visibleVolumeBuilding:!1},(function(){var e=a.mprPlanePosition();if(null===a.dicomViewersRefs[a.props.activeDcmIndex].volume&&(a.dicomViewersRefs[a.props.activeDcmIndex].volume=a.volume),"axial"===e){var t=null===a.props.files?1:a.props.files.length,n=Math.round(t/2);a.setState({sliceIndex:n,sliceMax:t}),a.dicomViewersRefs[a.props.activeDcmIndex].runTool("openimage",n)}else if("sagittal"===e){var o=a.props.files[0].image.columns,r=Math.round(o/2);a.setState({sliceIndex:r,sliceMax:o}),a.dicomViewersRefs[a.props.activeDcmIndex].mprRenderXZPlane(a.dicomViewersRefs[0].filename,e,r,a.mprData)}else{var i=a.props.files[0].image.rows,l=Math.round(i/2);a.setState({sliceIndex:l,sliceMax:i}),a.dicomViewersRefs[a.props.activeDcmIndex].mprRenderYZPlane(a.dicomViewersRefs[0].filename,e,l,a.mprData)}}))},a.mprPlanePosition=function(){return""===a.mprPlane&&(a.mprPlane=a.dicomViewersRefs[a.props.activeDcmIndex].mprPlanePosition()),a.mprPlane},a.mprOrthogonal=function(){if(!a.state.visibleMprOrthogonal){var e=Math.round(a.props.files.length/2);a.setState({sliceIndex:e}),a.setState({visibleMprOrthogonal:!0,visibleMprCoronal:!1,visibleMprSagittal:!1,visibleMprAxial:!1},(function(){0===a.volume.length?a.setState({visibleVolumeBuilding:!0},(function(){setTimeout((function(){a.mprBuildVolume()}),100)})):a.changeToOrthogonalView()}))}},a.mprSagittal=function(){a.state.visibleMprSagittal||a.setState({visibleMprOrthogonal:!1,visibleMprSagittal:!0,visibleMprCoronal:!1,visibleMprAxial:!1},(function(){0===a.volume.length?a.setState({visibleVolumeBuilding:!0},(function(){setTimeout((function(){a.mprBuildVolume()}),100)})):a.changeToSagittalView()}))},a.mprCoronal=function(){a.state.visibleMprCoronal||a.setState({visibleMprOrthogonal:!1,visibleMprSagittal:!1,visibleMprCoronal:!0,visibleMprAxial:!1},(function(){0===a.volume.length?a.setState({visibleVolumeBuilding:!0},(function(){setTimeout((function(){a.mprBuildVolume()}),100)})):a.changeToCoronalView()}))},a.mprAxial=function(){a.state.visibleMprAxial||a.setState({visibleMprOrthogonal:!1,visibleMprSagittal:!1,visibleMprCoronal:!1,visibleMprAxial:!0},(function(){0===a.volume.length?a.setState({visibleVolumeBuilding:!0},(function(){setTimeout((function(){a.mprBuildVolume()}),100)})):a.changeToAxialView()}))},a.listOpenFilesFirstFrame=function(){a.setState({sliceIndex:0},(function(){a.handleOpenImage(0)}))},a.listOpenFilesPreviousFrame=function(){var e=a.state.sliceIndex;e=0===e?a.state.sliceMax-1:e-1,a.setState({sliceIndex:e},(function(){a.handleOpenImage(e)}))},a.listOpenFilesNextFrame=function(){var e=a.state.sliceIndex;e=e===a.state.sliceMax-1?0:e+1,a.setState({sliceIndex:e},(function(){a.handleOpenImage(e)}))},a.listOpenFilesLastFrame=function(){var e=a.state.sliceMax-1;a.setState({sliceIndex:e},(function(){a.handleOpenImage(e)}))},a.listOpenFilesScrolling=function(){var e=a.state.listOpenFilesScrolling;a.setState({listOpenFilesScrolling:!e},(function(){e?clearInterval(a.timerScrolling):a.timerScrolling=setInterval((function(){a.listOpenFilesNextFrame()}),500)}))},a.handleSliceChange=function(e,t){console.log("slice value: ",Math.floor(t)),a.setState({sliceIndex:Math.floor(t)},(function(){var e=a.state.sliceIndex;a.props.setLocalFileStore(a.files[e]),a.handleOpenImage(e)}))},a.dicomImageRef=function(e){a.dicomImage=e},a.files=[],a.file=null,a.url=null,a.dicomImage=null,a.imageId=null,a.image=null,a.mprData={},a.mprPlane="",a.volume=[],a.mprSliceIndex=[0,0,0],a.fileOpen=o.a.createRef(),a.showFileOpen=a.showFileOpen.bind(Object(p.a)(a)),a.openDicomdir=o.a.createRef(),a.showOpenDicomdir=a.showOpenDicomdir.bind(Object(p.a)(a)),a.openFolder=o.a.createRef(),a.showOpenFolder=a.showOpenFolder.bind(Object(p.a)(a)),a.openUrlField=o.a.createRef(),a.dicomViewersRefs=[],a.dicomViewers=[];for(var n=0;n<16;n++)a.dicomViewers.push(a.setDcmViewer(n,0));return a.seriesListDicomViewersRefs=[],a.seriesListDicomViewers=[],a.seriesCounter=0,a}return Object(g.a)(t,e),Object(m.a)(t,[{key:"showFileOpen",value:function(){this.props.isOpenStore(!1),this.fileOpen.current.click()}},{key:"showOpenFolder",value:function(){this.openFolder.current.click()}},{key:"showOpenDicomdir",value:function(){this.openDicomdir.current.click()}},{key:"handleOpenFolder",value:function(e){var t,a,n,o,r,i,l=this;return s.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:t=[],a=[],n=0,o=function(o){var r,i,c;return s.a.async((function(m){for(;;)switch(m.prev=m.next){case 0:if(l.files.push(e[o]),void 0===e[o]){m.next=10;break}return r=Se.wadouri.fileManager.add(e[o]),m.next=5,s.a.awrap(pe.loadImage(r).then((function(e){return e})));case 5:i=m.sent,c=i.data.string("x00200011"),t.includes(c)?a.forEach((function(t){t.seriesNumber===c&&(t.images.push(i),t.files.push(e[o]))})):(t.push(c),a.push({seriesNumber:c,images:[i],files:[e[o]]}),n++),m.next=11;break;case 10:console.log("file is undefinde");case 11:case"end":return m.stop()}}))},r=0;case 5:if(!(r<e.length)){c.next=11;break}return c.next=8,s.a.awrap(o(r));case 8:r++,c.next=5;break;case 11:for(this.changeLayout(1,1),this.mprPlane="",this.volume=[],i=0;i<16;i++)void 0!==this.dicomViewersRefs[i]&&this.dicomViewersRefs[i].runTool("clear");this.setState({visibleExplorer:!0,totalSeries:a,seriesCounter:n,seriesListDicomViewers:this.seriesListDicomViewers,sliceIndex:0,sliceMax:1,visibleMprOrthogonal:!1,visibleMprCoronal:!1,visibleMprSagittal:!1,visibleMprAxial:!1},(function(){l.setState({visibleOpenMultipleFilesDlg:!0})}));case 16:case"end":return c.stop()}}),null,this)}},{key:"handleOpenDicomdir",value:function(e){var t=this;this.setState({visibleDicomdir:!1},(function(){for(var a=null,n=[],o=0;o<e.length;o++)e[o].webkitRelativePath.includes("DICOMDIR")?a=e[o]:n.push(e[o]);null!==a&&(t.props.setDicomdirStore({origin:"local",dicomdir:a,files:n}),t.toggleDicomdir())}))}},{key:"componentDidMount",value:function(){window.scrollTo(0,0)}},{key:"render",value:function(){var e=this,t=this.props.classes,a={primary:t.listItemText},n=this.props.isOpen[this.props.activeDcmIndex],r=null!==this.props.dicomdir,i=null!==this.props.files&&this.props.files.length>1,l=this.state.openMenu,s=this.state.openImageEdit,c=this.state.openMpr&&i&&""!==this.mprPlane,m=this.state.visibleHeader,u=this.state.visibleSettings,d=this.state.visibleAbout,p=this.state.visibleMeasure,g=this.state.visibleToolbox,f=this.state.visibleDicomdir,v=this.state.visibleFileManager,h=this.state.visibleClearMeasureDlg,S=this.state.visibleZippedFileDlg,x=this.state.visibleDownloadZipDlg,I=this.state.visibleOpenMultipleFilesDlg,C=this.state.visibleVolumeBuilding,D=this.state.visibleMprOrthogonal,w=this.state.visibleMprCoronal,P=this.state.visibleMprSagittal,O=this.state.visibleMprAxial,T=1===this.state.toolState?"#FFFFFF":"#999999",L=this.getActiveDcmViewer(),A=this.state.anchorEl,z=this.state.anchorElMpr,V=this.state.anchorElImageEdit,B=this.state.visibleSeries,N=this.state.anchorElLayout,j=function(){e.setState({anchorElLayout:null})};return o.a.createElement("div",null,o.a.createElement(qe.a,{className:t.appBar,position:"static",elevation:0},o.a.createElement(Ve.a,{variant:"dense"},o.a.createElement(me.a,{variant:"overline",className:t.title},o.a.createElement("strong",null,"M"),"ed",o.a.createElement("strong",null,"K"),"av"),o.a.createElement(Gt.a,{orientation:"vertical",style:{display:"list-item",backgroundColor:"#fff"},flexItem:!0}),o.a.createElement(Pt.a,{title:"File Manager",arrow:!0},o.a.createElement(Fe.a,{button:!0,onClick:function(){return e.toggleFileManager()},style:{marginLeft:"16px"}},o.a.createElement(Ce.a,{path:De.x,size:"1.2rem",color:"#FFFFFF"}))),o.a.createElement(Pt.a,{title:"Open",arrow:!0},o.a.createElement(Fe.a,{button:!0,onClick:function(t){return e.toggleOpenMenu(t)}},o.a.createElement(Ce.a,{path:De.B,size:"1.2rem",color:"#FFFFFF"}),l?o.a.createElement(F.a,null):o.a.createElement(M.a,null))),o.a.createElement(Kt.a,{open:l,anchorEl:A,role:void 0,transition:!0,disablePortal:!0,style:{backgroundColor:"#70c4c5"},placement:"center-top"},(function(t){var n=t.TransitionProps,r=t.placement;return o.a.createElement($t.a,Object.assign({},n,{style:{transformOrigin:"bottom"===r?"center top":"center bottom"}}),o.a.createElement(xt.a,{style:{backgroundColor:"#70c4c5",borderRadius:"0 0 4px 4px"}},o.a.createElement(ea.a,{onClickAway:function(t){return e.toggleOpenMenu(t)}},o.a.createElement(ta.a,{autoFocusItem:l,style:{padding:"0"},id:"menu-list-grow",onKeyDown:function(t){return e.toggleOpenMenu(t)}},o.a.createElement(Qt.a,{disabled:!0,button:!0,onClick:function(){return e.showFileOpen()}},o.a.createElement(Wt.a,null,o.a.createElement(Ce.a,{path:De.A,size:"1.0rem",color:"#FFFFFF"})),o.a.createElement(y.a,{classes:a,primary:o.a.createElement(me.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-20px"}},"File")})),o.a.createElement(Qt.a,{disabled:!0,button:!0,onClick:function(){return e.showOpenUrl()}},o.a.createElement(Wt.a,null,o.a.createElement(Ce.a,{path:De.Z,size:"1.0rem",color:"#FFFFFF"})),o.a.createElement(y.a,{classes:a,primary:o.a.createElement(me.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-20px"}},"URL")})),k()&&!R.isMobile?o.a.createElement(Qt.a,{button:!0,onClick:function(){return e.showOpenFolder()}},o.a.createElement(Wt.a,null,o.a.createElement(Ce.a,{path:De.C,size:"1.0rem",color:"#FFFFFF"})),o.a.createElement(y.a,{classes:a,primary:o.a.createElement(me.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-20px"}},"Folder")})):null,k()&&!R.isMobile?o.a.createElement(Qt.a,{disabled:!0,button:!0,onClick:function(){return e.showOpenDicomdir()}},o.a.createElement(Wt.a,null,o.a.createElement(Ce.a,{path:De.C,size:"1.0rem",color:"#FFFFFF"})),o.a.createElement(y.a,{classes:a,primary:o.a.createElement(me.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-20px"}},"DICOMDIR")})):null))))})),o.a.createElement(Pt.a,{title:"Clear All",arrow:!0},o.a.createElement(Fe.a,{button:!0,onClick:function(){return e.clear()}},o.a.createElement(Ce.a,{path:De.r,size:"1.2rem",color:"#FFFFFF"}))),o.a.createElement(Pt.a,{title:"Layout",arrow:!0},o.a.createElement(Fe.a,{button:!0,onClick:function(t){e.setState({anchorElLayout:t.currentTarget})}},o.a.createElement(Ce.a,{path:De.Y,size:"1.2rem",color:"#FFFFFF"}))),o.a.createElement(Kt.a,{open:Boolean(N),anchorEl:N,role:void 0,transition:!0,disablePortal:!0,style:{backgroundColor:"#70c4c5",marginTop:"3px"},placement:"center-top"},(function(t){var a=t.TransitionProps,n=t.placement;return o.a.createElement($t.a,Object.assign({},a,{style:{transformOrigin:"bottom"===n?"center top":"center bottom"}}),o.a.createElement(xt.a,{style:{backgroundColor:"#70c4c5",borderRadius:"0 0 4px 4px"}},o.a.createElement(ea.a,{onClickAway:j},o.a.createElement(bt,{row:e.props.layout[0]-1,col:e.props.layout[1]-1,onChange:e.changeLayout}))))})),o.a.createElement(Pt.a,{title:"Settings",arrow:!0},o.a.createElement(Fe.a,{button:!0,onClick:function(){return e.showSettings()}},o.a.createElement(Ce.a,{path:De.P,size:"1.2rem",color:"#FFFFFF"}))),o.a.createElement("div",{className:t.grow}),n||r?null:o.a.createElement(Fe.a,{onClick:this.showAbout},o.a.createElement(Ce.a,{path:De.H,size:"1.2rem",color:"#FFFFFF"})),null!==oa&&null!==this.props.tool&&n?o.a.createElement(Fe.a,{onClick:this.toolChange},o.a.createElement(Ce.a,{path:oa,size:"1.2rem",color:T})):null,n&&L.numberOfFrames>1&&n?o.a.createElement(Fe.a,{onClick:this.cinePlayer},o.a.createElement(Ce.a,{path:De.X,size:"1.2rem",color:"#FFFFFF"})):null,n?o.a.createElement(Fe.a,{onClick:this.resetImage},o.a.createElement(Ce.a,{path:De.N,size:"1.2rem",color:"#FFFFFF"})):null,n?o.a.createElement(Fe.a,{color:"inherit",onClick:this.saveShot},o.a.createElement(Ce.a,{path:De.e,size:"1.2rem",color:"#FFFFFF"})):null,n?o.a.createElement(Fe.a,{color:"inherit",onClick:this.toggleToolbox},o.a.createElement(Ce.a,{path:De.V,size:"1.2rem",color:"#FFFFFF"})):null,n?o.a.createElement(Fe.a,{color:"inherit",onClick:this.toggleMeasure},o.a.createElement(Ce.a,{path:De.y,size:"1.2rem",color:"#FFFFFF"})):null,n&&L.isDicom?o.a.createElement(Fe.a,{color:"inherit",onClick:this.toggleHeader},o.a.createElement(Ce.a,{path:De.z,size:"1.2rem",color:"#FFFFFF"})):null,r?o.a.createElement(Fe.a,{color:"inherit",onClick:this.toggleDicomdir},o.a.createElement(Ce.a,{path:De.C,size:"1.2rem",color:"#FFFFFF"})):null,n?o.a.createElement(Fe.a,{color:"inherit",onClick:this.toggleFileManager},o.a.createElement(Ce.a,{path:De.x,size:"1.2rem",color:"#FFFFFF"})):null)),o.a.createElement(qt.a,{direction:"up",in:this.state.visibleExplorer,mountOnEnter:!0,unmountOnExit:!0},o.a.createElement(aa.a,{className:t.toolbarCard,position:"fixed",elevation:0},o.a.createElement(Ve.a,{variant:"dense",style:{justifyContent:"center"}},o.a.createElement(Pt.a,{title:"Histogram",placement:"top",arrow:!0},o.a.createElement(Fe.a,{button:!0,onClick:function(){return e.toggleToolbox()},disabled:!n},o.a.createElement(Ce.a,{path:De.f,size:"1.2rem",color:"#FFFFFF"}))),o.a.createElement(Pt.a,{title:"MPR",placement:"top",arrow:!0},o.a.createElement(Fe.a,{button:!0,onClick:function(t){return e.toggleMpr(t)},disabled:!n||!i||""===this.mprPlane},o.a.createElement(Ce.a,{path:De.d,size:"1.2rem",color:"#FFFFFF"}),c?o.a.createElement(M.a,null):o.a.createElement(F.a,null))),o.a.createElement(Kt.a,{open:c,anchorEl:z,role:void 0,transition:!0,disablePortal:!0},(function(t){var n=t.TransitionProps,r=t.placement;return o.a.createElement($t.a,Object.assign({},n,{style:{transformOrigin:"bottom"===r?"center top":"center bottom"}}),o.a.createElement(xt.a,null,o.a.createElement(ea.a,{onClickAway:function(){return e.toggleMpr()}},o.a.createElement(ta.a,{dense:!0,component:"div"},o.a.createElement(Qt.a,{button:!0,style:{paddingLeft:40},onClick:function(){return e.mprOrthogonal()}},D?o.a.createElement(Wt.a,{style:{marginLeft:"-10px"}},o.a.createElement(Ce.a,{path:De.g,size:"1.0rem",color:"#FFFFFF"})):null,o.a.createElement(y.a,{style:D?{marginLeft:"-7px"}:{marginLeft:"40px"},classes:a,primary:o.a.createElement(me.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-23px"}},"Orthogonal")})),o.a.createElement(Qt.a,{button:!0,style:{paddingLeft:40},onClick:function(){return e.mprCoronal()}},w?o.a.createElement(Wt.a,{style:{marginLeft:"-10px"}},o.a.createElement(Ce.a,{path:De.g,size:"1.0rem",color:"#FFFFFF"})):null,o.a.createElement(y.a,{style:w?{marginLeft:"-7px"}:{marginLeft:"40px"},classes:a,primary:o.a.createElement(me.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-23px"}},"Coronal")})),o.a.createElement(Qt.a,{button:!0,style:{paddingLeft:40},onClick:function(){return e.mprSagittal()}},P?o.a.createElement(Wt.a,{style:{marginLeft:"-10px"}},o.a.createElement(Ce.a,{path:De.g,size:"1.0rem",color:"#FFFFFF"})):null,o.a.createElement(y.a,{style:P?{marginLeft:"-7px"}:{marginLeft:"40px"},classes:a,primary:o.a.createElement(me.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-23px"}},"Sagittal")})),o.a.createElement(Qt.a,{button:!0,style:{paddingLeft:40},onClick:function(){return e.mprAxial()}},O?o.a.createElement(Wt.a,{style:{marginLeft:"-10px"}},o.a.createElement(Ce.a,{path:De.g,size:"1.0rem",color:"#FFFFFF"})):null,o.a.createElement(y.a,{style:O?{marginLeft:"-7px"}:{marginLeft:"40px"},classes:a,primary:o.a.createElement(me.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-23px"}},"Axial")}))))))})),o.a.createElement(Pt.a,{title:"Edit",placement:"top",arrow:!0},o.a.createElement(Fe.a,{button:!0,onClick:function(t){return e.toggleImageEdit(t)},disabled:!n},o.a.createElement(Ce.a,{path:De.G,size:"1.2rem",color:"#FFFFFF"}),s?o.a.createElement(M.a,null):o.a.createElement(F.a,null))),o.a.createElement(Kt.a,{open:Boolean(V),anchorEl:V,role:void 0,transition:!0,style:{backgroundColor:"#70c4c5"},placement:"top"},(function(t){var n=t.TransitionProps,r=t.placement;return o.a.createElement($t.a,Object.assign({},n,{style:{transformOrigin:"bottom"===r?"center top":"center bottom"}}),o.a.createElement(xt.a,{style:{backgroundColor:"#70c4c5"}},o.a.createElement(ea.a,{onClickAway:function(t){return e.toggleImageEdit(t)}},o.a.createElement(ta.a,{dense:!0,component:"div",style:{padding:"0"}},o.a.createElement(Qt.a,{button:!0,onClick:function(){return e.toolExecute("Invert")}},o.a.createElement(Wt.a,null,o.a.createElement(Ce.a,{path:De.I,size:"1.2rem",color:"#FFFFFF"})),o.a.createElement(y.a,{classes:a,primary:"Invert"}))))))})),o.a.createElement(Gt.a,{orientation:"vertical",style:{display:"list-item",backgroundColor:"#fff"}}),o.a.createElement(Pt.a,{title:"No tool",placement:"top",arrow:!0},o.a.createElement(Fe.a,{button:!0,onClick:function(){return e.toolExecute("notool")},disabled:!n},o.a.createElement(Ce.a,{path:De.p,size:"1.2rem",color:"#FFFFFF"}))),o.a.createElement(Pt.a,{title:"WW/WC",placement:"top",arrow:!0},o.a.createElement(Fe.a,{button:!0,onClick:function(){return e.toolExecute("Wwwc")},disabled:!n},o.a.createElement(Ce.a,{path:De.b,size:"1.2rem",color:"#FFFFFF"}))),o.a.createElement(Pt.a,{title:"Pan",placement:"top",arrow:!0},o.a.createElement(Fe.a,{button:!0,onClick:function(){return e.toolExecute("Pan")},disabled:!n},o.a.createElement(Ce.a,{path:De.q,size:"1.2rem",color:"#FFFFFF"}))),o.a.createElement(Pt.a,{title:"Zoom",placement:"top",arrow:!0},o.a.createElement(Fe.a,{button:!0,onClick:function(){return e.toolExecute("Zoom")},disabled:!n},o.a.createElement(Ce.a,{path:De.J,size:"1.2rem",color:"#FFFFFF"}))),o.a.createElement(Pt.a,{title:"Magnify",placement:"top",arrow:!0},o.a.createElement(Fe.a,{button:!0,onClick:function(){return e.toolExecute("Magnify")},disabled:!n},o.a.createElement(Ce.a,{path:De.i,size:"1.2rem",color:"#FFFFFF"}))),o.a.createElement(Pt.a,{title:"Length",placement:"top",arrow:!0},o.a.createElement(Fe.a,{button:!0,onClick:function(){return e.toolExecute("Length")},disabled:!n},o.a.createElement(Ce.a,{path:De.O,size:"1.2rem",color:"#FFFFFF"}))),o.a.createElement(Pt.a,{title:"Probe",placement:"top",arrow:!0},o.a.createElement(Fe.a,{button:!0,onClick:function(){return e.toolExecute("Probe")},disabled:!n},o.a.createElement(Ce.a,{path:De.w,size:"1.2rem",color:"#FFFFFF"}))),o.a.createElement(Pt.a,{title:"Angle",placement:"top",arrow:!0},o.a.createElement(Fe.a,{button:!0,onClick:function(){return e.toolExecute("Angle")},disabled:!n},o.a.createElement(Ce.a,{path:De.a,size:"1.2rem",color:"#FFFFFF"}))),o.a.createElement(Pt.a,{title:"Elliptical Roi",placement:"top",arrow:!0},o.a.createElement(Fe.a,{button:!0,onClick:function(){return e.toolExecute("EllipticalRoi")},disabled:!n},o.a.createElement(Ce.a,{path:De.u,size:"1.2rem",color:"#FFFFFF"}))),o.a.createElement(Pt.a,{title:"Rectangle Roi",placement:"top",arrow:!0},o.a.createElement(Fe.a,{button:!0,onClick:function(){return e.toolExecute("RectangleRoi")},disabled:!n},o.a.createElement(Ce.a,{path:De.M,size:"1.2rem",color:"#FFFFFF"}))),o.a.createElement(Pt.a,{title:"Freehand Roi",placement:"top",arrow:!0},o.a.createElement(Fe.a,{button:!0,onClick:function(){return e.toolExecute("FreehandRoi")},disabled:!n},o.a.createElement(Ce.a,{path:De.F,size:"1.2rem",color:"#FFFFFF"})))))),o.a.createElement(Zt.a,{variant:"persistent",open:B,style:{position:"relative",zIndex:1},onClose:this.toggleSeriesMenu},o.a.createElement("div",{className:t.toolbar,style:{marginTop:"48px"}},o.a.createElement(b.a,{dense:!0},o.a.createElement(E.a,{button:!0,onClick:function(){return e.toggleSeriesMenu()}},o.a.createElement(Wt.a,null,o.a.createElement(Ce.a,{path:De.c,size:"1.2rem",color:"#FFFFFF"})),o.a.createElement(y.a,{classes:a,primary:"Hide Series"})),o.a.createElement(Gt.a,null),this.buildLayoutList()))),o.a.createElement(Zt.a,{variant:"persistent",anchor:"right",open:m,onClose:this.toggleHeader},m?o.a.createElement(Be,{dcmViewer:L,classes:t,color:"#FFFFFF"}):null),o.a.createElement(Zt.a,{variant:"persistent",anchor:"right",open:p,onClose:this.toggleMeasure},o.a.createElement("div",{style:{marginTop:"48px"}},o.a.createElement(Ve.a,{variant:"dense"},o.a.createElement(me.a,{variant:"subtitle1",className:t.title},"Measurements\xa0\xa0"),o.a.createElement("div",{className:t.grow}),o.a.createElement(Fe.a,{color:"inherit",onClick:this.saveMeasure,edge:"end"},o.a.createElement(Ce.a,{path:De.o,size:"1.2rem",color:"#FFFFFF"})),o.a.createElement(Fe.a,{color:"inherit",onClick:this.clearMeasure,edge:"end"},o.a.createElement(Ce.a,{path:De.W,size:"1.2rem",color:"#FFFFFF"}))),o.a.createElement("div",null,n?o.a.createElement(_e,{dcmViewer:L,toolRemove:this.toolRemove,classes:t}):null))),o.a.createElement(Zt.a,{variant:"persistent",anchor:"right",open:g,onClose:this.toggleToolbox},o.a.createElement("div",{style:{marginTop:"48px"}},o.a.createElement("div",null,n?o.a.createElement(vt,{key:this.getFileName(L)}):null))),o.a.createElement(Zt.a,{variant:"persistent",anchor:W(),open:f,onClose:this.toggleDicomdir},o.a.createElement("div",null,o.a.createElement("div",null,f?o.a.createElement(ae,{onOpenFile:this.handleOpenFileDicomdir,onOpenFs:this.handleOpenSandboxFs}):null))),o.a.createElement(Zt.a,{variant:"persistent",anchor:Z(),open:v,onClose:this.toggleFileManager},o.a.createElement("div",null,o.a.createElement("div",null,v?o.a.createElement(zt,{onOpen:this.handleOpenSandboxFs,onOpenImage:this.handleOpenImage,onOpenMultipleFilesCompleted:this.openMultipleFilesCompleted,onOpenDicomdir:this.handleOpenFsDicomdir,color:"#FFFFFF"}):null))),u?o.a.createElement(it,{onClose:this.hideSettings}):null,d?o.a.createElement(st,{onClose:this.showAbout}):null,x?o.a.createElement(Ut,{onClose:this.hideDownloadZipDlg,url:this.url}):null,I?o.a.createElement(Lt,{onClose:this.hideOpenMultipleFilesDlg,files:this.files,origin:"local"}):null,o.a.createElement(oe.a,{open:h,onClose:this.hideClearMeasureDlg},o.a.createElement(se.a,null,"Are you sure to remove all the measurements?"),o.a.createElement(re.a,null,o.a.createElement(ne.a,{onClick:this.hideClearMeasureDlg},"Cancel"),o.a.createElement(ne.a,{onClick:this.confirmClearMeasureDlg,autoFocus:!0},"Ok"))),o.a.createElement(oe.a,{open:S,onClose:this.hideZippedFileDlg},o.a.createElement(se.a,null,"This is a zipped file, would you import into sandbox file system?"),o.a.createElement(re.a,null,o.a.createElement(ne.a,{onClick:this.hideZippedFileDlg},"Cancel"),o.a.createElement(ne.a,{onClick:this.confirmZippedFileDlg,autoFocus:!0},"Ok"))),o.a.createElement(oe.a,{open:this.state.visibleOpenUrl,"aria-labelledby":"form-dialog-title"},o.a.createElement(se.a,{id:"form-dialog-title"},"Open URL"),o.a.createElement(ie.a,null,o.a.createElement(le.a,{id:"alert-dialog-description"},"Insert an URL to download a DICOM or image file:"),o.a.createElement(Ze.a,{autoFocus:!0,margin:"dense",id:"id-open-url",inputRef:function(t){return e.openUrlField=t},fullWidth:!0})),o.a.createElement(re.a,null,o.a.createElement(ne.a,{onClick:function(){return e.hideOpenUrl(!1)}},"Cancel"),o.a.createElement(ne.a,{onClick:function(){return e.hideOpenUrl(!0)},autoFocus:!0},"Ok"))),o.a.createElement(Ht.a,{anchorOrigin:{vertical:"top",horizontal:"center"},open:C,autoHideDuration:6e3,message:"Volume building, wait please ..."}),o.a.createElement(Xt.a,{container:!0},o.a.createElement(Xt.a,{item:!0,xs:2},o.a.createElement(qt.a,{direction:"right",in:this.state.visibleExplorer,mountOnEnter:!0,unmountOnExit:!0},o.a.createElement("div",{className:t.rootGridList},o.a.createElement(_t.a,{cellHeight:180,className:t.gridList},this.state.totalSeries?this.state.totalSeries.map((function(t,a){return o.a.createElement(Jt.a,{key:a,cols:1,style:{height:"auto",width:"100%",padding:"16px"},button:!0,onClick:function(){return e.layoutListClick(a)}},o.a.createElement("row",{style:{width:"100%"}},o.a.createElement(na,{image:t?t.images[0]:null})),o.a.createElement(Yt.a,{style:{height:"48px"},subtitle:"series number: ".concat(t?t.seriesNumber:"{ts.seriesNumber}"),title:o.a.createElement("span",{style:{fontSize:"10px"}},"number of items: ",t.files.length)}))})):null,o.a.createElement(Jt.a,{key:"Subheader",cols:1,style:{height:"54px",width:"100%"}})),this.buildLayoutList()))),o.a.createElement(Xt.a,{item:!0,xs:10},o.a.createElement("div",{style:{height:"calc(100vh - 48px)"}},this.buildLayoutGrid()))),o.a.createElement("div",null,o.a.createElement("input",{type:"file",id:"file_open",style:{display:"none"},ref:this.fileOpen,onChange:function(t){return e.handleOpenLocalFs(t.target.files)},multiple:!0})),o.a.createElement("div",null,o.a.createElement("input",{type:"file",id:"file_dicomdir",style:{display:"none"},ref:this.openDicomdir,onChange:function(t){return e.handleOpenDicomdir(t.target.files)},webkitdirectory:"",mozdirectory:"",directory:"",multiple:!0})),o.a.createElement("div",null,o.a.createElement("input",{type:"file",id:"file_folder",style:{display:"none"},ref:this.openFolder,onChange:function(t){return e.handleOpenFolder(t.target.files)},webkitdirectory:"",mozdirectory:"",directory:"",multiple:!0})))}}]),t}(n.PureComponent),ia=Object(h.b)((function(e){return{localFileStore:e.localFileStore,files:e.files,isOpen:e.isOpen,tool:e.tool,activeDcmIndex:e.activeDcmIndex,measurements:e.measurements,layout:e.layout,dicomdir:e.dicomdir,fsZippedFile:e.fsZippedFile}}),(function(e){return{clearingStore:function(){return e({type:"CLEAR_STORE"})},setLocalFileStore:function(t){return e(function(e){return{type:"LOCALFILE_STORE",localFile:e}}(t))},toolStore:function(t){return e(q(t))},isOpenStore:function(t){return e(Y(t))},setActiveDcm:function(t){return e(Q(t))},setActiveDcmIndex:function(t){return e(function(e){return{type:"ACTIVE_DCM_INDEX",activeDcmIndex:e}}(t))},setActiveMeasurements:function(t){return e(K(t))},setLayoutStore:function(t,a){return e(function(e,t){return{type:"LAYOUT",layout:[e,t]}}(t,a))},setDicomdirStore:function(t){return e(function(e){return{type:"DICOMDIR",dicomdir:e}}(t))},setFsZippedFile:function(t){return e($(t))},setVolumeStore:function(t){return e({type:"VOLUME_STORE",volume:t})},setFilesStore:function(t){return e(J(t))}}}))(Object(v.a)((function(e){return{"@global":{body:{backgroundColor:e.palette.common.black}},grow:{flexGrow:1},root:{display:"flex"},menuButton:{marginRight:e.spacing(2)},title:{textAlign:"center",marginRight:e.spacing(2)},appBar:{position:"relative",backgroundColor:"#3d9c9f",zIndex:e.zIndex.drawer+1,transition:e.transitions.create(["width","margin"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},toolbarCard:{zIndex:e.zIndex.drawer+1,backgroundColor:"#3d9c9f",position:"absolute",margin:"0 20% 0 20%",transition:e.transitions.create(["width","margin"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),top:"auto",bottom:0,right:0,left:0},appBarShift:{marginLeft:240,width:"calc(100% - ".concat(240,"px)"),transition:e.transitions.create(["width","margin"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.enteringScreen})},hide:{display:"none"},drawer:{width:240,flexShrink:0,whiteSpace:"nowrap"},drawerOpen:{width:240,transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.enteringScreen})},drawerClose:Object(f.a)({transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),overflowX:"hidden",width:e.spacing(7)+1},e.breakpoints.up("sm"),{width:e.spacing(9)+1}),toolbar:e.mixins.toolbar,content:{flexGrow:1,padding:e.spacing(3)},listItemText:{fontSize:"0.85em",marginLeft:"-20px"},rootGridList:{display:"flex",flexWrap:"wrap",justifyContent:"space-around",overflow:"hidden",height:"100%",backgroundColor:"#e4e5e655"},gridList:{width:500,height:"100vh"},icon:{color:"rgba(255, 255, 255, 0.54)"}}}))(ra)),la=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function sa(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var ca=a(181),ma=a.n(ca),ua=a(98),da=a(127);var pa={localFile:null,fsFile:null,files:null,isOpen:new Array(16).fill(!1),tool:null,activeDcmIndex:0,activeDcm:null,measurements:[],layout:[1,1],dicomdir:null,fsCurrentDir:"",fsCurrentList:[],fsZippedFile:null,fsRefresh:!1,volume:null},ga=Object(ua.b)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CLEAR_STORE":return{localFile:e.localFile,fsFile:e.fsFile,files:null,isOpen:e.isOpen.map((function(t,a){return a!==e.activeDcmIndex&&t})),tool:null,activeDcmIndex:e.activeDcmIndex,activeDcm:e.activeDcm,measurements:null,layout:e.layout,dicomdir:e.dicomdir,fsCurrentDir:e.fsCurrentDir,fsCurrentList:e.fsCurrentList,fsZippedFile:null,fsRefresh:e.fsRefresh,volume:null,lut:null};case"LOCALFILE_STORE":return Object(ze.a)({},e,{localFile:t.localFile,fsFile:null});case"LOCALFILE_STORE":return Object(ze.a)({},e,{localFile:null,fsFile:t.fsFile});case"FILES_STORE":return Object(ze.a)({},e,{files:t.files});case"DCM_IS_OPEN":return Object(ze.a)({},e,{isOpen:e.isOpen.map((function(e,a){return a===t.value.index?t.value.value:e})),measurements:e.measurements,layout:e.layout,dicomdir:e.dicomdir,fsCurrentDir:e.fsCurrentDir,fsCurrentList:e.fsCurrentList});case"DCM_TOOL":return Object(ze.a)({},e,{tool:t.tool,measurements:e.measurements,layout:e.layout,dicomdir:e.dicomdir,fsCurrentDir:e.fsCurrentDir,fsCurrentList:e.fsCurrentList});case"ACTIVE_DCM_INDEX":return Object(ze.a)({},e,{activeDcmIndex:t.activeDcmIndex,measurements:e.measurements,layout:e.layout,dicomdir:e.dicomdir,fsCurrentDir:e.fsCurrentDir,fsCurrentList:e.fsCurrentList});case"ACTIVE_DCM":return Object(ze.a)({},e,{activeDcm:t.activeDcm,measurements:e.measurements,layout:e.layout,dicomdir:e.dicomdir,fsCurrentDir:e.fsCurrentDir,fsCurrentList:e.fsCurrentList});case"ACTIVE_MEASUREMENTS":return Object(ze.a)({},e,{measurements:Object(da.a)(t.measurements)});case"LAYOUT":return Object(ze.a)({},e,{measurements:e.measurements,layout:t.layout,dicomdir:e.dicomdir,fsCurrentDir:e.fsCurrentDir,fsCurrentList:e.fsCurrentList});case"DICOMDIR":return Object(ze.a)({},e,{dicomdir:t.dicomdir});case"FSCURRENTDIR":return Object(ze.a)({},e,{fsCurrentDir:t.fsCurrentDir});case"FSCURRENTLIST":return Object(ze.a)({},e,{fsCurrentList:Object(da.a)(t.fsCurrentList)});case"FSZIPPEDFILE":return Object(ze.a)({},e,{fsZippedFile:t.fsZippedFile});case"FSREFRESH":return Object(ze.a)({},e,{fsRefresh:!e.fsRefresh});case"VOLUME_STORE":return Object(ze.a)({},e,{volume:t.volume});default:return e}}),pa,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()),fa=a(182),va=a(354);ma.a.load({google:{families:["Roboto:300,400,500,700","Material Icons"]}});var ha=Object(fa.a)({overrides:{MuiFormControlLabel:{label:{fontSize:"0.85em"}},MuiFormLabel:{root:{"&$focused":{color:"#CCCCCC"}}}},palette:{primary:{main:"#004d40"},secondary:{main:"#888888"},type:"dark"}});i.a.render(o.a.createElement(h.a,{store:ga},o.a.createElement(va.a,{theme:ha},o.a.createElement(ia,null))),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/dicom-viewer",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/dicom-viewer","/service-worker.js");la?(!function(e,t){fetch(e).then((function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):sa(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):sa(t,e)}))}}()}},[[199,1,2]]]);
//# sourceMappingURL=main.1f395c25.chunk.js.map